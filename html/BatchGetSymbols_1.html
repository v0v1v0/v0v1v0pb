<div class="container">

<table style="width: 100%;"><tr>
<td>BatchGetSymbols</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Function to download financial data</h2>

<h3>Description</h3>

<p>This function downloads financial data from Yahoo Finance using <code>getSymbols</code>.
Based on a set of tickers and a time period, the function will download the data for each ticker and return a report of the process, along with the actual data in the long dataframe format.
The main advantage of the function is that it automatically recognizes the source of the dataset from the ticker and structures the resulting data from different sources in the long format.
A caching system is also available, making it very fast.
</p>


<h3>Usage</h3>

<pre><code class="language-R">BatchGetSymbols(
  tickers,
  first.date = Sys.Date() - 30,
  last.date = Sys.Date(),
  thresh.bad.data = 0.75,
  bench.ticker = "^GSPC",
  type.return = "arit",
  freq.data = "daily",
  how.to.aggregate = "last",
  do.complete.data = FALSE,
  do.fill.missing.prices = TRUE,
  do.cache = TRUE,
  cache.folder = file.path(tempdir(), "BGS_Cache"),
  do.parallel = FALSE,
  be.quiet = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>tickers</code></td>
<td>
<p>A vector of tickers. If not sure whether the ticker is available, check the websites of google and yahoo finance. The source for downloading
the data can either be Google or Yahoo. The function automatically selects the source webpage based on the input ticker.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>first.date</code></td>
<td>
<p>The first date to download data (date or char as YYYY-MM-DD)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>last.date</code></td>
<td>
<p>The last date to download data (date or char as YYYY-MM-DD)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thresh.bad.data</code></td>
<td>
<p>A percentage threshold for defining bad data. The dates of the benchmark ticker are compared to each asset. If the percentage of non-missing dates
with respect to the benchmark ticker is lower than thresh.bad.data, the function will ignore the asset (default = 0.75)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bench.ticker</code></td>
<td>
<p>The ticker of the benchmark asset used to compare dates. My suggestion is to use the main stock index of the market from where the data is coming from (default = ^GSPC (SP500, US market))</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type.return</code></td>
<td>
<p>Type of price return to calculate: 'arit' (default) - aritmetic, 'log' - log returns.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>freq.data</code></td>
<td>
<p>Frequency of financial data ('daily', 'weekly', 'monthly', 'yearly')</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>how.to.aggregate</code></td>
<td>
<p>Defines whether to aggregate the data using the first observations of the aggregating period or last ('first', 'last').
For example, if freq.data = 'yearly' and how.to.aggregate = 'last', the last available day of the year will be used for all
aggregated values such as price.adjusted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do.complete.data</code></td>
<td>
<p>Return a complete/balanced dataset? If TRUE, all missing pairs of ticker-date will be replaced by NA or closest price (see input do.fill.missing.prices). Default = FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do.fill.missing.prices</code></td>
<td>
<p>Finds all missing prices and replaces them by their closest price with preference for the previous price. This ensures a balanced dataset for all assets, without any NA. Default = TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do.cache</code></td>
<td>
<p>Use cache system? (default = TRUE)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cache.folder</code></td>
<td>
<p>Where to save cache files? (default = file.path(tempdir(), 'BGS_Cache') )</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do.parallel</code></td>
<td>
<p>Flag for using parallel or not (default = FALSE). Before using parallel, make sure you call function future::plan() first.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>be.quiet</code></td>
<td>
<p>Logical for printing statements (default = FALSE)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list with the following items: </p>

<dl>
<dt>df.control </dt>
<dd>
<p>A dataframe containing the results of the download process for each asset</p>
</dd>
<dt>df.tickers</dt>
<dd>
<p>A dataframe with the financial data for all valid tickers</p>
</dd> </dl>
<h3>Warning</h3>

<p>Do notice that since 2019, adjusted prices are no longer available from google finance.
When using this source, the function will output NA values for this column.
</p>
<p>Also, be aware that when using cache system in a local folder (and not the default tempdir()), the aggregate prices series might not match if
a split or dividends event happens in between cache files.
</p>


<h3>See Also</h3>

<p>getSymbols
</p>


<h3>Examples</h3>

<pre><code class="language-R">tickers &lt;- c('FB','MMM')

first.date &lt;- Sys.Date()-30
last.date &lt;- Sys.Date()

l.out &lt;- BatchGetSymbols(tickers = tickers,
                         first.date = first.date,
                        last.date = last.date, do.cache=FALSE)

print(l.out$df.control)
print(l.out$df.tickers)
</code></pre>


</div>