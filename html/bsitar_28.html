<div class="container">

<table style="width: 100%;"><tr>
<td>plot_curves.bgmfit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plot growth curves</h2>

<h3>Description</h3>

<p>The <strong>plot_curves()</strong> provides visualization of six
different types of growth curves that are plotted by using the <span class="pkg">ggplot2</span>
package. The <strong>plot_curves()</strong> also allows users to make their own
detailed plots from the data returned as a <code>data.frame</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'bgmfit'
plot_curves(
  model,
  opt = "dv",
  apv = FALSE,
  bands = NULL,
  conf = 0.95,
  resp = NULL,
  ndraws = NULL,
  draw_ids = NULL,
  newdata = NULL,
  summary = TRUE,
  digits = 2,
  re_formula = NULL,
  numeric_cov_at = NULL,
  aux_variables = NULL,
  levels_id = NULL,
  avg_reffects = NULL,
  ipts = 10,
  deriv_model = TRUE,
  xrange = NULL,
  xrange_search = NULL,
  takeoff = FALSE,
  trough = FALSE,
  acgv = FALSE,
  acgv_velocity = 0.1,
  seed = 123,
  estimation_method = "fitted",
  allow_new_levels = FALSE,
  sample_new_levels = "uncertainty",
  incl_autocor = TRUE,
  robust = FALSE,
  future = FALSE,
  future_session = "multisession",
  cores = NULL,
  trim = 0,
  layout = "single",
  linecolor = NULL,
  linecolor1 = NULL,
  linecolor2 = NULL,
  label.x = NULL,
  label.y = NULL,
  legendpos = NULL,
  linetype.apv = NULL,
  linewidth.main = NULL,
  linewidth.apv = NULL,
  linetype.groupby = NA,
  color.groupby = NA,
  band.alpha = NULL,
  show_age_takeoff = TRUE,
  show_age_peak = TRUE,
  show_age_cessation = TRUE,
  show_vel_takeoff = FALSE,
  show_vel_peak = FALSE,
  show_vel_cessation = FALSE,
  returndata = FALSE,
  returndata_add_parms = FALSE,
  parms_eval = FALSE,
  idata_method = NULL,
  parms_method = "getPeak",
  verbose = FALSE,
  fullframe = NULL,
  dummy_to_factor = NULL,
  expose_function = FALSE,
  usesavedfuns = NULL,
  clearenvfuns = NULL,
  envir = NULL,
  ...
)

plot_curves(model, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>An object of class <code>bgmfit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>opt</code></td>
<td>
<p>A character string containing letter(s) corresponding to the
following plotting options: 'd' for population average distance curve, 'v'
for population average velocity curve, 'D' for individual-specific distance
curves, 'V' for individual-specific velocity curves, 'u' for unadjusted
individual-specific distance curves, and 'a' for adjusted
individual-specific distance curves (adjusted for the random effects).
Options 'd' and 'D' can not be specified simultaneously. Likewise, Options
'v' and 'V' can not be specified simultaneously. All other combinations are
allowed. For example, dvau', Dvau', dVau', DVau', or dvau'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>apv</code></td>
<td>
<p>An optional logical (default <code>FALSE</code>) specifying whether or
not to calculate and plot the age at peak velocity (APGV) when <code>opt</code>)
includes 'v' or 'V'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bands</code></td>
<td>
<p>A character string containing letter(s), or <code>NULL</code> (default)
to indicate if CI bands to be plotted around the distance and velocity
curves (and also the APGV). If <code>NULL</code>, no band plotted. Alternatively,
user can specify a string with any one of the following or their
combination(s): <code>'d'</code> for band around the distance curve, <code>'v} for
band around the velocity curve, and \code{'p</code> for band around the the
vertical line denoting the APGV parameter. The <code>'dvp'</code> will include CI
bands for distance and velocity curves, and the APGV.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conf</code></td>
<td>
<p>A numeric value (default <code>0.95</code>) to be used to compute the CI
and hence the width of the <code>bands</code>. See <code>growthparameters()</code>
for further details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resp</code></td>
<td>
<p>A character string (default <code>NULL</code>) to specify response
variable when processing posterior draws for the <code>univariate_by</code> and
<code>multivariate</code> models. See <code>bsitar()</code> for details on
<code>univariate_by</code> and <code>multivariate</code> models</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ndraws</code></td>
<td>
<p>A positive integer indicating the number of posterior draws to
be used in estimation. If <code>NULL</code> (default), all draws are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draw_ids</code></td>
<td>
<p>An integer indicating the specific posterior draw(s)
to be used in estimation (default <code>NULL</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>An optional data frame to be used in estimation. If
<code>NULL</code> (default), the <code>newdata</code> is retrieved from the
<code>model</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>summary</code></td>
<td>
<p>A logical indicating whether only the estimate should be
computed (<code>TRUE</code>, default), or estimate along with SE and CI should be
returned (<code>FALSE</code>). Setting <code>summary</code> as <code>FALSE</code> will
increase the computation time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>An integer (default <code>2</code>) to set the decimal argument for
the <code>base::round()</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>re_formula</code></td>
<td>
<p>Option to indicate whether or not to include the
individual/group-level effects in the estimation. When <code>NA</code> (default),
the individual-level effects are excluded and therefore population average
growth parameters are computed. When <code>NULL</code>, individual-level effects
are included in the computation and hence the growth parameters estimates
returned are individual-specific. In both situations, (i.e,, <code>NA</code> or
<code>NULL</code>), continuous and factor covariate(s) are appropriately included
in the estimation. The continuous covariates by default are set to their
means (see <code>numeric_cov_at</code> for details) whereas factor covariates are
left unaltered thereby allowing estimation of covariate specific population
average and individual-specific growth parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numeric_cov_at</code></td>
<td>
<p>An optional (named list) argument to specify the value
of continuous covariate(s). The default <code>NULL</code> option set the
continuous covariate(s) at their mean. Alternatively, a named list can be
supplied to manually set these values. For example, <code>numeric_cov_at =
  list(xx = 2)</code> will set the continuous covariate varibale 'xx' at 2. The
argument <code>numeric_cov_at</code> is ignored when no continuous covariate is
included in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>aux_variables</code></td>
<td>
<p>An optional argument to specify the variables to be
passed to the <code>ipts</code> argument. This is useful when fitting location
scale models and the measurement error models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>levels_id</code></td>
<td>
<p>An optional argument to specify the <code>ids</code> for
hierarchical model (default <code>NULL</code>). It is used only when model is
applied to the data with 3 or more levels of hierarchy. For a two level
model, the <code>levels_id</code> is automatically inferred from the model fit.
Even for 3 or higher level model, the <code>levels_id</code> is inferred from the
model fit but under the assumption that hierarchy is specified from lowest
to upper most level i.e, <code>id</code> followed by <code>study</code> where <code>id</code>
is nested within the <code>study</code> Note that it is not guaranteed that the
<code>levels_id</code> is sorted correctly, and therefore it is better to set it
manually when fitting a model with three or more levels of hierarchy.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avg_reffects</code></td>
<td>
<p>An optional argument (default <code>NULL</code>) to calculate
(marginal/average) curves and growth parameters such as APGV and PGV. If
specified, it must be a named list indicating the <code>over</code> (typically
level 1 predictor, such as age), <code>feby</code> (fixed effects, typically a
factor variable), and  <code>reby</code> (typically <code>NULL</code> indicating that
parameters are integrated over the random effects) such as
<code>avg_reffects = list(feby = 'study', reby = NULL, over = 'age')</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ipts</code></td>
<td>
<p>An integer to set the length of the predictor variable to get a
smooth velocity curve. The <code>NULL</code> will return original values whereas
an integer such as <code>ipts = 10</code> (default) will interpolate the
predictor. It is important to note that these interpolations do not alter
the range of predictor when calculating population average and/or the
individual specific growth curves.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deriv_model</code></td>
<td>
<p>A logical to specify whether to estimate velocity curve
from the derivative function, or the differentiation of the distance curve.
The argument <code>deriv_model</code> is set to <code>TRUE</code> for those functions
which need velocity curve such as <code>growthparameters()</code> and
<code>plot_curves()</code>, and <code>NULL</code> for functions which explicitly use
the distance curve (i.e., fitted values) such as <code>loo_validation()</code>
and <code>plot_ppc()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xrange</code></td>
<td>
<p>An integer to set the predictor range (i.e., age) when
executing the interpolation via <code>ipts</code>. The default <code>NULL</code> sets
the individual specific predictor range whereas code <code>xrange = 1</code> sets
identical range for individuals within the same higher grouping variable
(e.g., study). Code <code>xrange  = 2</code> sets the identical range across the
entire sample. Lastly, a paired numeric values can be supplied e.g.,
<code>xrange = c(6, 20)</code> to set the range within those values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xrange_search</code></td>
<td>
<p>A vector of length two, or a character string
<code>'range'</code> to set the range of predictor variable (<code>x</code> ) within
which growth parameters are searched. This is useful when there is more
than one peak and user wants to summarize peak within a given range of the
<code>x</code> variable. Default <code>xrange_search = NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>takeoff</code></td>
<td>
<p>A logical (default <code>FALSE</code>) to indicate whether
or not to calculate the age at takeoff velocity (ATGV) and the takeoff
growth velocity (TGV) parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trough</code></td>
<td>
<p>A logical (default <code>FALSE</code>) to indicate whether or
not to calculate the age at cessation of growth velocity (ACGV) and the
cessation of growth velocity (CGV) parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>acgv</code></td>
<td>
<p>A logical (default <code>FALSE</code>) to indicate whether or not to
calculate the age at cessation of growth velocity from the velocity curve.
If <code>TRUE</code>, age at cessation of growth velocity (ACGV) and the
cessation growth velocity (CGV) are  calculated based on the percentage of
the peak growth velocity as defined by the <code>acgv_velocity</code> argument
(see below). The <code>acgv_velocity</code> is typically set at 10 percent of the
peak growth velocity. The ACGV and CGV are calculated along with the the
uncertainty (SE and CI) around the ACGV and CGV parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>acgv_velocity</code></td>
<td>
<p>Specify the percentage of the peak growth velocity to be
used when estimating <code>acgv</code>. The default value is <code>0.10</code> i.e.,
10 percent of the peak growth velocity.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>An integer (default <code>123</code>) that is passed to the estimation
method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimation_method</code></td>
<td>
<p>A character string to specify the estimation method
when calculating the velocity from the posterior draws. The <code>'fitted'</code>
method internally calls the <code>fitted_draws()</code> whereas the option
<code>predict</code> calls the <code>predict_draws()</code>. See
<code>brms::fitted.brmsfit()</code> and <code>brms::predict.brmsfit()</code> for derails.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>allow_new_levels</code></td>
<td>
<p>A flag indicating if new levels of group-level
effects are allowed (defaults to <code>FALSE</code>). Only relevant if
<code>newdata</code> is provided.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_new_levels</code></td>
<td>
<p>Indicates how to sample new levels for grouping
factors specified in <code>re_formula</code>. This argument is only relevant if
<code>newdata</code> is provided and <code>allow_new_levels</code> is set to
<code>TRUE</code>. If <code>"uncertainty"</code> (default), each posterior sample for a
new level is drawn from the posterior draws of a randomly chosen existing
level. Each posterior sample for a new level may be drawn from a different
existing level such that the resulting set of new posterior draws
represents the variation across existing levels. If <code>"gaussian"</code>,
sample new levels from the (multivariate) normal distribution implied by the
group-level standard deviations and correlations. This options may be useful
for conducting Bayesian power analysis or predicting new levels in
situations where relatively few levels where observed in the old_data. If
<code>"old_levels"</code>, directly sample new levels from the existing levels,
where a new level is assigned all of the posterior draws of the same
(randomly chosen) existing level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>incl_autocor</code></td>
<td>
<p>A flag indicating if correlation structures originally
specified via <code>autocor</code> should be included in the predictions.
Defaults to <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>robust</code></td>
<td>
<p>A logical to specify the summarize options. If <code>FALSE</code>
(the default) the mean is used as the measure of central tendency and the
standard deviation as the measure of variability. If <code>TRUE</code>, the
median and the median absolute deviation (MAD) are applied instead. Ignored
if <code>summary</code> is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>future</code></td>
<td>
<p>A logical (default <code>FALSE</code>) to specify whether or not to
perform parallel computations. If set to <code>TRUE</code>, the
<code>future.apply::future_sapply()</code> function is used to summarize draws.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>future_session</code></td>
<td>
<p>A character string to set the session type when
<code>future = TRUE</code>. The <code>'multisession'</code> (default) options sets the
multisession whereas the <code>'multicore'</code> sets the multicore session.
Note that option <code>'multicore'</code> is not supported on Windows systems.
For more details, see <code>future.apply::future_sapply()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cores</code></td>
<td>
<p>Number of cores to be used when running the parallel
computations (if <code>future = TRUE</code>). On non-Windows systems this
argument can be set globally via the mc.cores option. For the default
<code>NULL</code> option, the number of cores are set automatically by calling
the <code>future::availableCores()</code>. The number of cores used are the maximum
number of cores avaialble minus one, i.e., <code>future::availableCores() -
  1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trim</code></td>
<td>
<p>A number (default 0) of long line segments to be excluded from
plot with option 'u' or 'a'. See sitar::plot.sitar for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>layout</code></td>
<td>
<p>A character string defining the layout structure of the plot. A
<code>'single'</code> (default) layout provides overlaid distance and velocity
curves on a single plot when opt includes <code>'dv'</code>, <code>'Dv'</code>,
<code>'dV'</code> or <code>'DV'</code> options.  Similarly, when opt includes
<code>'au'</code>, the adjusted and unadjusted curves are plotted as a single
plot. When opt is a single letter (e.g., <code>'d'</code>. <code>'v'</code> <code>'D'</code>,
<code>'V'</code>, <code>'a'</code>, <code>'u'</code>), the <code>'single'</code> optiion is ignored.
The alternative layout option, the <code>'facet'</code> uses the <code>facet_wrap</code>
from the <code>ggplot2</code>. to map and draw plot when <code>opt</code> include two or
more letters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linecolor</code></td>
<td>
<p>The color of line used when layout is <code>'facet'</code>. The
default is <code>NULL</code> which internally set the <code>linecolor</code> as
<code>'grey50'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linecolor1</code></td>
<td>
<p>The color of first line when layout is <code>'single'</code>. For
example, for <code>opt = 'dv'</code>, the color of distance line is controlled by
the <code>linecolor1</code>. Default <code>NULL</code> will internally set
<code>linecolor1</code> as <code>'orange2'</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linecolor2</code></td>
<td>
<p>The color of second line when layout is <code>'single'</code>. For
example, for <code>opt = 'dv'</code>, the color of velocity line is controlled by
the <code>linecolor2</code>. Default <code>NULL</code> sets the color <code>'green4'</code>
for <code>linecolor2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label.x</code></td>
<td>
<p>An optional character string to label the x axis. When
<code>NULL</code> (default), the x axis label is taken from the predictor (e.g.,
age).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label.y</code></td>
<td>
<p>An optional character string to label the y axis. When
<code>NULL</code> (default), the y axis label is taken from the type of plot
(e.g., distance, velocity etc.). Note that when layout option is
<code>'facet'</code>, then y axis label is removed and instead the same label is
used as a title.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legendpos</code></td>
<td>
<p>An optional character string to specify the position of
legends. When <code>NULL</code> (default), the legend position is set as 'bottom'
for distance and velocity curves with <code>'single'</code> layout option for the
population average curves, and <code>'none'</code> for the individual specific
curves. The <code>'none'</code> suppress all legends that helps in avoiding
printing legends for each individual.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linetype.apv</code></td>
<td>
<p>An optional character string to specify the type of the
vertical line drawn to mark the APGV. Default <code>NULL</code> sets the linetype
as <code>dotted</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linewidth.main</code></td>
<td>
<p>An optional character string to specify the width of the
the line for the distance and velocity curves. The default <code>NULL</code> will
set it as 0.35.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linewidth.apv</code></td>
<td>
<p>An optional character string to specify the width of the
the vertical line drawn to mark the APGV. The default <code>NULL</code> will set
it as 0.25.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>linetype.groupby</code></td>
<td>
<p>An optional argument to specify the line type for the
distance and velocity curves when drawing plots for a model that includes
factor covariate(s) or when visualising individual specific
distance/velocity curves (default <code>NA</code>). Setting it to <code>NULL</code> will
automatically sets the linetype for each factor level or individual This
will also add legends for the factor level covariate or individuals whereas
<code>NA</code> will set a 'solid' line type and suppress legends. It is
recommended to keep the default <code>NULL</code> option when plotting population
average curves for when model included factor covariates because this would
appropriately set the legends otherwise it is difficult to differentiate
which curve belongs to which level of factor. For individual specific
curves, the line type can be set to <code>NULL</code> when the number of
individuals is small. However, when the number of individuals is large,
<code>NA</code> is a better choice which prevents printing a large number of
legends for each individual.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color.groupby</code></td>
<td>
<p>An optional argument to specify the line color for
distance and velocity curves when drawing plots for a model that includes
factor covariate(s), or when visualising individual specific
distance/velocity curves (default <code>NA</code>). Setting it to <code>NULL</code> will
automatically sets the line color for each factor level or individual. This
will also add legends for the factor level covariate or individuals.
However, setting it as <code>NA</code> will set a 'solid' line type and suppress
legends. It is recommended to keep the default <code>NULL</code> option when
plotting population average curves for factor covariates because this would
appropriately set the legends otherwise it is difficult to differentiate
which curve belongs to which level of the factor. For individual specific
curves, the line color can be set to <code>NULL</code> when the number of
individuals is small. However, when the number of individuals is large,
<code>NA</code> is a better choice which prevents printing a large number of
legends for each individual.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>band.alpha</code></td>
<td>
<p>An optional numeric value to specify the transparency of the
CI band(s) around the distance curve, velocity curve and the line indicating
the APGV. The default <code>NULL</code> will set this value to 0.4.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_age_takeoff</code></td>
<td>
<p>A logical (default <code>TRUE</code>) to indicate whether to
display the ATGV line(s) on the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_age_peak</code></td>
<td>
<p>A logical (default <code>TRUE</code>) to indicate whether to
display the APGV line(s) on the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_age_cessation</code></td>
<td>
<p>A logical (default <code>TRUE</code>) to indicate whether
to display the ACGV line(s) on the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_vel_takeoff</code></td>
<td>
<p>A logical (default <code>FALSE</code>) to indicate whether
to display the TGV line(s) on the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_vel_peak</code></td>
<td>
<p>A logical (default <code>FALSE</code>) to indicate whether to
display the PGV line(s) on the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show_vel_cessation</code></td>
<td>
<p>A logical (default <code>FALSE</code>) to indicate whether
to display the CGV line(s) on the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returndata</code></td>
<td>
<p>A logical (default <code>FALSE</code>) indicating whether to plot
the data or return the data. If <code>TRUE</code>, the data is returned as a
<code>data.frame</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>returndata_add_parms</code></td>
<td>
<p>A logical (default <code>FALSE</code>) indicating
whether add growth parameters to the <code>returndata</code>. The
<code>returndata_add_parms</code> is ignored when <code>returndata = FALSE</code>. If
<code>TRUE</code>, the growth parameters such as <code>APGV</code> and <code>PGV</code> are
added to the returned <code>data.frame</code>. Note that growth parameters are
estimated only when <code>'opt'</code> argument include either <code>'v'</code> or
<code>'V'</code> option and the argument <code>'apv'</code> is set to <code>TRUE</code>. If
any of these conditions are missing, then <code>returndata_add_parms</code> will
ignored ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parms_eval</code></td>
<td>
<p>A logical to specify whether or not to get growth
parameters on the fly. This is for internal use only and mainly needed for
compatibility across internal functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>idata_method</code></td>
<td>
<p>A character string to indicate the interpolation method.
The number of of interpolation points is set up the <code>ipts</code> argument.
Options available for <code>idata_method</code> are <em>method 1</em> (specified as
<code>'m1'</code>) and <em>method 2</em> (specified as <code>'m2'</code>). The
<em>method 1</em> (<code>'m1'</code>) is adapted from the the <span class="pkg">iapvbs</span> package
and is documented here
<a href="https://rdrr.io/github/Zhiqiangcao/iapvbs/src/R/exdata.R">https://rdrr.io/github/Zhiqiangcao/iapvbs/src/R/exdata.R</a>
whereas <em>method 2</em> (<code>'m2'</code>) is based on the <span class="pkg">JMbayes</span>
package as documented here
<a href="https://github.com/drizopoulos/JMbayes/blob/master/R/dynPred_lme.R">https://github.com/drizopoulos/JMbayes/blob/master/R/dynPred_lme.R</a>.
The <code>'m1'</code> method works by internally constructing the data frame based
on the model configuration whereas the method <code>'m2'</code> uses the exact
data frame used in model fit and can be accessed via <code>fit$data</code>. If
<code>idata_method = NULL, default</code>, then method <code>'m2'</code> is
automatically set. Note that method <code>'m1'</code> might fail in some cases
when model involves covariates particularly when model is fit as
<code>univariate_by</code>. Therefore, it is advised to switch to method
<code>'m2'</code> in case <code>'m1'</code> results in error.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parms_method</code></td>
<td>
<p>A character to specify the method used to when evaluating
<code>parms_eval</code>. The default is <code>getPeak</code> which uses the
<code>sitar::getPeak()</code> function from the <code>sitar</code> package. The alternative
option is <code>findpeaks</code> that uses the <code>pracma::findpeaks()</code> function
function from the <code>pracma</code> package. This is for internal use only and
mainly needed for compatibility across internal functions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>An optional argument (logical, default <code>FALSE</code>) to
indicate whether to print information collected during setting up the
object(s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fullframe</code></td>
<td>
<p>A logical to indicate whether to return <code>fullframe</code>
object in which <code>newdata</code> is bind to the summary estimates. Note that
<code>fullframe</code> can not be combined with <code>summary = FALSE</code>.
Furthermore, <code>fullframe</code> can only be used when <code>idata_method =
  'm2'</code>. A particular use case is when fitting <code>univariate_by</code> model.
The <code>fullframe</code> is mainly for internal use only.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dummy_to_factor</code></td>
<td>
<p>A named list (default <code>NULL</code>) that is used to
convert dummy variables into a factor variable. The named elements are
<code>factor.dummy</code>, <code>factor.name</code>, and <code>factor.level</code>. The
<code>factor.dummy</code> is a vector of character strings that need to be
converted to a factor variable whereas the <code>factor.name</code> is a single
character string that is used to name the newly created factor variable.
The <code>factor.level</code> is used to name the levels of newly created factor.
When <code>factor.name</code> is <code>NULL</code>, then the factor name is internally
set as <code>'factor.var'</code>. If <code>factor.level</code> is <code>NULL</code>, then
names of factor levels are take from the <code>factor.dummy</code> i.e., the
factor levels are assigned same name as <code>factor.dummy</code>. Note that when
<code>factor.level</code> is not <code>NULL</code>, its length must be same as the
length of the <code>factor.dummy</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expose_function</code></td>
<td>
<p>An optional logical argument to indicate whether to
expose Stan functions (default <code>FALSE</code>). Note that if user has already
exposed Stan functions during model fit by setting <code>expose_function =
  TRUE</code> in the <code>bsitar()</code>, then those exposed functions are saved and can be
used during post processing of the posterior draws and therefore
<code>expose_function</code> is by default set as <code>FALSE</code> in all post
processing functions except <code>optimize_model()</code>. For <code>optimize_model()</code>, the
default setting is <code>expose_function = NULL</code>. The reason is that each
optimized model has different Stan function and therefore it need to be re
exposed and saved. The <code>expose_function = NULL</code> implies that the
setting for <code>expose_function</code> is taken from the original <code>model</code>
fit. Note that <code>expose_function</code> must be set to <code>TRUE</code> when
adding <code>fit criteria</code> and/or <code>bayes_R2</code> during model
optimization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>usesavedfuns</code></td>
<td>
<p>A logical (default <code>NULL</code>) to indicate whether to
use the already exposed and saved <code>Stan</code> functions. Depending on
whether the user have exposed Stan functions within the <code>bsitar()</code> call via
<code>expose_functions</code> argument in the <code>bsitar()</code>, the <code>usesavedfuns</code>
is automatically set to <code>TRUE</code> (if <code>expose_functions = TRUE</code>) or
<code>FALSE</code> (if <code>expose_functions = FALSE</code>). Therefore, manual
setting of <code>usesavedfuns</code> as <code>TRUE</code>/<code>FALSE</code> is rarely
needed. This is for internal purposes only and mainly used during the
testing of the functions and therefore should not be used by users as it
might lead to unreliable estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clearenvfuns</code></td>
<td>
<p>A logical to indicate whether to clear the exposed
function from the environment (<code>TRUE</code>) or not (<code>FALSE</code>). If
<code>NULL</code> (default), then <code>clearenvfuns</code> is set as <code>TRUE</code> when
<code>usesavedfuns</code> is <code>TRUE</code>, and <code>FALSE</code> if <code>usesavedfuns</code>
is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>envir</code></td>
<td>
<p>Environment used for function evaluation. The default is
<code>NULL</code> which will set <code>parent.frame()</code> as default environment.
Note that since most of post processing functions are based on <span class="pkg">brms</span>,
the functions needed for evaluation should be in the <code>.GlobalEnv</code>.
Therefore, it is strongly recommended to set <code> envir = globalenv()</code>
(or <code>envir = .GlobalEnv</code>). This is particularly true for the
derivatives such as velocity curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments passed to <code>brms::fitted.brmsfit()</code> and
<code>brms::predict()</code> functions.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The <strong>plot_curves()</strong> is a generic function that allows
visualization of following six curves: population average distance curve,
population average velocity curve, individual-specific distance curves,
individual-specific velocity curves, unadjusted individual growth curves
(i.e, observed growth curves), and the adjusted individual growth curves
(adjusted for the model estimated random effects). The
<strong>plot_curves()</strong> internally calls the <code>growthparameters()</code> function to
estimate and summaries the distance and velocity curves and to estimate
growth parameters such as the age at peak growth velocity (APGV). The
<strong>plot_curves()</strong> in turn calls the <code>fitted_draws()</code> or the
<code>predict_draws()</code> functions to make inference from the posterior draws.
Thus, <strong>plot_curves()</strong> allows plotting fitted or predicted curves. See
<code>fitted_draws()</code> and <code>predict_draws()</code> for details on these functions and
the difference between fitted and predicted values.
</p>


<h3>Value</h3>

<p>A plot object (default), or a <code>data.frame</code> when
<code>returndata = TRUE</code>.
</p>


<h3>Author(s)</h3>

<p>Satpal Sandhu  <a href="mailto:satpal.sandhu@bristol.ac.uk">satpal.sandhu@bristol.ac.uk</a>
</p>


<h3>See Also</h3>

<p><code>growthparameters()</code> fitted_draws <code>predict_draws()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Fit Bayesian SITAR model 

# To avoid mode estimation which takes time, the Bayesian SITAR model fit to 
# the 'berkeley_exdata' has been saved as an example fit ('berkeley_exfit').
# See 'bsitar' function for details on 'berkeley_exdata' and 'berkeley_exfit'.

# Check and confirm whether model fit object 'berkeley_exfit' exists
 berkeley_exfit &lt;- getNsObject(berkeley_exfit)

model &lt;- berkeley_exfit

# Population average distance and velocity curves with default options
plot_curves(model, opt = 'dv')


# Individual-specific distance and velocity curves with default options
# Note that legendpos = 'none' will suppress the legend positions. This   
# suppression is useful when plotting individual-specific curves

plot_curves(model, opt = 'DV')

# Population average distance and velocity curves with APGV

plot_curves(model, opt = 'dv', apv = TRUE)

# Individual-specific distance and velocity curves with APGV

plot_curves(model, opt = 'DV', apv = TRUE)

# Population average distance curve, velocity curve, and APGV with CI bands
# To construct CI bands, growth parameters are first calculated for each  
# posterior draw and then summarized across draws. Therefore,summary 
# option must be set to FALSE

plot_curves(model, opt = 'dv', apv = TRUE, bands = 'dvp', summary = FALSE)

# Adjusted and unadjusted individual curves
# Note ipts = NULL (i.e., no interpolation of predictor (i.e., age) to plot a 
# smooth curve). This is because it does not a make sense to interploate data 
# when estimating adjusted curves. Also, layout = 'facet' (and not default 
# layout = 'single') is used for the ease of visualizing the plotted 
# adjusted and unadjusted individual curves. However, these lines can be 
# superimposed on each other by setting the set layout = 'single'.
# For other plots shown above, layout can be set as 'single' or 'facet'

# Separate plots for adjusted and unadjusted curves (layout = 'facet')
plot_curves(model, opt = 'au', ipts = NULL, layout = 'facet')

# Superimposed adjusted and unadjusted curves (layout = 'single')
plot_curves(model, opt = 'au', ipts = NULL, layout = 'single')



</code></pre>


</div>