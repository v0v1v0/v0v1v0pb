<div class="container">

<table style="width: 100%;"><tr>
<td>estimate_partition_function</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate Partition Function</h2>

<h3>Description</h3>

<p>Estimate the logarithm of the partition function of the Mallows rank model.
Choose between the importance sampling algorithm described in
(Vitelli et al. 2018) and the IPFP algorithm for computing
an asymptotic approximation described in
(Mukherjee 2016). Note that exact partition functions
can be computed efficiently for Cayley, Hamming and Kendall distances with
any number of items, for footrule distances with up to 50 items, Spearman
distance with up to 20 items, and Ulam distance with up to 60 items. This
function is thus intended for the complement of these cases. See
<code>get_cardinalities()</code> and <code>compute_exact_partition_function()</code> for details.
</p>


<h3>Usage</h3>

<pre><code class="language-R">estimate_partition_function(
  method = c("importance_sampling", "asymptotic"),
  alpha_vector,
  n_items,
  metric,
  n_iterations,
  K = 20,
  cl = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Character string specifying the method to use in order to
estimate the logarithm of the partition function. Available options are
<code>"importance_sampling"</code> and <code>"asymptotic"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha_vector</code></td>
<td>
<p>Numeric vector of <code class="reqn">\alpha</code> values over which to
compute the importance sampling estimate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_items</code></td>
<td>
<p>Integer specifying the number of items.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metric</code></td>
<td>
<p>Character string specifying the distance measure to use.
Available options are <code>"footrule"</code> and <code>"spearman"</code> when <code>method = "asymptotic"</code> and in addition <code>"cayley"</code>, <code>"hamming"</code>, <code>"kendall"</code>, and
<code>"ulam"</code> when <code>method = "importance_sampling"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_iterations</code></td>
<td>
<p>Integer specifying the number of iterations to use. When
<code>method = "importance_sampling"</code>, this is the number of Monte Carlo samples
to generate. When <code>method = "asymptotic"</code>, on the other hand, it represents
the number of iterations of the IPFP algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p>Integer specifying the parameter <code class="reqn">K</code> in the asymptotic
approximation of the partition function. Only used when <code>method = "asymptotic"</code>. Defaults to 20.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cl</code></td>
<td>
<p>Optional computing cluster used for parallelization, returned from
<code>parallel::makeCluster()</code>. Defaults to <code>NULL</code>. Only used when <code>method = "importance_sampling"</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A matrix with two column and number of rows equal the degree of the
fitted polynomial approximating the partition function. The matrix can be
supplied to the <code>pfun_estimate</code> argument of <code>compute_mallows()</code>.
</p>


<h3>References</h3>

<p>Mukherjee S (2016).
“Estimation in exponential families on permutations.”
<em>The Annals of Statistics</em>, <b>44</b>(2), 853–875.
<a href="https://doi.org/10.1214/15-aos1389">doi:10.1214/15-aos1389</a>.<br><br> Vitelli V, Sørensen, Crispino M, Arjas E, Frigessi A (2018).
“Probabilistic Preference Learning with the Mallows Rank Model.”
<em>Journal of Machine Learning Research</em>, <b>18</b>(1), 1–49.
<a href="https://jmlr.org/papers/v18/15-481.html">https://jmlr.org/papers/v18/15-481.html</a>.
</p>


<h3>See Also</h3>

<p>Other partition function: 
<code>compute_exact_partition_function()</code>,
<code>get_cardinalities()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># IMPORTANCE SAMPLING
# Let us estimate logZ(alpha) for 20 items with Spearman distance
# We create a grid of alpha values from 0 to 10
alpha_vector &lt;- seq(from = 0, to = 10, by = 0.5)
n_items &lt;- 20
metric &lt;- "spearman"

# We start with 1e3 Monte Carlo samples
fit1 &lt;- estimate_partition_function(
  method = "importance_sampling", alpha_vector = alpha_vector,
  n_items = n_items, metric = metric, n_iterations = 1e3)
# A matrix containing powers of alpha and regression coefficients is returned
fit1
# The approximated partition function can hence be obtained:
estimate1 &lt;-
  vapply(alpha_vector, function(a) sum(a^fit1[, 1] * fit1[, 2]), numeric(1))

# Now let us recompute with 2e3 Monte Carlo samples
fit2 &lt;- estimate_partition_function(
  method = "importance_sampling", alpha_vector = alpha_vector,
  n_items = n_items, metric = metric, n_iterations = 2e3)
estimate2 &lt;-
  vapply(alpha_vector, function(a) sum(a^fit2[, 1] * fit2[, 2]), numeric(1))

# ASYMPTOTIC APPROXIMATION
# We can also compute an estimate using the asymptotic approximation
fit3 &lt;- estimate_partition_function(
  method = "asymptotic", alpha_vector = alpha_vector,
  n_items = n_items, metric = metric, n_iterations = 50)
estimate3 &lt;-
  vapply(alpha_vector, function(a) sum(a^fit3[, 1] * fit3[, 2]), numeric(1))

# We can now plot the estimates side-by-side
plot(alpha_vector, estimate1, type = "l", xlab = expression(alpha),
     ylab = expression(log(Z(alpha))))
lines(alpha_vector, estimate2, col = 2)
lines(alpha_vector, estimate3, col = 3)
legend(x = 7, y = 40, legend = c("IS,1e3", "IS,2e3", "IPFP"),
       col = 1:3, lty = 1)

# We see that the two importance sampling estimates, which are unbiased,
# overlap. The asymptotic approximation seems a bit off. It can be worthwhile
# to try different values of n_iterations and K.

# When we are happy, we can provide the coefficient vector in the
# pfun_estimate argument to compute_mallows
# Say we choose to use the importance sampling estimate with 1e4 Monte Carlo samples:
model_fit &lt;- compute_mallows(
  setup_rank_data(potato_visual),
  model_options = set_model_options(metric = "spearman"),
  compute_options = set_compute_options(nmc = 200),
  pfun_estimate = fit2)

</code></pre>


</div>