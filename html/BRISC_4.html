<div class="container">

<table style="width: 100%;"><tr>
<td>BRISC_estimation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Function for estimation with BRISC</h2>

<h3>Description</h3>

<p>The function <code>BRISC_estimation</code> fits univariate spatial regression models for large
spatial data using Vecchia's approximate likelihood (Vecchia, 1988). <code>BRISC_estimation</code>
uses the sparse Cholesky representation of Vecchia’s likelihood developed in Datta et al., 2016.
The Maximum Likelihood Estimates (MLE) of the parameters are used later for calculating the
confidence interval via the <code>BRISC_bootstrap</code> (BRISC, Saha &amp; Datta, 2018). <br> We recommend
using <code>BRISC_estimation</code> followed by <code>BRISC_bootstrap</code> to obtain the confidence
intervals for the model parameters.
</p>
<p>The optimization is performed with C library of limited-memory BFGS
libLBFGS: a library of Limited-memory Broyden-Fletcher-Goldfarb-Shanno (L-BFGS), <br>
http://www.chokkan.org/software/liblbfgs/ (Naoaki Okazaki). For user convenience
the source codes of the package libLBFGS are provided in the package. The code for
the coordinate ordering method, approximate Maximum Minimum Distance (Guinness, 2018)
is available in <br> https://github.com/joeguinness/gp_reorder/tree/master/R and is adopted
with minor modification. Some code blocks are borrowed from the R package: spNNGP:
Spatial Regression Models for Large Datasets using Nearest Neighbor Gaussian Processes
https://CRAN.R-project.org/package=spNNGP .
</p>


<h3>Usage</h3>

<pre><code class="language-R">BRISC_estimation(coords, y, x = NULL, sigma.sq = 1,
                 tau.sq = 0.1, phi = 1,
                 nu = 1.5, n.neighbors = 15,
                 n_omp = 1, order = "Sum_coords",
                 cov.model = "exponential",
                 search.type = "tree",
                 stabilization = NULL,
                 pred.stabilization = 1e-8,
                 verbose = TRUE, eps = 2e-05,
                 nugget_status = 1, ordering = NULL,
                 neighbor = NULL, tol = 12)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>coords</code></td>
<td>
<p>an <code class="reqn">n \times 2</code> matrix of the observation
coordinates in <code class="reqn">R^2</code> (e.g., easting and northing). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>an <code class="reqn">n</code> length vector of response at the observed coordinates. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>an <code class="reqn">n \times p</code> matrix of the covariates in the observation coordinates. Default value is
<code class="reqn">n \times 1</code> matrix of <code class="reqn">1</code> to adjust for the mean(intercept). </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma.sq</code></td>
<td>
<p>starting value of sigma square. Default value is 1. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau.sq</code></td>
<td>
<p>starting value of tau square. Default value is 0.1. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi</code></td>
<td>
<p>starting value of phi. Default value is 1. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nu</code></td>
<td>
<p>starting value of nu, only required for matern covariance model. Default value is 1.5. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.neighbors</code></td>
<td>
<p>number of neighbors used in the NNGP. Default value is 15. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_omp</code></td>
<td>
<p>number of threads to be used, value can be more than 1 if source code is compiled with OpenMP support.
Default is 1. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>order</code></td>
<td>
<p>keyword that specifies the ordering scheme to be used in ordering the observations. Supported keywords are:
<code>"AMMD"</code> and <code>"Sum_coords"</code> for approximate Maximum Minimum Distance and sum of coordinate based ordering,
respectively. Default value is <code>"Sum_coords"</code>. <code class="reqn">n &gt; 65</code> is required for <code>"AMMD"</code>. Ignored, if <code>"ordering"</code> in not <code>NULL</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov.model</code></td>
<td>
<p>keyword that specifies the covariance function to be used in modelling the spatial dependence structure
among the observations. Supported keywords are: <code>"exponential"</code>, <code>"matern"</code>, <code>"spherical"</code>, and <code>"gaussian"</code>
for exponential, Matern, spherical and Gaussian covariance function respectively. Default value is "exponential". </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>search.type</code></td>
<td>
<p>keyword that specifies type of nearest neighbor search algorithm to be used. Supported keywords are:
<code>"brute"</code>, <code>"tree"</code> and <code>"cb"</code>. <br><code>"brute"</code> and <code>"tree"</code> provide the same result, though
<code>"tree"</code> should be faster. <code>"cb"</code> implements fast code book search described in Ra and Kim (1993)
modified for NNGP. If locations do not have identical coordinate values on the axis used for the nearest neighbor
ordering (see <code>order</code> argument) then <code>"cb"</code> and <code>"brute"</code> should produce identical neighbor sets.
However, if there are identical coordinate values on the axis used for nearest neighbor ordering, then <code>"cb"</code>
and <code>"brute"</code> might produce different, but equally valid, neighbor sets, e.g., if data are on a grid.
Default value is <code>"tree"</code>. Ignored, if <code>"neighbor"</code> in not <code>NULL</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stabilization</code></td>
<td>
<p>when the spatial errors are generated from a very smooth covarince model (lower values of phi for spherical and Gaussian
covariance and low phi and high nu for Matern covarinace), the estimation process may fail due to computational
instability. If <code>stabilization = TRUE</code>, performs stabilization by adding a white noise to the reordered data with
nugget <code>tau.sq = </code> <code>sigma.sq</code> * 1e-06. Estimation is performed on this new data with <code>nugget_status = 1</code>
(see <code>nugget_status</code> argument below). Default value is <code>TRUE</code> for <code>cov.model = "expoenential"</code> and <code>FALSE</code> otherwise. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pred.stabilization</code></td>
<td>
<p>if not <code>NULL</code>, will truncate the estimated tau square to <code>pred.stabilization</code> * estimated sigma square.
This provides additional stability in <br><code>BRISC_prediction</code>. Default value is <code class="reqn">1e-8</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>if <code>TRUE</code>, model specifications along with information regarding OpenMP support and progress of the algorithm
is printed to the screen. Otherwise, nothing is printed to the screen. Default value is <code>TRUE</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps</code></td>
<td>
<p>tolerance to be used in centred finite difference approximation of derivatives. Default value is 2e-05. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nugget_status</code></td>
<td>
<p>if <code>nugget_status = 0</code>, <code>tau.sq</code> is fixed to 0, if <code>nugget_status = 1</code> <code>tau.sq</code> is estimated. Default value is 1. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ordering</code></td>
<td>
<p>if <code>NULL</code>, the observed locations will be ordered following the scheme in <code>"order"</code>. If not <code>NULL</code>, the ordering step is bypassed and the input must denote the <code class="reqn">n</code> length integer vector of ordering of the input coordinates that is to be used as the ordering of the coordinates for determination of the set of nearest neighbors. Output from <code>BRISC_order</code> can be used here. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>neighbor</code></td>
<td>
<p>if <code>NULL</code>, neighbor set and corresponding information are created using the search type specified in <code>"search.type"</code>. If not <code>NULL</code>, the step of searching the neighbors is bypassed and the input must be an output from <code>BRISC_neighbor</code> with identical input in <code>"order"</code>, <code>"ordering"</code> and <code>"search.type"</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tol</code></td>
<td>
<p>the input observation coordinates, response and the covariates are rounded to this many places after the decimal. The default value is 12. </p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>BRISC_Out</code>, which is a list comprising:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>ord</code></td>
<td>
<p>the vector of indices used to order data necessary for fitting the NNGP
model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coords</code></td>
<td>
<p>the matrix <code>coords[ord,]</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>If <code>stabilization = FALSE</code>, returns the vector <code>y[ord]</code>. <br> If <code>stabilization = TRUE</code>, returns <code>y[ord]</code> + used white noise in stabilization process. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>the matrix <code>x[ord,,drop=FALSE]</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.neighbors</code></td>
<td>
<p>the used value of <code>n.neighbors</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov.model</code></td>
<td>
<p>the used covariance model. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps</code></td>
<td>
<p>value of used <code>eps</code> for approximate derivation. Default value is 2e-05. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init</code></td>
<td>
<p>initial values of the parameters of the covariance model; <br> accounts for <code>stabilization</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Beta</code></td>
<td>
<p>estimate of beta. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Theta</code></td>
<td>
<p>estimate of parameters of covarinace model. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log_likelihood</code></td>
<td>
<p>value of Vecchia’s approximate log likelihood with parameter estimates. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estimation.time</code></td>
<td>
<p>time (in seconds) required to perform the model fitting after ordering and preprocessing data in <code>R</code>,
reported using <code>proc.time()</code>. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>BRISC_Object</code></td>
<td>
<p>object required for bootstrap and prediction. </p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Arkajyoti Saha <a href="mailto:arkajyotisaha93@gmail.com">arkajyotisaha93@gmail.com</a>, <br>
Abhirup Datta <a href="mailto:abhidatta@jhu.edu">abhidatta@jhu.edu</a>
</p>


<h3>References</h3>

<p>Saha, A., &amp; Datta, A. (2018). BRISC: bootstrap for rapid inference on spatial
covariances. Stat, e184, DOI: 10.1002/sta4.184.
</p>
<p>Datta, A., S. Banerjee, A.O. Finley, and A.E. Gelfand. (2016)
Hierarchical Nearest-Neighbor Gaussian process models for large
geostatistical datasets. Journal of the American Statistical
Association, 111:800-812.
</p>
<p>Guinness, J. (2018) Permutation and Grouping Methods for
Sharpening Gaussian Process Approximations, Technometrics,
DOI: 10.1080/00401706.2018.1437476, <br>
https://github.com/joeguinness/gp_reorder/tree/master/R .
</p>
<p>Vecchia, A. V. (1988) Estimation and model identification for
continuous spatial processes. Journal of the Royal Statistical
Society. Series B (Methodological), 297-312.
</p>
<p>Okazaki N. libLBFGS: a library of Limited-memory Broyden-Fletcher-Goldfarb-Shanno
(L-BFGS), <br> http://www.chokkan.org/software/liblbfgs/ .
</p>
<p>Andrew Finley, Abhirup Datta and Sudipto Banerjee (2020). spNNGP: Spatial Regression
Models for Large Datasets using Nearest Neighbor Gaussian Processes. R package version 0.1.4.
https://CRAN.R-project.org/package=spNNGP
</p>
<p>Ra, S. W., &amp; Kim, J. K. (1993). A fast mean-distance-ordered partial codebook search algorithm
for image vector quantization. IEEE Transactions on Circuits and Systems II: Analog and Digital
Signal Processing, 40(9), 576-579.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
rmvn &lt;- function(n, mu = 0, V = matrix(1)){
  p &lt;- length(mu)
  if(any(is.na(match(dim(V),p))))
    stop("Dimension not right!")
  D &lt;- chol(V)
  t(matrix(rnorm(n*p), ncol=p)%*%D + rep(mu,rep(n,p)))
}

set.seed(1)
n &lt;- 1000
coords &lt;- cbind(runif(n,0,1), runif(n,0,1))

beta &lt;- c(1,5)
x &lt;- cbind(rnorm(n), rnorm(n))

sigma.sq = 1
phi = 1
tau.sq = 0.1

B &lt;- as.matrix(beta)
D &lt;- as.matrix(dist(coords))
R &lt;- exp(-phi*D)
w &lt;- rmvn(1, rep(0,n), sigma.sq*R)

y &lt;- rnorm(n, x%*%B + w, sqrt(tau.sq))

estimation_result &lt;- BRISC_estimation(coords, y, x)
estimation_result$Theta ##Estimates of covariance model parameters.
estimation_result$Beta ##Estimates of Beta

</code></pre>


</div>