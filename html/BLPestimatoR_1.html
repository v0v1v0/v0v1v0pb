<div class="container">

<table style="width: 100%;"><tr>
<td>BLP_data</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Prepares data and parameters related to the BLP algorithm for estimation.</h2>

<h3>Description</h3>

<p>Prepares data and parameters related to the BLP algorithm for estimation.
</p>


<h3>Usage</h3>

<pre><code class="language-R">BLP_data(
  model,
  market_identifier,
  product_identifier,
  par_delta,
  group_structure = NULL,
  additional_variables = NULL,
  productData,
  demographic_draws,
  integration_accuracy,
  integration_method,
  integration_draws,
  integration_weights,
  integration_seed,
  blp_inner_tol = 1e-09,
  blp_inner_maxit = 10000
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>the model to be estimated in R's formula syntax,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>market_identifier</code></td>
<td>
<p>character specifying the market identifier (variable name must be included in <code>productData</code>),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>product_identifier</code></td>
<td>
<p>character specifying the product identifier (variable name must be included in <code>productData</code>),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par_delta</code></td>
<td>
<p>optional: numeric vector with values for the mean utility (variable name must be included in <code>productData</code>),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group_structure</code></td>
<td>
<p>optional: character specifying a group structure for clustered standard erros (variable name must be included in <code>productData</code>),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>additional_variables</code></td>
<td>
<p>optional: character vector specifying variables you want to keep for later analysis (variable names must be included in <code>productData</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>productData</code></td>
<td>
<p>data.frame with product characteristics,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>demographic_draws</code></td>
<td>
<p>optional: list with demographic draws for each market to consider observed heterogeneity (see details),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>integration_accuracy</code></td>
<td>
<p>integer specifying integration accuracy,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>integration_method</code></td>
<td>
<p>character specifying integration method,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>integration_draws</code></td>
<td>
<p>numeric matrix of manually provided integration draws (see details),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>integration_weights</code></td>
<td>
<p>numeric vector of manually provided integration weights,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>integration_seed</code></td>
<td>
<p>seed for the draws of Monte Carlo based integration,</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blp_inner_tol</code></td>
<td>
<p>tolerance for the contraction mapping (default: 1e-9),</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>blp_inner_maxit</code></td>
<td>
<p>maximum iterations for the contraction mapping (default: 10000)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For any form of user provided integration draws, i.e. <code>integration_draws</code> (unobserved heterogeneity)
or <code>demographic_draws</code> (observed heterogeneity), list entries must be named and contain the variable <code>market_identifier</code> to allow market matching.
Each line in these list entries contains the draws for one market.
In case of unobserved heterogeneity, list names must match the random coefficients from the model formula.
The <code>par_delta</code> argument provides the variable name for mean utilitys. For example, in the estimation algorithm these values are used as starting guesses in the contraction mapping.
Another example is the evaluation of the GMM, which is also based on the provided mean utilitys.
If you need to update <code>par_delta</code> or any other variable in the data object, use <code>update_BLP_data</code>.
</p>


<h3>Value</h3>

<p>Returns an object of class <code>blp_data</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">K&lt;-2 #number of random coefficients
data &lt;- simulate_BLP_dataset(nmkt = 25, nbrn = 20,
                        Xlin = c("price", "x1", "x2", "x3", "x4", "x5"),
                        Xexo = c("x1", "x2", "x3", "x4", "x5"),
                        Xrandom = paste0("x",1:K),instruments = paste0("iv",1:10),
                        true.parameters = list(Xlin.true.except.price = rep(0.2,5),
                                               Xlin.true.price = -0.2,
                                               Xrandom.true = rep(2,K),
                                               instrument.effects = rep(2,10),
                                               instrument.Xexo.effects = rep(1,5)),
                        price.endogeneity = list( mean.xi = -2,
                                                  mean.eita = 0,
                                                  cov = cbind( c(1,0.7), c(0.7,1))),
                        printlevel = 0, seed = 234234 )


model &lt;- as.formula("shares ~  price + x1 + x2 + x3 + x4 + x5 |
                    x1 + x2 + x3 + x4 + x5 |
                    0+ x1 + x2 |
                    iv1 + iv2 + iv3 + iv4 + iv5 + iv6 + iv7 + iv8 +iv9 +iv10" )

blp_data &lt;- BLP_data(model = model, market_identifier="cdid",
                     product_id = "prod_id",
                     productData = data,
                     integration_method = "MLHS" ,
                     integration_accuracy = 40,
                     integration_seed = 1)

</code></pre>


</div>