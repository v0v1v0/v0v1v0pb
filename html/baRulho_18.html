<div class="container">

<table style="width: 100%;"><tr>
<td>plot_degradation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Save multipanel plots with reference and test sounds</h2>

<h3>Description</h3>

<p><code>plot_degradation</code> creates multipanel plots (as image files) with reference and test sounds by distance and transect.
</p>


<h3>Usage</h3>

<pre><code class="language-R">plot_degradation(
  X,
  nrow = 4,
  env.smooth = getOption("env.smooth", 200),
  hop.size = getOption("hop.size", 11.6),
  wl = getOption("wl", NULL),
  ovlp = getOption("ovlp", 70),
  path = getOption("sound.files.path", "."),
  dest.path = getOption("dest.path", "."),
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  collevels = seq(-120, 0, 5),
  palette = viridis::viridis,
  flim = c("-1", "+1"),
  envelope = TRUE,
  spectrum = TRUE,
  heights = c(4, 1),
  widths = c(5, 1),
  margins = c(2, 1),
  row.height = 2,
  col.width = 2,
  cols = viridis::mako(4, alpha = 0.3),
  res = 120,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>The output of <code>set_reference_sounds</code> which is an object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code>selection_table</code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) "sound.files": name of the .wav files, 2) "selec": unique selection identifier (within a sound file), 3) "start": start time and 4) "end": end time of selections, 5) "bottom.freq": low frequency for bandpass, 6) "top.freq": high frequency for bandpass, 7) "sound.id": ID of sounds used to identify counterparts across distances and 8) "reference": identity of sounds to be used as reference for each test sound (row). See <code>set_reference_sounds</code> for more details on the structure of 'X'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nrow</code></td>
<td>
<p>Numeric vector of length 1 with the number of rows per image file. Default is 4. This would be dynamically adjusted if more rows than needed are set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>env.smooth</code></td>
<td>
<p>Numeric vector of length 1 determining the length of the sliding window (in amplitude samples) used for a sum smooth for amplitude envelope and power spectrum calculations (used internally by <code>env</code>). Default is 200.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 11.6 ms, which is equivalent to 512 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied. Can be set globally for the current R session via the "hop.size" option (see <code>options</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wl</code></td>
<td>
<p>a vector with a single even integer number specifying the window length of the spectrogram, default is <code>NULL</code>. If supplied, 'hop.size' is ignored. Odd integers will be rounded up to the nearest even number. Can be set globally for the current R session via the "wl" option (see <code>options</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ovlp</code></td>
<td>
<p>Numeric vector of length 1 specifying the percentage of overlap between two
consecutive windows, as in <code>spectro</code>. Only used when plotting. Default is 70. Applied to both spectra and spectrograms on image files. Can be set globally for the current R session via the "ovlp" option (see <code>options</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the "sound.files.path" option (see <code>options</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dest.path</code></td>
<td>
<p>Character string containing the directory path where the image files will be saved. If not supplied the current working directory will be used instead. Can be set globally for the current R session via the "dest.path" option (see <code>options</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the "mc.cores" option (see <code>options</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the "pb" option (see <code>options</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>collevels</code></td>
<td>
<p>Numeric vector indicating a set of levels which are used to partition the amplitude range of the spectrogram (in dB) as in <code>spectro</code>. Default is <code>seq(-120, 0, 5)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>palette</code></td>
<td>
<p>A color palette function to be used to assign colors in the
plot, as in <code>spectro</code>. Default is <code>viridis</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>flim</code></td>
<td>
<p>A numeric vector of length 2 indicating the highest and lowest frequency limits (kHz) of the spectrogram, as in <code>spectro</code>. Default is <code>NULL</code>. Alternatively, a character vector similar to <code>c("-1", "1")</code> in which the first number is the value to be added to the minimum bottom frequency in 'X' and the second the value to be added to the maximum top frequency in 'X'. This is computed independently for each sound id so the frequency limit better fits the frequency range of the annotated signals. This is useful when test sounds show marked differences in their frequency ranges.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>envelope</code></td>
<td>
<p>Logical to control if envelopes are plotted. Default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spectrum</code></td>
<td>
<p>Logical to control if power spectra are plotted. Default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>heights</code></td>
<td>
<p>Numeric vector of length 2 to control the relative heights of spectrogram (first number) and amplitude envelope (second number) when <code>envelope = TRUE</code>. Default is c(4, 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>widths</code></td>
<td>
<p>Numeric vector of length 2 to control the relative widths of spectrogram (first number) and power spectrum (second number) when <code>spectrum = TRUE</code>. Default is c(5, 1).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>margins</code></td>
<td>
<p>Numeric vector of length 2 to control the relative time of the test sound (first number) and adjacent margins (i.e. adjacent background noise, second number) to be included in the spectrogram <code>spectrum = TRUE</code>. Default is c(2, 1) which means that each margin next to the sound is half the duration of the sound. Note that all spectrograms will have the same time length so margins will be calculated to ensure all spectrograms match the duration of the spectrogram in the longest sound. As such, this argument controls the margin on the longest sound.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>row.height</code></td>
<td>
<p>Numeric vector of length 1 controlling the height (in inches) of sound panels in the output image file. Default is 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col.width</code></td>
<td>
<p>Numeric vector of length 1 controlling the width (in inches) of sound panels in the output image file. Default is 2.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cols</code></td>
<td>
<p>Character vector of length 4 containing the colors to be used for the background of column and row title panels (element 1), the color of amplitude envelopes (element 2), the color of power spectra (element 3), and the background color of envelopes and spectra (element 4).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res</code></td>
<td>
<p>Numeric argument of length 1. Controls image resolution. Default is 120 (faster) although 300 - 400 is recommended for publication/presentation quality.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments to be passed to the internal spectrogram
creating function for customizing graphical output. The function is a modified
version of <code>spectro</code>, so it takes the same arguments.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function aims to simplify the visual inspection of sound degradation by producing multipanel figures (saved in 'dest.path') containing visualizations of each test sound and its reference. Sounds are sorted by distance (columns) and transect (if more than 1). Visualizations include spectrograms, amplitude envelopes and power spectra (the last 2 are optional). Each row includes all the copies of a sound id for a given transect (the row label includes the sound id in the first line and transect in the second line), also including its reference if it comes from another transect. Ambient noise annotations (sound.id 'ambient') are excluded. Amplitude envelopes and power spectra are computed using the functions  <code>envelope</code> (warbleR package) and <code>spec</code> (seewave package) respectively. This two visualizations show the power distribution in time and frequency between the minimum and maximum power values for each sound. Therefore scales are not necessarily comparable across panels.
</p>


<h3>Value</h3>

<p>One ore more image files with a multipanel figure of spectrograms of test sound by distance, sound id and transect. It also returns the file path of the images invisibly.
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305.

</p>


<h3>See Also</h3>

<p><code>blur_ratio</code>, <code>plot_aligned_sounds</code>, <code>plot_degradation</code>
</p>
<p>Other quantify degradation: 
<code>blur_ratio()</code>,
<code>detection_distance()</code>,
<code>envelope_correlation()</code>,
<code>plot_blur_ratio()</code>,
<code>set_reference_sounds()</code>,
<code>signal_to_noise_ratio()</code>,
<code>spcc()</code>,
<code>spectrum_blur_ratio()</code>,
<code>spectrum_correlation()</code>,
<code>tail_to_signal_ratio()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
  # load example data
  data("test_sounds_est")

  # order so spectrograms from same sound id as close in the graph
  test_sounds_est &lt;- test_sounds_est[order(test_sounds_est$sound.id), ]

  # set directory to save image files
  options(dest.path = tempdir())

  # method 1
  Y &lt;- set_reference_sounds(X = test_sounds_est)

  # plot degradation spectrograms
  plot_degradation(
    X = Y, nrow = 3, ovlp = 95
  )

  # using other color palettes
  plot_degradation(
    X = Y, nrow = 3, ovlp = 95,
    cols = viridis::magma(4, alpha = 0.3),
    palette = viridis::magma
  )

  # missing some data, 2 rows
  plot_degradation(
    X = Y[-3, ], nrow = 2, ovlp = 95,
    cols = viridis::mako(4, alpha = 0.4), palette = viridis::mako, wl = 200
  )

  # changing marging and high overlap
  plot_degradation(X = Y, margins = c(5, 1), nrow = 6, ovlp = 95)

  # more rows than needed (will adjust it automatically)
  plot_degradation(X = Y, nrow = 10, ovlp = 90)


</code></pre>


</div>