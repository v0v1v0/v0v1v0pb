<div class="container">

<table style="width: 100%;"><tr>
<td>ssm_mng</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>General Non-Gaussian State Space Model</h2>

<h3>Description</h3>

<p>Construct an object of class <code>ssm_mng</code> by directly defining the
corresponding terms of the model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ssm_mng(
  y,
  Z,
  T,
  R,
  a1 = NULL,
  P1 = NULL,
  distribution,
  phi = 1,
  u,
  init_theta = numeric(0),
  D = NULL,
  C = NULL,
  state_names,
  update_fn = default_update_fn,
  prior_fn = default_prior_fn
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>Observations as multivariate time series or matrix with dimensions
n x p.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Z</code></td>
<td>
<p>System matrix Z of the observation equation as p x m matrix or
p x m x n array.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>T</code></td>
<td>
<p>System matrix T of the state equation. Either a m x m matrix or a
m x m x n array.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>R</code></td>
<td>
<p>Lower triangular matrix R the state equation. Either a m x k
matrix or a
m x k x n array.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a1</code></td>
<td>
<p>Prior mean for the initial state as a vector of length m.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>P1</code></td>
<td>
<p>Prior covariance matrix for the initial state as m x m matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distribution</code></td>
<td>
<p>A vector of distributions of the observed series.
Possible choices are
<code>"poisson"</code>, <code>"binomial"</code>, <code>"negative binomial"</code>,
<code>"gamma"</code>, and <code>"gaussian"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi</code></td>
<td>
<p>Additional parameters relating to the non-Gaussian distributions.
For negative binomial distribution this is the dispersion term, for
gamma distribution this is the shape parameter, for Gaussian this is
standard deviation, and for other distributions this is ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>A matrix of positive constants for non-Gaussian models
(of same dimensions as y). For Poisson,  gamma, and negative binomial
distribution, this corresponds to the offset term. For binomial, this is the
number of trials (and as such should be integer(ish)).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>init_theta</code></td>
<td>
<p>Initial values for the unknown hyperparameters theta
(i.e. unknown variables excluding latent state variables).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>D</code></td>
<td>
<p>Intercept terms for observation equation, given as p x n matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C</code></td>
<td>
<p>Intercept terms for state equation, given as m x n matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>state_names</code></td>
<td>
<p>A character vector defining the names of the states.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>update_fn</code></td>
<td>
<p>A function which returns list of updated model
components given input vector theta. This function should take only one
vector argument which is used to create list with elements named as
<code>Z</code>, <code>T</code>, <code>R</code>, <code>a1</code>, <code>P1</code>, <code>D</code>, <code>C</code>, and
<code>phi</code>, where each element matches the dimensions of the original model.
If any of these components is missing, it is assumed to be constant wrt.
theta. It's best to check the internal dimensions with
<code>str(model_object)</code> as the dimensions of input arguments can differ
from the final dimensions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior_fn</code></td>
<td>
<p>A function which returns log of prior density
given input vector theta.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The general multivariate non-Gaussian model is defined using the following
observational and state equations:
</p>
<p style="text-align: center;"><code class="reqn">p^i(y^i_t | D_t + Z_t \alpha_t), (\textrm{observation equation})</code>
</p>

<p style="text-align: center;"><code class="reqn">\alpha_{t+1} = C_t + T_t \alpha_t + R_t \eta_t, 
(\textrm{transition equation})</code>
</p>

<p>where <code class="reqn">\eta_t \sim N(0, I_k)</code> and
<code class="reqn">\alpha_1 \sim N(a_1, P_1)</code> independently of each other, and
<code class="reqn">p^i(y_t | .)</code> is either Poisson, binomial, gamma, Gaussian, or
negative binomial distribution for each observation series <code class="reqn">i=1,...,p</code>.
Here k is the number of disturbance terms (which can be less than m,
the number of states).
</p>


<h3>Value</h3>

<p>An object of class <code>ssm_mng</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"> 
set.seed(1)
n &lt;- 20
x &lt;- cumsum(rnorm(n, sd = 0.5))
phi &lt;- 2
y &lt;- cbind(
  rgamma(n, shape = phi, scale = exp(x) / phi),
  rbinom(n, 10, plogis(x)))

Z &lt;- matrix(1, 2, 1)
T &lt;- 1
R &lt;- 0.5
a1 &lt;- 0
P1 &lt;- 1

update_fn &lt;- function(theta) {
  list(R = array(theta[1], c(1, 1, 1)), phi = c(theta[2], 1))
}

prior_fn &lt;- function(theta) {
  ifelse(all(theta &gt; 0), sum(dnorm(theta, 0, 1, log = TRUE)), -Inf)
}

model &lt;- ssm_mng(y, Z, T, R, a1, P1, phi = c(2, 1), 
  init_theta = c(0.5, 2), 
  distribution = c("gamma", "binomial"),
  u = cbind(1, rep(10, n)),
  update_fn = update_fn, prior_fn = prior_fn,
  state_names = "random_walk",
  # using default values, but being explicit for testing purposes
  D = matrix(0, 2, 1), C = matrix(0, 1, 1))

# smoothing based on approximating gaussian model
ts.plot(cbind(y, fast_smoother(model)), 
  col = 1:3, lty = c(1, 1, 2))

</code></pre>


</div>