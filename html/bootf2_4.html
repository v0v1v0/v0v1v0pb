<div class="container">

<table style="width: 100%;"><tr>
<td>calcf2</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Calculate Similarity Factor <code class="reqn">f_2</code>
</h2>

<h3>Description</h3>

<p>Main function to calculate <code class="reqn">f_2</code> according to different regulatory
guidelines.
</p>


<h3>Usage</h3>

<pre><code class="language-R">calcf2(test, ref, path.in, file.in, path.out, file.out,
       regulation = c("EMA", "FDA", "WHO", "Canada", "ANVISA"),
       cv.rule = TRUE, message = FALSE, min.points = 3L,
       f2.type = c("est.f2", "exp.f2", "bc.f2", "vc.exp.f2",
                   "vc.bc.f2", "all"), both.TR.85 = FALSE,
       digits = 2L, time.unit = c("min", "h"),  plot = TRUE,
       plot.start.time = 0, plot.max.unit = 24L)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>test, ref</code></td>
<td>
<p><em>Data frames</em> of dissolution profiles of test and reference
product if <code>path.in</code> and <code>file.in</code> are not specified; otherwise, they
should be <em>character</em> strings indicating the worksheet names of the Excel
file where the dissolution data is saved. See Input/Output in Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path.in, file.in, path.out, file.out</code></td>
<td>
<p><em>Character</em> strings of input and
output directories and file names. See Input/Output in Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>regulation</code></td>
<td>
<p><em>Character</em> strings indicating regulatory guidelines. See
Regulation in Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cv.rule</code></td>
<td>
<p><em>Logical</em>. If <code>TRUE</code>, CV rule will be checked according
to regulatory guidelines. See Regulation in Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>message</code></td>
<td>
<p><em>Logical</em>. If <code>TRUE</code>, the results and messages will be
printed on screen. Users are recommended to set it to <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>min.points</code></td>
<td>
<p>An <em>integer</em> indicating the minimum time points to be used
to calculate <code class="reqn">f_2</code>. The default value 3 should be used for
conventional <code class="reqn">f_2</code> calculation. This parameter is mainly used for
bootstrap <code class="reqn">f_2</code> method. See Regulation in Details.
@seealso <code>bootf2()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>f2.type</code></td>
<td>
<p><em>Character</em> strings indicating which <code class="reqn">f_2</code> estimators
should be calculated. For conventional <code class="reqn">f_2</code> calculation, the
default <code>"est.f2"</code> should be used. Other estimators are mainly for the
bootstrap method. @seealso <code>bootf2()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>both.TR.85</code></td>
<td>
<p><em>Logical</em>. If <code>TRUE</code>, and if <code>regulation = "FDA"</code>, all
measurements up to the time points at which both test and reference
products dissolve more than 85% will be used to calculate <code class="reqn">f_2</code>.
This is the conventional, but incorrect, interpretation of the US FDA rule.
Therefore, the argument should only be set to <code>TRUE</code> for validation purpose
such as comparing the results from old literature that use the wrong
interpretation to calculate <code class="reqn">f_2</code>. See Regulation in Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>An <em>integer</em> indicating the decimal points for the output.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time.unit</code></td>
<td>
<p><em>Character</em> strings indicating the unit of time. It should
be either <code>"min"</code> for minute or <code>"h"</code> for hour. It is mainly used for
checking CV rules and making plot. See Regulation in Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p><em>Logical</em>. If <code>TRUE</code>, a dissolution versus time plot will be
printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.start.time</code></td>
<td>
<p><em>Numeric</em> value indicating the starting time for the
plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.max.unit</code></td>
<td>
<p><em>Integer</em>. If the number of individual units is no more
than this value, the mean and all individual profiles will be plotted;
otherwise, individual profiles will be represented by boxplots at each
time point. Therefore, to avoid overplotting, this value should not be
too large. @seealso <code>calcf2()</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>



<h4>Minimum required arguments that must be provided by the user</h4>

<p>Arguments <code>test</code> and <code>ref</code> must be provided by the user. They should be <code>R</code>
<code style="white-space: pre;">⁠data frames⁠</code>, with <em>time as the first column</em>, and all individual profiles
profiles as the rest columns, or mean profile as the second column if only
mean profile is available. The actual names of the columns do not matter
since they will be renamed internally.
</p>



<h4>Input/Output</h4>

<p>The dissolution data of test and reference product can either be provided as
<em>data frames</em> for <code>test</code> and <code>ref</code>, as explained above, or be read from an
<em>Excel file</em> with data of test and reference stored in <em>separate worksheets</em>.
In the latter case, the argument <code>path.in</code>, the directory where the Excel
file is, and <code>file.in</code>, the name of the Excel file <em>including the file
extension <code>.xls</code> or <code>.xlsx</code></em>, must be provided. In such case, the argument
<code>test</code> and <code>ref</code> must be <em>the names of the worksheets in quotation marks</em>.
The first column of each Excel worksheet must be time, and the rest columns
are individual dissolution profiles, or the second column must be mean
profile if only mean data is available. The first row should be column names,
such as time, unit01, unit02, ... The actual names of the columns do not
matter as they will be renamed internally.
</p>
<p>Arguments <code>path.out</code> and <code>file.out</code> are the names of the output directory
and file. It is an overkill to output such simple calculations; therefore,
unless these two arguments are specified by the user, results are printed
on screen by default.
</p>



<h4>Regulation</h4>

<p>To apply <code class="reqn">f_2</code> method, different regulatory guidelines have slightly
different requirements. Some requirements are almost universal, such as same
time points for the test and reference product, minimum 3 time points
(excluding time zero), and twelve individual profiles for each formulation.
Other requirements are slightly different among different regulatory
guidelines, or at least interpreted differently. Two main issues are the
rules for the variability (CV Rule) and time points where dissolution is more
than 85% (85% Rule).
</p>


<h5>CV rule</h5>


<ul>
<li> <p><code>EMA</code>, <code>Canada</code>, and <code>ANVISA</code>: The CV of the <em>first time point</em> should not
be greater than 20%, and the CV of the rest time points should not be
greater than 10%.
</p>
</li>
<li> <p><code>WHO</code>: The CV should not be greater than 20% for <em>time points up to
10 min</em>, and not greater than 10% for the rest time points.
</p>
</li>
<li> <p><code>FDA</code>: US FDA is more flexible. The CV for the <em>early time points</em> should
not be greater than 20%, and for the rest time points, not greater than
10%.
</p>
</li>
</ul>
<p>The phrase <em>the first time point</em> in <code>EMA</code> rule was later interpreted as all
time points up to 10 min, according to an unofficial communication with an
European regulator. This makes the <em><code>EMA</code> rule the same as <code>WHO</code> rule</em>. For
example, if there are 5 min and 10 min time points in the dissolution
profiles, the CV for both 5 min and 10 min should not be greater than 20%.
</p>
<p>The <em>first time point</em> in <code>ANVISA</code> rule corresponds to <em>40% of the total
collected points</em>. For example, for a dissolution profile with five
collection times, the first two collection times are considered first points.
</p>
<p>The phrase <em>early time points</em> in <code>FDA</code> rule is typically interpreted as
those points up to 15 min, sometimes even up to 20 min according to
an unofficial communication with FDA staff. In the function <code>calcf2()</code>, the
cutting point for FDA rule is 15 min.
</p>



<h5>85% Rule</h5>

<p>This rule is implemented as follows:
</p>

<ul>
<li> <p><code>EMA</code>, <code>FDA</code>, <code>Canada</code>, and <code>ANVISA</code>: Only one measurement is considered
after 85% of dissolution for any product.
</p>
</li>
<li> <p><code>WHO</code>: Dissolution profiles should be 'cut' at the time point where
the reference release more than 85%. Therefore, <code>WHO</code> rule only differs
from rule of <code>EMA</code>, <code>FDA</code>, <code>Canada</code>, and <code>ANVISA</code> when test product
dissolve faster than reference. If reference product dissolve faster, then
rules of all five regulatory bodies are same in this regard.
</p>
</li>
</ul>
<h5>Notes on conventional FDA rule</h5>

<p>The exact phrase in the guidance of US FDA regarding this rule is that
"<em>Only one measurement should be considered after 85% dissolution of both
the products</em>." Due to the ambiguous word "both" used in the sentence, the
conventional interpretation was that all measurements up to the time point
at which both test and reference dissolved more than 85% should be included
in the calculation of <code class="reqn">f_2</code>. However, this is only true when both
test and reference dissolve more than 85% at the same time points.
</p>
<p>Consider the following example:</p>

<table>
<tr>
<td style="text-align: right;">
   time </td>
<td style="text-align: right;"> test </td>
<td style="text-align: right;"> reference </td>
</tr>
<tr>
<td style="text-align: right;">
   5 </td>
<td style="text-align: right;"> 7 </td>
<td style="text-align: right;"> 10 </td>
</tr>
<tr>
<td style="text-align: right;">
   10 </td>
<td style="text-align: right;"> 15 </td>
<td style="text-align: right;"> 20 </td>
</tr>
<tr>
<td style="text-align: right;">
   15 </td>
<td style="text-align: right;"> 50 </td>
<td style="text-align: right;"> 55 </td>
</tr>
<tr>
<td style="text-align: right;">
   20 </td>
<td style="text-align: right;"> 69 </td>
<td style="text-align: right;"> 86 </td>
</tr>
<tr>
<td style="text-align: right;">
   30 </td>
<td style="text-align: right;"> 82 </td>
<td style="text-align: right;"> 90 </td>
</tr>
<tr>
<td style="text-align: right;">
   45 </td>
<td style="text-align: right;"> 84 </td>
<td style="text-align: right;"> 95 </td>
</tr>
<tr>
<td style="text-align: right;">
   60 </td>
<td style="text-align: right;"> 86 </td>
<td style="text-align: right;"> 97 </td>
</tr>
<tr>
<td style="text-align: right;">
</td>
</tr>
</table>
<p>According to conventional interpretation, all measurements up to 60 min
should be included to calculate <code class="reqn">f_2</code> because both test and reference
dissolved more than 85% only at 60 min, not at any earlier time point.
However, in such case, there would be 4 measurement of reference (20, 30, 45,
and 60 min) included in the calculation, which would be a direct
contradictory to the phrase "Only <em>one measurement</em> should be considered
after 85% ..." in the same statement in the guidance!
</p>
<p>In an unofficial communication using this example, an FDA staff confirmed
that only the first 4 time points (up to 20 min) would be used. In other
words, <em>FDA rule in this regard is the same as EMA rule</em>.
</p>
<p>The statement in <code>ANVISA</code> guideline also uses the word "ambos" (means both),
which could also lead to the similar confusion. Follow the same logic as
demonstrated above, it should also be interpreted as the same rule in EMA
guideline.
</p>
<p>Read vignette <em>Introduction to bootf2</em> for more details.
</p>




<h3>Value</h3>

<p>A <em>data frame</em> of <code class="reqn">f_2</code> type and <code class="reqn">f_2</code> value, the
number of time points used for the calculation (<code>f2.tp</code>), indication if
both test and reference dissolve more than 85% at 15 min (<code>d85at15</code>), and
other information used for the calculation.
</p>


<h3>Examples</h3>

<pre><code class="language-R">tp &lt;- c(5, 10, 15, 20, 30, 45, 60)

mod.par.t &lt;- list(fmax = 100, fmax.cv = 2, tlag = 0, tlag.cv = 0,
                  mdt = 20, mdt.cv = 5, beta = 2.2, beta.cv = 5)

d.t &lt;- sim.dp(tp, model.par = mod.par.t, seed = 100, n.units = 120L,
              plot = FALSE)$sim.disso

mod.par.r &lt;- list(fmax = 100, fmax.cv = 2, tlag = 0, tlag.cv = 0,
                  mdt = 25, mdt.cv = 4, beta = 2.1, beta.cv = 3)

d.r &lt;- sim.dp(tp, model.par = mod.par.r, seed = 100, n.units = 120L,
              plot = FALSE)$sim.disso

# set `message = TRUE` to view the compliance of the regulatory guidelines.
calcf2(d.t, d.r, plot = FALSE)

</code></pre>


</div>