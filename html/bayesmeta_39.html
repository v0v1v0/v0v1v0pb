<div class="container">

<table style="width: 100%;"><tr>
<td>normalmixture</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Compute normal mixtures
</h2>

<h3>Description</h3>

<p>This function allows to derive density, distribution function and
quantile function of a normal mixture with fixed mean (<code class="reqn">\mu</code>) and
random standard deviation (<code class="reqn">\sigma</code>).
</p>


<h3>Usage</h3>

<pre><code class="language-R">  normalmixture(density,
                cdf = Vectorize(function(x){integrate(density,0,x)$value}),
                mu = 0, delta = 0.01, epsilon = 0.0001,
                rel.tol.integrate = 2^16*.Machine$double.eps,
                abs.tol.integrate = rel.tol.integrate,
                tol.uniroot = rel.tol.integrate)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>density</code></td>
<td>

<p>the <code class="reqn">\sigma</code> mixing distribution's probability density
<code>function</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cdf</code></td>
<td>

<p>the <code class="reqn">\sigma</code> mixing distribution's cumulative distribution
<code>function</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu</code></td>
<td>

<p>the normal mean (<code class="reqn">\mu</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>delta, epsilon</code></td>
<td>

<p>the parameters specifying the desired accuracy for approximation of
the mixing distribution, and with that determining the number of
<code class="reqn">\sigma</code> support points being used internally. Smaller values
imply greater accuracy and greater computational burden (Roever and
Friede, 2017).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rel.tol.integrate, abs.tol.integrate, tol.uniroot</code></td>
<td>

<p>the <code>rel.tol</code>, <code>abs.tol</code> and <code>tol</code>
‘accuracy’ arguments that are passed to
the <code>integrate()</code> or <code>uniroot()</code> functions
for internal numerical integration or root finding
(see also the help there).
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>When a normal random variable
</p>
<p style="text-align: center;"><code class="reqn">X|\mu,\sigma \;\sim\; \mathrm{Normal}(\mu,\sigma^2)</code>
</p>

<p>has a fixed mean <code class="reqn">\mu</code>, but a random standard deviation
</p>
<p style="text-align: center;"><code class="reqn">\sigma|\phi \;\sim\; \mathrm{G}(\phi)</code>
</p>

<p>following some probability distribution <code class="reqn">\mathrm{G}(\phi)</code>,
then the <em>marginal distribution</em> of <code class="reqn">X</code>,
</p>
<p style="text-align: center;"><code class="reqn">X|\mu,\phi</code>
</p>

<p>is a <em>mixture distribution</em> (Lindsay, 1995; Seidel, 2010).
</p>
<p>The mixture distribution's probability density function etc. result
from integration and often are not available in analytical form.
The <code>normalmixture()</code> function approximates density,
distribution function and quantile function to some pre-set accuracy
by a <em>discrete</em> mixture of normal distributions based on a finite
number of <code class="reqn">\sigma</code> values using the ‘DIRECT’ algorithm
(Roever and Friede, 2017).
</p>
<p>Either the “<code>density</code>” or “<code>cdf</code>” argument
needs to be supplied. If only “<code>density</code>” is given, then
the CDF is derived via integration, if only “<code>cdf</code>” is
supplied, then the density function is not necessary.
</p>
<p>In <b>meta-analysis</b> applications, mixture distributions arise
e.g. in the
context of <b>prior predictive distributions</b>. Assuming
that a study-specific effect <code class="reqn">\theta_i</code> <em>a
priori</em> is distributed as
</p>
<p style="text-align: center;"><code class="reqn">\theta_i|\mu,\tau \;\sim\; \mathrm{Normal}(\mu,\tau^2)</code>
</p>

<p>with a prior distribution for the heterogeneity <code class="reqn">\tau</code>,
</p>
<p style="text-align: center;"><code class="reqn">\tau|\phi \;\sim\; \mathrm{G}(\phi)</code>
</p>

<p>yields a setup completely analogous to the above one.
</p>
<p>Since it is sometimes hard to judge what constitutes a sensible
heterogeneity prior, it is often useful to inspect the implications of
certain settings in terms of the corresponding <em>prior predictive
distribution</em> of
</p>
<p style="text-align: center;"><code class="reqn">\theta_i|\mu,\phi</code>
</p>

<p>indicating the <em>a priori</em> implied variation between studies due
to heterogeneity alone based on a certain prior setup (Spiegelhalter
et al., 2004, Sec. 5.7.3). Some examples using different heterogeneity
priors are illustrated below.
</p>


<h3>Value</h3>

<p>A <code>list</code> containing the following elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>delta, epsilon</code></td>
<td>
<p>The supplied design parameters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu</code></td>
<td>
<p>the normal mean.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bins</code></td>
<td>
<p>the number of bins used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>support</code></td>
<td>
<p>the matrix containing lower, upper and reference points
for each bin and its associated probability.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>density</code></td>
<td>
<p>the mixture's density <code>function(x)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cdf</code></td>
<td>
<p>the mixture's cumulative distribution <code>function(x)</code> (CDF).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantile</code></td>
<td>
<p>the mixture's quantile <code>function(p)</code> (inverse CDF).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mixing.density</code></td>
<td>
<p>the mixing distribution's density
<code>function()</code> (if supplied).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mixing.cdf</code></td>
<td>
<p>the mixing distribution's cumulative distribution
<code>function()</code>.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Christian Roever <a href="mailto:christian.roever@med.uni-goettingen.de">christian.roever@med.uni-goettingen.de</a>
</p>


<h3>References</h3>

<p>B.G. Lindsay.
<em>Mixture models: theory, geometry and applications</em>.
Vol. 5 of <em>CBMS Regional Conference Series in Probability and
Statistics</em>, 
Institute of Mathematical Statistics, Hayward, CA, USA, 1995.
</p>
<p>C. Roever, T. Friede.
Discrete approximation of a mixture distribution via restricted divergence.
<em>Journal of Computational and Graphical Statistics</em>,
<b>26</b>(1):217-222, 2017.
<a href="https://doi.org/10.1080/10618600.2016.1276840">doi:10.1080/10618600.2016.1276840</a>.
</p>
<p>C. Roever.
Bayesian random-effects meta-analysis using the bayesmeta R package.
<em>Journal of Statistical Software</em>, <b>93</b>(6):1-51, 2020.
<a href="https://doi.org/10.18637/jss.v093.i06">doi:10.18637/jss.v093.i06</a>.
</p>
<p>C. Roever, R. Bender, S. Dias, C.H. Schmid, H. Schmidli, S. Sturtz,
S. Weber, T. Friede.
On weakly informative prior distributions for the heterogeneity
parameter in Bayesian random-effects meta-analysis.
<em>Research Synthesis Methods</em>, <b>12</b>(4):448-474, 2021.
<a href="https://doi.org/10.1002/jrsm.1475">doi:10.1002/jrsm.1475</a>.
</p>
<p>W.E. Seidel. Mixture models.
In: M. Lovric (ed.),
<em>International Encyclopedia of Statistical Science</em>,
Springer, Heidelberg, pp. 827-829, 2010.
</p>
<p>D.J. Spiegelhalter, K.R. Abrams, J.P.Myles.
<em>Bayesian approaches to clinical trials and health-care
evaluation</em>. 
Wiley &amp; Sons, 2004.
</p>


<h3>See Also</h3>

<p><code>bayesmeta</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">##################################################################
# compare half-normal mixing distributions with different scales:
nm05 &lt;- normalmixture(cdf=function(x){phalfnormal(x, scale=0.5)})
nm10 &lt;- normalmixture(cdf=function(x){phalfnormal(x, scale=1.0)})
# (this corresponds to the case of assuming a half-normal prior
# for the heterogeneity tau)

# check the structure of the returned object:
str(nm05)

# show density functions:
# (these would be the marginal (prior predictive) distributions
# of study-specific effects theta[i])
x &lt;- seq(-1, 3, by=0.01)
plot(x, nm05$density(x), type="l", col="blue", ylab="density")
lines(x, nm10$density(x), col="red")
abline(h=0, v=0, col="grey")

# show cumulative distributions:
plot(x, nm05$cdf(x), type="l", col="blue", ylab="CDF")
lines(x, nm10$cdf(x), col="red")
abline(h=0:1, v=0, col="grey")

# determine 5 percent and 95 percent quantiles:
rbind("HN(0.5)"=nm05$quantile(c(0.05,0.95)),
      "HN(1.0)"=nm10$quantile(c(0.05,0.95)))


##################################################################
# compare different mixing distributions
# (half-normal, half-Cauchy, exponential and Lomax):
nmHN &lt;- normalmixture(cdf=function(x){phalfnormal(x, scale=0.5)})
nmHC &lt;- normalmixture(cdf=function(x){phalfcauchy(x, scale=0.5)})
nmE  &lt;- normalmixture(cdf=function(x){pexp(x, rate=2)})
nmL  &lt;- normalmixture(cdf=function(x){plomax(x, shape=4, scale=2)})

# show densities (logarithmic y-axis):
x &lt;- seq(-1, 3, by=0.01)
plot(x,  nmHN$density(x), col="green",  type="l", ylab="density", ylim=c(0.005, 6.5), log="y")
lines(x, nmHC$density(x), col="red")
lines(x, nmE$density(x),  col="blue")
lines(x, nmL$density(x),  col="cyan")
abline(v=0, col="grey")

# show CDFs:
plot(x,  nmHN$cdf(x), col="green",  type="l", ylab="CDF", ylim=c(0,1))
lines(x, nmHC$cdf(x), col="red")
lines(x, nmE$cdf(x),  col="blue")
lines(x, nmL$cdf(x),  col="cyan")
abline(h=0:1, v=0, col="grey")
# add "exponential" x-axis at top:
axis(3, at=log(c(0.5,1,2,5,10,20)), lab=c(0.5,1,2,5,10,20))
# show 95 percent quantiles:
abline(h=0.95, col="grey", lty="dashed")
abline(v=nmHN$quantile(0.95), col="green", lty="dashed")
abline(v=nmHC$quantile(0.95), col="red", lty="dashed")
abline(v=nmE$quantile(0.95),  col="blue", lty="dashed")
abline(v=nmL$quantile(0.95),  col="cyan", lty="dashed")
rbind("half-normal(0.5)"=nmHN$quantile(0.95),
      "half-Cauchy(0.5)"=nmHC$quantile(0.95),
      "exponential(2.0)"=nmE$quantile(0.95),
      "Lomax(4,2)"      =nmL$quantile(0.95))


#####################################################################
# a normal mixture distribution example where the solution
# is actually known analytically: the Student-t distribution.
# If  Y|sigma ~ N(0,sigma^2),  where  sigma = sqrt(k/X)
# and  X|k ~ Chi^2(df=k),
# then the marginal  Y|k  is Student-t with k degrees of freedom.

# define CDF of sigma:
CDF &lt;- function(sigma, df){pchisq(df/sigma^2, df=df, lower.tail=FALSE)}

# numerically approximate normal mixture (with k=5 d.f.):
k &lt;- 5
nmT1 &lt;- normalmixture(cdf=function(x){CDF(x, df=k)})
# in addition also try a more accurate approximation:
nmT2 &lt;- normalmixture(cdf=function(x){CDF(x, df=k)}, delta=0.001, epsilon=0.00001)
# check: how many grid points were required?
nmT1$bins
nmT2$bins

# show true and approximate densities:
x &lt;- seq(-2,10,le=400)
plot(x, dt(x, df=k), type="l")
abline(h=0, v=0, col="grey")
lines(x, nmT1$density(x), col="red", lty="dashed")
lines(x, nmT2$density(x), col="blue", lty="dotted")

# show ratios of true and approximate densities:
plot(x, nmT1$density(x)/dt(x, df=k), col="red",
     type="l", log="y", ylab="density ratio")
abline(h=1, v=0, col="grey")
lines(x, nmT2$density(x)/dt(x, df=k), col="blue")
</code></pre>


</div>