<div class="container">

<table style="width: 100%;"><tr>
<td>WPTOSpickout</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Find nonstationarities in a time series
</h2>

<h3>Description</h3>

<p>The nonstationarities are located by looking for significant
Haar wavelet coefficients of a b-spectrum of a time series (a b-spectrum
is the expectation of a wavelet packet periodgram). The significant
Haar coefficients can locate discontinuities in space and time.
</p>


<h3>Usage</h3>

<pre><code class="language-R">WPTOSpickout(x, level, index, filter.number = 1, family = "DaubExPhase",
	plot.it = FALSE, verbose = FALSE, lowlev = 3, highlev, nomsize = 0.05)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The time series you wish to analyse.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>The level of the b-spectrum you want to examine.
See help for <code>BootWPTOS</code> for more information
on levels.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index</code></td>
<td>
<p>The index of the b-spectrum you want to examine.
See help for <code>BootWPTOS</code> for more information
on indices you can chose.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter.number</code></td>
<td>
<p>The filter number of the underlying wavelet
you wish to examine.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>The family of the underlying wavelet you wish to examine.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot.it</code></td>
<td>
<p>If <code>TRUE</code> this plots the time series <code>x</code> as
supplied. Then, superimposed in red, is the raw wavelet packet
periodogram. The Haar wavelet coefficients of the red signal are
examined for whether they are deemed non-zero or not using
asymptotic normality results. If <code>FALSE</code> then no such plot
is produced.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>If <code>TRUE</code> then a single line indicating the
number of significant coefficients found is printed.
If <code>FALSE</code> then the function prints nothing.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lowlev</code></td>
<td>
<p>Keep away from coarse scales. Typically, Haar wavelet
coefficients at the coarse scales are contaminated by boundary
effects. These won't usually cause a problem at scales 3 or higher,
or maybe 2. Only coefficients at scales <code>lowlev</code> or finer
will be selected for testing.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>highlev</code></td>
<td>
<p>Keep away from fine scales. The testing of Haar
wavelet coeffients depends on utilizing enough data points
to enable asymptotic normality to kick in. At the finest scale
only TWO single points are compared and the distribution of each
point might be far from normality. At coarser scales TWO averages
are compared and those averages will consist of many points.
E.g. at the third finest scale each average will consist of four
points, at the fourth finest scale each average will consist of
8 points, etc. By default this argument is set to be roughly the
use a scale one level finer than the halfway number of levels.
So, if J=10, then highlev is 6. The formula is
floor(J/2)+1. Note: highlev and lowlev should be specified
in the WaveThresh scaling (e.g. scale 0 is the coarsest scale) 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nomsize</code></td>
<td>
<p>The nominal size of the test as a number between
0 and 1. So, if you want a 5
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function computes the nondecimated wavelet packet
transform of the packet you specified by
<code>level</code> and <code>index</code>. Note: you can only specify
one number for each of these. Then the b-spectrum (raw
wavelet packet periodogram) is formed by squaring the
nondecimated wavelet packet transform. Then the Haar
wavelet coefficients are obtained for the b-spectrum and
a multiple hypothesis test is performed on all the Haar
wavelet coefficients between scales lowlev and highlev.
The function return information about any significant wavelet
coefficients.
</p>


<h3>Value</h3>

<p>A list of class <code>toswp</code> containing the following
components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>The time series that was analyzed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>The level of the b-spectrum that we wanted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>index</code></td>
<td>
<p>The index of the b-spectrum that we wanted</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigcoefs</code></td>
<td>
<p>A wd class object containing the significant Haar
wavelet coefficients, if there are any</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nreject</code></td>
<td>
<p>The number of significant Haar wavelet coefficients</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ntests</code></td>
<td>
<p>The total number of hypothesis tests carried out in the
multiple hypothesis test</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bonsize</code></td>
<td>
<p>The Bonferroni corrected rate for the multiple hypothesis
test</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>G.P. Nason
</p>


<h3>References</h3>

<p>Cardinali, A. and Nason, G.P. (2016) Practical Powerful Wavelet Packet Tests
for Second-Order Stationarity. Applied and Computational Harmonic
Analysis, 2016
<a href="https://doi.org/10.1016/j.acha.2016.06.006">doi:10.1016/j.acha.2016.06.006</a>
</p>


<h3>See Also</h3>

<p><code>BootWPTOS</code>, <code>plot.toswp</code>, <code>print.toswp</code>,
<code>summary.toswp</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#
# Create some simulated data
#
x2 &lt;- c(rnorm(256), rnorm(256, 2))
#
# The following call to BootWPTOS (generic tester) 
#
# [We're not running them in R package testing as they can be quite intensive]
#
## Not run: x2.tos &lt;- BootWPTOS(x2, levs=5, indices=1, Bsims=500)
## Not run: x2.tos
#
#	WPBootTOS test of stationarity
#
#data:  x2
#= 5.2826, p-value &lt; 2.2e-16
#
# So, test indicates that strong evidence for nonstationarity. 
#
# Now let's do the multiple Haar hypothesis test.
#
x2.po &lt;- WPTOSpickout(x=x2, level=7, index=1)
x2.po
#Class 'toswp' : Wavelet Packet Test of Stationarity Object :
#       ~~~~  : List with 7 components with names
#              x level index sigcoefs nreject ntests bonsize 
#
#
#summary(.):
#----------
#Number of individual tests: 56 
#Bonferroni p-value was: 0.0008928571 
#Tests rejected: 2 
#Listing Bonferroni rejects...
#Wavelet Packet  (5,1): HWTlev: 4. Indices: 8  
#Wavelet Packet  (5,1): HWTlev: 5. Indices: 16 
#
# So, this test also shows nonstationarities. For this packet (5,1)
# two significant Haar coefficients were identified. One was at level 4
# position 8 and the other was at scale level 5 position 16.
#
# You can plot them also
#
plot(x2.po)
#
# You should get a nice plot of the time series with double-headed red
# arrows indicating the location and extent of the nonstationarities.
# For this example, where the spectrum changes dramatically at the halfway
# point - this is where the arrows should be located. Of course, with random
# data you might see other arrows in other locations, but this should be
# unlikely and on repeating the above they should not persist.
</code></pre>


</div>