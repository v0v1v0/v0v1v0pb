<div class="container">

<table style="width: 100%;"><tr>
<td>hgp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Hierarchical Gaussian Process Model for Dissolution Profile Modeling</h2>

<h3>Description</h3>

<p>This function implements the Bayesian hierarchical Gaussian process model described in Pourmohamad et al (2022).
</p>


<h3>Usage</h3>

<pre><code class="language-R">hgp(
  dis_data,
  locs,
  B = 1000,
  n_interp = 30,
  control = list(),
  adaptive = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dis_data</code></td>
<td>
<p>A data frame containing the dissolution data. The first column of the data frame should denote
the group labels identifying whether a given dissolution belongs to the "reference" or "test" formulation group.
For a given dissolution run, the remaining columns of the data frame contains the individual run's dissolution
measurements sorted in time. Alternatively, the user may provide a data object of class dis_data containing the
dissolution data. See the <code>make_dis_data()</code> function for the particular structure of the data object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>locs</code></td>
<td>
<p>A vector in ascending order that corresponds to each time point the dissolution data was measured at.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B</code></td>
<td>
<p>A positive integer specifying the number of posterior samples to draw. By default <code>B</code> is set to 10000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n_interp</code></td>
<td>
<p>An integer value specifying the number of time points to interpolate at. This sets the interploated points to be to <code>seq(1st time point, last time point, length = n_interp)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>An optional list of priors and initial values, otherwise the default values/strategies found in Pourmohamad et al (2022) will be used. More specifically, <code>control</code> can be used to define the following settings:
</p>

<ul>
<li> <p><code>sigma2_starting</code>: starting value for sigma^2
</p>
</li>
<li> <p><code>tau2_starting</code>: starting value for tau^2
</p>
</li>
<li> <p><code>phi_starting</code>: starting value for phi
</p>
</li>
<li> <p><code>psi_starting</code>: starting value for psi
</p>
</li>
<li> <p><code>sigma2_alpha</code> and <code>sigma2_beta</code>: parameters for the inverse gamma prior for sigma^2
</p>
</li>
<li> <p><code>tau2_alpha</code> and <code>tau2_beta</code>: parameters for the inverse gamma prior for tau^2
</p>
</li>
<li> <p><code>phi_alpha</code> and <code>phi_beta</code>: parameters for the gamma prior for phi
</p>
</li>
<li> <p><code>psi_alpha</code> and <code>psi_beta</code>: parameters for the gamma prior for psi
</p>
</li>
<li> <p><code>prop_phi</code>: proposal variance for the parameter phi
</p>
</li>
<li> <p><code>prop_psi</code>: proposal variance for the parameter psi
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adaptive</code></td>
<td>
<p>logical; an option for using adaptive MCMC. If <code>adaptive = TRUE</code>, this will replace both <code>prop_phi</code> and <code>prop_psi</code> by using past MCMC draws to inform the proposal variance.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The function returns a list of summary statistics and B posterior samples for parameters of the model. More specifically it returns:
</p>

<ul>
<li>
<p> delta: The average delta value over the posterior samples of delta. The definition of delta is given in Novick et. al 2015.
</p>
</li>
<li>
<p> f2: The average f2 value over the posterior samples of f2.
</p>
</li>
<li>
<p> mcmc_chains: A list of posterior samples for delta, f2, the mean parameters (<code>mu_pars</code>), and the covariance parameters (<code>cov_pars</code>).
</p>
</li>
</ul>
<h3>Note</h3>

<p>You should always check MCMC diagnostics on the posterior samples before drawing conclusions. Likewise, plots of the predicted dissolution curves should also be checked to evaluate if the model fit to the observed data seems reasonable.
</p>


<h3>References</h3>

<p>Novick, S., Shen, Y., Yang, H., Peterson, J., LeBlond, D., and Altan, S. (2015). Dissolution Curve Comparisons Through the F2 Parameter, a Bayesian Extension of the f2 Statistic. Journal of Biopharmaceutical Statistics, 25(2):351-371.
</p>
<p>Pourmohamad, T., Oliva Aviles, C.M., and Richardson, R. Gaussian Process Modeling for Dissolution Curve Comparisons. Journal of the Royal Statistical Society, Series C, 71(2):331-351.
</p>


<h3>Examples</h3>

<pre><code class="language-R">### dis_data comes loaded with the package
### We set B = 100 to obtain 100 posterior samples, you probably want to run it
### longer for say, B = 100000, but B = 100 runs fast for illustrative purposes
### and passing CRAN checks
B &lt;- 100

tp &lt;- seq(10, 80, 10) # Time points
burnin &lt;- B * 0.1     # A 10% burn-in
thin &lt;- 10            # Keep every 10th sample, i.e., thinning
post &lt;- hgp(dis_data, locs = tp, B = B, n_interp = 100)

### Example: Removing burn-in and then thinning the posterior samples for the covariance parameters
###          and then plotting the chains
phi &lt;- post$mcmc_chains$cov_pars$phi[-c(1:burnin)]
phi &lt;- phi[seq(1, (B-burnin), thin)]
psi &lt;- post$mcmc_chains$cov_pars$psi[-c(1:burnin)]
psi &lt;- psi[seq(1, (B-burnin), thin)]
sigma_R &lt;- post$mcmc_chains$cov_pars$sigma_R[-c(1:burnin)]
sigma_R &lt;- sigma_R[seq(1, (B-burnin), thin)]
sigma_T &lt;- post$mcmc_chains$cov_pars$sigma_T[-c(1:burnin)]
sigma_T &lt;- sigma_T[seq(1, (B-burnin), thin)]
tau &lt;- post$mcmc_chains$cov_pars$tau[-c(1:burnin)]
tau &lt;- tau[seq(1, (B-burnin), thin)]

chains &lt;- data.frame( # Data frame holding posterior samples
samples = rep(1:((B-burnin)/thin), times = 5),
parameter = rep(c("phi", "psi", "sigma_R", "sigma_T", "tau"),
                each = (B-burnin)/thin),
values = c(phi, psi, sigma_R, sigma_T, tau))
chains$parameter &lt;- factor(chains$parameter,
                           labels = c(expression(phi),
                                      expression(psi),
                                      expression(sigma[R]),
                                      expression(sigma[T]),
                                      expression(tau)))
ggplot2::ggplot(chains, ggplot2::aes(samples, values)) +
 ggplot2::geom_line() +
 ggplot2::labs(x = "Iterations", y = "Posterior Sample Values") +
 ggplot2::facet_wrap(~parameter, scales = "free",
             labeller = ggplot2::label_parsed) +
 ggplot2::theme(text = ggplot2::element_text(size = 22))

ggplot2::ggplot(chains, ggplot2::aes(values)) +
 ggplot2::geom_density() +
 ggplot2::labs(x = "Values", y = "Posterior Density") +
 ggplot2::facet_wrap(~parameter, scales = "free",
            labeller = ggplot2::label_parsed) +
 ggplot2::theme(text = ggplot2::element_text(size = 22))

### Plotting the predicted dissolution profiles
dissplot(dis_data, tp)
grid &lt;- sort(c(tp, seq(min(tp), max(tp), length = 100)))
grid1 &lt;- (1:B)[-(1:burnin)][seq(1, (B-burnin), thin)]
grid2 &lt;- ((B+1):(2*B))[-(1:burnin)][seq(1, (B-burnin), thin)]
lines(grid, apply(post$mcmc_chains$mu_pars[,grid1], 1, mean),
      col = "gray65", lwd = 2)
lines(grid, apply(post$mcmc_chains$mu_pars[,grid2], 1, mean),
      col = "black", lwd = 2)
lower &lt;- apply(post$mcmc_chains$mu_pars[,grid1], 1,
               quantile, prob = 0.025)
upper &lt;- apply(post$mcmc_chains$mu_pars[,grid1], 1,
               quantile, prob = 0.975)
polygon(c(grid, rev(grid)), c(lower, rev(upper)),
        col = scales::alpha("gray65",.2), border = NA)
lower &lt;- apply(post$mcmc_chains$mu_pars[,grid2], 1,
              quantile, prob = 0.025)
upper &lt;- apply(post$mcmc_chains$mu_pars[,grid2], 1,
               quantile, prob = 0.975)
polygon(c(grid, rev(grid)), c(lower, rev(upper)),
        col = scales::alpha("black",.2), border = NA)

### If we want to calculate the Pr(f2 &gt; 50 &amp; delta &lt; 15)
prob &lt;- sum(post$mcmc_chains$f2[grid1] &gt; 50 &amp;
            post$mcmc_chains$delta[grid1] &lt; 15) / ((B - burnin)/thin)

</code></pre>


</div>