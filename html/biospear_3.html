<div class="container">

<table style="width: 100%;"><tr>
<td>expSurv</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Computation of expected survival based on a prediction model</h2>

<h3>Description</h3>

<p>Based on a prediction model, this function computes expected survival for patients with associated confidence intervals. The returned object can be plotted to obtain a meaningful graphical visualization.
</p>


<h3>Usage</h3>

<pre><code class="language-R">expSurv(res, traindata, method, ci.level = .95, boot = FALSE, nboot, smooth = TRUE,
  pct.group = 4, time, trace = TRUE, ncores = 1)

## S3 method for class 'resexpSurv'
predict(object, newdata, ...)

## S3 method for class 'resexpSurv'
plot(x, method, pr.group, print.ci = TRUE, 
  xlim, ylim, xlab, ylab, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>res</code></td>
<td>
<p>an object of class '<code>resBMsel</code>' generated by <code>BMsel</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>traindata</code></td>
<td>
<p>the <code>data.frame</code> used to compute the <code>res</code> object (training set).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>selection method to compute. If missing, all methods contained in <code>res</code> are computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ci.level</code></td>
<td>
<p>the nominal level for the two-sided confidence interval (CI) of the survival probability.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>boot</code></td>
<td>
<p>logical value: <code>TRUE</code> = boostraped CI, <code>FALSE</code> = analytical CI.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nboot</code></td>
<td>
<p>number of bootstrap replicates (only used when <code>boot</code>=<code>TRUE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smooth</code></td>
<td>
<p>logical value indicating if smoothed B-splines should be computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pct.group</code></td>
<td>
<p>number or percentile of the prognostic-risk groups. If a single number is provided, all the groups must be defined according to Cox (1957). If percentiles are provided, the sum must be 1 (e.g. 0.164, 0.336, 0.336, 0.164).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>single time point to estimate the expected survival probabilities.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trace</code></td>
<td>
<p>logical parameter indicating if messages should be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncores</code></td>
<td>
<p>number of CPUs used (for the bootstrap CI).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object, x</code></td>
<td>
<p>an object of class '<code>resexpSurv</code>' generated by <code>expSurv</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p><code>data.frame</code> containing new patients data. <code>newdata</code> must have the same variables as <code>traindata</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pr.group</code></td>
<td>
<p>parameter for the <code>plot()</code> indicating the number of the prognostic-risk group for which the plot will be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.ci</code></td>
<td>
<p>logical parameter for the <code>plot()</code> indicating if CI will be printed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim, ylim, xlab, ylab</code></td>
<td>
<p>usual parameters for plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other paramaters for predict or plot.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Using an object of class '<code>resBMsel</code>' generated by <code>BMsel</code>, <code>expSurv</code> computes expected survival at a given <code>time</code> and constructs confidence intervals thereof either with an analytical (<code>boot</code> = <code>FALSE</code>) or non-parametric bootstrap approach (<code>boot</code> = <code>TRUE</code>). Smoothed B-splines (logical option <code>smooth</code>) and categorization of the prognostic score into risk groups (using the option <code>pct.group</code>) may be used to obtain a meaningful graphical visualization. Predictions for new patients (<code>newdata</code> data frame) can be computed using <code>predict()</code>. Graphical visualization can be obtained using <code>plot()</code>.
</p>


<h3>Value</h3>

<p>A <code>list</code> of length three containing the expected survival (<code>surv</code>) and their corresponding confidence intervals (<code>lower</code> and <code>upper</code>). Each element of the list contains a <code>matrix</code> of dimension number of patients x number of implemented methods. 
</p>


<h3>Author(s)</h3>

<p>Nils Ternes, Federico Rotolo, and Stefan Michiels<br>
Maintainer: Nils Ternes <a href="mailto:nils.ternes@yahoo.com">nils.ternes@yahoo.com</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R">########################################
# Simulated data set
########################################

## Low calculation time
  set.seed(654321)
  sdata &lt;- simdata(
    n = 500, p = 20, q.main = 3, q.inter = 0,
    prob.tt = 0.5, alpha.tt = 0,
    beta.main = -0.8,
    b.corr = 0.6, b.corr.by = 4,
    m0 = 5, wei.shape = 1, recr = 4, fu = 2,
    timefactor = 1)

  resBM &lt;- BMsel(
    data = sdata, 
    method = c("lasso", "lasso-pcvl"), 
    inter = FALSE, 
    folds = 5)
  
  esurv &lt;- expSurv(
    res = resBM,
    traindata = sdata,
    boot = FALSE,
    time = 5,
    trace = TRUE)
  plot(esurv, method = "lasso-pcvl")

## Not run: 
## Moderate calculation time
  set.seed(123456)
  sdata &lt;- simdata(
    n = 500, p = 100, q.main = 5, q.inter = 5,
    prob.tt = 0.5, alpha.tt = -0.5,
    beta.main = c(-0.5, -0.2), beta.inter = c(-0.7, -0.4),
    b.corr = 0.6, b.corr.by = 10,
    m0 = 5, wei.shape = 1, recr = 4, fu = 2,
    timefactor = 1,
    active.inter = c("bm003", "bm021", "bm044", "bm049", "bm097"))

  resBM &lt;- BMsel(
    data = sdata, 
    method = c("lasso", "lasso-pcvl"), 
    inter = TRUE, 
    folds = 5)
  
  esurv &lt;- expSurv(
    res = resBM,
    traindata = sdata,
    boot = TRUE,
    nboot = 100,
    smooth = TRUE,
    pct.group = 4,
    time = 5,
    ncores = 5)
  plot(esurv, method = "lasso", pr.group = 3)

## End(Not run)  

########################################
# Breast cancer data set
########################################

## Not run: 
  data(Breast)
  dim(Breast)

  set.seed(123456)
  resBM &lt;-  BMsel(
    data = Breast,
    x = 4:ncol(Breast),
    y = 2:1,
    tt = 3,
    inter = FALSE,
    std.x = TRUE,
    folds = 5,
    method = c("lasso", "lasso-pcvl"))

  esurv &lt;- expSurv(
    res = resBM,
    traindata = Breast,
    boot = FALSE,
    smooth = TRUE,
    time = 4,
    trace = TRUE
  )
  plot(esurv, method = "lasso")


## End(Not run)

########################################
########################################
</code></pre>


</div>