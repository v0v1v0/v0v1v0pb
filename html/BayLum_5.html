<div class="container">

<table style="width: 100%;"><tr>
<td>Age_Computation</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bayesian analysis for the OSL age estimation of one sample</h2>

<h3>Description</h3>

<p>This function computes the age (in ka) of a sample according to the model developed in Combes and Philippe (2017),
based on an output of Generate_DataFile or Generate_DataFile_MG.<br>
A sample, for which data is available in several BIN files, can be analysed.
</p>


<h3>Usage</h3>

<pre><code class="language-R">Age_Computation(
  DATA,
  SampleName = DATA$SampleNames[1],
  PriorAge = c(0.01, 100),
  BinPerSample = c(1),
  SavePdf = FALSE,
  OutputFileName = c("MCMCplot"),
  OutputFilePath = c(""),
  SaveEstimates = FALSE,
  OutputTableName = c("DATA"),
  OutputTablePath = c(""),
  LIN_fit = TRUE,
  Origin_fit = FALSE,
  distribution = c("cauchy"),
  I = 1,
  Iter = 50000,
  t = 5,
  n.chains = 3,
  quiet = FALSE,
  roundingOfValue = 3
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>DATA</code></td>
<td>
<p>list of objects: <code>LT</code>, <code>sLT</code>, <code>ITimes</code>, <code>dLab</code>, <code>ddot_env</code>, <code>regDose</code>, <code>J</code>, <code>K</code>, <code>Nb_measurement</code>,
provided by the function Generate_DataFile or Generate_DataFile_MG.
</p>
<p><code>DATA</code> can contain information for more than one sample.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SampleName</code></td>
<td>
<p>character: name of the sample.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PriorAge</code></td>
<td>
<p>numeric (with default): lower and upper bounds for the sample age parameter (in ka).
Note that, <code>length(PriorAge)=2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>BinPerSample</code></td>
<td>
<p>integer (with default): vector with the number of BIN files per sample.
If in <code>DATA</code> there is more than one sample,
the <code>BinPerSample</code> vector must be the same as that used to run the function
Generate_DataFile or in Generate_DataFile_MG for generating the <code>DATA</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SavePdf</code></td>
<td>
<p>logical (with default): if TRUE save graph in pdf file named <code>OutputFileName</code> in folder <code>OutputFilePath</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OutputFileName</code></td>
<td>
<p>character (with default): name of the pdf file that will be generated by the function if <code>SavePdf = TRUE</code>;
<code style="white-space: pre;">⁠length(OutputFileName = 2⁠</code>, see <strong>PLOT OUTPUT</strong> in <strong>Value</strong> section for more informations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OutputFilePath</code></td>
<td>
<p>character (with default): path to the pdf file that will be generated by the function if <code>SavePdf = TRUE</code>.
If it is not equal to "", it must be terminated by "/".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SaveEstimates</code></td>
<td>
<p>logical (with default): if TRUE save Bayes estimates and credible interval at level 68% and 95%  and
the result of the gelman en Rubin test of convergency, in a csv table named <code>OutputFileName</code> in folder <code>OutputFilePath</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OutputTableName</code></td>
<td>
<p>character (with default): name of the table that will be generated by the function if <code>SaveEstimates = TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>OutputTablePath</code></td>
<td>
<p>character (with default): path to the table that will be generated by the function if  <code>SaveEstimates = TRUE</code>.
If it is not equal to "", it must be terminated by "/".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>LIN_fit</code></td>
<td>
<p>logical (with default): if <code>TRUE</code> (default) allows a linear component,
on top of the (default) saturating exponential curve, for the fitting of dose response curves.
See details section for more informations on the proposed dose response curves.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Origin_fit</code></td>
<td>
<p>logical (with default): if <code>TRUE</code>, forces the dose response curves to pass through the origin.
See details section for more informations on the proposed growth curves.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distribution</code></td>
<td>
<p>character (with default): type of distribution that defines
how individual equivalent dose values are distributed around the palaeodose.
Allowed inputs are <code>"cauchy"</code>, <code>"gaussian"</code>, <code>"lognormal_A"</code> and <code>"lognormal_M"</code>, see details section for more informations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>I</code></td>
<td>
<p>integer (with default): if <code>DATA</code> contains data from more than one sample,
I indicates the ID number of the sample to be analysed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Iter</code></td>
<td>
<p>integer (with default): number of iterations for the MCMC computation (for more information see jags.model).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t</code></td>
<td>
<p>integer (with default): 1 every <code>t</code> iterations of the MCMC is considered for sampling the posterior distribution
(for more information see jags.model).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.chains</code></td>
<td>
<p>integer (with default): number of independent chains for the model (for more information see jags.model).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quiet</code></td>
<td>
<p>logical (with default): enables/disables rjags messages</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>roundingOfValue</code></td>
<td>
<p>integer (with default):  Integer indicating the number of decimal places to be used, default = 3.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><strong>Option on growth curves</strong><br></p>
<p>As for AgeS_Computation and Palaeodose_Computation, the user can choose from 4 dose response curves:
</p>

<ul>
<li> <p><strong>Saturating exponential plus linear growth</strong> (<code>AgeMultiBF_EXPLIN</code>):
</p>
<p>for all <code>x</code> in IR+, <code class="reqn">f(x)=a(1-exp(-x/b))+cx+d</code>; select
</p>

<ul>
<li> <p><code>LIN_fit=TRUE</code>
</p>
</li>
<li> <p><code>Origin_fit=FALSE</code>
</p>
</li>
</ul>
</li>
<li> <p><strong>Saturating exponential growth</strong> (<code>AgeMultiBF_EXP</code>):
</p>
<p>for all <code>x</code> in IR+, <code class="reqn">f(x)=a(1-exp(-x/b))+d</code>; select
</p>

<ul>
<li> <p><code>LIN_fit = FALSE</code>
</p>
</li>
<li> <p><code>Origin_fit = FALSE</code>
</p>
</li>
</ul>
</li>
<li> <p><strong>Saturating exponential plus linear growth and fitting through the origin</strong> (<code>AgeMultiBF_EXPLINZO</code>):
</p>
<p>for all <code>x</code> in IR+, <code class="reqn">f(x)=a(1-exp(-x/b))+cx</code>; select
</p>

<ul>
<li> <p><code>LIN_fit=TRUE</code>
</p>
</li>
<li> <p><code>Origin_fit=TRUE</code>
</p>
</li>
</ul>
</li>
<li> <p><strong>Saturating exponential growth and fitting through the origin</strong> (<code>AgeMultiBF_EXPZO</code>):
</p>
<p>for all <code>x</code> in IR+, <code class="reqn">f(x)=a(1-exp(-x/b))</code>; select
</p>

<ul>
<li> <p><code>LIN_fit=FALSE</code>
</p>
</li>
<li> <p><code>Origin_fit=TRUE</code>
</p>
</li>
</ul>
</li>
</ul>
<p><strong>Option on equivalent dose distribution around the palaeodose</strong><br></p>
<p>The use can choose between :
</p>

<ul>
<li> <p><code>cauchy</code>: a Cauchy distribution with location parameter equal to the palaeodose of the sample
</p>
</li>
<li> <p><code>gaussian</code>: a Gaussian distribution with mean equal to the palaeodose of the sample
</p>
</li>
<li> <p><code>lognormal_A</code>: a log-normal distribution with mean or <strong>A</strong>verage equal to the palaeodose of the sample
</p>
</li>
<li> <p><code>lognormal_M</code>: a log-normal distribution with <strong>M</strong>edian equal to the palaeodose of the sample
</p>
</li>
</ul>
<h3>Value</h3>

<p><strong>NUMERICAL OUTPUT</strong>
</p>

<ol>
<li> <p><strong>A list containing the following objects</strong>:
</p>

<ul>
<li> <p><strong>Sampling</strong> that corresponds to a sample of the posterior distributions
of the age (in ka), palaeodose (in Gy) and equivalent dose dispersion (in Gy) parameters.
</p>
</li>
<li> <p><strong>Model_GrowthCurve</strong>, stating which dose response fitting option was chosen;
</p>
</li>
<li> <p><strong>Distribution</strong>, stating which distribution was chosen to model the dispersion of
individual equivalent dose values around the palaeodose of the sample;
</p>
</li>
<li> <p><strong>PriorAge</strong>, stating the priors used for the age parameter (in ka).
</p>
</li>
</ul>
</li>
<li> <p><strong>The Gelman and Rubin test of convergency</strong>: prints the result of the Gelman and Rubin test of convergency for the age, palaeodose and equivalent dose dispersion parameters.
A result close to one is expected.<br>
In addition, the user must visually assess the convergency of the trajectories by looking at the graph
generated by the function (see <strong>PLOT OUTPUT</strong> for more informations).<br>
If both convergencies (Gelman and Rubin test and plot checking) are satisfactory,
the user can consider the printed estimates as valid. Otherwise, the user may try increasing the number of MCMC interations
(<code>Iter</code>), or being more precise on the <code>PriorAge</code> parameter (for example specify if it is a young sample <code>c(0.01,10)</code> an old sample <code>c(10,100)</code>),
or changing the parameter <code>distribution</code> or the growth curve, to reach convergency.to reach convergency.
</p>
</li>
<li> <p><strong>Credible intervals and Bayes estimates</strong>: prints the Bayes esitmates, the credible intervals at 95% and 68% for
the age, palaeodose and equivalent dose dispersion parameters of the sample.
</p>
</li>
</ol>
<p><strong>PLOT OUTPUT</strong>
</p>
<p>A graph with the MCMC trajectories and posterior distributions of the age, palaeodose and equivalent dose dispersion parameters is displayed.<br>
The first line of the figure correponds to the age parameter, the second to the palaeodose parameter and the third to the equivalent dose dispersion parameter.
On each line, the plot on the left represents the MCMC trajectories, and the one on the right the posterior distribution of the parameter.
</p>
<p>To give the results in a publication, we recommend to give the Bayes estimate of the parameter as well as the credible interval at 95% or 68%.
</p>


<h3>Note</h3>

<p>Please note that the initial values for all MCMC are currently all the same for all chains since we rely on the automatic
initial value generation of JAGS. This is not optimal and will be changed in future. However, it does not affect the quality
of the age estimates if the chains have converged.
</p>


<h3>Author(s)</h3>

<p>Claire Christophe, Sebastian Kreutzer, Anne Philippe, Guillaume Guérin
, RLum Developer Team</p>


<h3>References</h3>

<p>Combes, Benoit and Philippe, Anne, 2017.
Bayesian analysis of multiplicative Gaussian error for multiple ages estimation in optically
stimulated luminescence dating.
Quaternary Geochronology (39, 24-34)
</p>
<p>Combes, B., Philippe, A., Lanos, P., Mercier, N., Tribolo, C., Guerin, G., Guibert, P., Lahaye, C., 2015.
A Bayesian central equivalent dose model for optically stimulated luminescence dating.
Quaternary Geochronology 28, 62-70. doi:10.1016/j.quageo.2015.04.001
</p>


<h3>See Also</h3>

<p>Generate_DataFile, Generate_DataFile_MG, rjags, plot_MCMC, AgeS_Computation, Palaeodose_Computation
</p>


<h3>Examples</h3>

<pre><code class="language-R">## load data file generated by the function Generate_DataFile
data(DATA1,envir = environment())
priorage &lt;- c(10,60) # GDB3 is an old sample
Age &lt;- Age_Computation(
 DATA = DATA1,
 SampleName = "GDB3",
 PriorAge = priorage,
 Iter = 100,
 quiet = TRUE)

</code></pre>


</div>