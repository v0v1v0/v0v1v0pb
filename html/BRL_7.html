<div class="container">

<table style="width: 100%;"><tr>
<td>linkRecords</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bayes Estimates of Bipartite Matchings</h2>

<h3>Description</h3>

<p>Bayes point estimates of bipartite matchings that can be obtained 
in closed form according to Theorems 1, 2 and 3 of Sadinle (2017).
</p>


<h3>Usage</h3>

<pre><code class="language-R">linkRecords(Zchain, n1, lFNM = 1, lFM1 = 1, lFM2 = 2, lR = Inf)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>Zchain</code></td>
<td>
<p>matrix as the output <code>$Z</code> of the function <code>bipartiteGibbs</code>, with <code>n2</code> rows and <code>nIter</code> columns containing a chain 
of draws from a posterior distribution on bipartite matchings.  Each column indicates the records in datafile 1 to which the records in datafile 2 are matched according to that draw.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n1</code></td>
<td>
<p>number of records in datafile 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lFNM</code></td>
<td>
<p>individual loss of a false non-match in the loss functions of Sadinle (2017), default <code>lFNM=1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lFM1</code></td>
<td>
<p>individual loss of a false match of type 1 in the loss functions of Sadinle (2017), default <code>lFM1=1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lFM2</code></td>
<td>
<p>individual loss of a false match of type 2 in the loss functions of Sadinle (2017), default <code>lFM2=2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lR</code></td>
<td>
<p>individual loss of 'rejecting' to make a decision in the loss functions of Sadinle (2017), default <code>lR=Inf</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Not all combinations of losses <code>lFNM, lFM1, lFM2, lR</code> 
are supported.  The losses have to be positive numbers and satisfy one of three conditions:
</p>

<ol>
<li>
<p> Conditions of Theorem 1 of Sadinle (2017):
<code>(lR == Inf) &amp; (lFNM &lt;= lFM1) &amp; (lFNM + lFM1 &lt;= lFM2)</code>
</p>
</li>
<li>
<p> Conditions of Theorem 2 of Sadinle (2017):
<code>((lFM2 &gt;= lFM1) &amp; (lFM1 &gt;= 2*lR)) | ((lFM1 &gt;= lFNM) &amp; (lFM2 &gt;= lFM1 + lFNM))</code>
</p>
</li>
<li>
<p> Conditions of Theorem 3 of Sadinle (2017):
<code>(lFM2 &gt;= lFM1) &amp; (lFM1 &gt;= 2*lR) &amp; (lFNM &gt;= 2*lR)</code>
</p>
</li>
</ol>
<p>If one of the last two conditions is satisfied, the point estimate might be partial, meaning that there
might be some records in datafile 2 for which the point estimate does not include a linkage decision.
For combinations of losses not supported here, the linear sum assignment problem outlined by Sadinle (2017)
needs to be solved.
</p>


<h3>Value</h3>

<p>A vector containing the point estimate of the bipartite matching.  If <code>lR != Inf</code> the output might be a partial estimate.
A number smaller or equal to <code>n1</code> in entry <code>j</code> indicates the record in datafile 1 to which record <code>j</code> in datafile 2 
gets linked, a number <code>n1+j</code> indicates that record <code>j</code> does not get linked to any record in datafile 1, and the value <code>-1</code> 
indicates a 'rejection' to link, meaning that the correct linkage decision is not clear.
</p>


<h3>References</h3>

<p>Mauricio Sadinle (2017). Bayesian Estimation of Bipartite Matchings for Record Linkage. <em>Journal of the
American Statistical Association</em> 112(518), 600-612. [<a href="https://doi.org/10.1080/01621459.2016.1148612">Published</a>] [<a href="https://arxiv.org/abs/1601.06630">arXiv</a>]
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(twoFiles)

myCompData &lt;- compareRecords(df1, df2, flds=c("gname", "fname", "age", "occup"), 
                             types=c("lv","lv","bi","bi"))

chain &lt;- bipartiteGibbs(myCompData)

## discard first 100 iterations of Gibbs sampler

## full estimate of bipartite matching (full linkage)
fullZhat &lt;- linkRecords(chain$Z[,-c(1:100)], n1=nrow(df1), lFNM=1, lFM1=1, lFM2=2, lR=Inf)

## partial estimate of bipartite matching (partial linkage), where 
## lR=0.5, lFNM=1, lFM1=1 mean that we consider not making a decision for 
## a record as being half as bad as a false non-match or a false match of type 1
partialZhat &lt;- linkRecords(chain$Z[,-c(1:100)], n1=nrow(df1), lFNM=1, lFM1=1, lFM2=2, lR=.5)

## for which records the decision is not clear according to this set-up of the losses? 
undecided &lt;- which(partialZhat == -1)
df2[undecided,]

## compute frequencies of link options observed in the chain 
linkOptions &lt;- apply(chain$Z[undecided, -c(1:100)], 1, table)
linkOptions &lt;- lapply(linkOptions, sort, decreasing=TRUE)
linkOptionsInds &lt;- lapply(linkOptions, names)
linkOptionsInds &lt;- lapply(linkOptionsInds, as.numeric)
linkOptionsFreqs &lt;- lapply(linkOptions, function(x) as.numeric(x)/sum(x))

## first record without decision
df2[undecided[1],]

## options for this record; row of NAs indicates possibility that record has no match in df1
cbind(df1[linkOptionsInds[[1]],], prob = round(linkOptionsFreqs[[1]],3) )
</code></pre>


</div>