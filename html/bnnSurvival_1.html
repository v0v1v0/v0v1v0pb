<div class="container">

<table style="width: 100%;"><tr>
<td>bnnSurvival</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bagged k-nearest neighbors survival prediction</h2>

<h3>Description</h3>

<p>Bootstrap aggregated (bagged) version of the k-nearest neighbors survival probability prediction method (Lowsky et al. 2013). 
In addition to the bootstrapping of training samples, the features can be subsampled in each base learner.
</p>


<h3>Usage</h3>

<pre><code class="language-R">bnnSurvival(formula, data, k = max(1, nrow(data)/10),
  num_base_learners = 50, num_features_per_base_learner = NULL,
  metric = "mahalanobis", weighting_function = function(x) {     x * 0 + 1
  }, replace = TRUE, sample_fraction = NULL)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>Object of class formula or character describing the model to fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Training data of class data.frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>Number nearest neighbors to use. If a vector is given, the optimal k of these values is found using 5-fold cross validation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_base_learners</code></td>
<td>
<p>Number of base learners to use for bootstrapping.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_features_per_base_learner</code></td>
<td>
<p>Number of features randomly selected in each base learner. Default: all.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>metric</code></td>
<td>
<p>Metric d(x,y) used to measure the distance between observations. Currently only "mahalanobis".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weighting_function</code></td>
<td>
<p>Weighting function w(d(,x,y)) used to weight the observations based on their distance.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>replace</code></td>
<td>
<p>Sample with or without replacement.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_fraction</code></td>
<td>
<p>Fraction of observations to sample in [0,1]. Default is 1 for <code>replace=TRUE</code>, and 0.6321 for <code>replace=FALSE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For a description of the k-nearest neighbors survival probability prediction method see (Lowsky et al. 2013). 
Please note, that parallel processing, as currently implemented, does not work on Microsoft Windows platforms.
</p>
<p>The weighting function needs to be defined for all distances &gt;= 0. 
The default function is constant 1, a possible alternative is w(x) = 1/(1+x).
</p>
<p>To use the non-bagged version as in Lowsky et al. 2013, use <code>num_base_learners=1</code>, <code>replace=FALSE</code> and <code>sample_fraction=1</code>.
</p>


<h3>Value</h3>

<p>bnnSurvivalEnsemble object. Use predict() with a new data set to predict survival probabilites.
</p>


<h3>Author(s)</h3>

<p>Marvin N. Wright
</p>


<h3>References</h3>

<p>Lowsky, D.J. et al. (2013). A K-nearest neighbors survival probability prediction method. Stat Med, 32(12), 2062-2069.
</p>


<h3>See Also</h3>

<p><code>predict</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">require(bnnSurvival)

## Use only 1 core
options(mc.cores = 1)

## Load a dataset and split in training and test data
require(survival)
n &lt;- nrow(veteran)
idx &lt;- sample(n, 2/3*n)
train_data &lt;- veteran[idx, ]
test_data &lt;- veteran[-idx, ]

## Create model with training data and predict for test data
model &lt;- bnnSurvival(Surv(time, status) ~ trt + karno + diagtime + age + prior, train_data, 
                     k = 20, num_base_learners = 10, num_features_per_base_learner = 3)
result &lt;- predict(model, test_data)

## Plot survival curve for the first observations
plot(timepoints(result), predictions(result)[1, ])

</code></pre>


</div>