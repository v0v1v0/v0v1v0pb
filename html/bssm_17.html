<div class="container">

<table style="width: 100%;"><tr>
<td>bsm_ng</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Non-Gaussian Basic Structural (Time Series) Model</h2>

<h3>Description</h3>

<p>Constructs a non-Gaussian basic structural model with local level or
local trend component, a seasonal component, and regression component
(or subset of these components).
</p>


<h3>Usage</h3>

<pre><code class="language-R">bsm_ng(
  y,
  sd_level,
  sd_slope,
  sd_seasonal,
  sd_noise,
  distribution,
  phi,
  u,
  beta,
  xreg = NULL,
  period,
  a1 = NULL,
  P1 = NULL,
  C = NULL
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>A vector or a <code>ts</code> object of observations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sd_level</code></td>
<td>
<p>Standard deviation of the noise of level equation.
Should be an object of class <code>bssm_prior</code> or scalar
value defining a known value such as 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sd_slope</code></td>
<td>
<p>Standard deviation of the noise of slope equation.
Should be an object of class <code>bssm_prior</code>, scalar
value defining a known value such as 0, or missing, in which case the slope
term is omitted from the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sd_seasonal</code></td>
<td>
<p>Standard deviation of the noise of seasonal equation.
Should be an object of class <code>bssm_prior</code>, scalar
value defining a known value such as 0, or missing, in which case the
seasonal term is omitted from the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sd_noise</code></td>
<td>
<p>A prior for the standard deviation of the additional noise
term to be added to linear predictor, defined as an object of class
<code>bssm_prior</code>. If missing, no additional noise term is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distribution</code></td>
<td>
<p>Distribution of the observed time series. Possible
choices are <code>"poisson"</code>, <code>"binomial"</code>, <code>"gamma"</code>, and
<code>"negative binomial"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi</code></td>
<td>
<p>Additional parameter relating to the non-Gaussian distribution.
For negative binomial distribution this is the dispersion term, for gamma
distribution this is the shape parameter, and for other distributions this
is ignored. Should an object of class <code>bssm_prior</code> or
a positive scalar.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>u</code></td>
<td>
<p>A vector of positive constants for non-Gaussian models. For
Poisson, gamma, and negative binomial distribution, this corresponds to the
offset term. For binomial, this is the number of trials.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta</code></td>
<td>
<p>A prior for the regression coefficients.
Should be an object of class <code>bssm_prior</code> or <code>bssm_prior_list</code>
(in case of multiple coefficients) or missing in case of no covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xreg</code></td>
<td>
<p>A matrix containing covariates with number of rows matching the
length of <code>y</code>. Can also be <code>ts</code>, <code>mts</code> or similar object
convertible to matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>period</code></td>
<td>
<p>Length of the seasonal pattern.
Must be a positive value greater than 2 and less than the length of the
input time series. Default is <code>frequency(y)</code>,
which can also return non-integer value (in which case error is given).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a1</code></td>
<td>
<p>Prior means for the initial states (level, slope, seasonals).
Defaults to vector of zeros.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>P1</code></td>
<td>
<p>Prior covariance matrix for the initial states (level, slope,
seasonals).Default is diagonal matrix with 100 on the diagonal.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>C</code></td>
<td>
<p>Intercept terms for state equation, given as a m x n or m x 1
matrix.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>An object of class <code>bsm_ng</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># Same data as in Vihola, Helske, Franks (2020)
data(poisson_series)
s &lt;- sd(log(pmax(0.1, poisson_series)))
model &lt;- bsm_ng(poisson_series, sd_level = uniform(0.115, 0, 2 * s),
 sd_slope = uniform(0.004, 0, 2 * s), P1 = diag(0.1, 2), 
 distribution = "poisson")


out &lt;- run_mcmc(model, iter = 1e5, particles = 10)
summary(out, variable = "theta", return_se = TRUE)
# should be about 0.093 and 0.016
summary(out, variable = "states", return_se = TRUE, 
 states = 1, times = c(1, 100))
# should be about -0.075, 2.618


model &lt;- bsm_ng(Seatbelts[, "VanKilled"], distribution = "poisson",
  sd_level = halfnormal(0.01, 1),
  sd_seasonal = halfnormal(0.01, 1),
  beta = normal(0, 0, 10),
  xreg = Seatbelts[, "law"],
  # default values, just for illustration
  period = 12L,
  a1 = rep(0, 1 + 11), # level + period - 1 seasonal states
  P1 = diag(1, 12),
  C = matrix(0, 12, 1),
  u = rep(1, nrow(Seatbelts)))


set.seed(123)
mcmc_out &lt;- run_mcmc(model, iter = 5000, particles = 10, mcmc_type = "da")
mcmc_out$acceptance_rate
theta &lt;- expand_sample(mcmc_out, "theta")
plot(theta)
summary(theta)

library("ggplot2")
ggplot(as.data.frame(theta[,1:2]), aes(x = sd_level, y = sd_seasonal)) +
  geom_point() + stat_density2d(aes(fill = ..level.., alpha = ..level..),
  geom = "polygon") + scale_fill_continuous(low = "green", high = "blue") +
  guides(alpha = "none")

# Traceplot using as.data.frame method for MCMC output
library("dplyr")
as.data.frame(mcmc_out) |&gt; 
  filter(variable == "sd_level") |&gt; 
  ggplot(aes(y = value, x = iter)) + geom_line()
  

# Model with slope term and additional noise to linear predictor to capture 
# excess variation   
model2 &lt;- bsm_ng(Seatbelts[, "VanKilled"], distribution = "poisson",
  sd_level = halfnormal(0.01, 1),
  sd_seasonal = halfnormal(0.01, 1),
  beta = normal(0, 0, 10),
  xreg = Seatbelts[, "law"],
  sd_slope = halfnormal(0.01, 0.1),
  sd_noise = halfnormal(0.01, 1))

# instead of extra noise term, model using negative binomial distribution:
model3 &lt;- bsm_ng(Seatbelts[, "VanKilled"], 
  distribution = "negative binomial",
  sd_level = halfnormal(0.01, 1),
  sd_seasonal = halfnormal(0.01, 1),
  beta = normal(0, 0, 10),
  xreg = Seatbelts[, "law"],
  sd_slope = halfnormal(0.01, 0.1),
  phi = gamma_prior(1, 5, 5)) 

</code></pre>


</div>