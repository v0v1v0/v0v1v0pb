<div class="container">

<table style="width: 100%;"><tr>
<td>fit_bunching</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Fit Bunching</h2>

<h3>Description</h3>

<p>Fit bunching model to (binned) data and estimate excess mass.
</p>


<h3>Usage</h3>

<pre><code class="language-R">fit_bunching(thedata, themodelformula, binwidth, notch = FALSE, zD_bin = NA)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>thedata</code></td>
<td>
<p>(binned) data that includes all variables necessary for fitting the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>themodelformula</code></td>
<td>
<p>formula to fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>binwidth</code></td>
<td>
<p>a numeric value for the width of each bin.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>notch</code></td>
<td>
<p>whether analysis is for a kink or notch. Default is FALSE (kink).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zD_bin</code></td>
<td>
<p>the bin marking the upper end of the dominated region (notch case).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>fit_bunching</code> returns a list of the following results:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>coefficients</code></td>
<td>
<p>The coefficients from the fitted model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residuals</code></td>
<td>
<p>The residuals from the fitted model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cf_density</code></td>
<td>
<p>The estimated counterfactual density.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bunchers_excess</code></td>
<td>
<p>The estimate of the excess mass (not normalized).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cf_bunchers</code></td>
<td>
<p>The counterfactual estimate of counts in the bunching region.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b_estimate</code></td>
<td>
<p>The estimate of the normalized excess mass.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bins_bunchers</code></td>
<td>
<p>The number of bins in the bunching region.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_formula</code></td>
<td>
<p>The model formula used for fitting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B_zl_zstar</code></td>
<td>
<p>The count of bunchers in the bunching region below and up to zstar.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>B_zstar_zu</code></td>
<td>
<p>The count of bunchers in the bunching region above zstar.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>The estimated fraction of bunchers in the dominated region (only in notch case.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zD_bin</code></td>
<td>
<p>The value of the bin which zD falls in.</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code>bunchit</code>, <code>prep_data_for_fit</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(bunching_data)
binned_data &lt;- bin_data(z_vector = bunching_data$kink, zstar = 10000,
                        binwidth = 50, bins_l = 20, bins_r = 20)
prepped_data &lt;- prep_data_for_fit(binned_data, zstar = 10000, binwidth = 50,
                                  bins_l = 20, bins_r = 20, poly = 4)
fitted &lt;- fit_bunching(thedata = prepped_data$data_binned,
                       themodelformula = prepped_data$model_formula,
                       binwidth = 50)
# extract coefficients
fitted$coefficients
</code></pre>


</div>