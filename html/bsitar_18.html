<div class="container">

<table style="width: 100%;"><tr>
<td>loo_validation.bgmfit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Perform leave-one-out (loo) cross-validation</h2>

<h3>Description</h3>

<p>The <strong>loo_validation()</strong> is a wrapper around the
<code>brms::loo()</code> function to perform approximate leave-one-out
cross-validation based on the posterior likelihood. See <code>brms::loo()</code> for
more details.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'bgmfit'
loo_validation(
  model,
  compare = TRUE,
  resp = NULL,
  pointwise = FALSE,
  moment_match = FALSE,
  reloo = FALSE,
  k_threshold = 0.7,
  save_psis = FALSE,
  moment_match_args = list(),
  reloo_args = list(),
  model_names = NULL,
  ndraws = NULL,
  draw_ids = NULL,
  cores = 1,
  deriv_model = NULL,
  verbose = FALSE,
  dummy_to_factor = NULL,
  expose_function = FALSE,
  usesavedfuns = NULL,
  clearenvfuns = NULL,
  envir = NULL,
  ...
)

loo_validation(model, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>An object of class <code>bgmfit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compare</code></td>
<td>
<p>A flag indicating if the information criteria of the models
should be compared to each other via <code>loo::loo_compare()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resp</code></td>
<td>
<p>Optional names of response variables. If specified, predictions
are performed only for the specified response variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pointwise</code></td>
<td>
<p>A flag indicating whether to compute the full
log-likelihood matrix at once or separately for each observation.
The latter approach is usually considerably slower but
requires much less working memory. Accordingly, if one runs
into memory issues, <code>pointwise = TRUE</code> is the way to go.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>moment_match</code></td>
<td>
<p>A logical argument to indicate whether
<code>loo::loo_moment_match()</code> should be applied on problematic observations.
Defaults to <code>FALSE</code>. For most models, moment matching will only work
if you have set <code>save_pars = save_pars(all = TRUE)</code> when fitting the
model with <code>brms::brm()</code>. See <code>brms::loo_moment_match()</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reloo</code></td>
<td>
<p>A logical argument to indicate whether <code>brms::reloo()</code> should be
applied on problematic observations. Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k_threshold</code></td>
<td>
<p>The threshold at which pareto <code class="reqn">k</code>
estimates are treated as problematic. Defaults to <code>0.7</code>.
Only used if argument <code>reloo</code> is <code>TRUE</code>.
See <code>pareto_k_ids</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save_psis</code></td>
<td>
<p>Should the <code>"psis"</code> object created internally be saved
in the returned object? For more details see <code>loo</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>moment_match_args</code></td>
<td>
<p>An optional <code>list</code> of additional arguments
passed to <code>loo::loo_moment_match()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>reloo_args</code></td>
<td>
<p>An optional <code>list</code> of additional arguments passed to
<code>brms::reloo()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_names</code></td>
<td>
<p>If <code>NULL</code> (the default) will use model names
derived from deparsing the call. Otherwise will use the passed
values as model names.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ndraws</code></td>
<td>
<p>A positive integer indicating the number of posterior draws to
be used in estimation. If <code>NULL</code> (default), all draws are used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draw_ids</code></td>
<td>
<p>An integer indicating the specific posterior draw(s)
to be used in estimation (default <code>NULL</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cores</code></td>
<td>
<p>Number of cores to be used when running the parallel
computations (if <code>future = TRUE</code>). On non-Windows systems this
argument can be set globally via the mc.cores option. For the default
<code>NULL</code> option, the number of cores are set automatically by calling
the <code>future::availableCores()</code>. The number of cores used are the maximum
number of cores avaialble minus one, i.e., <code>future::availableCores() -
  1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deriv_model</code></td>
<td>
<p>A logical to specify whether to estimate velocity curve
from the derivative function, or the differentiation of the distance curve.
The argument <code>deriv_model</code> is set to <code>TRUE</code> for those functions
which need velocity curve such as <code>growthparameters()</code> and
<code>plot_curves()</code>, and <code>NULL</code> for functions which explicitly use
the distance curve (i.e., fitted values) such as <code>loo_validation()</code>
and <code>plot_ppc()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>An optional argument (logical, default <code>FALSE</code>) to
indicate whether to print information collected during setting up the
object(s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dummy_to_factor</code></td>
<td>
<p>A named list (default <code>NULL</code>) that is used to
convert dummy variables into a factor variable. The named elements are
<code>factor.dummy</code>, <code>factor.name</code>, and <code>factor.level</code>. The
<code>factor.dummy</code> is a vector of character strings that need to be
converted to a factor variable whereas the <code>factor.name</code> is a single
character string that is used to name the newly created factor variable.
The <code>factor.level</code> is used to name the levels of newly created factor.
When <code>factor.name</code> is <code>NULL</code>, then the factor name is internally
set as <code>'factor.var'</code>. If <code>factor.level</code> is <code>NULL</code>, then
names of factor levels are take from the <code>factor.dummy</code> i.e., the
factor levels are assigned same name as <code>factor.dummy</code>. Note that when
<code>factor.level</code> is not <code>NULL</code>, its length must be same as the
length of the <code>factor.dummy</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expose_function</code></td>
<td>
<p>An optional logical argument to indicate whether to
expose Stan functions (default <code>FALSE</code>). Note that if user has already
exposed Stan functions during model fit by setting <code>expose_function =
  TRUE</code> in the <code>bsitar()</code>, then those exposed functions are saved and can be
used during post processing of the posterior draws and therefore
<code>expose_function</code> is by default set as <code>FALSE</code> in all post
processing functions except <code>optimize_model()</code>. For <code>optimize_model()</code>, the
default setting is <code>expose_function = NULL</code>. The reason is that each
optimized model has different Stan function and therefore it need to be re
exposed and saved. The <code>expose_function = NULL</code> implies that the
setting for <code>expose_function</code> is taken from the original <code>model</code>
fit. Note that <code>expose_function</code> must be set to <code>TRUE</code> when
adding <code>fit criteria</code> and/or <code>bayes_R2</code> during model
optimization.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>usesavedfuns</code></td>
<td>
<p>A logical (default <code>NULL</code>) to indicate whether to
use the already exposed and saved <code>Stan</code> functions. Depending on
whether the user have exposed Stan functions within the <code>bsitar()</code> call via
<code>expose_functions</code> argument in the <code>bsitar()</code>, the <code>usesavedfuns</code>
is automatically set to <code>TRUE</code> (if <code>expose_functions = TRUE</code>) or
<code>FALSE</code> (if <code>expose_functions = FALSE</code>). Therefore, manual
setting of <code>usesavedfuns</code> as <code>TRUE</code>/<code>FALSE</code> is rarely
needed. This is for internal purposes only and mainly used during the
testing of the functions and therefore should not be used by users as it
might lead to unreliable estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clearenvfuns</code></td>
<td>
<p>A logical to indicate whether to clear the exposed
function from the environment (<code>TRUE</code>) or not (<code>FALSE</code>). If
<code>NULL</code> (default), then <code>clearenvfuns</code> is set as <code>TRUE</code> when
<code>usesavedfuns</code> is <code>TRUE</code>, and <code>FALSE</code> if <code>usesavedfuns</code>
is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>envir</code></td>
<td>
<p>Environment used for function evaluation. The default is
<code>NULL</code> which will set <code>parent.frame()</code> as default environment.
Note that since most of post processing functions are based on <span class="pkg">brms</span>,
the functions needed for evaluation should be in the <code>.GlobalEnv</code>.
Therefore, it is strongly recommended to set <code> envir = globalenv()</code>
(or <code>envir = .GlobalEnv</code>). This is particularly true for the
derivatives such as velocity curve.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to the <code>brms::loo()</code> function.
Please see <code>brms::loo</code> for details on various options available.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See <code>loo::loo_compare()</code> for details on model comparisons. For
<code>bgmfit</code> objects, <code>LOO</code> is an alias of <code>loo</code>. Use method
<code>brms::add_criterion()</code>  to store information criteria in the fitted model
object for later usage.
</p>


<h3>Value</h3>

<p>If only one model object is provided, then an object of class
<code>loo</code> is returned. If multiple objects are provided, an object of
class <code>loolist</code>.
</p>


<h3>Author(s)</h3>

<p>Satpal Sandhu  <a href="mailto:satpal.sandhu@bristol.ac.uk">satpal.sandhu@bristol.ac.uk</a>
</p>


<h3>See Also</h3>

<p><code>brms::loo()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Fit Bayesian SITAR model 

# To avoid mode estimation which takes time, the Bayesian SITAR model fit to 
# the 'berkeley_exdata' has been saved as an example fit ('berkeley_exfit').
# See 'bsitar' function for details on 'berkeley_exdata' and 'berkeley_exfit'.

# Check and confirm whether model fit object 'berkeley_exfit' exists
 berkeley_exfit &lt;- getNsObject(berkeley_exfit)

model &lt;- berkeley_exfit


loo_validation(model, cores = 1)



</code></pre>


</div>