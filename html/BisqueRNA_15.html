<div class="container">

<table style="width: 100%;"><tr>
<td>ReferenceBasedDecomposition</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Performs reference-based decomposition of bulk expression using single-cell
data</h2>

<h3>Description</h3>

<p>Generates a reference profile based on single-cell data. Learns a
transformation of bulk expression based on observed single-cell proportions
and performs  NNLS regression on these transformed values to estimate cell
proportions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ReferenceBasedDecomposition(
  bulk.eset,
  sc.eset,
  markers = NULL,
  cell.types = "cellType",
  subject.names = "SubjectName",
  use.overlap = TRUE,
  verbose = TRUE,
  old.cpm = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>bulk.eset</code></td>
<td>
<p>Expression Set containin bulk data. No PhenoData required
but if overlapping option used, IDs returned by sampleNames(bulk.eset) 
should match those found in sc.eset phenoData individual labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sc.eset</code></td>
<td>
<p>Expression Set containing single-cell data. PhenoData of this
Expression Set should contain cell type and individual labels for each
cell. Names of these fields specified by arguments below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>markers</code></td>
<td>
<p>Structure, such as character vector, containing marker genes
to be used in decomposition. 'base::unique(base::unlist(markers))' should
return a simple vector containing each gene name. If no argument or NULL
provided, the method will use all available genes for decomposition.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cell.types</code></td>
<td>
<p>Character string. Name of phenoData attribute in sc.eset
indicating cell type label for each cell</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subject.names</code></td>
<td>
<p>Character string. Name of phenoData attribute in sc.eset
indicating individual label for each cell</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use.overlap</code></td>
<td>
<p>Boolean. Whether to use and expect overlapping samples 
in decomposition.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Boolean. Whether to print log info during decomposition.
Errors will be printed regardless.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>old.cpm</code></td>
<td>
<p>Prior to version 1.0.4 (updated in July 2020), the package
converted counts to CPM after subsetting the marker genes. Github user
randel pointed out that the order of these operations should be switched.
Thanks randel! This option is provided for replication of older BisqueRNA
but should be enabled, especially for small marker gene sets.
We briefly tested this change on the cortex and adipose datasets.
The original and new order of operations produce estimates that have an
average correlation of 0.87 for the cortex and 0.84 for the adipose within
each cell type.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Expects read counts for both datasets, as they will be converted to 
counts per million (CPM). Two options available: Use overlapping indivudals
found in both single-cell and bulk datasets to learn transformation or 
learn transformation from single-cell alone. The overlapping option is
expected to have better performance.
</p>


<h3>Value</h3>

<p>A list. Slot <strong>bulk.props</strong> contains a matrix of cell type
proportion estimates with cell types as rows and individuals as columns.
Slot <strong>sc.props</strong> contains a matrix of cell type proportions 
estimated directly from counting single-cell data. 
Slot <strong>rnorm</strong> contains Euclidean norm of the residuals for each
individual's proportion estimates. Slot <strong>genes.used</strong> contains
vector of genes used in decomposition. Slot <strong>transformed.bulk</strong>
contains the transformed bulk expression used for decomposition. These
values are generated by applying a linear transformation to the CPM
expression.
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(Biobase)
sim.data &lt;- SimulateData(n.ind=10, n.genes=100, n.cells=100,
                         cell.types=c("Neurons", "Astrocytes", "Microglia"),
                         avg.props=c(.5, .3, .2))
sim.data$sc.eset &lt;- sim.data$sc.eset[,sim.data$sc.eset$SubjectName %in% as.character(6:10)]
res &lt;- ReferenceBasedDecomposition(sim.data$bulk.eset, sim.data$sc.eset)
estimated.cell.proportions &lt;- res$bulk.props

</code></pre>


</div>