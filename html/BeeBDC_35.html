<div class="container">

<table style="width: 100%;"><tr>
<td>jbd_coordinates_transposed</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Identify transposed geographic coordinates</h2>

<h3>Description</h3>

<p>This function flags and corrects records when latitude and longitude appear
to be transposed.
This function will preferably use the countryCode column generated by
<code>bdc::bdc_country_standardized()</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">jbd_coordinates_transposed(
  data,
  idcol = "database_id",
  sci_names = "scientificName",
  lat = "decimalLatitude",
  lon = "decimalLongitude",
  country = "country",
  countryCode = "countryCode",
  border_buffer = 0.2,
  save_outputs = FALSE,
  fileName = NULL,
  scale = "large",
  path = NULL,
  mc.cores = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>A data frame or tibble. Containing a unique identifier for each record,
geographical coordinates, and country names. Coordinates must be expressed
in decimal degrees and WGS84.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>idcol</code></td>
<td>
<p>A character string. The column name with a unique record identifier.
Default = "database_id".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sci_names</code></td>
<td>
<p>A character string. The column name with species' scientific
names. Default = "scientificName".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lat</code></td>
<td>
<p>A character string. The column name with latitudes. Coordinates must
be expressed in decimal degrees and WGS84. Default = "decimalLatitude".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lon</code></td>
<td>
<p>A character string. The column name with longitudes. Coordinates must be
expressed in decimal degrees and WGS84. Default = "decimalLongitude".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>country</code></td>
<td>
<p>A character string. The column name with the country
assignment of each occurrence record. Default = "country".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>countryCode</code></td>
<td>
<p>A character string. The column name containing an ISO-2 country code for
each record.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>border_buffer</code></td>
<td>
<p>Numeric. Must have value greater than or equal to 0.
A distance in decimal degrees used to
created a buffer around each country. Records within a given country and at
a specified distance from the border will be not be corrected.
Default = 0.2 (~22 km at the equator).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save_outputs</code></td>
<td>
<p>Logical. Indicates if a table containing transposed coordinates should be
saved for further inspection. Default = FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fileName</code></td>
<td>
<p>A character string. The out file's name.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>Passed to rnaturalearth's ne_countries().
Scale of map to return, one of 110, 50, 10 or 'small', 'medium', 'large'. Default = "large".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>A character string. A path as a character vector for where to create the directories
and save the figures. If
no path is provided (the default), the directories will be created using <code>here::here()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mc.cores</code></td>
<td>
<p>Numeric. If &gt; 1, the jbd_correct_coordinates function will run in parallel
using mclapply using the number of cores specified. If = 1 then it will be run using a serial
loop. NOTE: Windows machines must use a value of 1 (see ?parallel::mclapply). Additionally,
be aware that each thread can use large chunks of memory.
Default = 1.#'</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This test identifies transposed coordinates based on mismatches between the
country provided for a record and the record's latitude and longitude coordinates. Transposed
coordinates often fall outside of the indicated country (i.e., in other
countries or in the sea). Different coordinate transformations are
performed to correct country/coordinates mismatches. Importantly, verbatim
coordinates are replaced by the corrected ones in the returned database. A
database containing verbatim and corrected coordinates is created in
"Output/Check/01_coordinates_transposed.csv" if save_outputs == TRUE. The
columns "country" and "countryCode" can be retrieved by using the function
bdc::bdc_country_standardized.
</p>


<h3>Value</h3>

<p>A tibble containing the column "coordinates_transposed" which indicates if
verbatim coordinates were not transposed (TRUE). Otherwise
records are flagged as (FALSE) and, in this case, verbatim coordinates are
replaced by corrected coordinates.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
if(requireNamespace("rnaturalearthdata")){
database_id &lt;- c(1, 2, 3, 4)
scientificName &lt;- c(
  "Rhinella major", "Scinax ruber",
  "Siparuna guianensis", "Psychotria vellosiana"
)
decimalLatitude &lt;- c(63.43333, -14.43333, -41.90000, -46.69778)
decimalLongitude &lt;- c(-17.90000, -67.91667, -13.25000, -13.82444)
country &lt;- c("BOLIVIA", "bolivia", "Brasil", "Brazil")

x &lt;- data.frame(
  database_id, scientificName, decimalLatitude,
  decimalLongitude, country
)

# Get country codes
x &lt;- bdc::bdc_country_standardized(data = x, country = "country")

jbd_coordinates_transposed(
  data = x,
  idcol = "database_id",
  sci_names = "scientificName",
  lat = "decimalLatitude",
  lon = "decimalLongitude",
  country = "country_suggested",
  countryCode = "countryCode",
  border_buffer = 0.2,
  save_outputs = FALSE,
  scale = "medium"
) 
}
 # END if require

</code></pre>


</div>