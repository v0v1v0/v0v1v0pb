<div class="container">

<table style="width: 100%;"><tr>
<td>bunch</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bunching Analysis</h2>

<h3>Description</h3>

<p>Given a kinked or notched budget set, this function gets a vector of earnings
and analyzes bunching. The bunchr package has two main useful functions:
</p>


<h3>Usage</h3>

<pre><code class="language-R">bunch(earnings, zstar, t1, t2, Tax = 0, cf_start = NA, cf_end = NA,
  exclude_before = NA, exclude_after = NA, force_after = FALSE,
  binw = 10, poly_size = 7, convergence = 0.01, max_iter = 100,
  correct = TRUE, select = TRUE, draw = TRUE, nboots = 0, seed = NA,
  progress = FALSE, title = "Bunching Visualization",
  varname = "Earnings")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>earnings</code></td>
<td>
<p>Vector of earnings, hopefully a very large one.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zstar</code></td>
<td>
<p>Place of kink (critical earning point).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t1</code></td>
<td>
<p>Marginal tax rate before kink.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t2</code></td>
<td>
<p>Marginal tax rate after kink.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Tax</code></td>
<td>
<p>"Penalty" tax for crossing zstar.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cf_start</code></td>
<td>
<p>Number of bins before the kink bin where counter-factual
histogram should start.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cf_end</code></td>
<td>
<p>Number of bins after the kink bin where counter-factual
histogram should start.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exclude_before</code></td>
<td>
<p>Number of excluded bins before the kink bin.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exclude_after</code></td>
<td>
<p>Number of excluded bins after the kink bin.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>force_after</code></td>
<td>
<p>For notch analysis, should <code>bunch</code> be forced to use
of the provided <em>exclude_after</em> for the end of the bunching, rather than
trying to find the bin where the sum of the integral is zero? See details at
<code>notch_estimator</code> documentation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>binw</code></td>
<td>
<p>Bin width.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>poly_size</code></td>
<td>
<p>Order of polynomial used to calculate counter-factual
histogram.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>convergence</code></td>
<td>
<p>Minimal rate of change of bunching estimate to stop
iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_iter</code></td>
<td>
<p>Maximum number of iterations for bunching estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>correct</code></td>
<td>
<p>Should the counter-factual histogram be corrected to compensate
for shifting left because of the notch? See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>select</code></td>
<td>
<p>Should model selection be used to find counter-factual
histogram? See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draw</code></td>
<td>
<p>Should a graph be drawn?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nboots</code></td>
<td>
<p>how many bootstraps should be run?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>specify seed for bootstraps (earnings sampling).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>progress</code></td>
<td>
<p>Should a progress bar be desplayed?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>title</code></td>
<td>
<p>Title for Plot output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varname</code></td>
<td>
<p>Name for running variable, to be desplayed in the plot</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>bunch</code> checks if the specification has a kink, i.e. if the Tax
parameter is greater than zero. If so, it applies <code>notch_estimator</code>.
Otherwise, it applies <code>kink_estimator</code>.  Additionally, <code>bunch</code>
can bootstrap by sampling the earnings vector, returning a vector with
the estimated elasticities.
</p>


<h3>Value</h3>

<p><code>bunch</code> returns a list comprising of the parameters returned by
<code>kink_estimator</code> and <code>notch_estimator</code>. If bootstraps were asked for,
bootstrapped values are added to the list. Drawing of histograms is
suppressed when running the bootsraps.
</p>


<h3>See Also</h3>

<p><code>kink_estimator</code>, <code>notch_estimator</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># analyzing a kink
ability_vec &lt;- 4000 * rbeta(100000, 2, 5)
earning_vec &lt;- sapply(ability_vec, earning_fun, 0.2, 0, 0.2, 0, 1000)
# bunch_viewer(earning_vec, 1000, 20, 20, 1, 1, binw = 20)
estim &lt;- bunch(earning_vec, 1000, 0, 0.2, Tax = 0, 20, 20, 1, 1,
binw = 20, draw=TRUE, nboots = 0, seed = 16)
estim$e

# analyzing a notch
earning_vec &lt;- sapply(ability_vec, earning_fun, 0.2, 0.2, 0.2, 500, 1000)
bunch_viewer(earning_vec, 1000, 10, 40, 2, 22, binw = 50)
estim &lt;- bunch(earning_vec, 1000, 0.2, 0.2, Tax = 500, 10, 40, 2, 22,
binw = 50, draw = FALSE, nboots = 0, seed = 16)
estim$e

</code></pre>


</div>