<div class="container">

<table style="width: 100%;"><tr>
<td>run.tfr3.mcmc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Running Markov Chain Monte Carlo for Parameters of Total Fertility Rate in Phase III
</h2>

<h3>Description</h3>

<p>Runs (or continues running) MCMCs for simulating Phase III total fertility rate, using a Bayesian hierarchical version of an AR(1) model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">run.tfr3.mcmc(sim.dir, nr.chains = 3, iter = 50000, thin = 10, 
    replace.output = FALSE, my.tfr.file = NULL, buffer.size = 100, 
    use.extra.countries = FALSE, 
    mu.prior.range = c(0, 2.1), rho.prior.range = c(0, 1 - .Machine$double.xmin), 
    sigma.mu.prior.range = c(1e-05, 0.318), sigma.rho.prior.range = c(1e-05, 0.289), 
    sigma.eps.prior.range = c(1e-05, 0.5), 
    mu.ini = NULL, mu.ini.range = mu.prior.range, 
    rho.ini = NULL, rho.ini.range = rho.prior.range, 
    sigma.mu.ini = NULL, sigma.mu.ini.range = sigma.mu.prior.range, 
    sigma.rho.ini = NULL, sigma.rho.ini.range = sigma.rho.prior.range, 
    sigma.eps.ini = NULL, sigma.eps.ini.range = sigma.eps.prior.range, 
    seed = NULL, parallel = FALSE, nr.nodes = nr.chains, compression.type = "None", 
    auto.conf = list(max.loops = 5, iter = 50000, iter.incr = 20000, nr.chains = 3, 
                    thin = 60, burnin = 10000), 
    verbose = FALSE, verbose.iter = 1000, ...)
        
continue.tfr3.mcmc(sim.dir, iter, chain.ids=NULL, 
    parallel = FALSE, nr.nodes = NULL, auto.conf = NULL,
    verbose=FALSE, verbose.iter = 1000, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>sim.dir</code></td>
<td>
<p>Directory with an existing simulation of phase II TFR (see <code>run.tfr.mcmc</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nr.chains</code></td>
<td>
<p>Number of MCMC chains to run.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>
<p>Number of iterations to run in each chain. In addition to a single value, it can have the value ‘auto’ in which case the function runs for the number of iterations given in the <code>auto.conf</code> list (see below), then checks if the MCMCs converged (using the <code>auto.conf</code> settings). If it did not converge, the procedure is repeated until convergence is reached or the number of repetition exceeded <code>auto.conf$max.loops</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thin</code></td>
<td>
<p>Thinning interval between consecutive observations to be stored on disk.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>replace.output</code></td>
<td>
<p>If <code>TRUE</code>, previously stored results of a phase III simulation will be overwritten.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>my.tfr.file</code></td>
<td>
<p>File name containing user-specified TFR time series for one or more countries. See description of this argument in <code>run.tfr.mcmc</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>buffer.size</code></td>
<td>
<p>Buffer size (in number of iterations) for keeping data in the memory.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use.extra.countries</code></td>
<td>
<p>By default, only countries are used in the MCMCs that were assigned for estimation (i.e. their ‘include_code’ is 2 in the include) dataset and are in phase III at present time (argument <code>present.year</code> in <code>run.tfr.mcmc</code>). If this argument is <code>TRUE</code>, countries that were added using <code>run.tfr.mcmc.extra</code> and are in phase III are also included.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu.prior.range, rho.prior.range, sigma.mu.prior.range, sigma.rho.prior.range, sigma.eps.prior.range</code></td>
<td>
<p>Min and max for the prior (uniform) distribution of these paraemters.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu.ini, rho.ini, sigma.mu.ini, sigma.rho.ini, sigma.eps.ini</code></td>
<td>
<p>Initial value(s) of the parameters. It can be a single value or an array of the size <code>nr.chains</code>.  By default, if <code>nr.chains</code> is 1, it is the middle point of the corresponding range. Otherwise, it is uniformly randomly distributed within the range.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu.ini.range, rho.ini.range, sigma.mu.ini.range, sigma.rho.ini.range, sigma.eps.ini.range</code></td>
<td>
<p>Min and max for the initial values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Seed of the random number generator. If <code>NULL</code> no seed is set.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel</code></td>
<td>
<p>Logical determining if the simulation should run multiple chains in parallel. If it is <code>TRUE</code>, the package <span class="pkg">snowFT</span> is required.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nr.nodes</code></td>
<td>
<p>Relevant only if <code>parallel</code> is <code>TRUE</code>. It gives the number of nodes for running the simulation in parallel.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compression.type</code></td>
<td>
<p>One of ‘None’, ‘gz’, ‘xz’, ‘bz’, determining type of a compression of the MCMC files. Important: Do not use this option for a long MCMC simulation as this tends to cause very long run times due to slow reading!</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>auto.conf</code></td>
<td>
<p>List containing a configuration for an ‘automatic’ run (see description of argument <code>iter</code>). Item <code>iter</code> gives the number of iterations in the first chunk of the MCMC simulation; item <code>iter.incr</code> gives the number of iterations in the following chunks; <code>nr.chains</code> gives the number of chains in all chunks of the MCMC simulation; items <code>thin</code> and <code>burnin</code> are used in the convergence diagnostics following each chunk; <code>max.loops</code> controls the maximum number of chunks. All items must be integer values. This argument is only used if the function argument <code>iter</code> is set to ‘auto’.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical switching log messages on and off.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose.iter</code></td>
<td>
<p>Integer determining how often (in number of iterations) messages are outputted during the estimation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional parameters to be passed to the function <code>performParallel</code>, if <code>parallel</code> is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chain.ids</code></td>
<td>
<p>Array of chain identifiers that should be resumed. If it is <code>NULL</code>, all existing chains are resumed.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The MCMCs are stored in <code>sim.dir</code> in a subdirectory called “phaseIII”. It has exactly the same structure as phase II MCMCs described in <code>run.tfr.mcmc</code>.
</p>


<h3>Value</h3>

<p>An object of class <code>bayesTFR.mcmc.set</code> which is a list with two components:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>meta</code></td>
<td>
<p>An object of class <code>bayesTFR.mcmc.meta</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mcmc.list</code></td>
<td>
<p>A list of objects of class <code>bayesTFR.mcmc</code>, one for each MCMC.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Hana Sevcikova
</p>


<h3>References</h3>

<p>Raftery, A.E., Alkema, L. and Gerland, P. (2014). Bayesian Population Projections for the United Nations.
Statistical Science, Vol. 29, 58-68. <a href="https://doi.org/10.1214/13-STS419">doi:10.1214/13-STS419</a>. 
</p>


<h3>See Also</h3>

<p><code>run.tfr.mcmc</code>, <code>get.tfr3.mcmc</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
sim.dir &lt;- tempfile()
# Runs Phase II MCMCs (must be run before Phase III)
m &lt;- run.tfr.mcmc(nr.chains=1, iter=5, output.dir=sim.dir, verbose=TRUE)
# Runs Phase III MCMCs
m3 &lt;- run.tfr3.mcmc(sim.dir=sim.dir, nr.chains=2, iter=50, thin=1, verbose=TRUE)
m3 &lt;- continue.tfr3.mcmc(sim.dir=sim.dir, iter=10, verbose=TRUE)
summary(m3, burnin=10)
unlink(sim.dir, recursive=TRUE)
## End(Not run)
</code></pre>


</div>