<div class="container">

<table style="width: 100%;"><tr>
<td>gen_bound</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Generalized band</h2>

<h3>Description</h3>

<p>This function computes an upper prediction bound on the FDP among target wins
in any set <code class="reqn">R</code> of hypotheses of TDC. See details for more information.
</p>


<h3>Usage</h3>

<pre><code class="language-R">gen_bound(
  labels,
  indices,
  gamma,
  type,
  d_max = NULL,
  max_fdp = 0.5,
  c = 0.5,
  lambda = 0.5
)

genband(
  labels,
  indices,
  gamma,
  type,
  d_max = NULL,
  max_fdp = 0.5,
  c = 0.5,
  lambda = 0.5
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p>A vector of (ordered) labels. See details below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>indices</code></td>
<td>
<p>A vector specifying the indices of hypotheses for which an
upper prediction bound on the FDP is computed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gamma</code></td>
<td>
<p>The confidence parameter of the band. Typical values include
<code>gamma = 0.05</code> or <code>gamma = 0.01</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>type</code></td>
<td>
<p>A character string specifying which band to use. Must be one of
<code>"stband"</code> or <code>"uniband"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>d_max</code></td>
<td>
<p>An optional positive integer specifying the maximum number
of decoy wins considered in calculating the bands.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_fdp</code></td>
<td>
<p>A number specifying the maximum FDP considered by the user in
calculating the bands. Used to compute <code>d_max</code> if <code>d_max</code> is
set to <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>c</code></td>
<td>
<p>Determines the ranks of the target score that are considered
winning. Defaults to <code>c = 0.5</code> for (single-decoy) TDC.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>Determines the ranks of the target score that are
considered losing. Defaults to <code>lambda = 0.5</code> for (single-decoy) TDC.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In (single-decoy) TDC, each hypothesis is associated to a
winning score and a label (1 for a target win, -1 for a decoy win). This
function assumes that the hypotheses are ordered in decreasing order of
winning scores (with ties broken at random). The argument <code>labels</code>,
therefore, must be ordered according to this rule.
</p>
<p>This function also supports the extension of TDC that uses multiple
decoys. In that setup, the target score is competed with multiple decoy
scores and the rank of the target score after competition is used to determine whether the
hypothesis is a target win (label = 1), decoy win (-1) or uncounted (0).
The top <code>c</code> proportion of ranks are considered winning, the bottom
<code>1-lambda</code> losing, and all the rest uncounted.
</p>
<p>The threshold of TDC is given by the formula (assuming hypotheses are ordered):
</p>
<p style="text-align: center;"><code class="reqn">\max\{k : \frac{D_k + 1}{T_k \vee 1} \cdot \frac{c}{1-\lambda} \leq \alpha\}</code>
</p>

<p>where <code class="reqn">T_k</code> is the number of target wins among the top
<code class="reqn">k</code> hypotheses, and <code class="reqn">D_k</code> is the number of decoy wins similarly.
</p>
<p>The argument <code>gamma</code> sets a confidence level of <code>1-gamma</code>. Both
the uniform and standardized bands require pre-computed Monte Carlo
statistics, so only certain values of <code>gamma</code> are available to use.
Commonly used confidence levels, like 0.95 and 0.99, are available.
We refer the reader to the README of this package for more details.
</p>
<p>The argument <code>d_max</code> controls the rate at which the returned bounds
increase: a larger <code>d_max</code> results in a more conservative bound.
If, however, <code class="reqn">D_k + 1</code> exceeds <code>d_max</code> for some index <code class="reqn">k</code>, each target
win thereafter is considered a false discovery when computing the bound.
Thus it is important that <code>d_max</code>, chosen a priori, is large enough. Given
it is sufficiently large, the precise value of <code>d_max</code> does not have a
significant effect on the resulting bounds (see <a href="https://arxiv.org/abs/2302.11837">https://arxiv.org/abs/2302.11837</a> for more details).
</p>
<p>We recommend setting <code>d_max = NULL</code> so that it is computed automatically
using <code>max_fdp</code>. This argument ensures that <code class="reqn">D_k + 1</code> never
exceeds <code>d_max</code> when the (non-interpolated) FDP bound on the top
<code class="reqn">k</code> hypotheses is less than <code>max_fdp</code>.
</p>


<h3>Value</h3>

<p>An upper prediction bound on the FDP among target wins in the set of
hypotheses whose <code>indices</code> are given as input.
</p>


<h3>References</h3>

<p>Ebadi et al. (2022), Bounding the FDP in competition-based
control of the FDR <a href="https://arxiv.org/abs/2302.11837">https://arxiv.org/abs/2302.11837</a>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">if (requireNamespace("fdpbandsdata", quietly = TRUE)) {
  set.seed(123)
  labels &lt;- c(
    rep(1, 250),
    sample(c(1, -1), size = 250, replace = TRUE, prob = c(0.9, 0.1)),
    sample(c(1, -1), size = 250, replace = TRUE, prob = c(0.5, 0.5)),
    sample(c(1, -1), size = 250, replace = TRUE, prob = c(0.1, 0.9))
  )
  indices &lt;- c(1:100, 300:400, 600:650)
  gamma &lt;- 0.05
  gen_bound(labels, indices, gamma, "stband")
}

</code></pre>


</div>