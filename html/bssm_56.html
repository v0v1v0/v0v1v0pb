<div class="container">

<table style="width: 100%;"><tr>
<td>particle_smoother</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Particle Smoothing</h2>

<h3>Description</h3>

<p>Function <code>particle_smoother</code> performs particle smoothing
based on either bootstrap particle filter (Gordon et al. 1993),
<code class="reqn">\psi</code>-auxiliary particle filter (<code class="reqn">\psi</code>-APF) (Vihola et al. 2020),
extended Kalman particle filter (Van Der Merwe et al. 2001),
or its version based on iterated EKF (Jazwinski, 1970).
The smoothing phase is based on the filter-smoother algorithm by
Kitagawa (1996).
</p>


<h3>Usage</h3>

<pre><code class="language-R">particle_smoother(model, particles, ...)

## S3 method for class 'lineargaussian'
particle_smoother(
  model,
  particles,
  method = "psi",
  seed = sample(.Machine$integer.max, size = 1),
  ...
)

## S3 method for class 'nongaussian'
particle_smoother(
  model,
  particles,
  method = "psi",
  seed = sample(.Machine$integer.max, size = 1),
  max_iter = 100,
  conv_tol = 1e-08,
  ...
)

## S3 method for class 'ssm_nlg'
particle_smoother(
  model,
  particles,
  method = "bsf",
  seed = sample(.Machine$integer.max, size = 1),
  max_iter = 100,
  conv_tol = 1e-08,
  iekf_iter = 0,
  ...
)

## S3 method for class 'ssm_sde'
particle_smoother(
  model,
  particles,
  L,
  seed = sample(.Machine$integer.max, size = 1),
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>A model object of class <code>bssm_model</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>particles</code></td>
<td>
<p>Number of particles as a positive integer. Suitable values
depend on the model, the data, and the chosen algorithm. While larger values
provide more accurate estimates, the run time also increases with respect to
the number of particles, so it is generally a good idea to test the filter
first with a small number of particles, e.g., less than 100.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>Choice of particle filter algorithm.
For Gaussian and non-Gaussian models with linear dynamics,
options are <code>"bsf"</code> (bootstrap particle filter, default for
non-linear models)
and <code>"psi"</code> (<code class="reqn">\psi</code>-APF, the default for other models), and
for non-linear models option <code>"ekf"</code> (extended Kalman particle filter)
is also available.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Seed for the C++ RNG (positive integer).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_iter</code></td>
<td>
<p>Maximum number of iterations used in Gaussian approximation,
as a positive integer.
Default is 100 (although typically only few iterations are needed).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>conv_tol</code></td>
<td>
<p>Positive tolerance parameter used in Gaussian approximation.
Default is 1e-8.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iekf_iter</code></td>
<td>
<p>Non-negative integer. If zero (default), first
approximation for non-linear Gaussian models is obtained from extended
Kalman filter. If <code>iekf_iter &gt; 0</code>, iterated extended Kalman filter is
used with <code>iekf_iter</code> iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>L</code></td>
<td>
<p>Positive integer defining the discretization level for SDE model.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>See one of the vignettes for <code class="reqn">\psi</code>-APF in case of nonlinear models.
</p>


<h3>Value</h3>

<p>List with samples (<code>alpha</code>) from the smoothing distribution
and corresponding weights (<code>weights</code>),
as well as smoothed means and covariances (<code>alphahat</code> and <code>Vt</code>)
of the states and
estimated log-likelihood (<code>logLik</code>).
</p>


<h3>References</h3>

<p>Gordon, NJ, Salmond, DJ, Smith, AFM (1993).
Novel approach to nonlinear/non-Gaussian Bayesian state estimation.
IEE Proceedings-F, 140, 107-113.
https://doi.org/10.1049/ip-f-2.1993.0015
</p>
<p>Vihola, M, Helske, J, Franks, J. Importance sampling type estimators
based on approximate marginal Markov chain Monte Carlo.
Scand J Statist. 2020; 1-38.
https://doi.org/10.1111/sjos.12492
</p>
<p>Van Der Merwe, R, Doucet, A, De Freitas, N,  Wan, EA (2001).
The unscented particle filter.
In Advances in neural information processing systems, p 584-590.
</p>
<p>Jazwinski, A 1970. Stochastic Processes and Filtering Theory.
Academic Press.
</p>
<p>Kitagawa, G (1996). Monte Carlo filter and smoother for non-Gaussian
nonlinear state space models.
Journal of Computational and Graphical Statistics, 5, 1-25.
https://doi.org/10.2307/1390750
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(1)
x &lt;- cumsum(rnorm(100))
y &lt;- rnorm(100, x)
model &lt;- ssm_ulg(y, Z = 1, T = 1, R = 1, H = 1, P1 = 1)
system.time(out &lt;- particle_smoother(model, particles = 1000))
# same with simulation smoother:
system.time(out2 &lt;- sim_smoother(model, particles = 1000, 
  use_antithetic = TRUE))
ts.plot(out$alphahat, rowMeans(out2), col = 1:2)

</code></pre>


</div>