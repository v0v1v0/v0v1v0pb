<div class="container">

<table style="width: 100%;"><tr>
<td>estintp</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimation of Thomas-type cluster point process with complex inhomogeneities</h2>

<h3>Description</h3>

<p>The Bayesian MCMC estimation of
parameters for Thomas-type cluster point process with inhomogeneity
is performed in any of the following parts: (i) distribution of parent
points, (ii) mean number of points in a cluster, (iii) cluster spread.
The process is observed in the observation window <em>W</em> which
is a union of aligned rectangles, aligned with the coordinate axes.
The inhomogeneities are described through a parametric model
depending on covariates. The estimation algorithm is described in
Dvořák, Remeš, Beránek &amp; Mrkvička (2022)
(<a href="https://doi.org/10.48550/arXiv.2205.07946">doi:10.48550/arXiv.2205.07946</a>).
</p>


<h3>Usage</h3>

<pre><code class="language-R">estintp(
  X,
  control,
  x_left,
  x_right,
  y_bottom,
  y_top,
  W_dil,
  z_beta = NULL,
  z_alpha = NULL,
  z_omega = NULL,
  verbose = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>observed point pattern in the <code>spatstat.geom::ppp()</code> format of
the <span class="pkg">spatstat</span> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>list specifying various tuning constants for the MCMC
estimation. See also Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_left</code></td>
<td>
<p>vector describing the observation window, contains
the lower x-coordinate of the corners of each rectangle.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x_right</code></td>
<td>
<p>vector describing the observation window, contains
the higher x-coordinate of the corners of each rectangle.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y_bottom</code></td>
<td>
<p>vector describing the observation window, contains the smaller y-coordinate of the corners of each rectangle.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y_top</code></td>
<td>
<p>vector describing the observation window, contains the higher y-coordinate of the corners of each rectangle.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>W_dil</code></td>
<td>
<p>the observation window dilated by the assumed maximal cluster radius.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z_beta</code></td>
<td>
<p>list of covariates describing the intensity function of the parent process, each covariate being a pixel image as used in the <span class="pkg">spatstat</span> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z_alpha</code></td>
<td>
<p>list of covariates describing the location-dependent mean number of points in a cluster, each covariate being a pixel image as used in the <span class="pkg">spatstat</span> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>z_omega</code></td>
<td>
<p>list of covariates describing the location-dependent scale of a cluster, each covariate being a pixel image as used in the <span class="pkg">spatstat</span> package.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>logical (TRUE or FALSE). For suppressing information messages to the console set value to FALSE. Defaults to TRUE.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The output of the function is given by the list containing
the parameter estimates along with the 2.5% and 97.5% quantiles
of the posterior distributions. Also, several auxiliary objects are
included in the list which are needed for the <code>print_outputs()</code> and
<code>plot_outputs()</code> functions.
</p>


<h3>Details</h3>



<h4>Parametric model</h4>

<p>The model for the intensity function of the parent process is the following:
<code class="reqn">f(u) = kappa * exp(beta_1 * z\_beta_1(u) + … + beta_k * z\_beta_k(u))</code>,
where <code class="reqn">(kappa, beta_1, …, beta_k)</code> is the vector of parameters
and <code class="reqn">z\_beta = (z\_beta_1, …, z\_beta_k)</code> is the list of covariates.
Note that choosing <code class="reqn">k = 0</code> is acceptable, resulting in a homogeneous
distribution of parents. In such a case <em>z_beta</em> must be an empty list
or NULL. Furthermore, the list z_beta must contain named covariates in order
to properly function with the function <code>spatstat.model::ppm()</code> from the
<span class="pkg">spatstat</span> package
which is used in the first step to estimate the parameters
<code class="reqn">(kappa, beta_1, …, beta_k)</code>. Note that due to identifiability issues
the covariate lists <em>z_beta</em> and <em>z_alpha</em> must be disjoint.
</p>
<p>The model for the mean number of points in a cluster corresponding
to the parent at location <code class="reqn">u</code> is the following:
<code class="reqn">g(u) = exp(alpha + alpha_1 * z\_alpha_1(u) + … + alpha_l * z\_alpha_l(u))</code>,
where <code class="reqn">(alpha, alpha_1, …, alpha_l)</code> is the vector of parameters and
<code class="reqn">z\_alpha = (z\_alpha_1, …, z\_alpha_l)</code> is the list of covariates.
Note that choosing <code class="reqn">l = 0</code> is acceptable, resulting in a constant model.
In such a case <em>z_alpha</em> must be an empty list or NULL. Note that
due to identifiability issues the covariate lists <em>z_beta</em> and
<em>z_alpha</em> must be disjoint.
</p>
<p>The model for the scale of a cluster corresponding to the parent at
location <code class="reqn">u</code> is the following:
<code class="reqn">h(u) = exp(omega + omega_1 * z\_omega_1(u) + … + omega_m * z\_omega_m(u))</code>,
where <br><code class="reqn">(omega, omega_1, …, omega_m)</code> is the vector of parameters and <br><code class="reqn">z\_omega = (z\_omega_1, …, z\_omega_m)</code> is the list of covariates.
Note that choosing <code class="reqn">m = 0</code> is acceptable, resulting in a constant model.
In such a case <em>z_omega</em> must be an empty list or NULL.
</p>



<h4>Observation window and its dilation</h4>

<p>The observation window must be provided as the union of aligned rectangles,
aligned with the coordinate axes. This, however, allows the analysis
of point patterns observed in rather irregular regions by approximating
the region by a union of aligned rectangles. The structure of the vectors
<em>x_left, x_right, y_bottom</em> and <em>y_top</em> is such that the first
rectangle is constructed using the function <code>spatstat.geom::owin()</code> from the
<span class="pkg">spatstat</span> package as
<code>owin(c(x_left[1], x_right[1]), c(y_bottom[1], y_top[1]))</code>,
and similarly for the other rectangles. Naturally, a rectangular window
can be used and in such a case the vectors <em>x_left</em> to <em>y_top</em>
each contain a single element.
</p>



<h4>Covariates</h4>

<p>The covariates must be provided as pixel images of the class
<code>spatstat.geom::im()</code> used in the <span class="pkg">spatstat</span> package. It is recommended
that all the covariates have the same pixel resolution. However, it is
necessary that all the covariates in the list <em>z_beta</em> have the same
resolution, all the covariates in the list <em>z_alpha</em> have the same
resolution and all the covariates in the list <em>z_omega</em> have
the same distribution. The covariates must be provided in the dilated
observation window <em>W_dil</em>, with NA values at pixels lying outside
<em>W_dil</em>.
</p>



<h4>Control</h4>

<p>The control list must contain the following elements: <em>NStep</em>
(the required number of MCMC iterations to be performed), <em>BurnIn</em>
(burn-in, how many iterations at the beginning of the chain will be
disregarded when computing the resulting estimates – note that this choice
can be updated after the computation without re-running the chain,
see the function <code>re_estimate()</code>), <em>SamplingFreq</em> (sampling frequency
for estimating the posterior distributions). Additionally,
the hyperparameters for the prior distributions should be given, see below.
Note that some default values for the hyperparameters are provided but it is
<strong>strongly encouraged</strong> that the hyperparameter values are given
by the user, based on the actual knowledge of the problem at hand.
</p>



<h4>Prior distributions and hyperparameters</h4>

<p>The prior distribution for <em>alpha</em> is normal with
<code>mean = Prior_alpha_mean</code> and <br><code>SD = Prior_alpha_SD</code>.
</p>
<p>The prior distribution for the vector <code class="reqn">(alpha_1, …, alpha_l)</code> is
centered normal with diagonal variance matrix and the vector of
<code>SDs = Prior_alphavec_SD</code>.
</p>
<p>The prior distribution for <em>omega</em> is normal with
<code>mean = Prior_omega_mean</code> and <br><code>SD = Prior_omega_SD</code>.
</p>
<p>The prior distribution for the vector <code class="reqn">(omega_1, …, omega_m)</code>
is centered normal with diagonal variance matrix and the vector of
<code>SDs = Prior_omegavec_SD</code>.
</p>
<p>The hyperparameters should be provided in the control list. However,
the following default choices are applied if the hyperparameter values
are not provided by user or are given as NULL: <br><code>Prior_alpha_mean = 3</code>,
<code>Prior_alpha_SD = 2</code>, <code>Prior_omega_mean = log(sqrt(area(W) / 20))</code>,
<code>Prior_omega_SD = log(3 + sqrt(area(W) / 40))</code>,
<code>Prior_alphavec_SD[i] = 2 / max(z_alpha_i)</code>,
<code>Prior_omegavec_SD[i] = 2 / max(z_omega_i) * log(3 + sqrt(area(W) / 20))</code>.
</p>



<h4>Output</h4>

<p>The output of the function is given by the list containing the parameter
estimates along with the 2.5% and 97.5% quantiles of the posterior
distributions. Also, several auxiliary objects are included in the list
which are needed for the <code>print_outputs()</code> and <code>plot_outputs()</code> functions.
</p>



<h3>Examples</h3>

<pre><code class="language-R">
library(spatstat)
# Prepare the dataset:
X = trees_N4
x_left = x_left_N4
x_right = x_right_N4
y_bottom = y_bottom_N4
y_top = y_top_N4

z_beta = list(refor = cov_refor, slope = cov_slope)
z_alpha = list(tmi = cov_tmi, tdensity = cov_tdensity)
z_omega = list(slope = cov_slope, reserv = cov_reserv)

# Determine the union of rectangles:
W = NULL
W = owin(c(x_left[1], x_right[1]), c(y_bottom[1], y_top[1]))
if (length(x_left) &gt;= 2) {
  for (i in 2:length(x_left)) {
    W2 = owin(c(x_left[i], x_right[i]), c(y_bottom[i], y_top[i]))
    W = union.owin(W, W2)
  }
}

# Dilated observation window:
W_dil = dilation.owin(W, 100)


# User-specified hyperparameters for prior distributions:
control = list(NStep = 100, BurnIn = 50, SamplingFreq = 5,
    Prior_alpha_mean = 3, Prior_alpha_SD = 2, Prior_omega_mean = 5.5,
    Prior_omega_SD = 5, Prior_alphavec_SD = c(4.25, 0.012),
    Prior_omegavec_SD = c(0.18,0.009))

# MCMC estimation:
Output = estintp(X, control, x_left, x_right, y_bottom, y_top,
    W_dil, z_beta, z_alpha, z_omega, verbose = FALSE)

# Text output + series of figures:
print_outputs(Output)
plot_outputs(Output)

</code></pre>


</div>