<div class="container">

<table style="width: 100%;"><tr>
<td>PPC-discrete</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>PPCs for discrete outcomes</h2>

<h3>Description</h3>

<p>Many of the PPC functions in <strong>bayesplot</strong> can
be used with discrete data. The small subset of these functions that can
<em>only</em> be used if <code>y</code> and <code>yrep</code> are discrete are documented
on this page. Currently these include rootograms for count outcomes and bar
plots for ordinal, categorical, and multinomial outcomes. See the
<strong>Plot Descriptions</strong> section below.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ppc_bars(
  y,
  yrep,
  ...,
  prob = 0.9,
  width = 0.9,
  size = 1,
  fatten = 2.5,
  linewidth = 1,
  freq = TRUE
)

ppc_bars_grouped(
  y,
  yrep,
  group,
  ...,
  facet_args = list(),
  prob = 0.9,
  width = 0.9,
  size = 1,
  fatten = 2.5,
  linewidth = 1,
  freq = TRUE
)

ppc_rootogram(
  y,
  yrep,
  style = c("standing", "hanging", "suspended"),
  ...,
  prob = 0.9,
  size = 1
)

ppc_bars_data(y, yrep, group = NULL, prob = 0.9, freq = TRUE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>A vector of observations. See <strong>Details</strong>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yrep</code></td>
<td>
<p>An <code>S</code> by <code>N</code> matrix of draws from the posterior (or prior)
predictive distribution. The number of rows, <code>S</code>, is the size of the
posterior (or prior) sample used to generate <code>yrep</code>. The number of columns,
<code>N</code> is the number of predicted observations (<code>length(y)</code>). The columns of
<code>yrep</code> should be in the same order as the data points in <code>y</code> for the plots
to make sense. See the <strong>Details</strong> and <strong>Plot Descriptions</strong> sections for
additional advice specific to particular plots.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Currently unused.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prob</code></td>
<td>
<p>A value between <code>0</code> and <code>1</code> indicating the desired probability
mass to include in the <code>yrep</code> intervals. Set <code>prob=0</code> to remove the
intervals. (Note: for rootograms these are intervals of the <em>square roots</em>
of the expected counts.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>width</code></td>
<td>
<p>For bar plots only, passed to <code>ggplot2::geom_bar()</code> to control
the bar width.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>size, fatten, linewidth</code></td>
<td>
<p>For bar plots, <code>size</code>, <code>fatten</code>, and <code>linewidth</code>
are passed to <code>ggplot2::geom_pointrange()</code> to control the appearance of the
<code>yrep</code> points and intervals. For rootograms <code>size</code> is passed to
<code>ggplot2::geom_line()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>freq</code></td>
<td>
<p>For bar plots only, if <code>TRUE</code> (the default) the y-axis will
display counts. Setting <code>freq=FALSE</code> will put proportions on the y-axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group</code></td>
<td>
<p>A grouping variable of the same length as <code>y</code>.
Will be coerced to factor if not already a factor.
Each value in <code>group</code> is interpreted as the group level pertaining
to the corresponding observation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>facet_args</code></td>
<td>
<p>An optional list of  arguments (other than <code>facets</code>)
passed to <code>ggplot2::facet_wrap()</code> to control faceting.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>style</code></td>
<td>
<p>For <code>ppc_rootogram</code>, a string specifying the rootogram
style. The options are <code>"standing"</code>, <code>"hanging"</code>, and
<code>"suspended"</code>. See the <strong>Plot Descriptions</strong> section, below, for
details on the different styles.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>For all of these plots <code>y</code> and <code>yrep</code> must be integers, although
they need not be integers in the strict sense of <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span>'s
integer type. For rootogram plots <code>y</code> and <code>yrep</code> must also
be non-negative.
</p>


<h3>Value</h3>

<p>The plotting functions return a ggplot object that can be further
customized using the <strong>ggplot2</strong> package. The functions with suffix
<code style="white-space: pre;">⁠_data()⁠</code> return the data that would have been drawn by the plotting
function.
</p>


<h3>Plot Descriptions</h3>


<dl>
<dt><code>ppc_bars()</code></dt>
<dd>
<p>Bar plot of <code>y</code> with <code>yrep</code> medians and uncertainty intervals
superimposed on the bars.
</p>
</dd>
<dt><code>ppc_bars_grouped()</code></dt>
<dd>
<p>Same as <code>ppc_bars()</code> but a separate plot (facet) is generated for each
level of a grouping variable.
</p>
</dd>
<dt><code>ppc_rootogram()</code></dt>
<dd>
<p>Rootograms allow for diagnosing problems in count data models such as
overdispersion or excess zeros. They consist of a histogram of <code>y</code> with the
expected counts based on <code>yrep</code> overlaid as a line along with uncertainty
intervals. The y-axis represents the square roots of the counts to
approximately adjust for scale differences and thus ease comparison between
observed and expected counts. Using the <code>style</code> argument, the histogram
style can be adjusted to focus on different aspects of the data:
</p>

<ul>
<li> <p><em>Standing</em>: basic histogram of observed counts with curve
showing expected counts.
</p>
</li>
<li> <p><em>Hanging</em>: observed counts counts hanging from the curve
representing expected counts.
</p>
</li>
<li> <p><em>Suspended</em>: histogram of the differences between expected and
observed counts.
</p>
</li>
</ul>
<p><strong>All of the rootograms are plotted on the square root scale</strong>. See Kleiber
and Zeileis (2016) for advice on interpreting rootograms and selecting
among the different styles.
</p>
</dd>
</dl>
<h3>References</h3>

<p>Kleiber, C. and Zeileis, A. (2016).
Visualizing count data regressions using rootograms.
<em>The American Statistician</em>. 70(3): 296–303.
<a href="https://arxiv.org/abs/1605.01311">https://arxiv.org/abs/1605.01311</a>.
</p>


<h3>See Also</h3>

<p>Other PPCs: 
<code>PPC-censoring</code>,
<code>PPC-distributions</code>,
<code>PPC-errors</code>,
<code>PPC-intervals</code>,
<code>PPC-loo</code>,
<code>PPC-overview</code>,
<code>PPC-scatterplots</code>,
<code>PPC-test-statistics</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(9222017)

# bar plots
f &lt;- function(N) {
  sample(1:4, size = N, replace = TRUE, prob = c(0.25, 0.4, 0.1, 0.25))
}
y &lt;- f(100)
yrep &lt;- t(replicate(500, f(100)))
dim(yrep)
group &lt;- gl(2, 50, length = 100, labels = c("GroupA", "GroupB"))

color_scheme_set("mix-pink-blue")
ppc_bars(y, yrep)

# split by group, change interval width, and display proportion
# instead of count on y-axis
color_scheme_set("mix-blue-pink")
ppc_bars_grouped(y, yrep, group, prob = 0.5, freq = FALSE)

## Not run: 
# example for ordinal regression using rstanarm
library(rstanarm)
fit &lt;- stan_polr(
  tobgp ~ agegp,
  data = esoph,
  method = "probit",
  prior = R2(0.2, "mean"),
  init_r = 0.1,
  seed = 12345,
  # cores = 4,
  refresh = 0
 )

# coded as character, so convert to integer
yrep_char &lt;- posterior_predict(fit)
print(yrep_char[1, 1:4])

yrep_int &lt;- sapply(data.frame(yrep_char, stringsAsFactors = TRUE), as.integer)
y_int &lt;- as.integer(esoph$tobgp)

ppc_bars(y_int, yrep_int)

ppc_bars_grouped(
  y = y_int,
  yrep = yrep_int,
  group = esoph$agegp,
  freq=FALSE,
  prob = 0.5,
  fatten = 1,
  size = 1.5
)

## End(Not run)

# rootograms for counts
y &lt;- rpois(100, 20)
yrep &lt;- matrix(rpois(10000, 20), ncol = 100)

color_scheme_set("brightblue")
ppc_rootogram(y, yrep)
ppc_rootogram(y, yrep, prob = 0)

ppc_rootogram(y, yrep, style = "hanging", prob = 0.8)
ppc_rootogram(y, yrep, style = "suspended")

</code></pre>


</div>