<div class="container">

<table style="width: 100%;"><tr>
<td>bdpsurvival</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bayesian Discount Prior: Survival Analysis</h2>

<h3>Description</h3>

<p><code>bdpsurvival</code> is used to estimate the survival probability
(single arm trial; OPC) or hazard ratio (two-arm trial; RCT) for
right-censored data using the survival analysis implementation of the
Bayesian discount prior. In the current implementation, a two-arm analysis
requires all of current treatment, current control, historical treatment,
and historical control data. This code is modeled after
the methodologies developed in Haddad et al. (2017).
</p>


<h3>Usage</h3>

<pre><code class="language-R">bdpsurvival(
  formula = formula,
  data = data,
  data0 = NULL,
  breaks = NULL,
  a0 = 0.1,
  b0 = 0.1,
  surv_time = NULL,
  discount_function = "identity",
  alpha_max = 1,
  fix_alpha = FALSE,
  number_mcmc = 10000,
  weibull_scale = 0.135,
  weibull_shape = 3,
  method = "mc",
  compare = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>an object of class "formula." Must have a survival object on
the left side and at most one input on the right side, treatment. See
"Details" for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame containing the current data variables in the model.
Columns denoting 'time' and 'status' must be present. See "Details" for required
structure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data0</code></td>
<td>
<p>optional. A data frame containing the historical data variables in the model.
If present, the column labels of data and data0 must match.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breaks</code></td>
<td>
<p>vector. Breaks (interval starts) used to compose the breaks of the
piecewise exponential model. Do not include zero. Default breaks are the
quantiles of the input times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a0</code></td>
<td>
<p>scalar. Prior value for the gamma shape of the piecewise
exponential hazards. Default is 0.1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>b0</code></td>
<td>
<p>scalar. Prior value for the gamma rate of the piecewise
exponential hazards. Default is 0.1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surv_time</code></td>
<td>
<p>scalar. Survival time of interest for computing the
probability of survival for a single arm (OPC) trial. Default is
overall, i.e., current+historical, median survival time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>discount_function</code></td>
<td>
<p>character. Specify the discount function to use.
Currently supports <code>weibull</code>, <code>scaledweibull</code>, and
<code>identity</code>. The discount function <code>scaledweibull</code> scales
the output of the Weibull CDF to have a max value of 1. The <code>identity</code>
discount function uses the posterior probability directly as the discount
weight. Default value is "<code>identity</code>".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha_max</code></td>
<td>
<p>scalar. Maximum weight the discount function can apply.
Default is 1. For a two-arm trial, users may specify a vector of two values
where the first value is used to weight the historical treatment group and
the second value is used to weight the historical control group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fix_alpha</code></td>
<td>
<p>logical. Fix alpha at alpha_max? Default value is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>number_mcmc</code></td>
<td>
<p>scalar. Number of Monte Carlo simulations. Default is 10000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weibull_scale</code></td>
<td>
<p>scalar. Scale parameter of the Weibull discount function
used to compute alpha, the weight parameter of the historical data. Default
value is 0.135. For a two-arm trial, users may specify a vector of two
values where the first value is used to estimate the weight of the
historical treatment group and the second value is used to estimate the
weight of the historical control group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weibull_shape</code></td>
<td>
<p>scalar. Shape parameter of the Weibull discount function
used to compute alpha, the weight parameter of the historical data. Default
value is 3. For a two-arm trial, users may specify a vector of two values
where the first value is used to estimate the weight of the historical
treatment group and the second value is used to estimate the weight of the
historical control group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>character. Analysis method with respect to estimation of the weight
paramter alpha. Default method "<code>mc</code>" estimates alpha for each
Monte Carlo iteration. Alternate value "<code>fixed</code>" estimates alpha once
and holds it fixed throughout the analysis.  See the the
<code>bdpsurvival</code> vignette <br><code>vignette("bdpsurvival-vignette", package="bayesDP")</code> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>compare</code></td>
<td>
<p>logical. Should a comparison object be included in the fit?
For a one-arm analysis, the comparison object is simply the posterior
chain of the treatment group parameter. For a two-arm analysis, the comparison
object is the posterior chain of the treatment effect that compares treatment and
control. If <code>compare=TRUE</code>, the comparison object is accessible in the
<code>final</code> slot, else the <code>final</code> slot is <code>NULL</code>. Default is
<code>TRUE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>bdpsurvival</code> uses a two-stage approach for determining the
strength of historical data in estimation of a survival probability outcome.
In the first stage, a <em>discount function</em> is used that
that defines the maximum strength of the
historical data and discounts based on disagreement with the current data.
Disagreement between current and historical data is determined by stochastically
comparing the respective posterior distributions under noninformative priors.
With a single arm survival data analysis, the comparison is the
probability (<code>p</code>) that the current survival is less than the historical
survival. For a two-arm survival data, analysis the comparison is the
probability that the hazard ratio comparing treatment and control is
different from zero. The comparison metric <code>p</code> is then
input into the discount function and the final strength of the
historical data is returned (alpha).
</p>
<p>In the second stage, posterior estimation is performed where the discount
function parameter, <code>alpha</code>, is used incorporated in all posterior
estimation procedures.
</p>
<p>To carry out a single arm (OPC) analysis, data for the current and
historical treatments are specified in separate data frames, data and data0,
respectively. The data frames must have matching columns denoting time and status.
The 'time' column is the survival (censor) time of the event and the 'status' column
is the event indicator. The results are then based on the posterior probability of
survival at <code>surv_time</code> for the current data augmented by the historical data.
</p>
<p>Two-arm (RCT) analyses are specified similarly to a single arm trial. Again
the input data frames must have columns denoting time and status, but now
an additional column named 'treatment' is required to denote treatment and control
data. The 'treatment' column must use 0 to indicate the control group. The current data
are augmented by historical data (if present) and the results are then based
on the posterior distribution of the hazard ratio between the treatment
and control groups.
</p>
<p>For more details, see the <code>bdpsurvival</code> vignette: <br><code>vignette("bdpsurvival-vignette", package="bayesDP")</code>
</p>


<h3>Value</h3>

<p><code>bdpsurvival</code> returns an object of class "bdpsurvival".
The functions <code>summary</code> and <code>print</code> are used to obtain and
print a summary of the results, including user inputs. The <code>plot</code>
function displays visual outputs as well.
</p>
<p>An object of class "<code>bdpsurvival</code>" is a list containing at least
the following components:
</p>

<dl>
<dt><code>posterior_treatment</code></dt>
<dd>
<p>list. Entries contain values related to the treatment group:</p>
</dd>
</dl>
<ul>
<li>
<p><code>alpha_discount</code>
numeric. Alpha value, the weighting parameter of the historical data.
</p>
</li>
<li>
<p><code>p_hat</code>
numeric. The posterior probability of the stochastic comparison
between the current and historical data.
</p>
</li>
<li>
<p><code>posterior_survival</code>
vector. If one-arm trial, a vector of length <code>number_mcmc</code>
containing the posterior probability draws of survival at
<code>surv_time</code>.
</p>
</li>
<li>
<p><code>posterior_flat_survival</code>
vector. If one-arm trial, a vector of length <code>number_mcmc</code>
containing the probability draws of survival at <code>surv_time</code>
for the current treatment not augmented by historical treatment.
</p>
</li>
<li>
<p><code>prior_survival</code>
vector. If one-arm trial, a vector of length <code>number_mcmc</code>
containing the probability draws of survival at <code>surv_time</code>
for the historical treatment.
</p>
</li>
<li>
<p><code>posterior_hazard</code>
matrix. A matrix with <code>number_mcmc</code> rows and <code>length(breaks)</code>
columns containing the posterior draws of the piecewise hazards
for each interval break point.
</p>
</li>
<li>
<p><code>posterior_flat_hazard</code>
matrix. A matrix with <code>number_mcmc</code> rows and <code>length(breaks)</code>
columns containing the draws of piecewise hazards for each interval
break point for current treatment not augmented by historical treatment.
</p>
</li>
<li>
<p><code>prior_hazard</code>
matrix. A matrix with <code>number_mcmc</code> rows and <code>length(breaks)</code>
columns containing the draws of piecewise hazards for each interval break point
for historical treatment.
</p>
</li>
</ul>
<dl>
<dt><code>posterior_control</code></dt>
<dd>
<p>list. If two-arm trial, contains values related to the control group
analagous to the <code>posterior_treatment</code> output.</p>
</dd>
<dt><code>final</code></dt>
<dd>
<p>list. Contains the final comparison object, dependent on the analysis type:</p>
</dd>
</dl>
<ul>
<li>
<p>One-arm analysis:
vector. Posterior chain of survival probability at requested time.
</p>
</li>
<li>
<p>Two-arm analysis:
vector. Posterior chain of log-hazard rate comparing treatment and control groups.
</p>
</li>
</ul>
<dl>
<dt><code>args1</code></dt>
<dd>
<p>list. Entries contain user inputs. In addition, the following elements
are ouput:</p>
</dd>
</dl>
<ul>
<li>
<p><code>S_t</code>, <code>S_c</code>, <code>S0_t</code>, <code>S0_c</code>
survival objects. Used internally to pass survival data between
functions.
</p>
</li>
<li>
<p><code>arm2</code>
logical. Used internally to indicate one-arm or two-arm analysis.
</p>
</li>
</ul>
<h3>References</h3>

<p>Haddad, T., Himes, A., Thompson, L., Irony, T., Nair, R. MDIC Computer
Modeling and Simulation working group.(2017) Incorporation of stochastic
engineering models as prior information in Bayesian medical device trials.
<em>Journal of Biopharmaceutical Statistics</em>, 1-15.
</p>


<h3>See Also</h3>

<p><code>summary</code>,
<code>print</code>,
and <code>plot</code> for details of each of the
supported methods.
</p>


<h3>Examples</h3>

<pre><code class="language-R"># One-arm trial (OPC) example - survival probability at 5 years

# Collect data into data frames
df_ &lt;- data.frame(
  status = rexp(50, rate = 1 / 30),
  time = rexp(50, rate = 1 / 20)
)
df_$status &lt;- ifelse(df_$time &lt; df_$status, 1, 0)

df0 &lt;- data.frame(
  status = rexp(50, rate = 1 / 30),
  time = rexp(50, rate = 1 / 10)
)
df0$status &lt;- ifelse(df0$time &lt; df0$status, 1, 0)


fit1 &lt;- bdpsurvival(Surv(time, status) ~ 1,
  data = df_,
  data0 = df0,
  surv_time = 5,
  method = "fixed"
)

print(fit1)
## Not run: 
plot(fit1)

## End(Not run)

# Two-arm trial example
# Collect data into data frames
df_ &lt;- data.frame(
  time = c(
    rexp(50, rate = 1 / 20), # Current treatment
    rexp(50, rate = 1 / 10)
  ), # Current control
  status = rexp(100, rate = 1 / 40),
  treatment = c(rep(1, 50), rep(0, 50))
)
df_$status &lt;- ifelse(df_$time &lt; df_$status, 1, 0)

df0 &lt;- data.frame(
  time = c(
    rexp(50, rate = 1 / 30), # Historical treatment
    rexp(50, rate = 1 / 5)
  ), # Historical control
  status = rexp(100, rate = 1 / 40),
  treatment = c(rep(1, 50), rep(0, 50))
)
df0$status &lt;- ifelse(df0$time &lt; df0$status, 1, 0)

fit2 &lt;- bdpsurvival(Surv(time, status) ~ treatment,
  data = df_,
  data0 = df0,
  method = "fixed"
)
summary(fit2)

### Fix alpha at 1
fit2_1 &lt;- bdpsurvival(Surv(time, status) ~ treatment,
  data = df_,
  data0 = df0,
  fix_alpha = TRUE,
  method = "fixed"
)
summary(fit2_1)
</code></pre>


</div>