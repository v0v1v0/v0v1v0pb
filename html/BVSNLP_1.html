<div class="container">

<table style="width: 100%;"><tr>
<td>bvs</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>High dimensional Bayesian variable selection using nonlocal priors</h2>

<h3>Description</h3>

<p>This function performs Bayesian variable selection for high
dimensional design matrix using iMOM prior for non-zero coefficients. It
also performs adaptive hyperparameter selection for iMOM prior. Cleaning
the data in a preprocessing step and before any data analysis is done by
user preference. This function is for binary and survival time response
datasets. In the former, MCMC is used to search in the model space while for
the latter a stochastic search does that job. This function has the option
to do all the mentioned tasks in a parallel fashion, exploiting hundreds of
CPUs. It is highly recommended to use a cluster for this purpose. This
function also supports fixing covariates in variable selection process,
thus making them included in the final selected model with probability 1.
Categorical variable are also supported by this function as input covariates
to the selection process. They need to be well defined factor variables as
part of the input data frame. For the output, this function reports
necessary measurements that is common in Bayesian variable selection
algorithms. They include Highest Posterior Probability model, median
probability model and posterior inclusion probability for each of the
covariates in the design matrix.
</p>


<h3>Usage</h3>

<pre><code class="language-R">bvs(
  X,
  resp,
  prep = TRUE,
  logT = FALSE,
  fixed_cols = NULL,
  eff_size = 0.5,
  family = c("logistic", "survival"),
  hselect = TRUE,
  nlptype = "piMOM",
  r = 1,
  tau = 0.25,
  niter = 30,
  mod_prior = c("unif", "beta"),
  inseed = NULL,
  cplng = FALSE,
  ncpu = 4,
  parallel.MPI = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>The <code>n</code> times <code>p</code> input data frame containing the
covariates in the design matrix. The columns should represent genes and rows
represent the observed samples. The column names are used as gene names so
they should not be left as <code>NULL</code>. Moreover, the minimum number of
columns allowed is 3. The input data frame can also contain categorical
covariates that are appropriately defined as factor variables in R.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resp</code></td>
<td>
<p>For logistic regression models it is the binary response
vector which could be either numeric or factor variable in R. For the Cox
proportional hazard models this is a two column matrix where the first
column contains survival time vector and the second column is the censoring
status for each observation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prep</code></td>
<td>
<p>A boolean variable determining if the preprocessing step should
be performed on the design matrix or not. That step contains removing
columns that have <code>NA</code>'s or all their elements are equal to 0, along
with standardizing non-binary columns. This step is recommended and thus the
default value is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logT</code></td>
<td>
<p>A boolean variable determining if log transform should be done
on continuous columns before scaling them in the preprocessing step.
Note that those columns should not contain any zeros or negative values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed_cols</code></td>
<td>
<p>A vector of indices showing the columns in the input
data frame that are not subject to the the selection procedure. These
columns are always in the final selected model. Note that if any of these
columns contain <code>NA</code>, they will be removed. Moreover, if a categorical
variable with <code>k</code> levels is chosen to be fixed, all <code>k-1</code> dummy
variables associated with it will be selected in the final model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eff_size</code></td>
<td>
<p>This is the expected effect size in the model for a
standardized design matrix, which is basically the coefficient value that is
expected to occur the most based on some prior knowledge.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>Determines the type of data analysis. <code>logistic</code> is for
binary outcome data where logistic regression modeling is used, whereas
<code>survival</code> is for survival outcome data using Cox proportional
hazard model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hselect</code></td>
<td>
<p>A boolean variable indicating whether the automatic procedure
for hyperparameter selection should be run or not. The default value is
<code>TRUE</code>. Note that in this setting, <code>r</code> is always chosen to be 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nlptype</code></td>
<td>
<p>Determines the type of nonlocal prior that is used in the
analyses. It can be "piMOM" for product inverse moment prior, or "pMOM" for
product moment prior. The default is set to piMOM prior.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>The paramter <code>r</code> of the iMOM prior, when no automatic
procedure for hyperparameter selection is done. As a result, this is
relevant only when <code>hselect = FALSE</code>, otherwise it is ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>The paramter <code>tau</code> of the iMOM prior, when no automatic
procedure for hyperparameter selection is done. As a result, this is
relevant only when <code>hselect = FALSE</code>, otherwise it is ignored.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>niter</code></td>
<td>
<p>Number of iterations. For binary response data, this
determines the number of MCMC iterations per CPU. For survival response data
this is the number of iterations per temperature schedule in the stochastic
search algorithm.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mod_prior</code></td>
<td>
<p>Type of prior used for the model space. <code>unif</code> is
for a uniform binomial and <code>beta</code> is for a beta binomial prior. In the
former case, both hyper parameters in the beta prior are equal to <code>1</code>,
but in the latter case those two hyper parameters are chosen as explained in
the reference papers. The default choice for this variable is the uniform
prior.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inseed</code></td>
<td>
<p>The input seed for making the parallel processing
reproducible. This parameter is ignored in logistic regression models when
<code>cplng = FALSE</code>. The default value is <code>NULL</code> which means that each
time the search for model space is started from different starting points.
In case it is set to a number, it initializes the RNG for the first task and
subsequent tasks to get separate substreams.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cplng</code></td>
<td>
<p>This parameter is only used in logistic regression models, and
indicating if coupling algorithm for MCMC output should be performed or not.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncpu</code></td>
<td>
<p>This is the number of cpus used in parallel processing. For
logistic regression models this is the number of parallel coupled chains
run at the same time. For survival outcome data this is the number of cpus
doing stochastic search at the same time to increase th enumber of visited
models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>parallel.MPI</code></td>
<td>
<p>A boolean variable determining if MPI is used for
parallel processing or not. Note that in order to use this feature, your
system should support MPI and <code>Rmpi</code> and <code>doMPI</code> packages should
already be installed. The default is set to <code>FALSE</code> but in case your
system have the requirements, it is recommended to set this parameter to
<code>TRUE</code> as it is more efficient and results in faster run-time.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>It returns a list containing different objects that depend on the
family of the model and the coupling flag for logistic regression models.
The following describes the objects in the output list based on different
combinations of those two input arguments.<br><br><strong>1) </strong> <code>family = logistic &amp;&amp; cplng = FALSE</code>
</p>
<table>
<tr style="vertical-align: top;">
<td><code>num_vis_models</code></td>
<td>
<p>Number of unique models visited throughout the search
of the model space.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_prob</code></td>
<td>
<p>Maximum unnormalized probability among all visited models</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>HPM</code></td>
<td>
<p>The indices of the model with highest posterior
probability among all visited models, with respect to the columns in
the output <code>des_mat</code>. This is not necessarily the same as the input
design matrix due to some changes to categorical variables. The names of
the selected columns can be checked using <code>gene_names</code>.
The corresponding design matrix is also one of the outputs that can be
checked in <code>des_mat</code>. If the output is <code>character[0]</code> it means
none of the variables of the design matrix is selected in the HPM and
HPM contains only the intercept.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta_hat</code></td>
<td>
<p>The coefficient vector for the selected model. The first
component is always for the intercept.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MPM</code></td>
<td>
<p>The indices of median probability model. According to the paper
Barbieri et. al., this is defined to be the model consisting of those
variables whose posterior inclusion probability is at least 1/2. The order
of columns is similar to that is explained for <code>HPM</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_prob_vec</code></td>
<td>
<p>A <code>1000</code> by <code>1</code> vector of unnormalized
probabilities of the first 1000 models with highest posterior probability
among all visited models. If the total number of visited models is less than
1000, then the length of this vector would be equal to <code>num_vis_models</code>
. Note that the intercept is always used in calculating the probabilities
in this vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_models</code></td>
<td>
<p>A list containing models corresponding to
<code>max_prob_vec</code> vector. Each entry of this list contains the indices of
covariates for the model with posterior probability reported in the
corresponding entry in <code>max_prob_vec</code>. The intercept column is not
shown in this list as it is present in all of the models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inc_probs</code></td>
<td>
<p>A vector of length <code>p+1</code> containing the posterior
inclusion probability for each covariate in the design matrix. The order of
columns is with respect to processed design matrix, <code>des_mat</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nlptype</code></td>
<td>
<p>The type of nonlocal prior used in the analyses.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>des_mat</code></td>
<td>
<p>The design matrix used in the analysis where fixed columns
are moved to the beginning of the matrix and if <code>prep=TRUE</code>, the
columns containing <code>NA</code> are all removed. The reported indices in
selected models are all with respect to the columns of this matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gene_names</code></td>
<td>
<p>Names of the genes extracted from the design matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>The hyperparameter for iMOM prior density function, calculated
using the proposed algorithm for the given dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>The hyperparameter for iMOM prior density function, calculated
using the proposed algorithm for the given dataset.</p>
</td>
</tr>
</table>
<p><strong>2) </strong> <code>family = logistic &amp;&amp; cplng = TRUE</code>
</p>
<table>
<tr style="vertical-align: top;">
<td><code>cpl_percent</code></td>
<td>
<p>Shows what percentage of pairs of chains are coupled.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>margin_probs</code></td>
<td>
<p>A <code>k</code> by <code>1</code> vector of marginal probabilities
where element <code>i</code> shows the maximum marginal probability of the
data under the maximum model for the <code class="reqn">i^{th}</code> pair of chains. <code>k</code>
is the number of paired chains which is the same as number of CPUs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>chains</code></td>
<td>
<p>A <code>k</code> by <code>p</code> binary matrix, where each row is the
model for the <code class="reqn">i^{th}</code> pair of chains. Note that the index of nonzero
elements are not necessarily in the same order as the input design matrix,
<code>X</code>, depending on existence of fixed columns in selection procedure.
As a result, always match the indices to the columns of the design matrix
that is reported as an output in <code>des_mat</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nlptype</code></td>
<td>
<p>The type of nonlocal prior used in the analyses.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cpl_flags</code></td>
<td>
<p>A <code>k</code> by <code>1</code> binary vector, showing which pairs
are coupled, (=<code>1</code>) and which are not, (= <code>0</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta_hat</code></td>
<td>
<p>A <code>k</code> by <code>(p+1)</code> matrix where each row is the
estimated coefficient for each modelin the rows of <code>Chains</code> variable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uniq_models</code></td>
<td>
<p>A list showing unique models with the indices of the
included covariates at each model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>freq</code></td>
<td>
<p>Frequency of each of the unique models. It is used to find
the highest frquency model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>probs</code></td>
<td>
<p>Unnormalized probability of each of the unique models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>des_mat</code></td>
<td>
<p>The design matrix used in the analysis where fixed columns
are moved to the beginning of the matrix and if <code>prep=TRUE</code>, the
columns containing <code>NA</code> are all removed. The reported indices in
selected models are all with respect to the columns of this matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gene_names</code></td>
<td>
<p>Names of the genes extracted from the design matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>The hyperparameter for iMOM prior density function, calculated
using the proposed algorithm for the given dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>The hyperparameter for iMOM prior density function, calculated
using the proposed algorithm for the given dataset.</p>
</td>
</tr>
</table>
<p><strong>3) </strong> <code>family = survival</code>
</p>
<table>
<tr style="vertical-align: top;">
<td><code>num_vis_models</code></td>
<td>
<p>Number of visited models during the whole process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_prob</code></td>
<td>
<p>The unnormalized probability of the maximum model among
all visited models.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>HPM</code></td>
<td>
<p>The indices of the model with highest posterior
probability among all visited models, with respect to the columns in
<code>des_mat</code>. As a result, always look at the names of the selected
columns using <code>gene_names</code>. The corresponding design matrix is one of
the outputs that can be checked in <code>des_mat</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>MPM</code></td>
<td>
<p>The indices of median probability model. According to the paper
Barbieri et. al., this is defined to be the model consisting of those
variables whose posterior inclusion probability is at least 1/2. The order
of columns is similar to that is explained for <code>HPM</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta_hat</code></td>
<td>
<p>The coefficient vector for the selected model reported in
<code>HPM</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_prob_vec</code></td>
<td>
<p>A <code>1000</code> by <code>1</code> vector of unnormalized
probabilities of the first 1000 models with highest posterior probability
among all visited models. If the total number of visited models is less than
1000, then the length of this vector would be equal to <code>num_vis_models</code>
.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_models</code></td>
<td>
<p>A list containing models corresponding to
<code>max_prob_vec</code> vector. Each entry of this list contains the indices of
covariates for the model with posterior probability reported in the
corresponding entry in <code>max_prob_vec</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inc_probs</code></td>
<td>
<p>A <code>p</code> by <code>1</code> vector containing the posterior
inclusion probability for each covariate in the design matrix. The order of
columns is with respect to processed design matrix, <code>des_mat</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nlptype</code></td>
<td>
<p>The type of nonlocal prior used in the analyses.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>des_mat</code></td>
<td>
<p>The design matrix used in the analysis where fixed columns
are moved to the beginning of the matrix and if <code>prep=TRUE</code>, the
columns containing <code>NA</code> are all removed. The reported indices in
selected models are all with respect to the columns of this matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start_models</code></td>
<td>
<p>A <code>k</code> by <code>3</code> matrix showing the starting model
for each worker CPU. Obviously <code>k</code> is equal to the number of CPUs.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>gene_names</code></td>
<td>
<p>Names of the genes extracted from the design matrix.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>The hyperparameter for iMOM prior density function, calculated
using the proposed algorithm for the given dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>The hyperparameter for iMOM prior density function, calculated
using the proposed algorithm for the given dataset.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Amir Nikooienejad
</p>


<h3>References</h3>

<p>Nikooienejad, A., Wang, W., and Johnson, V. E. (2016). Bayesian
variable selection for binary outcomes in high dimensional genomic studies
using nonlocal priors. Bioinformatics, 32(9), 1338-1345.<br><br>
Nikooienejad, A., Wang, W., &amp; Johnson, V. E. (2020). Bayesian variable
selection for survival data using inverse moment priors. Annals of Applied
Statistics, 14(2), 809-828. <br><br>
Johnson, V. E. (1998). A coupling-regeneration scheme for
diagnosing convergence in Markov chain Monte Carlo algorithms. Journal of
the American Statistical Association, 93(441), 238-248.<br><br>
Shin, M., Bhattacharya, A., and Johnson, V. E. (2017). Scalable Bayesian
variable selection using nonlocal prior densities in ultrahigh dimensional
settings. Statistica Sinica.<br><br>
Johnson, V. E., and Rossell, D. (2010). On the use of non-local prior
densities in Bayesian hypothesis tests. Journal of the Royal Statistical
Society: Series B (Statistical Methodology), 72(2), 143-170.<br><br>
Barbieri, M. M., and Berger, J. O. (2004). Optimal predictive model
selection. The annals of statistics, 32(3), 870-897.
</p>


<h3>See Also</h3>

<p><code>ModProb</code>, <code>CoefEst</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">### Simulating Logistic Regression Data
n &lt;- 200
p &lt;- 40
set.seed(123)
Sigma &lt;- diag(p)
full &lt;- matrix(c(rep(0.5, p*p)), ncol=p)
Sigma &lt;- full + 0.5*Sigma
cholS &lt;- chol(Sigma)
Beta &lt;- c(-1.9,1.3,2.2)
X &lt;- matrix(rnorm(n*p), ncol=p)
X &lt;- X%*%cholS
beta &lt;- numeric(p)
beta[c(1:length(Beta))] &lt;- Beta
XB &lt;- X%*%beta
probs &lt;- as.vector(exp(XB)/(1+exp(XB)))
y &lt;- rbinom(n,1,probs)
colnames(X) &lt;- paste("gene_",c(1:p),sep="")
X &lt;- as.data.frame(X)

### Running 'bvs' function without coupling and with hyperparamter selection
### procedure
bout &lt;- bvs(X, y, family = "logistic", nlptype = "piMOM",
            mod_prior = "beta", niter = 50)
            
### Highest Posterior Model
bout$HPM

### Estimated Coefficients:
bout$beta_hat

### Number of Visited Models:
bout$num_vis_models
</code></pre>


</div>