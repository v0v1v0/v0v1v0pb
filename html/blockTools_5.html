<div class="container">

<table style="width: 100%;"><tr>
<td>block2seqblock</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Prepare prior nonsequential assignments for subsequent sequential assignments</h2>

<h3>Description</h3>

<p>Converts output objects from the <code>block</code> and <code>assignment</code> functions
into an object in the format of one output by the <code>seqblock</code> function. This allows the
user to block and assign multiple units at the beginning of an experiment (using <code>block</code> and
<code>assignment</code>) and then sequentially block and assign more units to the experiment over time
(using <code>seqblock</code>).</p>


<h3>Usage</h3>

<pre><code class="language-R">block2seqblock(block.obj, assg.obj, data, exact.restr = NULL, covar.restr = NULL, 
  covar.order = NULL, trn = NULL, apstat = "mean", mtrim = 0.1, apmeth = "ktimes", 
  kfac = 2, assgpr = c(0.5, 0.5), distance = NULL, datetime = NULL, orig, seed = NULL,
  file.name = "sbout.RData", verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>block.obj</code></td>
<td>
<p>an output object from <code>block</code>, or a user-specified block object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assg.obj</code></td>
<td>
<p>an output object from <code>assignment</code>, or a user-specified assignment object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a matrix or dataframe containing the original data used to block the units in the study</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exact.restr</code></td>
<td>
<p>a list object containing the restricted values that the exact blocking variables can take on. Thus the first element of <code>exact.restr</code> is a vector containing all of the possible values that the first exact blocking variable can take on; the second element is a vector containing all of the possible values for the second exact blocking variable; and so on</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covar.restr</code></td>
<td>
<p>a list object containing the restricted values that the non-exact blocking variables can take on. Thus the first element of <code>covar.restr</code> is a vector containing all of the possible values that the first non-exact blocking variable can take on; the second element is a vector containing all of the possible values for the second non-exact blocking variable; and so on</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covar.order</code></td>
<td>
<p>a string or vector of strings containing the name of the non-exact blocking variables ordered so that the highest priority covariate comes first, followed by the second highest priority covariate, then the third, etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trn</code></td>
<td>
<p>a string or vector of strings containing the names of the different treatment groups</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>apstat</code></td>
<td>
<p>a string specifying the assignment probability summary statistic that was used</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mtrim</code></td>
<td>
<p>a numeric value specifying the proportion of observations to be dropped when the assignment probability statistic takes on the value <code>"trimmean"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>apmeth</code></td>
<td>
<p>a string specifying the assignment probability algorithm that was used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kfac</code></td>
<td>
<p>the assignment probability <em>kfactor</em>; see <em>assg.prob.kfac</em> in the Arguments section above</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assgpr</code></td>
<td>
<p>a vector of assignment probabilities to each treatment group</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distance</code></td>
<td>
<p>a string specifying how the multivarite distance used for blocking is calculated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datetime</code></td>
<td>
<p>the date and time that the units were assigned to the treatment group; by default this is set to be a vector of NA; however the user could also specify a specific datetime and all of the units from the block object will be given the same datetime stamp</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>orig</code></td>
<td>
<p>a dataframe containing the names and values for the different id and blocking variables, as well as each unit's initial treatment assignment</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>an optional integer value for the random seed set which is used when assigning units to treatment groups</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>file.name</code></td>
<td>
<p>a string containing the name of the file that one would like the output to be written to. Ideally this file name should have the extension .RData</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>a logical stating whether the function should print the name of the output file, the current working directory, and the dataframe <code>x</code> returned by the function as part of the <code>bdata</code> list</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function converts data from a blocked experiment into a form allowing subsequent sequential blocking.  Minimally, the user sets only the arguments <code>block.obj</code>, <code>assg.obj</code> and <code>data</code>.  Then, <code>block2seqblock</code> uses the call to <code>block</code>, the assignment object, and the original data to create an object that is ready to be input into <code>seqblock</code>.
</p>
<p>If the user explicitly specifies <code>groups</code>, <code>id.vars</code> and <code>block.vars</code> in the initial <code>block</code> function that is used to create the <code>block.obj</code>, <code>block2seqblock</code> will order the variables in the output it produces according to the order specified in the initial <code>block</code> function call. If the user does not explicitly specify the blocking variables in the <code>block</code> function call, <code>block2seqblock</code> will order the variables according to the order in the initial matrix or dataframe that was used to run the original <code>block</code> function.
</p>
<p>As part of the function, variables that are of class <code>factor</code> in the original matrix or dataframe specified in <code>data</code>, will be converted into class <code>character</code>. 
</p>
<p>The <code>trn</code> argument uses the <code>n.tr</code> argument from <code>block</code> to extract the names of the treatment variables. Most other arguments are set to default values that mirror those in the <code>seqblock</code> function.  One exception is the <code>datetime</code> argument, which defaults to a vector of <code>NA</code>'s instead of the current datetime.</p>


<h3>Value</h3>

<p>A list (called <code>bdata</code>) with elements
</p>
<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a dataframe containing the names and values for the different ID and blocking variables, as well as each unit's initial treatment assignment.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nid</code></td>
<td>
<p>a string or vector of strings containing the name(s) of the ID variable(s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nex</code></td>
<td>
<p>a string or vector of strings containing the name(s) of the exact blocking variable(s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ncv</code></td>
<td>
<p>a string or vector of strings containing the name(s) of the non-exact blocking variable(s).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rex</code></td>
<td>
<p>a list of the restricted values of the exact blocking variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rcv</code></td>
<td>
<p>a list of the restricted values of the non-exact blocking variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ocv</code></td>
<td>
<p>a vector of the order of the non-exact blocking variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trn</code></td>
<td>
<p>a string or vector of strings containing the name(s) of the different treatment groups.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>apstat</code></td>
<td>
<p>a string specifying the assignment probability summary statistic that was used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mtrim</code></td>
<td>
<p>a numeric value specifying the proportion of observations to be dropped when the assignment probability statistic takes on the value <code>"trimmean"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>apmeth</code></td>
<td>
<p>a string specifying the assignment probability algorithm that was used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>kfac</code></td>
<td>
<p>the assignment probability <em>kfactor</em>; see <em>assg.prob.kfac</em> in the Arguments section above.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assgpr</code></td>
<td>
<p>a vector of assignment probabilities to each treatment group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>distance</code></td>
<td>
<p>a string specifying how the multivarite distance used for blocking is calculated</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trd</code></td>
<td>
<p>a list with the length equal to the number of previously assigned treatment conditions; each object in the list contains a vector of the distance between each unit in one treatment group and the new unit.  Set to <code>NULL</code> when there are no non-exact blocking variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tr.sort</code></td>
<td>
<p>a string vector of treatment conditions, sorted from the largest to the smallest</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p</code></td>
<td>
<p>a vector of assignment probabilities to each treatment group used in assigning a treatment condition to the new unit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>trcount</code></td>
<td>
<p>a table containing the counts for each experimental/treatment conditions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>datetime</code></td>
<td>
<p>the date and time that the user was assigned a treatment group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>orig</code></td>
<td>
<p>a dataframe containing the names and values for the different id and blocking variables, as well as each unit's initial treatment assignment.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Tommy Carroll <a href="mailto:tcarroll22@wustl.edu">tcarroll22@wustl.edu</a>, Jonathan Homola <a href="mailto:homola@wustl.edu">homola@wustl.edu</a>, and Ryan T. Moore <a href="mailto:rtm@wustl.edu">rtm@wustl.edu</a></p>


<h3>See Also</h3>

<p><code>block</code>, <code>assignment</code>, <code>seqblock</code></p>


<h3>Examples</h3>

<pre><code class="language-R"># data(x100)
# out &lt;- block(x100, n.tr = 2, id.vars = c("id"), block.vars = c("b1", "b2"), 
#   algorithm = "optGreedy", distance = "mahalanobis", valid.var = "b1", valid.range = c(0,500))
# assg.out &lt;- assignment(out, seed = 123)
# b2sb &lt;- block2seqblock(block.obj = out, assg.obj = assg.out, data = x100)
# sb &lt;- seqblock("sbout.RData", id.vals = 1101, covar.vals = c(100, 200), file.name = "sb101.RData")
</code></pre>


</div>