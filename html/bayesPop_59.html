<div class="container">

<table style="width: 100%;"><tr>
<td>pop.map</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
World Map of Population Measures
</h2>

<h3>Description</h3>

<p>Generates a world map of various population measures for a given quantile and a projection or observed period, using different techniques: <code>pop.map</code> use <span class="pkg">rworldmap</span>, <code>pop.ggmap</code> uses <span class="pkg">ggplot2</span>, and <code>pop.map.gvis</code> creates an interactive map via <span class="pkg">GoogleVis</span>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pop.map(pred, sex = c("both", "male", "female"), age = "all", expression = NULL, ...)

pop.ggmap(pred, sex=c('both', 'male', 'female'), age='all', expression=NULL, ...)

get.pop.map.parameters(pred, expression = NULL, sex = c("both", "male", "female"), 
    age = "all", range = NULL, nr.cats = 50, same.scale = TRUE, quantile = 0.5, ...)
    
pop.map.gvis(pred, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>pred</code></td>
<td>
<p>Object of class <code>bayesPop.prediction</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sex</code></td>
<td>
<p>One of “both”  (default), “male” or “female”. By default the male and female counts are summed up. This argument is only used if <code>expression</code> is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>age</code></td>
<td>
<p>Either a character string “all” (default) or an integer vector of age indices. Value 1 corresponds to age 0-4, value 2 corresponds to age 5-9 etc. Last age goup <code class="reqn">130+</code> corresponds to index 27. This argument is only used if <code>expression</code> is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expression</code></td>
<td>
<p>Expression defining the population measure to be plotted. For syntax see <code>pop.expressions</code>. The country components of the expression should be given as “XXX”.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>range</code></td>
<td>
<p>Range of the population measure to be displayed. It is of the form <code>c(</code><var>min</var>, <var>max</var><code>)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nr.cats</code></td>
<td>
<p>Number of color categories.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>same.scale</code></td>
<td>
<p>Logical controlling if maps for all years of this prediction object should be on the same color scale.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantile</code></td>
<td>
<p>Quantile for which the map should be generated. It must be equal to one of the values in <code>dimnames(pred$quantiles[[2]])</code>, i.e. 0, 0.025, 0.05, 0.1, 0.2, 0.25, 0.3, 0.4, 0.5, 0.6, 0.7, 0.75, 0.8, 0.9, 0.95, 0.975, 1. Value 0.5 corresponds to the median.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to the underlying functions. In <code>pop.map</code>, these are <code>quantile</code>, <code>year</code>, <code>projection.index</code>, <code>device</code>, <code>main</code>, and <code>device.args</code> (see <code>tfr.map</code>). For <code>pop.ggmap</code>, these are arguments that can be passed to <code>tfr.ggmap</code>. For <code>pop.map.gvis</code>, these are all arguments that can be passed to <code>tfr.map.gvis</code>. In addition, <code>pop.map</code> and <code>get.pop.map.parameters</code> accept arguments passed to the <code>mapCountryData</code> function of the <span class="pkg">rworldmap</span> package.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>pop.map</code> creates a single map for the given time period and quantile. If the package <span class="pkg">fields</span> is installed, a color bar legend at the botom of the map is created.
</p>
<p>Function <code>get.pop.map.parameters</code> can be used in combination with <code>pop.map</code>. It sets breakpoints for the color scheme.
</p>
<p>Function <code>pop.ggmap</code> is similar to <code>pop.map</code>, but uses the <span class="pkg">ggplot2</span> package in combination with the <code>geom_sf</code> function.
</p>
<p>Function <code>pop.map.gvis</code> creates an interactive map using the <span class="pkg">googleVis</span> package and opens it in an internet browser. It also generates a table of the mapped values that can be sorted by columns interactively in the browser. 
</p>


<h3>Value</h3>

<p><code>get.pop.map.parameters</code> returns a list with elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>pred</code></td>
<td>
<p>The object of class <code>bayesPop.prediction</code> used in the function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantile</code></td>
<td>
<p>Value of the argument <code>quantile</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>catMethod</code></td>
<td>
<p>If the argument <code>same.scale</code> is <code>TRUE</code>, this element contains breakpoints for categorization. Otherwise, it is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numCats</code></td>
<td>
<p>Number of categories.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coulourPalette</code></td>
<td>
<p>Subset of the rainbow palette, starting from dark blue and ending at red.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to the function.</p>
</td>
</tr>
</table>
<h3>Performance and Caching</h3>

<p>If the <code>expression</code> argument or a non-standard combination of sex and age is used, quantiles are computed on the fly. In such a case, trajectory files for all countries have to be loaded from disk, which can be quite time expensive. Therefore a simple caching mechanism was added to the prediction object which allows re-using data from previously used expressions. The prediction object points to an environment called <code>cache</code> which is a collection of data arrays that are results of evaluating expressions. The space-trimmed expressions are the names of the <code>cache</code> entries. Every time a map function is called, it is checked if the corresponding expression is contained in the <code>cache</code>. If it is not the case, the quantiles are computed on the fly, otherwise the existing values are taken. 
</p>
<p>When computing on the fly, the function tries to process it in parallel if possible, using the package <span class="pkg">parallel</span>. In such a case, the computation is split into <code class="reqn">n</code> nodes where <code class="reqn">n</code> is either the number of cores detected automatically (default), or the value of <code>getOption("cl.cores")</code>. Use <code>options(cl.cores=n)</code> to modify the default. If a sequential processing is desired, set <code>cl.cores</code> to 1. 
</p>
<p>The cache data are also stored on disk, namely in the simulation directory of the prediction object. By default, every update of the cache in memory is also updated on the disk. Thus, data expression results can be re-used in multiple R sessions. Function <code>pop.cleanup.cache</code> deletes the content of the cache. This behaviour can be turned off by setting the argument <code>write.to.cache=FALSE</code> in the <code>get.pop.prediction</code> function. We use this settings in the examples throughout this manual whenever the example data from the installation directory is used, in order to prevent writing into the installation directory.
</p>


<h3>Author(s)</h3>

<p>Hana Sevcikova
</p>


<h3>See Also</h3>

<p><code>tfr.map</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
##########################
# This example only makes sense if there is a simulation 
# for all countries. Below, only two countries are included,
# so the map is useless.
##########################
sim.dir &lt;- file.path(find.package("bayesPop"), "ex-data", "Pop")
pred &lt;- get.pop.prediction(sim.dir=sim.dir, write.to.cache=FALSE)

# Using ggplot2
pop.ggmap(pred)
pop.ggmap(pred, year = 2100)

# Using rworldmap
# Uses heat colors with seven categories by default
pop.map(pred, sex="female", age=4:10)
# Female population in child-bearing age as a proportion of totals
pop.map(pred, expression="PXXX_F[4:10] / PXXX")
# The same with more colors
params &lt;- get.pop.map.parameters(pred, expression="PXXX_F[4:10] / PXXX")
do.call("pop.map", params)
# Another projection year on the same color scale
do.call("pop.map", c(list(year=2043), params))

# Interactive map of potential support ratio (requires Flash)
pop.map.gvis(pred, expression="PXXX[5:13] / PXXX[14:27]")
## End(Not run)	
</code></pre>


</div>