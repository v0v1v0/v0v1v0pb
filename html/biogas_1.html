<div class="container">

<table style="width: 100%;"><tr>
<td>calcBgGD</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Calculate Biogas Production from Gas Density Data (GD-BMP)
</h2>

<h3>Description</h3>

<p><code>calcBgGD</code> (for <em>calc</em>ulate <em>b</em>io<em>g</em>as from <em>GD</em> (gas density) measurements) calculates cumulative biogas, methane production and production rates from mass loss and volume measurements for any number of bottles.
</p>


<h3>Usage</h3>

<pre><code class="language-R">calcBgGD(
  # Main arguments
  dat, 
  temp.vol,
  temp.grav,
  pres.vol,
  pres.grav,
  # Column names
  id.name, 
  time.name, 
  vol.name,
  m.pre.name = NULL,
  m.post.name,
  comp.name = 'xCH4',       
  # Settings
  vented.mass = FALSE,
  averaging = 'final',  
  temp.init = NULL,       
  pres.init = NULL,      
  headspace = NULL,     
  vol.hs.name = NULL,  
  headcomp = 'N2',    
  # Calculation method and other settings
  vmethod = 'vol',   
  comp.lim = c(0, 1), 
  comp.sub = NA,     
  imethod = 'linear',
  extrap = FALSE,
  addt0 = TRUE,
  showt0 = TRUE,
  dry = FALSE,
  # Warnings and messages
  std.message = TRUE,
  check = TRUE,
  # Units and standard conditions
  temp.std = getOption('temp.std', as.numeric(NA)),
  pres.std = getOption('pres.std', as.numeric(NA)),
  unit.temp = getOption('unit.temp', 'C'),
  unit.pres = getOption('unit.pres', 'atm')
  ) 
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>dat</code></td>
<td>

<p>a data frame with bottle identification code, time of measurement (as <code>numeric</code>, or <code>POSIX</code>), bottle mass, and measured biogas volume.
See Details section for details on units.
Additional columns can be present–these will be returned in the output data frame.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>temp.vol</code></td>
<td>

<p>temperature at which biogas volume was measured.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>temp.grav</code></td>
<td>

<p>temperature of bottle headspace at time of biogas venting, prior to gravimetric measurement.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pres.vol</code></td>
<td>

<p>pressure at which biogas volume was measured.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pres.grav</code></td>
<td>

<p>pressure of bottle headspace at time of biogas venting, prior to gravimetric measurement.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id.name</code></td>
<td>

<p>name of the bottle identification code column in <code>dat</code>. Must be the same in all data frames used in the function. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time.name</code></td>
<td>

<p>name of column containing time data (cumulative time) in <code>dat</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vol.name</code></td>
<td>

<p>name of the measured biogas volume column in <code>dat</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m.pre.name</code></td>
<td>

<p>name of column containing pre-venting bottle mass in <code>dat</code> data frame. 
Optional, required for <code>vented.mass = TRUE</code> and to calculate leakage.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m.post.name</code></td>
<td>

<p>name of column containing post-venting bottle mass in <code>dat</code> data frame. 
See details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>comp.name</code></td>
<td>

<p>name of column with biogas composition to be added to output data frame. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vented.mass</code></td>
<td>

<p>Set to <code>TRUE</code> to use vented mass loss (GD_v method) instead of total mass loss (GD_t method) in calculations.
See details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>averaging</code></td>
<td>

<p>type of averaging used for calculating biogas composition.
Default is <code>final</code>.
See details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>temp.init</code></td>
<td>

<p>optional initial headspace temperature.
Used to correct results for initial headspace.
See details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pres.init</code></td>
<td>

<p>optional initial headspace pressure.
Used to correct results for initial headspace.
See details.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>headspace</code></td>
<td>

<p>optional data frame or length-one numeric vector with reactor headspace volume(s).
If a data frame is used, it should at least contain a <code>"id"</code> (reactor identification code) column (see <code>"id.name"</code>) and headspace volume column (see <code>vol.hs.name</code> argument).
Required if <code>cmethod = "total"</code>.
Default is <code>NULL</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vol.hs.name</code></td>
<td>

<p>optional name of column containing headspace volume data in optional <code>headspace</code> data frame. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>headcomp</code></td>
<td>

<p>optional initial headspace composition used to correct results for initial headspace.
Default of <code>"N2"</code> is only logical value.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vmethod</code></td>
<td>

<p>method used for calculating biogas volume.
Default of <code>'vol'</code> is based on measured biogas volume in <code>vol.name</code> column.
Alternative is <code>'grav'</code> for gravimetric method, which should be used with <code>vented.mass = TRUE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>comp.lim</code></td>
<td>

<p>acceptable limits on calculated methane mole fraction.
Any values outside of this range are set to <code>comp.sub</code>.
Default of <code>c(0, 1)</code>.
Length two vector.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>comp.sub</code></td>
<td>

<p>Value substituted in for calculated methane mole fraction when calculated value is outside of <code>comp.lim</code> range.
Length one vector.
Default value of <code>NA</code> should generally never be changed.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>imethod</code></td>
<td>

<p>method used for interpolation of <code>xCH4</code>.
This is passed as the <code>method</code> argument to <code>interp</code>.
Length one character vector. 
Default is <code>"linear"</code> for linear interpolation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extrap</code></td>
<td>

<p>should <code>comp.name</code> be extrapolated? 
Length one logical vector.
This is passed as the <code>extrap</code> argument to <code>interp</code>. 
Default is <code>FALSE</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>addt0</code></td>
<td>

<p>is the earliest time in <code>dat</code> data frame “time zero” (start time)? 
If not, this argument adds a row with <code>time.name = 0</code> for each reactor in order to calculate production rates for the first observation.
This addition is only made when <code>time.name</code> is <code>numeric</code> (or <code>integer</code>).
Length-one logical vector.
Default is <code>TRUE</code>.
To return these additional rows in the output, see <code>showt0</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>showt0</code></td>
<td>

<p>should “time zero” rows be returned in the output?
Can be convenient for plotting cumulative volumes.
Only applies if <code>time.name</code> is <code>numeric</code> (or <code>integer</code>).
These rows may have been present in the original data (<code>dat</code>) or added by the function (see <code>addt0</code>).
Default value depends on <code>dat</code> <code>time.name</code> column content. 
If <code>time.name</code> column is numeric and contains 0 then the default value is <code>TRUE</code> and otherwise <code>FALSE</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dry</code></td>
<td>

<p>set to <code>TRUE</code> if volume data are standardized to dry conditions.
The default (<code>FALSE</code>) means biogas is assumed to be saturated with water vapor.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>std.message</code></td>
<td>

<p>should a message with the standard conditions be displayed? 
Default is <code>TRUE</code>. 
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check</code></td>
<td>

<p>should input data be checked for unreasonable values (with warnings)? 
Currently only composition values are checked.
Default is <code>TRUE</code>.
Values are changed if outside 0, 1 (divided by 100).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>temp.std</code></td>
<td>

<p>standard temperature for presentation of biogas and methane results.
Length one numeric vector.
Default value is 0 degrees C (set in <code>stdVol</code>).
Argument is passed to <code>stdVol</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pres.std</code></td>
<td>

<p>standard pressure for presentation of biogas and methane results.
Length one numeric vector.
Default value is 1.0 atm (101325 Pa) (set in <code>stdVol</code>).
Argument is passed to <code>stdVol</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unit.temp</code></td>
<td>

<p>temperature units for <code>temp</code> and <code>temp.std</code> arguments.
Default is <code>"C"</code> for degrees Celcius. 
Argument is passed to <code>stdVol</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>unit.pres</code></td>
<td>

<p>pressure units for <code>pres</code> and <code>pres.std</code> arguments.
Default is <code>"atm"</code>.
Argument is passed to <code>stdVol</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Using volume and mass loss data from <code>dat</code>, this function will calculate standardized biogas and methane production for each observation using the gas density (GD) method.
See reference below for details on the method.
</p>
<p>Standard values and units for temperature and pressure can be globally set using the function <code>options</code>.
See <code>stdVol</code>.
</p>


<h3>Value</h3>

<p>a data frame with all the columns originally present in <code>dat</code>, plus others including these:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>vBg</code></td>
<td>
<p>Standardized volume of biogas production for individual event.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xCH4</code></td>
<td>
<p>Calculated mole fraction of methane in biogas.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vCH4</code></td>
<td>
<p>Standardized volume of methane production for individual event.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cvBg</code></td>
<td>
<p>Standardized cumulative volume of biogas production.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cvCH4</code></td>
<td>
<p>Standardized cumulative volume of methane production.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rvBg</code></td>
<td>
<p>Production rate of biogas.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rvCH4</code></td>
<td>
<p>Production rate of methane.</p>
</td>
</tr>
</table>
<p>Units are based on units in input data.
</p>


<h3>Author(s)</h3>

<p>Sasha D. Hafner, Camilla Justesen, Jacob Mortensen
</p>


<h3>References</h3>

<p>Justesen, C.G., Astals, S., Mortensen, J.R., Thorsen, R., Koch, K., Weinrich, S., Triolo, J.M., Hafner, S.D. 2019. Development and validation of a low-cost gas density method for measuring biochemical potential (BMP) <em>Water (MDPI)</em> <b>11(12)</b>: 2431.
</p>


<h3>See Also</h3>

<p><code>calcBgMan</code>,
<code>calcBgVol</code>,
<code>summBg</code>,
<code>interp</code>,
<code>stdVol</code>,
<code>options</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R"> 

data("UQGDBiogas")
data("UQGDSetup")

head(UQGDBiogas)
head(UQGDSetup)

cbg &lt;- calcBgGD(UQGDBiogas,
                temp.vol = 20, pres.vol = 1013.25,
                temp.grav = 30, pres.grav = 1500,
                id.name = 'id', vol.name = 'vol',
                m.pre.name = 'mass.init', m.post.name = 'mass.final',
                time.name = 'time.d', unit.pres = 'mbar')


BMP &lt;- summBg(cbg, UQGDSetup, id.name = "id",
              time.name = 'time.d', descrip.name = 'descrip',
              inoc.name = "Inoculum", inoc.m.name = "m.inoc", norm.name = "m.sub.vs",
              when = 'end')

BMP

</code></pre>


</div>