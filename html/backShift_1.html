<div class="container">

<table style="width: 100%;"><tr>
<td>backShift</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Estimate connectivity matrix of a directed graph with linear effects and
hidden variables.
</h2>

<h3>Description</h3>

<p>This function estimates the connectivity matrix of a directed
(possibly cyclic) graph with hidden variables. The underlying system is required
to be linear and we assume that observations under different shift interventions
are available. More precisely, the function takes as an input an (nxp) data matrix,
where <code class="reqn">n</code> is the sample size and <code class="reqn">p</code> the number of variables. In each
environment <code class="reqn">j</code> (<code class="reqn">j</code> in {<code class="reqn">1, \ldots, J</code>}) we have observed
<code class="reqn">n_j</code> samples generated from </p>
<p style="text-align: center;"><code class="reqn">X_j= X_j * A + c_j + e_j</code>
</p>

<p>(in case of cycles this should be understood as an equilibrium
distribution). The <code class="reqn">c_j</code> is a p-dimensional random vector that is assumed
to have a diagonal covariance matrix. The noise vector <code class="reqn">e_j</code> is assumed to
have the same distribution in all environments <code class="reqn">j</code> but is allowed to have
an arbitrary covariance matrix. The different intervention settings are provided
to the method with the help of the vector <code>ExpInd</code> of length
<code class="reqn">n = (n_1 + ... + n_j + ... + n_J)</code>. The goal is to estimate the
connectivity matrix <code class="reqn">A</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">backShift(X, ExpInd, covariance=TRUE, ev=0, threshold =0.75, nsim=100,
          sampleSettings=1/sqrt(2), sampleObservations=1/sqrt(2),
          nodewise=TRUE, tolerance = 10^(-4), baseSettingEnv = 1,
          verbose = FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>

<p>A (nxp)-dimensional matrix (or data frame) with n observations of p variables.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ExpInd</code></td>
<td>

<p>Indicator of the experiment or the intervention type an observation belongs to.
A numeric vector of length n. Has to contain at least three different unique values.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covariance</code></td>
<td>

<p>A boolean variable. If <code>TRUE</code>, use only shift in covariance matrix;
otherwise use shift in Gram matrix.
Set only to <code>FALSE</code> if at most one variable has a non-zero shift in mean
in the same setting (default is <code>TRUE</code>).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ev</code></td>
<td>

<p>The expected number of false selections for stability selection.
No stability selection computed if <code>ev=0</code>. Defaults to <code>ev=0</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>threshold</code></td>
<td>

<p>The selection threshold for stability selection (has to be between 0.5 and 1).
Edges which are selected with empirical proportion higher than <code>threshold</code>
will be retained.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsim</code></td>
<td>

<p>Number of resamples taken (if using stability selection).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sampleSettings</code></td>
<td>

<p>The proportion of unique settings to resample for each resample; has to be in [0,1].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sampleObservations</code></td>
<td>

<p>The fraction of all samples to retain when subsampling (no replacement); has to be in [0,1].
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nodewise</code></td>
<td>

<p>If <code>FALSE</code>, stability selection retains for each subsample the largest
overall entries in the connectivity matrix. If <code>TRUE</code>, values are
ordered row- and node-wise first and then the largest entries in each row
and column are retained. Error control is valid (under exchangeability
assumption) in both cases. The latter setting <code>TRUE</code> is perhaps more
robust and is the default.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tolerance</code></td>
<td>

<p>Precision parameter for <code>ffdiag</code>: the algorithm stops when the criterium
difference between two iterations is less than <code>tolerance</code>. Default is 10^(-4).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>baseSettingEnv</code></td>
<td>

<p>Index for baseline environment against which the intervention variances are measured.
Defaults to 1.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>

<p>If <code>FALSE</code>, most messages are supressed.
</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list with elements
</p>
<table>
<tr style="vertical-align: top;">
<td><code>Ahat</code></td>
<td>
<p>The connectivity matrix where entry (i,j) is the effect pointing
from variable i to variable j.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>AhatAdjacency</code></td>
<td>
<p>If <code>ev</code>&gt;0, the connectivity matrix retained by
stability selection. Entries give the rounded percentage of times the edge has
been retained (and 0 if below the critical threshold).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varianceEnv</code></td>
<td>
<p>The estimated interventions variances up to an offset.
<code>varianceEnv</code> is a (Gxp)-dimensional matrix where G is the number
of unique environments.
The ij-th entry contains the difference
between the estimated intervention variance of variable j in environment i
and the estimated intervention variance of variable j in the base setting
(given by input parameter <code>baseSettingEnv</code>).
</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Christina Heinze-Deml &lt;heinzedeml@stat.math.ethz.ch&gt;
</p>


<h3>References</h3>

<p>Dominik Rothenhaeusler, Christina Heinze, Jonas Peters, Nicolai Meinshausen:
backShift: Learning causal cyclic graphs from unknown shift interventions. Advances in Neural Information Processing Systems (NIPS) 28, 2015. arXiv: <a href="http://arxiv.org/abs/1506.02494">http://arxiv.org/abs/1506.02494</a>
</p>


<h3>See Also</h3>

  <p><code>ICP</code> and
<code>hiddenICP</code> for reconstructing
the parents of a variable under interventions on all other variables.
<code>getParents</code> and
<code>getParentsStable</code> from the package
<code>CompareCausalNetworks</code> to estimate the
connectivity matrix of a directed causal graph, using various possible methods
(including <code>backShift</code>).
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Simulate data with connectivity matrix A

seed &lt;- 1
# sample size n
n &lt;- 10000
# 3 predictor variables
p  &lt;- 3
A &lt;- diag(p)*0
A[1,2] &lt;- 0.8
A[2,3] &lt;- -0.8
A[3,1] &lt;- 0.8

# divide data into 10 different environments
G &lt;- 10

# simulate
simulation.res &lt;- simulateInterventions(
                    n, p, A, G, intervMultiplier = 2,
                    noiseMult = 1, nonGauss = FALSE,
                    fracVarInt = 0.5, hidden = TRUE,
                    knownInterventions = FALSE,
                    simulateObs = TRUE, seed)

environment &lt;- simulation.res$environment
X &lt;- simulation.res$X

## Compute feedback estimator with stability selection

network &lt;- backShift(X, environment, ev = 1)

## Print point estimates and stable edges

# true connectivity matrix
print(A)
# point estimate
print(network$Ahat)
# shows empirical selection probability for stable edges
print(network$AhatAdjacency)
</code></pre>


</div>