<div class="container">

<table style="width: 100%;"><tr>
<td>BIFIE.by</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Statistics for User Defined Functions
</h2>

<h3>Description</h3>

<p>Computes statistics for user defined functions.
</p>


<h3>Usage</h3>

<pre><code class="language-R">BIFIE.by( BIFIEobj, vars, userfct, userparnames=NULL,
     group=NULL, group_values=NULL, se=TRUE, use_Rcpp=TRUE)

## S3 method for class 'BIFIE.by'
summary(object,digits=4,...)

## S3 method for class 'BIFIE.by'
coef(object,...)

## S3 method for class 'BIFIE.by'
vcov(object,...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>BIFIEobj</code></td>
<td>

<p>Object of class <code>BIFIEdata</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vars</code></td>
<td>

<p>Vector of variables for which statistics should be computed
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>userfct</code></td>
<td>
<p>User defined function. This function must include
a matrix <code>X</code> and a weight vector <code>w</code> as
arguments. The value of this function must be a vector.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>userparnames</code></td>
<td>
<p>An optional vector of parameter names for the
value of <code>userfct</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group</code></td>
<td>

<p>Optional grouping variable(s)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>group_values</code></td>
<td>

<p>Optional vector of grouping values. This can be omitted and grouping
values will be determined automatically.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se</code></td>
<td>
<p>Optional logical indicating whether statistical inference
based on replication should be employed.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>use_Rcpp</code></td>
<td>
<p>Optional logical indicating whether the user defined
function should be evaluated in <span class="pkg">Rcpp</span>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object</code></td>
<td>
<p>Object of class <code>BIFIE.by</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>Number of digits for rounding output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments to be passed</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list with following entries
</p>
<table>
<tr style="vertical-align: top;">
<td><code>stat</code></td>
<td>
<p>Data frame with statistics defined in <code>userfct</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output</code></td>
<td>
<p>Extensive output with all replicated statistics</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>More values</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code>survey::svyby</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">#############################################################################
# EXAMPLE 1: Imputed TIMSS dataset
#############################################################################

data(data.timss1)
data(data.timssrep)

# create BIFIE.dat object
bifieobj &lt;- BIFIEsurvey::BIFIE.data( data.list=data.timss1, wgt=data.timss1[[1]]$TOTWGT,
           wgtrep=data.timssrep[, -1 ] )

#****************************
#*** Model 1: Weighted means (as a toy example)
userfct &lt;- function(X,w){
        pars &lt;- c( stats::weighted.mean( X[,1], w ),
                     stats::weighted.mean(X[,2], w )   )
        return(pars)
                        }
res1 &lt;-  BIFIEsurvey::BIFIE.by( bifieobj, vars=c("ASMMAT", "migrant", "books"),
                userfct=userfct, userparnames=c("MW_MAT", "MW_Migr"),
                group="female" )
summary(res1)

# evaluate function in pure R implementation using the use_Rcpp argument
res1b &lt;-  BIFIEsurvey::BIFIE.by( bifieobj, vars=c("ASMMAT", "migrant", "books" ),
                userfct=userfct, userparnames=c("MW_MAT", "MW_Migr"),
                group="female", use_Rcpp=FALSE )
summary(res1b)

#--- statistical inference for a derived parameter (see ?BIFIE.derivedParameters)
# define gender difference for mathematics score (divided by 100)
derived.parameters &lt;- list(
        "gender_diff"=~ 0 + I( ( MW_MAT_female1 - MW_MAT_female0 ) / 100 )
                            )
# inference derived parameter
res1d &lt;- BIFIEsurvey::BIFIE.derivedParameters( res1,
                derived.parameters=derived.parameters )
summary(res1d)

## Not run: 
#****************************
#**** Model 2: Robust linear model

# (1) start from scratch to formulate the user function for X and w
dat1 &lt;- bifieobj$dat1
vars &lt;- c("ASMMAT", "migrant", "books" )
X &lt;- dat1[,vars]
w &lt;- bifieobj$wgt
library(MASS)
# ASMMAT ~ migrant + books
mod &lt;- MASS::rlm( X[,1] ~  as.matrix( X[, -1 ] ), weights=w )
coef(mod)
# (2) define a user function "my_rlm"
my_rlm &lt;- function(X,w){
    mod &lt;- MASS::rlm( X[,1] ~  as.matrix( X[, -1 ] ), weights=w )
    return( coef(mod) )
                }
# (3) estimate model
res2 &lt;-  BIFIEsurvey::BIFIE.by( bifieobj, vars, userfct=my_rlm,
                group="female", group_values=0:1)
summary(res2)
# estimate model without computing standard errors
res2a &lt;-  BIFIEsurvey::BIFIE.by( bifieobj, vars, userfct=my_rlm,
                group="female", se=FALSE)
summary(res2a)

# define a user function with formula language
my_rlm2 &lt;- function(X,w){
    colnames(X) &lt;- vars
    X &lt;- as.data.frame(X)
    mod &lt;- MASS::rlm( ASMMAT ~  migrant + books, weights=w, data=X)
    return( coef(mod) )
                }
# estimate model
res2b &lt;-  BIFIEsurvey::BIFIE.by( bifieobj, vars, userfct=my_rlm2,
                group="female", group_values=0:1)
summary(res2b)


#****************************
#**** Model 3: Number of unique values for variables in BIFIEdata

#*** define variables for which the number of unique values should be calculated
vars &lt;- c( "female", "books","ASMMAT" )
#*** define a user function extracting these unqiue values
userfct &lt;- function(X,w){
        pars &lt;- apply( X, 2, FUN=function(vv){
                     length( unique(vv))  } )
        # Note that weights are (of course) ignored in this function
        return(pars)
                        }
#*** extract number of unique values
res3 &lt;-  BIFIEsurvey::BIFIE.by( bifieobj, vars=vars, userfct=userfct,
              userparnames=paste0( vars, "_Nunique"),  se=FALSE )
summary(res3)
  ##   Statistical Inference for User Definition Function
  ##               parm Ncases  Nweight    est
  ##   1 female_Nunique   4668 78332.99    2.0
  ##   2  books_Nunique   4668 78332.99    5.0
  ##   3 ASMMAT_Nunique   4668 78332.99 4613.4
# number of unique values in each of the five imputed datasets
res3$output$parsrepM
  ##        [,1] [,2] [,3] [,4] [,5]
  ##   [1,]    2    2    2    2    2
  ##   [2,]    5    5    5    5    5
  ##   [3,] 4617 4619 4614 4609 4608

#****************************
#**** Model 4: Estimation of a lavaan model with BIFIE.by

#* estimate model in lavaan

data0 &lt;- data.timss1[[1]]
# define lavaan model
lavmodel &lt;- "
  ASSSCI ~ likesc
  ASSSCI ~~ ASSSCI
  likesc ~ female
  likesc ~~ likesc
  female ~~ female
"

mod0 &lt;- lavaan::lavaan(lavmodel, data=data0, sampling.weights="TOTWGT")
summary(mod0, stand=TRUE, fit.measures=TRUE)

#* construct input for BIFIE.by
vars &lt;- c("ASSSCI","likesc","female","TOTWGT")
X &lt;- data0[,vars]
mod0 &lt;- lavaan::lavaan(lavmodel, data=X, sampling.weights="TOTWGT")
w &lt;- data0$TOTWGT

#* define user function
userfct &lt;- function(X,w){
  X1 &lt;- as.data.frame(X)
  colnames(X1) &lt;- vars
  X1$studwgt &lt;- w
  mod0 &lt;- lavaan::lavaan(lavmodel, data=X1, sampling.weights="TOTWGT")
  pars &lt;- coef(mod0)
  # extract some fit statistics
  pars2 &lt;- lavaan::fitMeasures(mod0)
  pars &lt;- c(pars, pars2[c("cfi","tli")])
  return(pars)
}

#* test function
res0 &lt;- userfct(X,w)
userparnames &lt;- names(res0)

#* estimate lavaan model with replicated sampling weights
res1 &lt;-  BIFIEsurvey::BIFIE.by( bifieobj, vars=vars, userfct=userfct,
                  userparnames=userparnames, use_Rcpp=FALSE )
summary(res1)

## End(Not run)
</code></pre>


</div>