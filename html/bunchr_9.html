<div class="container">

<table style="width: 100%;"><tr>
<td>notch_estimator</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Analyzing Bunching at a Notch</h2>

<h3>Description</h3>

<p>Given a kinked budget set, this function gets a vector of earnings and
analyzes bunching. This function could be run independently, but best used
through the <code>bunch</code> function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">notch_estimator(earnings, zstar, t1, t2, Tax = 0, cf_start = NA,
  cf_end = NA, exclude_before = NA, exclude_after = NA,
  force_after = FALSE, binw = 10, poly_size = 7, convergence = 0.01,
  max_iter = 100, select = TRUE, draw = TRUE,
  title = "Bunching Visualization", varname = "Earnings")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>earnings</code></td>
<td>
<p>Vector of earnings, hopefully a very large one</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zstar</code></td>
<td>
<p>Place of kink (critical earning point)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t1</code></td>
<td>
<p>Tax rate before kink</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>t2</code></td>
<td>
<p>Tax rate after kink</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Tax</code></td>
<td>
<p>"Penalty" tax for crossing zstar.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cf_start</code></td>
<td>
<p>Number of bins before the kink bin where counter-factual
histogram should start.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cf_end</code></td>
<td>
<p>Number of bins after the kink bin where counter-factual
histogram should start.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exclude_before</code></td>
<td>
<p>Number of excluded bins before the kink bin.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>exclude_after</code></td>
<td>
<p>Number of excluded bins after the kink bin.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>force_after</code></td>
<td>
<p>Should <code>bunch</code> be forced to use of the provided
<em>exclude_after</em> for the end of the bunching, rather than trying to find
the bin where the sum of the integral is zero? See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>binw</code></td>
<td>
<p>Bin width.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>poly_size</code></td>
<td>
<p>Order of polynomial used to calculate counter-factual
histogram.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>convergence</code></td>
<td>
<p>Minimal rate of change of bunching estimate to stop
iterations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>max_iter</code></td>
<td>
<p>Maximum number of iterations for bunching estimates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>select</code></td>
<td>
<p>Should model selection be used to find counter-factual
histogram? See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>draw</code></td>
<td>
<p>Should a graph be drawn?</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>title</code></td>
<td>
<p>Title for plot output</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>varname</code></td>
<td>
<p>Name for running variable, to be desplayed in the plot</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>A histogram is created from the earnings vector, with the kink
point zstar as the center of one of the bins.
</p>
<p>For "unpure" notches, where the marginal tax rate after the notch is different
than the one before it, this function disregards the shifting of post-notch
distribution to the right, as suggested by Kleven (2016). Asssumption is that
the notch effect is much stronger anyway.
</p>
<p>Model selection works using the <code>step</code> function from the stats package.
It runs backwards from the full polynomial model, trying to find the best
explanatory model using the Akaike Information Criterion.
</p>
<p>By default, <code>notch_estimator</code> will try to find the end of the notch, i.e.
a histogram bin defining a right-side boundary for a range of an excluded area.
An interpolation of the counts inside this range renders an equality between
the sum of the “excess” counts, from the left side to the notch point, and
the sum of “missing” counts from the notch point to the notch size.
<code>notch_estimator</code> goes through an iterative process to find a stable
right-side boundary, labels it <em>notch_size</em> and returns it. However, the
user might want to force a visibly detectible end of notch, rather than let
<code>notch_estimator</code> calculate one. Use this option with caution: the notch
size is then used to calculate elasticity. For calculating intensive margin
elasticities, excess bunching must all come from other bins. Thus, total sums
must be equal and forcing the notch size might not be appropriate. In other
settings, e.g. a labor market with extensive margins (entry and exit from
labor force), forcing the notch size might be helpful.
</p>


<h3>Value</h3>

<p><code>notch_estimator </code> returns a list of the following variables:
</p>

<dl>
<dt><code>e</code></dt>
<dd>
<p>Estimated elasticity</p>
</dd>
<dt><code>Bn</code></dt>
<dd>
<p>The sum of total estimated extra bunching in the area starting
at cf_start and through the notch bin (zstar) </p>
</dd>
<dt><code>notch_size</code></dt>
<dd>
<p>Distance between notch bin and bin where the estimated
influence of the notch ends, delta_zed</p>
</dd>
<dt><code>data</code></dt>
<dd>
<p>A data frame with bin mids, counts, counter-factual
counts, and excluded dummy</p>
</dd>
</dl>
<h3>References</h3>

<p>Kleven, H J (2016). <em>Bunching</em>, Annual Review of Economics,
8(1).
</p>


<h3>See Also</h3>

<p><code>bunch</code>, <code>kink_estimator</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">ability_vec &lt;- 4000 * rbeta(100000, 2, 5)
earning_vec &lt;- sapply(ability_vec, earning_fun, 0.2, 0.2, 0.2, 500, 1000)
bunch_viewer(earning_vec, 1000, 15, 30, 2, 21, binw = 50)
notch_estimator(earning_vec, 1000, 0.2, 0.2, 500, 15, 30, 2, 21, binw = 50,
draw = FALSE)$e

</code></pre>


</div>