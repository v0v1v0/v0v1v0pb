<div class="container">

<table style="width: 100%;"><tr>
<td>bhpm.cluster.BB.hier2</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>A Two-Level Hierarchical Model for grouped data and clusters with Point-Mass.</h2>

<h3>Description</h3>

<p>Implementation of a Two-Level Hierarchical for grouped data and clusters with Point-Mass.</p>


<h3>Usage</h3>

<pre><code class="language-R">	bhpm.cluster.BB.hier2(cluster.data, sim_type = "SLICE", burnin = 20000,
	iter = 60000, nchains = 5, theta_algorithm = "MH",
	global.sim.params = data.frame(type = c("MH", "MH", "MH", "MH",
	"SLICE", "SLICE", "SLICE"),
	param = c("sigma_MH_alpha", "sigma_MH_beta", "sigma_MH_gamma",
	"sigma_MH_theta", "w_alpha", "w_beta", "w_gamma"),
	value = c(3, 3, 0.2, 0.5, 1, 1, 1), control = c(0, 0, 0, 0, 6, 6, 6),
	stringsAsFactors = FALSE),
	sim.params = NULL,
	monitor = data.frame(variable = c("theta", "gamma", "mu.gamma",
	"mu.theta", "sigma2.theta", "sigma2.gamma", "pi"),
	monitor = c(1, 1, 1, 1, 1, 1, 1), stringsAsFactors = FALSE),
	initial_values = NULL, level = 1,
	hyper_params = list(mu.gamma.0 = 0, tau2.gamma.0 = 10, mu.theta.0 = 0,
	tau2.theta.0 = 10, alpha.gamma = 3, beta.gamma = 1, alpha.theta = 3,
	beta.theta = 1, alpha.pi = 1.1, beta.pi = 1.1),
	global.pm.weight = 0.5,
	pm.weights = NULL,
	adapt_phase=1, memory_model = "HIGH")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>cluster.data</code></td>
<td>

<p>A file or data frame containing the cluster data. It must contain the columns <em>Cluster</em>, <em>Outcome.Grp</em>, <em>Outcome</em>, <em>Trt.Grp</em> (1 - control, 2,... comparator treatments), <em>Count</em> (total number of events), <em>Exposure</em> (total exposure of time of all patients fot the Trt.Grp in the Cluster).
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>burnin</code></td>
<td>

<p>The burnin period for the monte-carlo simulation. These are discarded from the returned samples.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>iter</code></td>
<td>

<p>The total number of iterations for which the monte-carlo simulation is run. This includes the burnin period.
The total number of samples returned is <em>iter - burnin</em>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nchains</code></td>
<td>

<p>The number of independent chains to run.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta_algorithm</code></td>
<td>

<p>MCMC algorithm used to sample the theta variables. "MH" is the only currently supported stable algorithm.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sim_type</code></td>
<td>

<p>The type of MCMC method to use for simulating from non-standard distributions apart from theta. Allowed values are <em>"MH"</em> and <em>"SLICE"</em> for Metropis_Hastings and Slice sampling respectively.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>monitor</code></td>
<td>

<p>A dataframe indicating which sets of variables to monitor.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>global.sim.params</code></td>
<td>

<p>A data frame containing the parameters for the simuation type <em>sim_type</em>. For <em>"MH"</em> the parameter
is the variance of the normal distribution used to simulate the next candidate value centred on the current
value. For <em>"SLICE"</em> the parameters are the estimated width of the slice and a value limiting the search for the next sample.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sim.params</code></td>
<td>

<p>A dataframe containing simulation parameters which override the global simulation parameters (<em>global.sim.params</em>) for particular model
parameters. <em>sim.params</em> must contain the following columns: type: the simulation type ("MH" or "SLICE"); variable: the model parameter 
for which the simulation parameters are being overridden; Outcome.Grp: the outcome grouping (if applicable); Outcome: the outcome (if applicable);
param: the simulation parameter; value: the overridden value; control: the overridden control value.
</p>
<p>The function <em>bhpm.sim.control.params</em> generates a template for <em>sim.params</em> which can be edited by the user.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>initial_values</code></td>
<td>

<p>The initial values for starting the chains. If NULL (the default) is passed the function generates the initial
values for the chains. initial_values is a list with the following format:
</p>
<pre>
list(gamma, theta, mu.gamma, mu.theta, sigma2.gamma,
	sigma2.theta, pi, mu.gamma.0, mu.theta.0,
	tau2.gamma.0, tau2.theta.0, alpha.pi, beta.pi)
</pre>
<p>The function <em>bhpm.gen.initial.values</em> can be used to generate a template for the list which can be updated by the user if required.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>

<p>Allowed valus are 0, 1. Respectively these indicate independent clusters, common means across the clusters.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hyper_params</code></td>
<td>

<p>The hyperparameters for the model.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>global.pm.weight</code></td>
<td>
<p>A global weighting for the proposal distribution used to sample theta.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pm.weights</code></td>
<td>
<p>Override global.pm.weight for specific outcomes.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>adapt_phase</code></td>
<td>

<p>Unused parameter.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>memory_model</code></td>
<td>

<p>Allowed values are "HIGH" and "LOW". "HIGH" means use as much memory as possible. "LOW" means use the minimum amount of memory.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The model is fitted by a Gibbs sampler.
</p>


<h3>Value</h3>

<p>The output from the simulation including all the sampled values is as follows:
</p>
<pre>
list(id, theta_alg, sim_type, chains, nClusters, Clusters, Trt.Grps, nOutcome.Grp,
	maxOutcome.Grps, maxOutcomes, nOutcome, Outcome, Outcome.Grp, burnin,
	iter, monitor,
	mu.gamma, mu.theta, sigma2.gamma, sigma2.theta, pi,
	gamma, theta, gamma_acc, theta_acc)
</pre>
<p>where
</p>
<p><em>id</em> - a string identifying the verions of the function
</p>
<p><em>theta_alg</em> - an string identifying the algorithm used to smaple theta
</p>
<p><em>sim_type</em> - an string identifying the samlping method used for non-standard distributions, either <em>"MH"</em> or <em>"SLICE"</em>
</p>
<p><em>chains</em> - the number of chains for which the simulation was run
</p>
<p><em>nClusters</em> - the number of clusters in the simulation
</p>
<p><em>Clusters</em> - an array. The clusters.
</p>
<p><em>nOutcome.Grp</em> - the number of outcome groupings.
</p>
<p><em>maxOutcome.Grps</em> - the maximum number of outcome groupings in a cluster.
</p>
<p><em>maxOutcomes</em> - the maximum number of outcomes in an outcome grouping.
</p>
<p><em>nOutcome</em> - an array. The number of outcomes in each outcome grouping.
</p>
<p><em>Outcome</em> - an array of dimension <em>nOutcome.Grp</em>, <em>maxOutcomes</em>. The outcomes.
</p>
<p><em>Outcome.Grp</em> - an array. The outcome groupings.
</p>
<p><em>burnin</em> - burnin used for the simulation.
</p>
<p><em>iter</em> - the total number of iterations in the simulation.
</p>
<p><em>monitor</em> - the variables being monitored. A dataframe.
</p>
<p><em>mu.gamma</em> - array of generated samples.
</p>
<p><em>mu.theta</em> - array of generated samples.
</p>
<p><em>sigma2.gamma</em> - array of generated samples.
</p>
<p><em>sigma2.theta</em> - array of generated samples.
</p>
<p><em>pi</em> - array of generated samples.
</p>
<p><em>gamma</em> - array of generated samples.
</p>
<p><em>theta</em> - array of generated samples.
</p>
<p><em>gamma_acc</em> - the acceptance rate for the gamma samples if a Metropolis-Hastings method is used.
</p>
<p><em>theta_acc</em> - the acceptance rate for the theta samples.
</p>


<h3>Note</h3>

<p>The function performs the simulation and returns the raw output. No checks for convergence are performed. 
</p>


<h3>Author(s)</h3>

<p>R. Carragher
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(bhpm.cluster.data1)
raw = bhpm.cluster.BB.hier2(bhpm.cluster.data1, level = 1, burnin = 100, iter = 200)

data(bhpm.cluster.data1)
raw = bhpm.cluster.BB.hier2(bhpm.cluster.data1, level = 1)

</code></pre>


</div>