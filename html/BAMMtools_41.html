<div class="container">

<table style="width: 100%;"><tr>
<td>plotRateThroughTime</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plot rates through time</h2>

<h3>Description</h3>

<p>Generates a plot of diversification or phenotypic rate through
time with confidence intervals.
</p>


<h3>Usage</h3>

<pre><code class="language-R">plotRateThroughTime(
  ephy,
  useMedian = TRUE,
  intervals = seq(from = 0, to = 1, by = 0.01),
  ratetype = "auto",
  nBins = 100,
  smooth = FALSE,
  smoothParam = 0.2,
  opacity = 0.01,
  intervalCol = "blue",
  avgCol = "red",
  start.time = NULL,
  end.time = NULL,
  node = NULL,
  nodetype = "include",
  plot = TRUE,
  cex.axis = 1,
  cex.lab = 1.3,
  lwd = 3,
  xline = 3.5,
  yline = 3.5,
  mar = c(6, 6, 1, 1),
  xticks = NULL,
  yticks = NULL,
  xlim = "auto",
  ylim = "auto",
  add = FALSE,
  axis.labels = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>ephy</code></td>
<td>
<p>Object of class <code>bammdata</code> or <code>bamm-ratematrix</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>useMedian</code></td>
<td>
<p>A logical: will plot median if <code>TRUE</code>, mean if
<code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intervals</code></td>
<td>
<p>If <code>NULL</code>, no intervals will be plotted, otherwise a
vector of quantiles must be supplied (these will define shaded
polygons).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ratetype</code></td>
<td>
<p>If 'auto', defaults to speciation (for diversification) or
beta (for traits). Can alternatively specify 'netdiv' or 'extinction'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nBins</code></td>
<td>
<p>Number of time slices used to generate rates through time.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smooth</code></td>
<td>
<p>A logical: whether or not to apply loess smoothing.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>smoothParam</code></td>
<td>
<p>Loess smoothing parameter, ignored if
<code>smooth = FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>opacity</code></td>
<td>
<p>Opacity of color for interval polygons.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>intervalCol</code></td>
<td>
<p>Color for interval polygons.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>avgCol</code></td>
<td>
<p>Color for mean/median line (line will not be plotted if
<code>avgCol = NULL</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start.time</code></td>
<td>
<p>Start time (in units before present). If <code>NULL</code>,
starts at root.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>end.time</code></td>
<td>
<p>End time (in units before present). If <code>NULL</code>, ends
at present.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>node</code></td>
<td>
<p>If supplied, the clade descended from this node will be used
or ignored, depending on <code>nodetype</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nodetype</code></td>
<td>
<p>If 'include', rates will be plotted only for the clade
descended from <code>node</code>. If 'exclude', the clade descended from
<code>node</code> will be left out of the calculation of rates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>plot</code></td>
<td>
<p>A logical: if <code>TRUE</code>, a plot will be returned, if
<code>FALSE</code>, the data for the plot will be returned.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex.axis</code></td>
<td>
<p>Size of axis tick labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex.lab</code></td>
<td>
<p>Size of axis labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwd</code></td>
<td>
<p>Line width of the average rate.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xline</code></td>
<td>
<p>Margin line for placing x-axis label.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yline</code></td>
<td>
<p>Margin line for placing y-axis label.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mar</code></td>
<td>
<p>Passed to <code>par()</code> to set plot margins.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xticks</code></td>
<td>
<p>Number of ticks on the x-axis, automatically inferred if
<code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>yticks</code></td>
<td>
<p>Number of ticks on the y-axis, automatically inferred if
<code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim</code></td>
<td>
<p>Vector of length 2 with min and max times for x axis. X axis
is time since present, so if plotting till the present,
<code>xlim[2] == 0</code>. Can also be 'auto'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>Vector of length 2 with min and max rates for y axis. Can also
be 'auto'.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add</code></td>
<td>
<p>A logical: should rates be added to an existing plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>axis.labels</code></td>
<td>
<p>A logical: if <code>TRUE</code>, axis labels will be plotted.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If the input <code>ephy</code> object has been generated by
<code>getEventData</code> and is of class <code>bammdata</code>, then
<code>start.time</code>, <code>end.time</code>, <code>node</code>, and <code>nodetype</code>
can be specified. If the input <code>ephy</code> object has been generated
by <code>getRateThroughTimeMatrix</code> and is of class
<code>bamm-ratematrix</code>, then those arguments cannot be specified
because they are needed to generate the rate matrix, which in this
case has already happened. 
</p>
<p>The user has complete control of the plotting of the confidence
intervals. Confidence intervals will not be plotted at all if
<code>intervals=NULL</code>. If a single confidence interval polygon is
desired, rather than overlapping polygons, then <code>intervals</code> can
specify the confidence interval bounds, and <code>opacity</code> should be
set to 1 (see examples).
</p>
<p>If working with a large dataset, we recommend first creating a
<code>bamm-ratematrix</code> object with
<code>getRateThroughTimeMatrix</code> and then using that object as
input for <code>plotRateThroughTime</code>. This way, the computation of
rates has already happened and will not slow the plotting function
down, making it easier to adjust plotting parameters.
</p>


<h3>Value</h3>

<p>If <code>plot = FALSE</code>, then a list is returned with the following
components:
</p>

<ul>
<li>
<p> poly: A list of matrices, where each matrix contains the
coordinates that define each overlapping confidence interval
polygon.
</p>
</li>
<li>
<p> avg: A vector of y-coordinates for mean or median rates
used to plot the average rates line.
</p>
</li>
<li>
<p> times: A vector of time values, used as x-coordinates in
this plot function.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Pascal Title
</p>


<h3>See Also</h3>

<p>See <code>getEventData</code> and
<code>getRateThroughTimeMatrix</code> to generate input data.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
data(events.whales)
data(whales)
ephy &lt;- getEventData(whales,events.whales)

# Simple plot of rates through time with default settings
plotRateThroughTime(ephy)

# Plot two processes separately with 90% CI and loess smoothing
plotRateThroughTime(ephy, intervals = seq(from = 0, 0.9, by = 0.01), smooth = TRUE,
                    node = 141, nodetype = 'exclude', ylim = c(0, 1.2))

plotRateThroughTime(ephy, intervals = seq(from = 0, 0.9, by = 0.01), smooth = TRUE, 
                    node = 141, nodetype = 'include', add = TRUE,
                    intervalCol = 'orange')

legend('topleft', legend = c('Dolphins','Whales'), col = 'red',
    fill = c('orange', 'blue'), border = FALSE, lty = 1, lwd = 2, merge = TRUE,
           seg.len=0.6)

# Same plot, but from bamm-ratematrix objects
rmat1 &lt;- getRateThroughTimeMatrix(ephy, node = 141, nodetype = 'exclude')
rmat2 &lt;- getRateThroughTimeMatrix(ephy, node = 141, nodetype = 'include')

plotRateThroughTime(rmat1, intervals=seq(from = 0, 0.9, by = 0.01), 
    smooth = TRUE, ylim = c(0, 1.2))

plotRateThroughTime(rmat2, intervals = seq(from = 0, 0.9, by = 0.01), 
    smooth = TRUE, add = TRUE, intervalCol = 'orange')

# To plot the mean rate without the confidence envelope
plotRateThroughTime(ephy, useMedian = FALSE, intervals = NULL)

# To plot the mean rate, with a single 95% confidence envelope, grayscale
plotRateThroughTime(ephy, useMedian = FALSE, intervals = c(0.05, 0.95),
    intervalCol = 'gray70', avgCol = 'black', opacity = 1)

# To not plot, but instead return the plotting data generated in this
# function, we can make plot = FALSE
plotRateThroughTime(ephy, plot = FALSE)
## End(Not run)
</code></pre>


</div>