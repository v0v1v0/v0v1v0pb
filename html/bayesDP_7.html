<div class="container">

<table style="width: 100%;"><tr>
<td>bdplm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bayesian Discount Prior: Two-Arm Linear Regression</h2>

<h3>Description</h3>

<p><code>bdplm</code> is used to estimate the treatment effect in the
presence of covariates using the regression analysis implementation of the
Bayesian discount prior. <code>summary</code> and <code>print</code> methods are
supported. Currently, the function only supports a two-arm clinical trial
where all of current treatment, current control, historical treatment, and
historical control data are present
</p>


<h3>Usage</h3>

<pre><code class="language-R">bdplm(
  formula = formula,
  data = data,
  data0 = NULL,
  prior_treatment_effect = NULL,
  prior_control_effect = NULL,
  prior_treatment_sd = NULL,
  prior_control_sd = NULL,
  prior_covariate_effect = 0,
  prior_covariate_sd = 10000,
  number_mcmc_alpha = 5000,
  number_mcmc_sigmagrid = 5000,
  number_mcmc_sigma = 100,
  number_mcmc_beta = 10000,
  discount_function = "identity",
  alpha_max = 1,
  fix_alpha = FALSE,
  weibull_scale = 0.135,
  weibull_shape = 3,
  method = "mc"
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>an object of class "formula." See "Details" for more
information, including specification of treatment data indicators.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>a data frame containing the current data variables in the model.
A column named <code>treatment</code> must be present; <code>treatment</code> must be
binary and indicate treatment group vs. control group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data0</code></td>
<td>
<p>a data frame containing the historical data variables in the
model. The column labels of data and data0 must match.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior_treatment_effect</code></td>
<td>
<p>scalar. The historical adjusted treatment
effect. If left <code>NULL</code>, value is estimated from the historical data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior_control_effect</code></td>
<td>
<p>scalar. The historical adjusted control effect.
If left <code>NULL</code>, value is estimated from the historical data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior_treatment_sd</code></td>
<td>
<p>scalar. The standard deviation of the historical
adjusted treatment effect. If left <code>NULL</code>, value is estimated from the
historical data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior_control_sd</code></td>
<td>
<p>scalar. The standard deviation of the historical
adjusted control effect. If left <code>NULL</code>, value is estimated from the
historical data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior_covariate_effect</code></td>
<td>
<p>vector. The prior mean(s) of the covariate
effect(s). Default value is zero. If a single value is input, the the
scalar is repeated to the length of the input covariates. Otherwise, care
must be taken to ensure the length of the input matches the number of
covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior_covariate_sd</code></td>
<td>
<p>vector. The prior standard deviation(s) of the
covariate effect(s). Default value is 1e4. If a single value is input, the
the scalar is repeated to the length of the input covariates. Otherwise,
care must be taken to ensure the length of the input matches the number of
covariates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>number_mcmc_alpha</code></td>
<td>
<p>scalar. Number of Monte Carlo simulations for
estimating the historical data weight. Default is 5000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>number_mcmc_sigmagrid</code></td>
<td>
<p>scalar. Grid size for computing sigma. Default
is 5000. See "Details" for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>number_mcmc_sigma</code></td>
<td>
<p>scalar. Number of Monte Carlo simulations for
estimating sigma. Default is 1000. See "Details" for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>number_mcmc_beta</code></td>
<td>
<p>scalar. Number of Monte Carlo simulations for
estimating beta, the vector of regression coefficients. Default is 10000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>discount_function</code></td>
<td>
<p>character. Specify the discount function to use.
Currently supports <code>weibull</code>, <code>scaledweibull</code>, and
<code>identity</code>. The discount function <code>scaledweibull</code> scales the
output of the Weibull CDF to have a max value of 1. The <code>identity</code>
discount function uses the posterior probability directly as the discount
weight. Default value is "<code>identity</code>".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha_max</code></td>
<td>
<p>scalar. Maximum weight the discount function can apply.
Default is 1. Users may specify a vector of two values where the first
value is used to weight the historical treatment group and the second value
is used to weight the historical control group.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fix_alpha</code></td>
<td>
<p>logical. Fix alpha at alpha_max? Default value is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weibull_scale</code></td>
<td>
<p>scalar. Scale parameter of the Weibull discount function
used to compute alpha, the weight parameter of the historical data. Default
value is 0.135. Users may specify a vector of two values where the first
value is used to estimate the weight of the historical treatment group and
the second value is used to estimate the weight of the historical control
group. Not used when <code>discount_function</code> = "identity".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weibull_shape</code></td>
<td>
<p>scalar. Shape parameter of the Weibull discount function
used to compute alpha, the weight parameter of the historical data. Default
value is 3. Users may specify a vector of two values where the first value
is used to estimate the weight of the historical treatment group and the
second value is used to estimate the weight of the historical control
group. Not used when <code>discount_function</code> = "identity".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>character. Analysis method with respect to estimation of the
weight paramter alpha. Default method "<code>mc</code>" estimates alpha for each
Monte Carlo iteration. Alternate value "<code>fixed</code>" estimates alpha once
and holds it fixed throughout the analysis.  See the the <code>bdplm</code>
vignette <br><code>vignette("bdplm-vignette", package="bayesDP")</code> for more
details.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p><code>bdplm</code> uses a two-stage approach for determining the strength
of historical data in estimation of an adjusted mean or covariate effect.
In the first stage, a <em>discount function</em> is used that that defines
the maximum strength of the historical data and discounts based on
disagreement with the current data. Disagreement between current and
historical data is determined by stochastically comparing the respective
posterior distributions under noninformative priors. Here with a two-arm
regression analysis, the comparison is the proability (<code>p</code>) that the
covariate effect of an historical data indicator is significantly different
from zero. The comparison metric <code>p</code> is then input into the discount
function and the final strength of the historical data is returned
(<code>alpha</code>).
</p>
<p>In the second stage, posterior estimation is performed where the discount
function parameter, <code>alpha</code>, is used to weight the historical data
effects.
</p>
<p>The formula must include an intercept (i.e., do not use <code>-1</code> in the
formula) and both data and data0 must be present. The column names of data
and data0 must match. See <code>examples</code> below for example usage.
</p>
<p>The underlying model results in a marginal posterior distribution for the
error variance <code>sigma2</code> that does not have a known distribution. Thus,
we use a grid search to draw samples of <code>sigma2</code>. First, the marginal
posterior is evaluated at a grid of <code>number_mcmc_sigmagrid</code>
<code>sigma2</code> values. The bounds of the grid are taken as approximately six
standard deviations from an estimate of <code>sigma2</code> using the <code>lm</code>
function. Next, <code>number_mcmc_sigma</code> posterior draws of <code>sigma2</code>
are made by sampling with replacement from the grid with each value having
the corresponding marginal posterior probability of being selected. With
posterior draws of <code>sigma2</code> in hand, we can make posterior draws of
the regression coefficients.
</p>


<h3>Value</h3>

<p><code>bdplm</code> returns an object of class "bdplm".
</p>
<p>An object of class "<code>bdplm</code>" is a list containing at least the
following components: </p>
 <dl>
<dt><code>posterior</code></dt>
<dd>
<p> data frame. The
posterior draws of the covariates, the intercept, and the treatment effect.
The grid of sigma values are included.</p>
</dd> <dt><code>alpha_discount</code></dt>
<dd>
<p>vector. The posterior probability of the stochastic comparison between the
current and historical data for each of the treatment and control arms. If
<code>method="mc"</code>, the result is a matrix of estimates, otherwise for
<code>method="fixed"</code>, the result is a vector of estimates.</p>
</dd>
<dt><code>estimates</code></dt>
<dd>
<p> list. The posterior means and standard errors of
the intercept, treatment effect, covariate effect(s) and error variance.</p>
</dd> </dl>
<h3>Examples</h3>

<pre><code class="language-R"># Set sample sizes
n_t &lt;- 30 # Current treatment sample size
n_c &lt;- 30 # Current control sample size
n_t0 &lt;- 80 # Historical treatment sample size
n_c0 &lt;- 80 # Historical control sample size

# Treatment group vectors for current and historical data
treatment &lt;- c(rep(1, n_t), rep(0, n_c))
treatment0 &lt;- c(rep(1, n_t0), rep(0, n_c0))

# Simulate a covariate effect for current and historical data
x &lt;- rnorm(n_t + n_c, 1, 5)
x0 &lt;- rnorm(n_t0 + n_c0, 1, 5)

# Simulate outcome:
# - Intercept of 10 for current and historical data
# - Treatment effect of 31 for current data
# - Treatment effect of 30 for historical data
# - Covariate effect of 3 for current and historical data
Y &lt;- 10 + 31 * treatment + x * 3 + rnorm(n_t + n_c, 0, 5)
Y0 &lt;- 10 + 30 * treatment0 + x0 * 3 + rnorm(n_t0 + n_c0, 0, 5)

# Place data into separate treatment and control data frames and
# assign historical = 0 (current) or historical = 1 (historical)
df_ &lt;- data.frame(Y = Y, treatment = treatment, x = x)
df0 &lt;- data.frame(Y = Y0, treatment = treatment0, x = x0)

# Fit model using default settings
fit &lt;- bdplm(
  formula = Y ~ treatment + x, data = df_, data0 = df0,
  method = "fixed"
)

# Look at estimates and discount weight
summary(fit)
print(fit)
</code></pre>


</div>