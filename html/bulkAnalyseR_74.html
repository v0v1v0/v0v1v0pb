<div class="container">

<table style="width: 100%;"><tr>
<td>volcano_plot</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create a volcano plot visualising differential expression (DE) results</h2>

<h3>Description</h3>

<p>This function creates a volcano plot to visualise the results
of a DE analysis.
</p>
<p><code>volcano_enhance</code> is called indirectly by
<code>volcano_plot</code> to add extra features.
</p>


<h3>Usage</h3>

<pre><code class="language-R">volcano_plot(
  genes.de.results,
  pval.threshold = 0.05,
  lfc.threshold = 1,
  alpha = 0.1,
  xlims = NULL,
  log10pval.cap = TRUE,
  add.colours = TRUE,
  add.expression.colour.gradient = TRUE,
  add.guide.lines = TRUE,
  add.labels.auto = TRUE,
  add.labels.custom = FALSE,
  ...
)

volcano_enhance(
  vp,
  df,
  pval.threshold,
  lfc.threshold,
  alpha,
  add.colours,
  point.colours = c("#bfbfbf", "orange", "red", "blue"),
  raster = FALSE,
  add.expression.colour.gradient,
  colour.gradient.scale = list(left = c("#99e6ff", "#000066"), right = c("#99e6ff",
    "#000066")),
  colour.gradient.breaks = waiver(),
  colour.gradient.limits = NULL,
  add.guide.lines,
  guide.line.colours = c("green", "blue"),
  add.labels.auto,
  add.labels.custom,
  annotation = NULL,
  n.labels.auto = c(5, 5, 5),
  genes.to.label = NULL,
  seed = 0,
  label.force = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>genes.de.results</code></td>
<td>
<p>the table of DE genes, usually generated by
<code>DEanalysis_edger</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pval.threshold, lfc.threshold</code></td>
<td>
<p>the p-value and/or log2(fold-change)
thresholds to determine whether a gene is DE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>the transparency of points; ignored for DE genes if
add.expression.colour.gradient is TRUE; default is 0.1</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlims</code></td>
<td>
<p>a single value to create (symmetric) x-axis limits; by default
inferred from the data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>log10pval.cap</code></td>
<td>
<p>whether to cap the log10(p-value at -10); any p-values
lower that 10^(-10) are set to the cap for plotting</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add.colours</code></td>
<td>
<p>whether to colour genes based on their log2(fold-change)
and -log10(p-value); default is TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add.expression.colour.gradient</code></td>
<td>
<p>whether to add a colour gradient
for DE genes to present their log2(expression); default is TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add.guide.lines</code></td>
<td>
<p>whether to add vertical and horizontal guide lines
to the plot to highlight the thresholds; default is TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add.labels.auto</code></td>
<td>
<p>whether to automatically label genes with the
highest |log2(fold-change)| and expression; default is TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>add.labels.custom</code></td>
<td>
<p>whether to add labels to user-specified genes;
the parameter genes.to.label must also be specified; default is FALSE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>parameters passed on to <code>volcano_enhance</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vp</code></td>
<td>
<p>volcano plot as a ggplot object (usually passed by <code>volcano_plot</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>data frame of DE results for all genes (usually passed by
<code>volcano_plot</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>point.colours</code></td>
<td>
<p>a vector of 4 colours to colour genes with both pval
and lfc under thresholds, just pval under threshold, just lfc under threshold,
both pval and lfc over threshold (DE genes) respectively; only used if
add.colours is TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raster</code></td>
<td>
<p>whether to rasterize non-DE genes with ggraster to reduce
memory usage; particularly useful when saving plots to files</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colour.gradient.scale</code></td>
<td>
<p>a vector of two colours to create a colour
gradient for colouring the DE genes based on expression; a named list with
components left and right can be supplied to use two different colour scales;
only used if add.expression.colour.gradient is TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colour.gradient.breaks, colour.gradient.limits</code></td>
<td>
<p>parameters to customise
the legend of the colour gradient scale; especially useful if creating
multiple plots or a plot with two scales;
only used if add.expression.colour.gradient is TRUE</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>guide.line.colours</code></td>
<td>
<p>a vector with two colours to be used to colour
the guide lines; the first colour is used for the p-value and log2(fold-change)
thresholds and the second for double those values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>annotation</code></td>
<td>
<p>annotation data frame containing a match between the gene
field of df (usually ENSEMBL IDs) and the gene names that should be shown
in the plot labels; not necessary if df already contains gene names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.labels.auto</code></td>
<td>
<p>a integer vector of length 3 denoting the number of
genes that should be automatically labelled; the first entry corresponds to
DE genes with the lowest p-value, the second to those with highest absolute
log2(fold-change) and the third to those with highest expression; a single
integer can also be specified, to be used for all 3 entries; default is 5</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>genes.to.label</code></td>
<td>
<p>a vector of gene names to be labelled in the
plot; if names are present those are shown as the labels (but the values are
the ones matched - this is to allow custom gene names to be presented)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>the random seed to be used for reproducibility; only used for
ggrepel::geom_label_repel if labels are present</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>label.force</code></td>
<td>
<p>passed to the force argument of ggrepel::geom_label_repel;
higher values make labels overlap less (at the cost of them being further
away from the points they are labelling)</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>The volcano plot as a ggplot object.
</p>
<p>The enhanced volcano plot as a ggplot object.
</p>


<h3>Examples</h3>

<pre><code class="language-R">expression.matrix.preproc &lt;- as.matrix(read.csv(
  system.file("extdata", "expression_matrix_preprocessed.csv", package = "bulkAnalyseR"), 
  row.names = 1
))[1:500, 1:4]

anno &lt;- AnnotationDbi::select(
  getExportedValue('org.Mm.eg.db', 'org.Mm.eg.db'),
  keys = rownames(expression.matrix.preproc),
  keytype = 'ENSEMBL',
  columns = 'SYMBOL'
) %&gt;%
  dplyr::distinct(ENSEMBL, .keep_all = TRUE) %&gt;%
  dplyr::mutate(NAME = ifelse(is.na(SYMBOL), ENSEMBL, SYMBOL))
  
edger &lt;- DEanalysis_edger(
  expression.matrix = expression.matrix.preproc,
  condition = rep(c("0h", "12h"), each = 2),
  var1 = "0h",
  var2 = "12h",
  anno = anno
)
vp &lt;- volcano_plot(edger)
print(vp)
</code></pre>


</div>