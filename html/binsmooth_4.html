<div class="container">

<table style="width: 100%;"><tr>
<td>rsubbins</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Recursive subdivision PDF and CDF fitted to binned data
</h2>

<h3>Description</h3>

<p>Creates a PDF and CDF based on a set of binned data, using recursive subdivision on a step function.
</p>


<h3>Usage</h3>

<pre><code class="language-R">rsubbins(bEdges, bCounts, m=NULL, eps1 = 0.25, eps2 = 0.75, depth = 3,
        tailShape = c("onebin", "pareto", "exponential"),
        nTail=16, numIterations=20, pIndex=1.160964, tbRatio=0.8)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>bEdges</code></td>
<td>
<p>A vector <code class="reqn">e_1, e_2, \ldots, e_n</code> giving the right endpoints of each bin. The value in <code class="reqn">e_n</code> is ignored and assumed to be <code>Inf</code> or <code>NA</code>, indicating that the top bin is unbounded. The edges determine <code class="reqn">n</code> bins on the intervals <code class="reqn">e_{i-1} \le x \le e_i</code>, where <code class="reqn">e_0</code> is assumed to be 0.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bCounts</code></td>
<td>

<p>A vector <code class="reqn">c_1, c_2, \ldots, c_n</code> giving the counts for each bin (i.e., the number of data elements in each bin). Assumed to be nonnegative.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>

<p>An estimate for the mean of the distribution. If no value is supplied, the mean will be estimated by (temporarily) setting <code class="reqn">e_n</code> equal to <code class="reqn">2e_{n-1}</code>, and a warning message will be generated.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps1</code></td>
<td>

<p>Parameter controlling how far the edges of the subdivided bins are shifted. Must be between 0 and 0.5.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eps2</code></td>
<td>

<p>Parameter controlling how wide the middle subdivsion of each bin should be. Must be between 0 and 1.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>depth</code></td>
<td>

<p>Number of times to subdivide the bins.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tailShape</code></td>
<td>

<p>Must be one of <code>"onebin"</code>, <code>"pareto"</code>, or <code>"exponential"</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nTail</code></td>
<td>

<p>The number of bins to use to form the initial tail, before recursive subdivision.
Ignored if <code>tailShape</code> equals <code>"onebin"</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numIterations</code></td>
<td>

<p>The number of iterations to optimize the tail to fit the mean. Ignored if
<code>tailShape</code> equals <code>"onebin"</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pIndex</code></td>
<td>

<p>The Pareto index for the shape of the tail. Defaults to <code class="reqn">\ln(5)/\ln(4)</code>.
Ignored unless <code>tailShape</code> equals <code>"pareto"</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tbRatio</code></td>
<td>

<p>The decay ratio for the tail bins. Ignored unless <code>tailShape</code> equals <code>"exponential"</code>.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>First, a step function PDF is created, as described in <code>stepbins</code>. The bins of the resulting PDF are then recursively subdivided and shifted in a manner that preserves the area of the original bins, resulting in a step function with finer bins.
</p>
<p>The methods <code>stepbins</code> and <code>rsubbins</code> are included in this package mainly for the purpose of comparison. For most use cases, <code>splinebins</code> will produce more accurate smoothing results.
</p>


<h3>Value</h3>

<p>Returns a list with the following components.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>rsubPDF</code></td>
<td>
<p>A <code>stepfun</code> function giving the fitted PDF.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rsubCDF</code></td>
<td>
<p>A piecewise-linear <code>approxfun</code> function giving the CDF.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>E</code></td>
<td>
<p>The right-hand endpoint of the support of the PDF.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shrinkFactor</code></td>
<td>
<p>If the supplied estimate for the mean is too small to be fitted with a step function, the bins edges will be scaled by <code>shrinkFactor</code>, which will be chosen less than (and close to) 1.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>David J. Hunter and McKalie Drown
</p>


<h3>References</h3>

<p>Paul T. von Hippel, David J. Hunter, McKalie Drown. <em>Better Estimates from Binned Income Data: Interpolated CDFs and Mean-Matching</em>, Sociological Science, November 15, 2017. <a href="https://www.sociologicalscience.com/articles-v4-26-641/">https://www.sociologicalscience.com/articles-v4-26-641/</a>
</p>


<h3>See Also</h3>

<p><code>stepbins</code></p>


<h3>Examples</h3>

<pre><code class="language-R"># 2005 ACS data from Cook County, Illinois
binedges &lt;- c(10000,15000,20000,25000,30000,35000,40000,45000,
              50000,60000,75000,100000,125000,150000,200000,NA)
bincounts &lt;- c(157532,97369,102673,100888,90835,94191,87688,90481,
               79816,153581,195430,240948,155139,94527,92166,103217)
rsb &lt;- rsubbins(binedges, bincounts, 76091, tailShape="pareto")

plot(rsb$rsubPDF, do.points=FALSE)
plot(rsb$rsubCDF, 0, rsb$E)

library(pracma)
integral(rsb$rsubPDF, 0, rsb$E)
integral(function(x){1-rsb$rsubCDF(x)}, 0, rsb$E) #mean is approximated
</code></pre>


</div>