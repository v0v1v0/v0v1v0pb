<div class="container">

<table style="width: 100%;"><tr>
<td>bma_design</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Simulate a BMA design</h2>

<h3>Description</h3>

<p>Simulates a BMA design given hyperparameters
</p>


<h3>Usage</h3>

<pre><code class="language-R">bma_design(
  nSims,
  nBaskets,
  maxDistinct = nBaskets,
  eRates,
  rRates,
  meanTime,
  sdTime,
  ppEffCrit,
  ppFutCrit,
  futOnly = FALSE,
  rRatesNull,
  rRatesAlt,
  minSSFut,
  minSSEff,
  minSSEnr,
  maxSSEnr,
  targSSPer,
  I0,
  mu0 = 0.5,
  phi0 = 1,
  priorModelProbs = NULL,
  pmp0 = 1
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>nSims</code></td>
<td>
<p>number of simulation studies to be performed</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nBaskets</code></td>
<td>
<p>number of baskets</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxDistinct</code></td>
<td>
<p>integer between 1 and <code>nBaskets</code> giving number of distinct model probabilities to use. Defaults to <code>nBaskets</code>. It is recommended to call <code>numModels</code> to ensure that computation is tractable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eRates</code></td>
<td>
<p>scalar or vector of Poisson process rates for each basket</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rRates</code></td>
<td>
<p>scalar or vector of true response rates for each basket</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>meanTime</code></td>
<td>
<p>mean parameter for time to outcome ascertainment</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sdTime</code></td>
<td>
<p>standard deviation parameter for time to outcome ascertainment</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ppEffCrit</code></td>
<td>
<p>scalar or vector giving basket-specific posterior probability threshold for activity (i.e., efficacy).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ppFutCrit</code></td>
<td>
<p>scalar or vector giving basket-specific posterior probability threshold for futility</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>futOnly</code></td>
<td>
<p><code>logical</code> giving whether design allows only for futility stopping (<code>TRUE</code> = futility only, <code>FALSE</code> = both futility and efficacy)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rRatesNull</code></td>
<td>
<p>scalar or vector of basket-specific null hypothesis values (for efficacy determination)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rRatesAlt</code></td>
<td>
<p>scalar or vector of basket-specific hypothesized alternative values (for futility determination)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minSSFut</code></td>
<td>
<p>minimum number of subjects in basket to assess futility</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minSSEff</code></td>
<td>
<p>minimum number of subjects in basket to assess activity</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>minSSEnr</code></td>
<td>
<p>matrix giving minimum number of new subjects per basket before next analysis (each row is an interim analysis, each column is a basket)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>maxSSEnr</code></td>
<td>
<p>matrix giving maximum number of new subjects per basket before next analysis (each row is an interim analysis, each column is a basket)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>targSSPer</code></td>
<td>
<p>scalar or vector giving target sample size increment for each basket</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>I0</code></td>
<td>
<p>maximum number of analyses</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mu0</code></td>
<td>
<p>prior mean for the response probabilities</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>phi0</code></td>
<td>
<p>prior dispersion response probabilities</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>priorModelProbs</code></td>
<td>
<p>vector giving prior probabilities for models. Default is prior of each model is proportional <code>exp(pmp0 * D)</code> where <code>D</code> is the number of distinct parameters in the model</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pmp0</code></td>
<td>
<p>scalar giving power for <code>priorModelProbs</code>. If <code>pmp0==0</code>, a uniform prior is used for model probabilities. Defaults to 1. Ignored if <code>priorModelProbs</code> is not <code>NULL</code></p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>a nested list giving results of the simulation with the following structure:
</p>

<ul>
<li> <p><strong>hypothesis.testing</strong>       - hypothesis testing information
</p>

<ul>
<li> <p><strong>rr</strong>                     - basket-specific null hypothesis rejection rate
</p>
</li>
<li> <p><strong>fw.fpr</strong>                 - family-wise false positive rate (across all inactive baskets)
</p>
</li>
<li> <p><strong>nerr</strong>                   - average number of false null hypothesis rejections
</p>
</li>
<li> <p><strong>fut</strong>                    - basket-specific probability of futility stopping
</p>
</li>
</ul>
</li>
<li> <p><strong>sample.size</strong>              - trial sample size information
</p>

<ul>
<li> <p><strong>basket.ave</strong>             - basket-specific expected sample size
</p>
</li>
<li> <p><strong>basket.med</strong>             - basket-specific median sample size
</p>
</li>
<li> <p><strong>basket.min</strong>             - basket-specific minimum sample size
</p>
</li>
<li> <p><strong>basket.max</strong>             - basket-specific maximum sample size
</p>
</li>
<li> <p><strong>overall.ave</strong>            - expected overall sample size
</p>
</li>
</ul>
</li>
<li> <p><strong>point.estimation</strong>         - point estimation information
</p>

<ul>
<li> <p><strong>PM.ave</strong>                 - basket-specific average posterior mean
</p>
</li>
<li> <p><strong>SP.ave</strong>                 - basket-specific average sample proportion
</p>
</li>
<li> <p><strong>PP.ave</strong>                 - basket-specific average posterior probability
</p>
</li>
<li> <p><strong>bias</strong>                   - basket-specific bias of the posterior mean
</p>
</li>
<li> <p><strong>mse</strong>                    - basket-specific MSE of the posterior mean
</p>
</li>
</ul>
</li>
<li> <p><strong>early.stopping</strong>           - early stopping information
</p>

<ul>
<li> <p><strong>interim.stop.prob</strong>      - probability of trial stoppage by interim
</p>
</li>
<li> <p><strong>baskets.continuing.ave</strong> - average number of baskets continuing past interim
</p>
</li>
</ul>
</li>
</ul>
<h3>Examples</h3>

<pre><code class="language-R">## SIMULATE DATA AND SET SIMULATION PARAMS
nSims      &lt;- 100             ## would be much more in practice                     
meanTime   &lt;- 0.01
sdTime     &lt;- 0.0000000001
mu0        &lt;- 0.45
phi0       &lt;- 1.00
ppEffCrit  &lt;- 0.985
ppFutCrit  &lt;- 0.2750
pmp0       &lt;- 2
n1         &lt;- 7
n2         &lt;- 16
targSSPer  &lt;- c(n1, n2)
nInterim   &lt;- 2
futOnly    &lt;- 1
K0         &lt;- 5
row        &lt;- 0
mss        &lt;- 4
minSSFut   &lt;- mss  ## minimum number of subjects in basket to assess futility using BMA
minSSEff   &lt;- mss  ## minimum number of subjects in basket to assess activity using BMA
rTarg      &lt;- 0.45
rNull      &lt;- 0.15
rRatesMod  &lt;- matrix(rNull,(K0+1)+3,K0)
rRatesNull &lt;- rep(rNull,K0)
rRatesMid  &lt;- rep(rTarg,K0)
eRatesMod  &lt;- rep(1, K0)

## min and max #' of new subjects per basket before next analysis (each row is interim)
minSSEnr &lt;- matrix(rep(mss, K0), nrow=nInterim ,ncol=K0, byrow=TRUE) 
maxSSEnr &lt;- matrix(rep(100, K0), nrow=nInterim, ncol=K0, byrow=TRUE) 

## construct matrix of rates
for (i in 1:K0)  
{
  rRatesMod[(i+1):(K0+1),i]= rTarg     
}
rRatesMod[(K0+2),] &lt;- c(0.05,0.15,0.25,0.35,0.45)
rRatesMod[(K0+3),] &lt;- c(0.15,0.30,0.30,0.30,0.45)
rRatesMod[(K0+4),] &lt;- c(0.15,0.15,0.30,0.30,0.30)

## conduct simulation of trial data and analysis
x &lt;- bma_design(
  nSims, K0, K0, eRatesMod, rRatesMod[i+1,], meanTime, sdTime, 
  ppEffCrit, ppFutCrit, as.logical(futOnly), rRatesNull, rRatesMid, 
  minSSFut, minSSEff, minSSEnr, maxSSEnr, targSSPer, nInterim, mu0, 
  phi0, priorModelProbs = NULL, pmp0 = pmp0
)
</code></pre>


</div>