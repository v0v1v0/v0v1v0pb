<div class="container">

<table style="width: 100%;"><tr>
<td>ordspline</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Fits Ordinal Smoothing Spline
</h2>

<h3>Description</h3>

<p>Given a real-valued response vector <code class="reqn">\mathbf{y}=\{y_{i}\}_{n\times1}</code> and an ordinal predictor vector <code class="reqn">\mathbf{x}=\{x_{i}\}_{n\times 1}</code> with <code class="reqn">x_{i} \in \{1,\ldots,K\} \ \forall i</code>, an ordinal smoothing spline model has the form </p>
<p style="text-align: center;"><code class="reqn">y_{i}=\eta(x_{i})+e_{i}</code>
</p>
<p> where <code class="reqn">y_{i}</code> is the <code class="reqn">i</code>-th observation's respone, <code class="reqn">x_{i}</code> is the <code class="reqn">i</code>-th observation's predictor, <code class="reqn">\eta</code> is an unknown function relating the response and predictor, and <code class="reqn">e_{i}\sim\mathrm{N}(0,\sigma^{2})</code> is iid Gaussian error.
</p>


<h3>Usage</h3>

<pre><code class="language-R">ordspline(x, y, knots, weights, lambda, monotone=FALSE)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>

<p>Predictor vector.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>

<p>Response vector. Must be same length as <code>x</code>.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>

<p>Either a scalar giving the number of equidistant knots to use, or a vector of values to use as the spline knots. If left blank, the number of knots is <code>min(50, nu)</code> where <code>nu = length(unique(x)).</code>
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>

<p>Weights vector (for weighted penalized least squares). Must be same length as <code>x</code> and contain non-negative values.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>

<p>Smoothing parameter. If left blank, <code>lambda</code> is tuned via Generalized Cross-Validation.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>monotone</code></td>
<td>

<p>If <code>TRUE</code>, the relationship between <code>x</code> and <code>y</code> is constrained to be monotonic increasing.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>To estimate <code class="reqn">\eta</code> I minimize the penalized least-squares functional </p>
<p style="text-align: center;"><code class="reqn">\frac{1}{n}\sum_{i=1}^{n}(y_{i}-\eta(x_{i}))^{2}+\lambda \sum_{x=2}^K [\eta(x)-\eta(x-1)]^2 dx</code>
</p>
<p> where <code class="reqn">\lambda\geq0</code> is a smoothing parameter that controls the trade-off between fitting and smoothing the data. 
</p>
<p>Default use of the function estimates <code class="reqn">\lambda</code> by minimizing the GCV score: </p>
<p style="text-align: center;"><code class="reqn">\mbox{GCV}(\lambda) = \frac{n\|(\mathbf{I}_{n}-\mathbf{S}_{\lambda})\mathbf{y}\|^{2}}{[n-\mathrm{tr}(\mathbf{S}_{\lambda})]^2}</code>
</p>
<p> where <code class="reqn">\mathbf{I}_{n}</code> is the identity matrix and <code class="reqn">\mathbf{S}_{\lambda}</code> is the smoothing matrix.
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>fitted.values</code></td>
<td>
<p>Vector of fitted values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>se.fit</code></td>
<td>
<p>Vector of standard errors of <code>fitted.values</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>Estimated error standard deviation, i.e., <code class="reqn">\hat{\sigma}</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>Chosen smoothing parameter.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>info</code></td>
<td>
<p>Model fit information: vector containing the GCV, R-squared, AIC, and BIC of fit model (assuming Gaussian error).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coef</code></td>
<td>
<p>Spline basis function coefficients.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>coef.csqrt</code></td>
<td>
<p>Matrix square-root of covariace matrix of <code>coef</code>. Use <code>tcrossprod(coef.csqrt)</code> to get covariance matrix of <code>coef</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>
<p>Number of data points, i.e., <code>length(x)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>Effective degrees of freedom (trace of smoothing matrix).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xunique</code></td>
<td>
<p>Unique elements of <code>x</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>Predictor vector (same as input).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>Response vector (same as input).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>residuals</code></td>
<td>
<p>Residual vector, i.e., <code>y - fitted.values</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>Spline knots used for fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>monotone</code></td>
<td>
<p>Logical (same as input).</p>
</td>
</tr>
</table>
<h3>Warnings </h3>

<p>When inputting user-specified <code>knots</code>, all values in <code>knots</code> must match a corresponding value in <code>x</code>.
</p>


<h3>Note</h3>

<p>The spline is estimated using penalized least-squares, which does not require the Gaussian error assumption. However, the spline inference information (e.g., standard errors and fit information) requires the Gaussian error assumption.
</p>


<h3>Author(s)</h3>

<p>Nathaniel E. Helwig &lt;helwig@umn.edu&gt;
</p>


<h3>References</h3>

<p>Gu, C. (2013). <em>Smoothing spline ANOVA models, 2nd edition</em>. New York: Springer.
</p>
<p>Helwig, N. E. (2013). <em>Fast and stable smoothing spline analysis of variance models for large samples with applications to electroencephalography data analysis</em>. Unpublished doctoral dissertation. University of Illinois at Urbana-Champaign.
</p>
<p>Helwig, N. E. (2017). <a href="http://dx.doi.org/10.3389/fams.2017.00015">Regression with ordered predictors via ordinal smoothing splines</a>. Frontiers in Applied Mathematics and Statistics, 3(15), 1-13.
</p>
<p>Helwig, N. E. and Ma, P. (2015). Fast and stable multiple smoothing parameter selection in smoothing spline analysis of variance models with large samples. <em>Journal of Computational and Graphical Statistics, 24</em>, 715-732.
</p>


<h3>Examples</h3>

<pre><code class="language-R">
##########   EXAMPLE   ##########

# generate some data
n &lt;- 100
nk &lt;- 50
x &lt;- seq(-3,3,length.out=n)
eta &lt;- (sin(2*x/pi) + 0.25*x^3 + 0.05*x^5)/15
set.seed(1)
y &lt;- eta + rnorm(n, sd=0.5)

# plot data and true eta
plot(x, y)
lines(x, eta, col="blue", lwd=2)

# fit ordinal smoothing spline
ossmod &lt;- ordspline(x, y, knots=nk)
lines(ossmod$x, ossmod$fit, col="red", lwd=2)

# fit monotonic smoothing spline
mssmod &lt;- ordspline(x, y, knots=nk, monotone=TRUE)
lines(mssmod$x, mssmod$fit, col="purple", lwd=2)

</code></pre>


</div>