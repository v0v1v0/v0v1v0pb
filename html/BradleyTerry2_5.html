<div class="container">

<table style="width: 100%;"><tr>
<td>BTm</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Bradley-Terry Model and Extensions</h2>

<h3>Description</h3>

<p>Fits Bradley-Terry models for pair comparison data, including models with
structured scores, order effect and missing covariate data.  Fits by either
maximum likelihood or maximum penalized likelihood (with Jeffreys-prior
penalty) when abilities are modelled exactly, or by penalized
quasi-likelihood when abilities are modelled by covariates.
</p>


<h3>Usage</h3>

<pre><code class="language-R">BTm(
  outcome = 1,
  player1,
  player2,
  formula = NULL,
  id = "..",
  separate.ability = NULL,
  refcat = NULL,
  family = "binomial",
  data = NULL,
  weights = NULL,
  subset = NULL,
  na.action = NULL,
  start = NULL,
  etastart = NULL,
  mustart = NULL,
  offset = NULL,
  br = FALSE,
  model = TRUE,
  x = FALSE,
  contrasts = NULL,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>outcome</code></td>
<td>
<p>the binomial response: either a numeric vector, a factor in
which the first level denotes failure and all others success, or a
two-column matrix with the columns giving the numbers of successes and
failures.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>player1</code></td>
<td>
<p>either an ID factor specifying the first player in each
contest, or a data.frame containing such a factor and possibly other
contest-level variables that are specific to the first player. If given in a
data.frame, the ID factor must have the name given in the <code>id</code>
argument. If a factor is specified it will be used to create such a
data.frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>player2</code></td>
<td>
<p>an object corresponding to that given in <code>player1</code> for
the second player in each contest, with identical structure – in particular
factors must have identical levels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>formula</code></td>
<td>
<p>a formula with no left-hand-side, specifying the model for
player ability. See details for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>the name of the ID factor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>separate.ability</code></td>
<td>
<p>(if <code>formula</code> does not include the ID factor as
a separate term) a character vector giving the names of players whose
abilities are to be modelled individually rather than using the
specification given by <code>formula</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refcat</code></td>
<td>
<p>(if <code>formula</code> includes the ID factor as a separate term)
a character specifying which player to use as a reference, with the first
level of the ID factor as the default. Overrides any other contrast
specification for the ID factor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>a description of the error distribution and link function to
be used in the model. Only the binomial family is implemented, with
either<code>"logit"</code>, <code>"probit"</code> , or <code>"cauchit"</code> link. (See
<code>stats::family()</code> for details of family functions.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an optional object providing data required by the model. This
may be a single data frame of contest-level data or a list of data frames.
Names of data frames are ignored unless they refer to data frames specified
by <code>player1</code> and <code>player2</code>. The rows of data frames that do not
contain contest-level data must correspond to the levels of a factor used
for indexing, i.e. row 1 corresponds to level 1, etc. Note any rownames are
ignored. Objects are searched for first in the <code>data</code> object if
provided, then in the environment of <code>formula</code>. If <code>data</code> is a
list, the data frames are searched in the order given.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>an optional numeric vector of ‘prior weights’.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>an optional logical or numeric vector specifying a subset of
observations to be used in the fitting process.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.action</code></td>
<td>
<p>a function which indicates what should happen when any
contest-level variables contain <code>NA</code>s. The default is the
<code>na.action</code> setting of <code>options</code>. See details for the handling of
missing values in other variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p>a vector of starting values for the fixed effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>etastart</code></td>
<td>
<p>a vector of starting values for the linear predictor.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mustart</code></td>
<td>
<p>a vector of starting values for the vector of means.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>offset</code></td>
<td>
<p>an optional offset term in the model. A vector of length equal
to the number of contests.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>br</code></td>
<td>
<p>logical.  If <code>TRUE</code> fitting will be by penalized maximum
likelihood as in Firth (1992, 1993), using <code>brglm::brglm()</code>,
rather than maximum likelihood using <code>glm()</code>, when abilities are
modelled exactly or when the abilities are modelled by covariates and the
variance of the random effects is estimated as zero.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>logical: whether or not to return the model frame.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>logical: whether or not to return the design matrix for the fixed
effects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contrasts</code></td>
<td>
<p>an optional list specifying contrasts for the factors in
<code>formula</code>. See the <code>contrasts.arg</code> of <code>model.matrix()</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>other arguments for fitting function (currently either
<code>glm()</code>, <code>brglm::brglm()</code>, or <code>glmmPQL()</code>)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>In each comparison to be modelled there is a 'first player' and a 'second
player' and it is assumed that one player wins while the other loses (no
allowance is made for tied comparisons).
</p>
<p>The <code>countsToBinomial()</code> function is provided to convert a
contingency table of wins into a data frame of wins and losses for each pair
of players.
</p>
<p>The <code>formula</code> argument specifies the model for player ability and
applies to both the first player and the second player in each contest. If
<code>NULL</code> a separate ability is estimated for each player, equivalent to
setting <code>formula = reformulate(id)</code>.
</p>
<p>Contest-level variables can be specified in the formula in the usual manner,
see <code>formula()</code>. Player covariates should be included as variables
indexed by <code>id</code>, see examples. Thus player covariates must be ordered
according to the levels of the ID factor.
</p>
<p>If <code>formula</code> includes player covariates and there are players with
missing values over these covariates, then a separate ability will be
estimated for those players.
</p>
<p>When player abilities are modelled by covariates, then random player effects
should be added to the model. These should be specified in the formula using
the vertical bar notation of <code>lme4::lmer()</code>, see examples.
</p>
<p>When specified, it is assumed that random player effects arise from a
<code class="reqn">N(0, </code><code class="reqn"> \sigma^2)</code> distribution and
model parameters, including <code class="reqn">\sigma</code>, are estimated using PQL
(Breslow and Clayton, 1993) as implemented in the <code>glmmPQL()</code>
function.
</p>


<h3>Value</h3>

<p>An object of class <code>c("BTm", "x")</code>, where <code>"x"</code> is the
class of object returned by the model fitting function (e.g. <code>glm</code>).
Components are as for objects of class <code>"x"</code>, with additionally
</p>
<table>
<tr style="vertical-align: top;">
<td><code>id</code></td>
<td>
<p>the <code>id</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>separate.ability</code></td>
<td>
<p>the
<code>separate.ability</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>refcat</code></td>
<td>
<p>the <code>refcat</code>
argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>player1</code></td>
<td>
<p>a data frame for the first player containing the
ID factor and any player-specific contest-level variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>player2</code></td>
<td>
<p>a
data frame corresponding to that for <code>player1</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>assign</code></td>
<td>
<p>a
numeric vector indicating which coefficients correspond to which terms in
the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>term.labels</code></td>
<td>
<p>labels for the model terms.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>random</code></td>
<td>
<p>for models with random effects, the design matrix for the
random effects. </p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Heather Turner, David Firth
</p>


<h3>References</h3>

<p>Agresti, A. (2002) <em>Categorical Data Analysis</em> (2nd ed).  New York:
Wiley.
</p>
<p>Firth, D. (1992) Bias reduction, the Jeffreys prior and GLIM. In
<em>Advances in GLIM and Statistical Modelling</em>, Eds. Fahrmeir, L.,
Francis, B. J., Gilchrist, R. and Tutz, G., pp91–100. New York: Springer.
</p>
<p>Firth, D. (1993) Bias reduction of maximum likelihood estimates.
<em>Biometrika</em> <strong>80</strong>, 27–38.
</p>
<p>Firth, D. (2005) Bradley-Terry models in R.  <em>Journal of Statistical
Software</em>, <strong>12</strong>(1), 1–12.
</p>
<p>Stigler, S. (1994) Citation patterns in the journals of statistics and
probability.  <em>Statistical Science</em> <strong>9</strong>, 94–108.
</p>
<p>Turner, H. and Firth, D. (2012) Bradley-Terry models in R: The BradleyTerry2
package.  <em>Journal of Statistical Software</em>, <strong>48</strong>(9), 1–21.
</p>


<h3>See Also</h3>

<p><code>countsToBinomial()</code>, <code>glmmPQL()</code>,
<code>BTabilities()</code>, <code>residuals.BTm()</code>,
<code>add1.BTm()</code>, <code>anova.BTm()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
########################################################
##  Statistics journal citation data from Stigler (1994)
##  -- see also Agresti (2002, p448)
########################################################

##  Convert frequencies to success/failure data
citations.sf &lt;- countsToBinomial(citations)
names(citations.sf)[1:2] &lt;- c("journal1", "journal2")

##  First fit the "standard" Bradley-Terry model
citeModel &lt;- BTm(cbind(win1, win2), journal1, journal2, data = citations.sf)

##  Now the same thing with a different "reference" journal
citeModel2 &lt;- update(citeModel, refcat = "JASA")
BTabilities(citeModel2)

##################################################################
##  Now an example with an order effect -- see Agresti (2002) p438
##################################################################
data(baseball) # start with baseball data as provided by package

##  Simple Bradley-Terry model, ignoring home advantage:
baseballModel1 &lt;- BTm(cbind(home.wins, away.wins), home.team, away.team,
                      data = baseball, id = "team")

##  Now incorporate the "home advantage" effect
baseball$home.team &lt;- data.frame(team = baseball$home.team, at.home = 1)
baseball$away.team &lt;- data.frame(team = baseball$away.team, at.home = 0)
baseballModel2 &lt;- update(baseballModel1, formula = ~ team + at.home)

##  Compare the fit of these two models:
anova(baseballModel1, baseballModel2)

##
## For a more elaborate example with both player-level and contest-level
## predictor variables, see help(chameleons).
##

</code></pre>


</div>