<div class="container">

<table style="width: 100%;"><tr>
<td>phm.fixed.a0</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Model fitting for the proportional hazards model with piecewise constant hazard and fixed a0</h2>

<h3>Description</h3>

<p>Model fitting using power priors for the proportional hazards model with piecewise constant hazard and fixed <code class="reqn">a_0</code>
</p>


<h3>Usage</h3>

<pre><code class="language-R">phm.fixed.a0(
  time = NULL,
  event = NULL,
  X = NULL,
  S = NULL,
  historical,
  a0,
  n.intervals,
  change.points = NULL,
  shared.blh = FALSE,
  prior.beta = "Normal",
  prior.beta.mean = rep(0, 50),
  prior.beta.sd = rep(1000, 50),
  prior.lambda = "Gamma",
  prior.lambda.hp1 = rep(10^(-5), 50),
  prior.lambda.hp2 = rep(10^(-5), 50),
  prior.lambda0.hp1 = rep(10^(-5), 50),
  prior.lambda0.hp2 = rep(10^(-5), 50),
  lower.limits = NULL,
  upper.limits = rep(100, 50),
  slice.widths = rep(0.1, 50),
  current.data = TRUE,
  nMC = 10000,
  nBI = 250
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>Vector of follow up times.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event</code></td>
<td>
<p>Vector of status indicators. Normally 0=alive and 1=dead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>Matrix of covariates. The first column must be the treatment indicator.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>S</code></td>
<td>
<p>Vector of integers, where each integer represents the stratum that the subject belongs to. For example, if there are three strata, S can take values 1, 2 or 3.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>historical</code></td>
<td>
<p>List of historical dataset(s). East historical dataset is stored in a list which contains four <em>named</em> elements: <code>time</code>, <code>event</code>, <code>X</code> and <code>S</code>.
</p>

<ul>
<li> <p><code>time</code> is a vector of follow up times.
</p>
</li>
<li> <p><code>event</code> is a vector of status indicators. Normally 0=alive and 1=dead.
</p>
</li>
<li> <p><code>X</code> is a matrix of covariates. The first column must be the treatment indicator.
</p>
</li>
<li> <p><code>S</code> is a vector of integers, where each integer represents the stratum that the subject belongs to. For example, if there are three strata, S can take values 1, 2 or 3.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>a0</code></td>
<td>
<p>Vector containing numbers between 0 and 1 indicating the discounting parameter value for each historical dataset. The length of the vector should be equal to the length of <code>historical</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.intervals</code></td>
<td>
<p>Vector of integers, indicating the number of intervals for the baseline hazards for each stratum. The length of the vector should be equal to the total number of strata.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>change.points</code></td>
<td>
<p>List of vectors. Each vector in the list contains the change points for the baseline hazards for each stratum. The length of the list should be equal to the total number of strata.
For a given stratum, if there is only one interval, then <code>change.points</code> should be <code>NULL</code> for that stratum.
By default, we assign the change points so that the same number of events are observed in all the intervals in the pooled current and historical data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shared.blh</code></td>
<td>
<p>Logical value indicating whether baseline hazard parameters are shared between the current and historical data. If TRUE, baseline hazard parameters are shared. The default value is FALSE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.beta</code></td>
<td>
<p>Prior used for <code class="reqn">\beta</code>. The choices are "Uniform" and "Normal". If <code>prior.beta</code> is "Uniform", the uniform improper prior is used.
If <code>prior.beta</code> is "Normal", independent normal priors are used for each element of <code class="reqn">\beta</code>. The default choice is "Normal".</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.beta.mean</code></td>
<td>
<p>(Only applies if <code>prior.beta</code> is "Normal") vector of means of the normal prior on <code class="reqn">\beta</code>. The default value is zero for all the elements of <code class="reqn">\beta</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.beta.sd</code></td>
<td>
<p>(Only applies if <code>prior.beta</code> is "Normal") vector of standard deviations of the normal prior on <code class="reqn">\beta</code>. The default value is 10^3 for all the elements of <code class="reqn">\beta</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.lambda</code></td>
<td>
<p>Prior used for <code class="reqn">\lambda</code>. The choices are "Gamma", "Log-normal" and "Improper". The default choice is "Gamma".
</p>
<p>If <code>prior.lambda</code> is "Gamma", then the prior on the first element of <code class="reqn">\lambda</code> is
</p>
<p>Gamma(shape=<code>prior.lambda.hp1[1]</code>, rate=<code>prior.lambda.hp2[1]</code>).
</p>
<p>If <code>prior.lambda</code> is "Log-normal", then the prior on the first element of <code class="reqn">\lambda</code> is Log-normal(mean=<code>prior.lambda.hp1[1]</code>, sd=<code>prior.lambda.hp2[1]</code>).
</p>
<p>If <code>prior.lambda</code> is "Improper", then the prior on each element of <code class="reqn">\lambda</code> is the improper prior <code class="reqn">\lambda^{-1}</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.lambda.hp1</code></td>
<td>
<p>(Only applies if <code>prior.lambda</code> is "Gamma" or "Log-normal") Vector of first hyperparameters of the prior on <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.lambda.hp2</code></td>
<td>
<p>(Only applies if <code>prior.lambda</code> is "Gamma" or "Log-normal") Vector of second hyperparameters of the prior on <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.lambda0.hp1</code></td>
<td>
<p>(Only applies if <code>shared.blh</code> is FALSE and if <code>prior.lambda</code> is "Gamma" or "Log-normal") Vector of first hyperparameters of the prior on <code class="reqn">\lambda_0</code>.
We assume the same distribution choice for the prior for <code class="reqn">\lambda_0</code> and <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda_0</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda_0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.lambda0.hp2</code></td>
<td>
<p>(Only applies if <code>shared.blh</code> is FALSE and if <code>prior.lambda</code> is "Gamma" or "Log-normal") Vector of second hyperparameters of the prior on <code class="reqn">\lambda_0</code>.
We assume the same distribution choice for the prior for <code class="reqn">\lambda_0</code> and <code class="reqn">\lambda</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda_0</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda_0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lower.limits</code></td>
<td>
<p>Vector of lower limits for parameters (<code class="reqn">\beta</code>, <code class="reqn">\lambda</code>, and <code class="reqn">\lambda_0</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is -100 for <code class="reqn">\beta</code> and 0 for <code class="reqn">\lambda</code> and <code class="reqn">\lambda_0</code> (may not be appropriate for all situations).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upper.limits</code></td>
<td>
<p>Vector of upper limits for parameters (<code class="reqn">\beta</code>, <code class="reqn">\lambda</code>, and <code class="reqn">\lambda_0</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is 100 for all parameters (may not be appropriate for all situations).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>slice.widths</code></td>
<td>
<p>Vector of initial slice widths for parameters (<code class="reqn">\beta</code>, <code class="reqn">\lambda</code>, and <code class="reqn">\lambda_0</code>, in this order) to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is 0.1 for all parameters (may not be appropriate for all situations).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>current.data</code></td>
<td>
<p>Logical value indicating whether current data is included. The default is TRUE. If FALSE, only historical data is included in the analysis,
and the posterior samples can be used as a discrete approximation to the sampling prior in
<code>power.phm.fixed.a0</code> and <code>power.phm.random.a0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nMC</code></td>
<td>
<p>Number of iterations (excluding burn-in samples) for the slice sampler. The default is 10,000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nBI</code></td>
<td>
<p>Number of burn-in samples for the slice sampler. The default is 250.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The proportional hazards model with piecewise constant hazard is implemented.
We assume <code class="reqn">\beta</code> is the regression coefficients. We assume the first column of the covariate matrix is the treatment indicator,
and the corresponding parameter is <code class="reqn">\beta_1</code>. The baseline hazards of the current data are denoted by <code class="reqn">\lambda</code>.
The baseline hazards of the historical data are denoted by <code class="reqn">\lambda_0</code>.
If the baseline hazards are shared between the historical and current data, then <code class="reqn">\lambda_0</code>=<code class="reqn">\lambda</code>.
</p>
<p>Posterior samples are obtained through slice sampling.
The default lower limits are -100 for <code class="reqn">\beta</code> and 0 for <code class="reqn">\lambda</code> and <code class="reqn">\lambda_0</code>. The default upper limits
for the parameters are 100. The default slice widths for the parameters are 0.1.
The defaults may not be appropriate for all situations, and the user can specify the appropriate limits
and slice width for each parameter.
</p>


<h3>Value</h3>

<p>Posterior samples of <code class="reqn">\beta</code>, <code class="reqn">\lambda</code> and <code class="reqn">\lambda_0</code> (if baseline hazards are not shared between the current and historical data) are returned.
</p>


<h3>References</h3>

<p>Ibrahim, J. G., Chen, M.-H. and Sinha, D. (2001). Bayesian Survival Analysis. New York: Springer Science &amp; Business Media.
</p>
<p>Psioda, M. A. and Ibrahim, J. G. (2019). Bayesian clinical trial design using historical data that inform the treatment effect. Biostatistics 20, 400–415.
</p>
<p>Shen, Y., Psioda, M. A., and Joseph, J. G. (2023). BayesPPD: an R package for Bayesian sample size determination using the power and normalized power prior for generalized linear models. The R Journal, 14(4).
</p>


<h3>See Also</h3>

<p><code>power.phm.fixed.a0</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">set.seed(1)
# Simulate current data
n &lt;- 50
P &lt;- 4
time &lt;- round(rexp(n, rate=0.5),1)
event &lt;- rep(1,n)
X &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S &lt;- c(rep(1,n/2),rep(2,n/2))

# Simulate two historical datasets
n &lt;- 100
time1 &lt;- round(rexp(n, rate=0.5),1)
event1 &lt;- rep(1,n)
X1 &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S1 &lt;- c(rep(1,n/2),rep(2,n/2))
time2 &lt;- round(rexp(n, rate=0.7),1)
event2 &lt;- rep(1,n)
X2 &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S2 &lt;- c(rep(1,n/2),rep(2,n/2))
historical &lt;- list(list(time=time1, event=event1, X=X1, S=S1),
                   list(time=time2, event=event2, X=X2, S=S2))

# a0 is 0.3 for the first historical dataset and 0.6 for the second
a0 &lt;- c(0.3, 0.6)


# We choose three intervals for the first stratum and two intervals for the second stratum
n.intervals &lt;- c(3,2) 
change.points &lt;- list(c(1,2), 2)


nMC &lt;- 1000 # nMC should be larger in practice
nBI &lt;- 50

result &lt;- phm.fixed.a0(time=time, event=event, X=X, S=S,
                       historical=historical, a0=a0, n.intervals=n.intervals, 
                       change.points=change.points, nMC=nMC, nBI=nBI)

# posterior mean of beta
colMeans(result$beta_samples) 
# posterior mean of baseline hazards for stratum 1
colMeans(result$lambda_samples[[1]]) 
# posterior mean of baseline hazards for stratum 2
colMeans(result$lambda_samples[[2]]) 
# posterior mean of historical baseline hazards for stratum 1
colMeans(result$lambda0_samples[[1]]) 
# posterior mean of historical baseline hazards for stratum 2
colMeans(result$lambda0_samples[[2]]) 




</code></pre>


</div>