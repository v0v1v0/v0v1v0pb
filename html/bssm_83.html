<div class="container">

<table style="width: 100%;"><tr>
<td>suggest_N</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Suggest Number of Particles for <code class="reqn">\psi</code>-APF Post-correction</h2>

<h3>Description</h3>

<p>Function <code>estimate_N</code> estimates suitable number particles needed for
accurate post-correction of approximate MCMC.
</p>


<h3>Usage</h3>

<pre><code class="language-R">suggest_N(
  model,
  theta,
  candidates = seq(10, 100, by = 10),
  replications = 100,
  seed = sample(.Machine$integer.max, size = 1)
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>model</code></td>
<td>
<p>Model of class <code>nongaussian</code> or <code>ssm_nlg</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>theta</code></td>
<td>
<p>A vector of theta corresponding to the model, at which point
the standard deviation of the log-likelihood is computed. Typically MAP
estimate from the (approximate) MCMC run. Can also be an output from
<code>run_mcmc</code> which is then used to compute the MAP
estimate of theta.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>candidates</code></td>
<td>
<p>A vector of positive integers containing the candidate
number of particles to test. Default is <code>seq(10, 100, by = 10)</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>replications</code></td>
<td>
<p>Positive integer, how many replications should be used
for computing the standard deviations? Default is 100.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>
<p>Seed for the C++ RNG  (positive integer).</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Function <code>suggest_N</code> estimates the standard deviation of the
logarithm of the post-correction weights at approximate MAP of theta,
using various particle sizes and suggest smallest number of particles
which still leads standard deviation less than 1. Similar approach was
suggested in the context of pseudo-marginal MCMC by Doucet et al. (2015),
but see also Section 10.3 in Vihola et al (2020).
</p>


<h3>Value</h3>

<p>List with suggested number of particles <code>N</code> and matrix
containing estimated standard deviations of the log-weights and
corresponding number of particles.
</p>


<h3>References</h3>

<p>Doucet, A, Pitt, MK, Deligiannidis, G, Kohn, R (2015).
Efficient implementation of Markov chain Monte Carlo when using an
unbiased likelihood estimator, Biometrika, 102(2) p. 295-313,
https://doi.org/10.1093/biomet/asu075
</p>
<p>Vihola, M, Helske, J, Franks, J (2020). Importance sampling type estimators
based on approximate marginal Markov chain Monte Carlo.
Scand J Statist. 1-38. https://doi.org/10.1111/sjos.12492
</p>


<h3>Examples</h3>

<pre><code class="language-R">
set.seed(1)
n &lt;- 300
x1 &lt;- sin((2 * pi / 12) * 1:n)
x2 &lt;- cos((2 * pi / 12) * 1:n)
alpha &lt;- numeric(n)
alpha[1] &lt;- 0
rho &lt;- 0.7
sigma &lt;- 1.2
mu &lt;- 1
for(i in 2:n) {
  alpha[i] &lt;- rnorm(1, mu * (1 - rho) + rho * alpha[i-1], sigma)
}
u &lt;- rpois(n, 50)
y &lt;- rbinom(n, size = u, plogis(0.5 * x1 + x2 + alpha))

ts.plot(y / u)

model &lt;- ar1_ng(y, distribution = "binomial", 
  rho = uniform(0.5, -1, 1), sigma = gamma_prior(1, 2, 0.001),
  mu = normal(0, 0, 10),
  xreg = cbind(x1,x2), beta = normal(c(0, 0), 0, 5),
  u = u)

# theta from earlier approximate MCMC run
# out_approx &lt;- run_mcmc(model, mcmc_type = "approx", 
#   iter = 5000) 
# theta &lt;- out_approx$theta[which.max(out_approx$posterior), ]

theta &lt;- c(rho = 0.64, sigma = 1.16, mu = 1.1, x1 = 0.56, x2 = 1.28)

estN &lt;- suggest_N(model, theta, candidates = seq(10, 50, by = 10),
  replications = 50, seed = 1)
plot(x = estN$results$N, y = estN$results$sd, type = "b")
estN$N

</code></pre>


</div>