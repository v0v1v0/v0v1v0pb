<div class="container">

<table style="width: 100%;"><tr>
<td>noise_profile</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Measure full spectrum sound noise profiles</h2>

<h3>Description</h3>

<p><code>noise_profile</code> Measure full spectrum sound pressure levels (i.e. noise profiles) in sound files or extended selection tables.
</p>


<h3>Usage</h3>

<pre><code class="language-R">noise_profile(
  X = NULL,
  files = NULL,
  mar = NULL,
  noise.ref = c("adjacent", "custom"),
  cores = getOption("mc.cores", 1),
  pb = getOption("pb", TRUE),
  path = getOption("sound.files.path", "."),
  bp = NULL,
  hop.size = getOption("hop.size", 1),
  wl = getOption("wl", NULL),
  PSD = FALSE,
  norm = TRUE,
  dB = c("A", "B", "C", "D", "ITU", "max0"),
  averaged = TRUE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>X</code></td>
<td>
<p>Object of class 'data.frame', 'selection_table' or 'extended_selection_table' (the last 2 classes are created by the function <code>selection_table</code> from the warbleR package) with the reference to the test sounds . Must contain the following columns: 1) "sound.files": name of the .wav files, 2) "selec": unique selection identifier (within a sound file), 3) "start": start time and 4) "end": end time of selections, 5)  "bottom.freq": low frequency for bandpass, 6) "top.freq": high frequency for bandpass and 7) "sound.id": ID of sounds used to identify counterparts across distances (needed for "custom" noise reference, see "noise.ref" argument). Default is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>files</code></td>
<td>
<p>Character vector with names of wave files to be analyzed. Files must be found in 'path' supplied (or in the working directory if 'path' is not supplied). Default is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mar</code></td>
<td>
<p>numeric vector of length 1. Specifies the margins adjacent to
the start and end points of selection over which to measure ambient noise. Required if 'X' is supplied and ignored if not supplied. Default is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>noise.ref</code></td>
<td>
<p>Character vector of length 1 to determined which noise segment must be used for measuring ambient noise. Ignored if 'X' is not supplied. Two options are available:
</p>

<ul>
<li> <p><code>adjacent</code>: measure ambient noise right before the sound (using argument 'mar' to define duration of ambient noise segments).
</p>
</li>
<li> <p><code>custom</code>: measure ambient noise segments referenced in the selection table (labeled as 'ambient' in the 'sound.id' column).
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cores</code></td>
<td>
<p>Numeric vector of length 1. Controls whether parallel computing is applied by specifying the number of cores to be used. Default is 1 (i.e. no parallel computing). Can be set globally for the current R session via the "mc.cores" option (see <code>options</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pb</code></td>
<td>
<p>Logical argument to control if progress bar is shown. Default is <code>TRUE</code>.  Can be set globally for the current R session via the "pb" option (see <code>options</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>path</code></td>
<td>
<p>Character string containing the directory path where the sound files are found. Only needed when 'X' is not an extended selection table. If not supplied the current working directory is used. Can be set globally for the current R session via the "sound.files.path" option (see <code>options</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bp</code></td>
<td>
<p>Numeric vector of length 2 giving the lower and upper limits of a frequency bandpass filter (in kHz). Default is <code>NULL</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hop.size</code></td>
<td>
<p>A numeric vector of length 1 specifying the time window duration (in ms). Default is 1 ms, which is equivalent to ~45 wl for a 44.1 kHz sampling rate. Ignored if 'wl' is supplied.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wl</code></td>
<td>
<p>A numeric vector of length 1 specifying the window length of the spectrogram, default
is NULL. Ignored if <code>bp = NULL</code>. If supplied, 'hop.size' is ignored.
Note that lower values will increase time resolution, which is more important for amplitude ratio calculations.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PSD</code></td>
<td>
<p>Logical to control whether the Probability Mass Function (the probability distribution of frequencies). See <code>meanspec</code>. Default is <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>norm</code></td>
<td>
<p>Logical to control whether amplitude values are normalized (divided by the maximum) so the highest value is 1. See <code>meanspec</code>. Default is <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dB</code></td>
<td>
<p>A character string of length 1 specifying the type dB to return: "max0" for a maximum dB value at 0, "A", "B", "C", "D", and "ITU" for common dB weights. See <code>meanspec</code>. Default is <code>"A"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>averaged</code></td>
<td>
<p>Logical to control if frequency spectra are averaged within a sound file. Default is <code>TRUE</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function estimates full spectrum sound pressure levels (i.e. noise profiles) of ambient noise. This can be done on data frames/(extended) selection tables (using the segments containing no target sound or the 'ambient' sound id) or over complete sound files in the working directory (or path supplied). The function uses <code>meanspec</code> internally to calculate frequency spectra.
</p>


<h3>Value</h3>

<p>A data frame containing the frequency spectra for each sound file or wave object (if 'X' is supplied and is of class 'extended.selection.table').
</p>


<h3>Author(s)</h3>

<p>Marcelo Araya-Salas (<a href="mailto:marcelo.araya@ucr.ac.cr">marcelo.araya@ucr.ac.cr</a>)
</p>


<h3>References</h3>


<p>Araya-Salas M., E. Grabarczyk, M. Quiroz-Oliva, A. Garcia-Rodriguez, A. Rico-Guevara. (2023), baRulho: an R package to quantify degradation in animal acoustic signals .bioRxiv 2023.11.22.568305..
</p>



<h3>See Also</h3>

<p><code>excess_attenuation</code>
</p>
<p>Other miscellaneous: 
<code>add_noise()</code>,
<code>attenuation()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">{
  # load example data
  data("test_sounds_est")

  # measure on custom noise reference
  noise_profile(X = test_sounds_est, mar = 0.01, pb = FALSE, noise.ref = "custom")

  # remove noise selections so noise is measured right before the signals
  pe &lt;- test_sounds_est[test_sounds_est$sound.id != "ambient", ]

  noise_profile(X = pe, mar = 0.01, pb = FALSE, noise.ref = "adjacent")
}
</code></pre>


</div>