<div class="container">

<table style="width: 100%;"><tr>
<td>loo_moment_match.brmsfit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Moment matching for efficient approximate leave-one-out cross-validation</h2>

<h3>Description</h3>

<p>Moment matching for efficient approximate leave-one-out cross-validation
(LOO-CV). See <code>loo_moment_match</code>
for more details.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'brmsfit'
loo_moment_match(
  x,
  loo = NULL,
  k_threshold = 0.7,
  newdata = NULL,
  resp = NULL,
  check = TRUE,
  recompile = FALSE,
  ...
)

## S3 method for class 'loo'
loo_moment_match(x, fit, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> object of class <code>brmsfit</code> or <code>loo</code> depending
on the method.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loo</code></td>
<td>
<p>An <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> object of class <code>loo</code>. If <code>NULL</code>,
brms will try to extract a precomputed <code>loo</code> object
from the fitted model, added there via <code>add_criterion</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k_threshold</code></td>
<td>
<p>The Pareto <code class="reqn">k</code> threshold for which observations
moment matching is applied. Defaults to <code>0.7</code>.
See <code>pareto_k_ids</code>
for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>newdata</code></td>
<td>
<p>An optional data.frame for which to evaluate predictions. If
<code>NULL</code> (default), the original data of the model is used. <code>NA</code>
values within factors (excluding grouping variables) are interpreted as if
all dummy variables of this factor are zero. This allows, for instance, to
make predictions of the grand mean when using sum coding. <code>NA</code> values
within grouping variables are treated as a new level.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resp</code></td>
<td>
<p>Optional names of response variables. If specified, predictions
are performed only for the specified response variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>check</code></td>
<td>
<p>Logical; If <code>TRUE</code> (the default), some checks
check are performed if the <code>loo</code> object was generated
from the <code>brmsfit</code> object passed to argument <code>fit</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>recompile</code></td>
<td>
<p>Logical, indicating whether the Stan model should be
recompiled. This may be necessary if you are running moment matching on
another machine than the one used to fit the model. No recompilation
is done by default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments passed to the underlying methods.
Additional arguments initially passed to <code>loo</code>,
for example, <code>newdata</code> or <code>resp</code> need to be passed
again to <code>loo_moment_match</code> in order for the latter
to work correctly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit</code></td>
<td>
<p>An <span style="font-family: Courier New, Courier; color: #666666;"><b>R</b></span> object of class <code>brmsfit</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The moment matching algorithm requires draws of all variables
defined in Stan's <code>parameters</code> block to be saved. Otherwise
<code>loo_moment_match</code> cannot be computed. Thus, please set
<code>save_pars = save_pars(all = TRUE)</code> in the call to <code>brm</code>,
if you are planning to apply <code>loo_moment_match</code> to your models.
</p>


<h3>Value</h3>

<p>An updated object of class <code>loo</code>.
</p>


<h3>References</h3>

<p>Paananen, T., Piironen, J., Buerkner, P.-C., Vehtari, A. (2021).
Implicitly Adaptive Importance Sampling. Statistics and Computing.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
fit1 &lt;- brm(count ~ zAge + zBase * Trt + (1|patient),
            data = epilepsy, family = poisson(),
            save_pars = save_pars(all = TRUE))

# throws warning about some pareto k estimates being too high
(loo1 &lt;- loo(fit1))

# no more warnings after moment matching
(mmloo1 &lt;- loo_moment_match(fit1, loo = loo1))

## End(Not run)

</code></pre>


</div>