<div class="container">

<table style="width: 100%;"><tr>
<td>plotProportions</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plot Proportions of Tied Matches and Non-tied Matches Won</h2>

<h3>Description</h3>

<p>Plot proportions of tied matches and non-tied matches won by the first
player, within matches binned by the relative player ability, as expressed
by the probability that the first player wins, given the match is not a tie.
Add fitted lines for each set of matches, as given by the generalized
Davidson model.
</p>


<h3>Usage</h3>

<pre><code class="language-R">plotProportions(
  win,
  tie = NULL,
  loss,
  player1,
  player2,
  abilities = NULL,
  home.adv = NULL,
  tie.max = NULL,
  tie.scale = NULL,
  tie.mode = NULL,
  at.home1 = NULL,
  at.home2 = NULL,
  data = NULL,
  subset = NULL,
  bin.size = 20,
  xlab = "P(player1 wins | not a tie)",
  ylab = "Proportion",
  legend = NULL,
  col = 1:2,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>win</code></td>
<td>
<p>a logical vector: <code>TRUE</code> if player1 wins, <code>FALSE</code>
otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tie</code></td>
<td>
<p>a logical vector: <code>TRUE</code> if the outcome is a tie,
<code>FALSE</code> otherwise (<code>NULL</code> if there are no ties).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>loss</code></td>
<td>
<p>a logical vector: <code>TRUE</code> if player1 loses, <code>FALSE</code>
otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>player1</code></td>
<td>
<p>an ID factor specifying the first player in each contest,
with the same set of levels as <code>player2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>player2</code></td>
<td>
<p>an ID factor specifying the second player in each contest,
with the same set of levels as <code>player2</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>abilities</code></td>
<td>
<p>the fitted abilities from a generalized Davidson model (or
a Bradley-Terry model).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>home.adv</code></td>
<td>
<p>if applicable, the fitted home advantage parameter from a
generalized Davidson model (or a Bradley-Terry model).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tie.max</code></td>
<td>
<p>the fitted parameter from a generalized Davidson model
corresponding to the maximum tie probability.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tie.scale</code></td>
<td>
<p>if applicable, the fitted parameter from a generalized
Davidson model corresponding to the scale of dependence of the tie
probability on the probability that <code>player1</code> wins, given the outcome
is not a draw.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tie.mode</code></td>
<td>
<p>if applicable, the fitted parameter from a generalized
Davidson model corresponding to the location of maximum tie probability, in
terms of the probability that <code>player1</code> wins, given the outcome is not
a draw.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>at.home1</code></td>
<td>
<p>a logical vector: <code>TRUE</code> if <code>player1</code> is at home,
<code>FALSE</code> otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>at.home2</code></td>
<td>
<p>a logical vector: <code>TRUE</code> if <code>player2</code> is at home,
<code>FALSE</code> otherwise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an optional data frame providing variables required by the
model, with one observation per match.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>an optional logical or numeric vector specifying a subset of
observations to include in the plot.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bin.size</code></td>
<td>
<p>the approximate number of matches in each bin.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlab</code></td>
<td>
<p>the label to use for the x-axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylab</code></td>
<td>
<p>the label to use for the y-axis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend</code></td>
<td>
<p>text to use for the legend.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>col</code></td>
<td>
<p>a vector specifying colours to use for the proportion of non-tied
matches won and the proportion of tied matches.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments passed to plot.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If <code>home.adv</code> is specified, the results are re-ordered if necessary so
that the home player comes first; any matches played on neutral ground are
omitted.
</p>
<p>First the probability that the first player wins given that the match is not
a tie is computed: </p>
<p style="text-align: center;"><code class="reqn">expit(home.adv + abilities[player1] -
abilities[player2])</code>
</p>
<p> where <code>home.adv</code> and <code>abilities</code> are
parameters from a generalized Davidson model that have been estimated on the
log scale.
</p>
<p>The matches are then binned according to this probability, grouping together
matches with similar relative ability between the first player and the
second player. Within each bin, the proportion of tied matches is computed
and these proportions are plotted against the mid-point of the bin. Then the
bins are re-computed omitting the tied games and the proportion of non-tied
matches won by the first player is found and plotted against the new
mid-point.
</p>
<p>Finally curves are added for the probability of a tie and the conditional
probability of win given the match is not a tie, under a generalized
Davidson model with parameters as specified by <code>tie.max</code>,
<code>tie.scale</code> and <code>tie.mode</code>.
</p>
<p>The function can also be used to plot the proportions of wins along with the
fitted probability of a win under the Bradley-Terry model.
</p>


<h3>Value</h3>

<p>A list of data frames: </p>
<table>
<tr style="vertical-align: top;">
<td><code>win</code></td>
<td>
<p> a data frame comprising
<code>prop.win</code>, the proportion of non-tied matches won by the first player
in each bin and <code>bin.win</code>, the mid-point of each bin. </p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tie</code></td>
<td>

<p>(when ties are present) a data frame comprising <code>prop.tie</code>, the
proportion of tied matches in each bin and <code>bin.tie</code>, the mid-point of
each bin. </p>
</td>
</tr>
</table>
<h3>Note</h3>

<p>This function is designed for single match outcomes, therefore data
aggregated over player pairs will need to be expanded.
</p>


<h3>Author(s)</h3>

<p>Heather Turner
</p>


<h3>See Also</h3>

<p><code>GenDavidson()</code>, <code>BTm()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
#### A Bradley-Terry example using icehockey data

## Fit the standard Bradley-Terry model, ignoring home advantage
standardBT &lt;- BTm(outcome = result,
                  player1 = visitor, player2 = opponent,
                  id = "team", data = icehockey)

## comparing teams on a "level playing field"
levelBT &lt;- BTm(result,
               data.frame(team = visitor, home.ice = 0),
               data.frame(team = opponent, home.ice = home.ice),
               ~ team + home.ice,
               id = "team", data = icehockey)

## compare fit to observed proportion won
## exclude tied matches as not explicitly modelled here
par(mfrow = c(1, 2))
plotProportions(win = result == 1, loss = result == 0,
                player1 = visitor, player2 = opponent,
                abilities = BTabilities(standardBT)[,1],
                data = icehockey, subset = result != 0.5,
                main = "Without home advantage")

plotProportions(win = result == 1, loss = result == 0,
                player1 = visitor, player2 = opponent,
                home.adv = coef(levelBT)["home.ice"],
                at.home1 = 0, at.home2 = home.ice,
                abilities = BTabilities(levelBT)[,1],
                data = icehockey, subset = result != 0.5,
                main = "With home advantage")

#### A generalized Davidson example using football data
if (require(gnm)) {

    ## subset to first and last season for illustration
    football &lt;- subset(football, season %in% c("2008-9", "2012-13"))

    ## convert to trinomial counts
    football.tri &lt;- expandCategorical(football, "result", idvar = "match")

    ## add variable to indicate whether team playing at home
    football.tri$at.home &lt;- !logical(nrow(football.tri))

    ## fit Davidson model
    Dav &lt;- gnm(count ~ GenDavidson(result == 1, result == 0, result == -1,
                                   home:season, away:season, home.adv = ~1,
                                   tie.max = ~1,
                                   at.home1 = at.home,
                                   at.home2 = !at.home) - 1,
               eliminate = match, family = poisson, data = football.tri)

    ## fit shifted &amp; scaled Davidson model
    shifScalDav &lt;- gnm(count ~
        GenDavidson(result == 1, result == 0, result == -1,
                    home:season, away:season, home.adv = ~1,
                    tie.max = ~1, tie.scale = ~1, tie.mode = ~1,
                    at.home1 = at.home,
                    at.home2 = !at.home) - 1,
        eliminate = match, family = poisson, data = football.tri)

    ## diagnostic plots
    main &lt;- c("Davidson", "Shifted &amp; Scaled Davidson")
    mod &lt;- list(Dav, shifScalDav)
    names(mod) &lt;- main
    alpha &lt;- names(coef(Dav)[-(1:2)])

    ## use football.tri data so that at.home can be found,
    ## but restrict to actual match results
    par(mfrow = c(1,2))
    for (i in 1:2) {
        coef &lt;- parameters(mod[[i]])
        plotProportions(result == 1, result == 0, result == -1,
                        home:season, away:season,
                        abilities = coef[alpha],
                        home.adv = coef["home.adv"],
                        tie.max = coef["tie.max"],
                        tie.scale = coef["tie.scale"],
                        tie.mode = coef["tie.mode"],
                        at.home1 = at.home,
                        at.home2 = !at.home,
                        main = main[i],
                        data = football.tri, subset = count == 1)
    }
}

</code></pre>


</div>