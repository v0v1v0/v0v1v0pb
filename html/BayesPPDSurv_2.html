<div class="container">

<table style="width: 100%;"><tr>
<td>approximate.prior.beta</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Approximating the normalized power prior for <code class="reqn">\beta</code> for the proportional hazards model with piecewise constant hazard and random a0</h2>

<h3>Description</h3>

<p>Approximation of the normalized power prior for <code class="reqn">\beta</code> for the proportional hazards model with piecewise constant hazard and random <code class="reqn">a_0</code>.
The function returns discrete samples of <code class="reqn">\beta</code> from the normalized power prior, and the user can use any mixture of multivariate normal distributions as an
approximation for the normalized power prior for <code class="reqn">\beta</code>.
This function is used to produce <code>prior.beta.mvn</code> in the function <code>power.phm.random.a0</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">approximate.prior.beta(
  historical,
  n.intervals,
  change.points = NULL,
  prior.a0.shape1 = rep(1, 10),
  prior.a0.shape2 = rep(1, 10),
  prior.beta.mean = rep(0, 50),
  prior.beta.sd = rep(1000, 50),
  prior.lambda0.hp1 = rep(10^(-5), 50),
  prior.lambda0.hp2 = rep(10^(-5), 50),
  lower.limits = rep(-100, 50),
  upper.limits = rep(100, 50),
  slice.widths = rep(0.1, 50),
  nMC = 10000,
  nBI = 250
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>historical</code></td>
<td>
<p>List of historical dataset(s). East historical dataset is stored in a list which contains four <em>named</em> elements: <code>time</code>, <code>event</code>, <code>X</code> and <code>S</code>.
</p>

<ul>
<li> <p><code>time</code> is a vector of follow up times.
</p>
</li>
<li> <p><code>event</code> is a vector of status indicators. Normally 0=alive and 1=dead.
</p>
</li>
<li> <p><code>X</code> is a matrix of covariates. The first column must be the treatment indicator.
</p>
</li>
<li> <p><code>S</code> is a vector of integers, where each integer represents the stratum that the subject belongs to. For example, if there are three strata, S can take values 1, 2 or 3.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.intervals</code></td>
<td>
<p>Vector of integers, indicating the number of intervals for the baseline hazards for each stratum. The length of the vector should be equal to the total number of strata.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>change.points</code></td>
<td>
<p>List of vectors. Each vector in the list contains the change points for the baseline hazards for each stratum. The length of the list should be equal to the total number of strata.
For a given stratum, if there is only one interval, then <code>change.points</code> should be <code>NULL</code> for that stratum.
By default, we assign the change points so that the same number of events are observed in all the intervals in the historical data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.a0.shape1</code></td>
<td>
<p>Vector of the first shape parameters of the independent beta priors for <code class="reqn">a_0</code>. The length of the vector should be equal to the number of historical datasets. The default is a vector of one's.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.a0.shape2</code></td>
<td>
<p>Vector of the second shape parameters of the independent beta priors for <code class="reqn">a_0</code>. The length of the vector should be equal to the number of historical datasets. The default is a vector of one's.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.beta.mean</code></td>
<td>
<p>Vector of means of the normal initial prior on <code class="reqn">\beta</code>. The default value is zero for all the elements of <code class="reqn">\beta</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.beta.sd</code></td>
<td>
<p>Vector of standard deviations of the normal initial prior on <code class="reqn">\beta</code>. The default value is 10^3 for all the elements of <code class="reqn">\beta</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.lambda0.hp1</code></td>
<td>
<p>Vector of first hyperparameters of the Gamma prior on <code class="reqn">\lambda_0</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda_0</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda_0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior.lambda0.hp2</code></td>
<td>
<p>Vector of second hyperparameters of the Gamma prior on <code class="reqn">\lambda_0</code>.
The length of the vector should be equal to the dimension of <code class="reqn">\lambda_0</code>, i.e., the total number of intervals for all strata. The default value is 10^(-5) for all the elements of <code class="reqn">\lambda_0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lower.limits</code></td>
<td>
<p>Vector of lower limits for <code class="reqn">\beta</code> to be used by the slice sampler. The length of the vector should be equal to the length of <code class="reqn">\beta</code>. The default is -100 for all the elements of <code class="reqn">\beta</code> (may not be appropriate for all situations).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>upper.limits</code></td>
<td>
<p>Vector of upper limits for <code class="reqn">\beta</code> to be used by the slice sampler. The length of the vector should be equal to the length of <code class="reqn">\beta</code>. The default is 100 for all the elements of <code class="reqn">\beta</code> (may not be appropriate for all situations).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>slice.widths</code></td>
<td>
<p>Vector of initial slice widths for <code class="reqn">\beta</code> to be used by the slice sampler. The length of the vector should be equal to the total number of parameters. The default is 0.1 for all the elements of <code class="reqn">\beta</code> (may not be appropriate for all situations).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nMC</code></td>
<td>
<p>Number of iterations (excluding burn-in samples) for the slice sampler. The default is 10,000.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nBI</code></td>
<td>
<p>Number of burn-in samples for the slice sampler. The default is 250.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function is used to produce <code>prior.beta.mvn</code> in the function <code>power.phm.random.a0</code>. It approximates the normalized power prior for <code class="reqn">\beta</code> when <code class="reqn">a_0</code> is modeled as random.
The function returns discrete samples of <code class="reqn">\beta</code> from the normalized power prior, and the user can use any mixture of multivariate normal distributions as an
approximation for the normalized power prior for <code class="reqn">\beta</code>.
</p>
<p>Baseline hazard parameters for the
current and historical data are NOT shared.
The baseline hazards of the historical data are denoted by <code class="reqn">\lambda_0</code>. We assume Gamma priors for <code class="reqn">\lambda_0</code>
and independent normal initial priors for <code class="reqn">\beta</code>.
</p>
<p>Posterior samples are obtained through slice sampling.
The default lower limits are -100 for <code class="reqn">\beta</code>. The default upper limits
for the parameters are 100. The default slice widths for the parameters are 0.1.
The defaults may not be appropriate for all situations, and the user can specify the appropriate limits
and slice width for each parameter.
</p>


<h3>Value</h3>

<p>Samples of <code class="reqn">\beta</code> (approximating the normalized power prior) are returned.
</p>


<h3>References</h3>

<p>Ibrahim, J. G., Chen, M.-H. and Sinha, D. (2001). Bayesian Survival Analysis. New York: Springer Science &amp; Business Media.
</p>
<p>Psioda, M. A. and Ibrahim, J. G. (2019). Bayesian clinical trial design using historical data that inform the treatment effect. Biostatistics 20, 400â€“415.
</p>
<p>Shen, Y., Psioda, M. A., and Joseph, J. G. (2023). BayesPPD: an R package for Bayesian sample size determination using the power and normalized power prior for generalized linear models. The R Journal, 14(4).
</p>


<h3>See Also</h3>

<p><code>phm.random.a0</code> and <code>power.phm.random.a0</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
# Simulate two historical datasets
n &lt;- 100
P &lt;- 4
time1 &lt;- round(rexp(n, rate=0.5),1)
event1 &lt;- rep(1,n)
X1 &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S1 &lt;- c(rep(1,n/2),rep(2,n/2))
time2 &lt;- round(rexp(n, rate=0.7),1)
event2 &lt;- rep(1,n)
X2 &lt;- matrix(rbinom(n*P,prob=0.5,size=1), ncol=P)
S2 &lt;- c(rep(1,n/2),rep(2,n/2))
historical &lt;- list(list(time=time1, event=event1, X=X1, S=S1),
                   list(time=time2, event=event2, X=X2, S=S2))

# We choose three intervals for the first stratum and two intervals for the second stratum
n.intervals &lt;- c(3,2) 
change.points &lt;- list(c(1,2), 2)

# Get samples from the approximate normalized power prior for beta
nMC &lt;- 100 # nMC should be larger in practice
nBI &lt;- 50
prior.beta &lt;- approximate.prior.beta(historical, n.intervals, change.points=change.points,
                                     prior.a0.shape1=c(1,1), prior.a0.shape2=c(1,1), 
                                     nMC=nMC, nBI=nBI)
prior_beta_mu=colMeans(prior.beta)
prior_beta_sigma=cov(prior.beta) 

# Aprroximate the discrete sames with a single multivariate normal with weight one.
# The user can use any mixture of multivariate normal distributions as an 
# approximation for the normalized power prior for beta.
prior.beta.mvn &lt;- list(list(prior_beta_mu, prior_beta_sigma, 1))
# prior.beta.mvn is a parameter for phm.random.a0() and power.phm.random.a0()



</code></pre>


</div>