<div class="container">

<table style="width: 100%;"><tr>
<td>prep_data_for_fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Data Preparation</h2>

<h3>Description</h3>

<p>Prepare binned data and model for bunching estimation.
</p>


<h3>Usage</h3>

<pre><code class="language-R">prep_data_for_fit(
  data_binned,
  zstar,
  binwidth,
  bins_l,
  bins_r,
  poly = 9,
  bins_excl_l = 0,
  bins_excl_r = 0,
  rn = NA,
  extra_fe = NA,
  correct_above_zu = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data_binned</code></td>
<td>
<p>dataframe of counts per bin</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>zstar</code></td>
<td>
<p>a numeric value for the the bunching point.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>binwidth</code></td>
<td>
<p>a numeric value for the width of each bin.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bins_l</code></td>
<td>
<p>number of bins to left of zstar to use in analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bins_r</code></td>
<td>
<p>number of bins to right of zstar to use in analysis.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>poly</code></td>
<td>
<p>a numeric value for the order of polynomial for counterfactual fit. Default is 9.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bins_excl_l</code></td>
<td>
<p>number of bins to left of zstar to include in bunching region. Default is 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bins_excl_r</code></td>
<td>
<p>number of bins to right of zstar to include in bunching region. Default is 0.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rn</code></td>
<td>
<p>a numeric vector of (up to 2) round numbers to control for. Default includes no controls.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>extra_fe</code></td>
<td>
<p>a numeric vector of bin values to control for using fixed effects. Default includes no controls.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>correct_above_zu</code></td>
<td>
<p>if integration constraint correction is implemented, should counterfactual be shifted only above zu (upper bound of exclusion region)? Default is FALSE (i.e. shift from above zstar).</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p><code>data_binned</code> returns a list with the following:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>data_binned</code></td>
<td>
<p>The binned data with the extra columns necessary for model fitting, such as indicators for bunching region, fixed effects, etc.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>model_formula</code></td>
<td>
<p>The formula used for model fitting.</p>
</td>
</tr>
</table>
<h3>See Also</h3>

<p><code>bunchit</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(bunching_data)
binned_data &lt;- bin_data(z_vector = bunching_data$kink, zstar = 10000,
                        binwidth = 50, bins_l = 20, bins_r = 20)
prepped_data &lt;- prep_data_for_fit(binned_data, zstar = 10000, binwidth = 50,
                                  bins_l = 20, bins_r = 20, poly = 4,
                                  bins_excl_l = 2, bins_excl_r = 3,
                                  rn = c(250,500), extra_fe = 10200)
head(prepped_data$data_binned)
prepped_data$model_formula
</code></pre>


</div>