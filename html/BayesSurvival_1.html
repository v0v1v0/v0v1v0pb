<div class="container">

<table style="width: 100%;"><tr>
<td>BayesSurv</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Compute the posterior mean and a credible band for the survival and
cumulative hazard, and the posterior mean for the hazard.</h2>

<h3>Description</h3>

<p>This is the main function of this package, computing relevant quantities for
a Bayesian survival analysis of (possibly right-censored) time-to-event-data.
Starting with a piecewise exponential prior with dependent or independent
Gamma heights (details below) on the hazard function, the function computes
the posterior mean for the hazard, cumulative hazard and survival function,
serving as an estimator for the true functions. In addition, for the
cumulative hazard and survival function, the radius for a fixed-width
credible band is computed. The interpretation of this credible band as a
confidence band is justified in Castillo and Van der Pas (2020).
</p>


<h3>Usage</h3>

<pre><code class="language-R">BayesSurv(
  df,
  time = "time",
  event = "event",
  prior = c("Dependent", "Independent"),
  K = ceiling((dim(df)[1]/log(dim(df)[1]))^(1/2)),
  time.max = max(df[[time]]),
  alpha = 0.05,
  N = 1000,
  alpha.dep = 1,
  alpha0.dep = 1.5,
  beta0.dep = 1,
  alpha.indep = 1.5,
  beta.indep = 1,
  surv.factor = 10,
  surv.epsilon = 1e-10
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>df</code></td>
<td>
<p>A dataframe, containing at minimum a column with follow-up times
and a column with a status indicator (event observed or censored).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time</code></td>
<td>
<p>The name of the column in the dataframe containing the (possibly
right-censored) follow-up times, that is, the minimum of the time of the
event and the time of censoring. Input the name as character/string.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>event</code></td>
<td>
<p>The name of the column in the dataframe containing the status
indicator, which must be coded as: 0 = censored, 1 = event observed. Input
the name as character/string.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>prior</code></td>
<td>
<p>Select either dependent or independent Gamma heights for the
piecewise exponential prior on the hazard. Dependent heights (with the
Markov structure described below) is default.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>K</code></td>
<td>
<p>The number of intervals to be used in the piecewise exponential
(histogram) prior. Default is set to <code class="reqn">K = (n / \log{n})^{1/2}</code>, with
<code class="reqn">n</code> the number of observations, as recommended by Castillo and Van der
Pas (2020).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time.max</code></td>
<td>
<p>The maximum follow-up time to consider, corresponding to the
parameter <code class="reqn">\tau</code> in Castillo and Van der Pas (2020).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>The function will compute (1-<code>alpha</code>)100% credible bands
for the cumulative hazard and survival function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>The number of samples to draw from the posterior.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha.dep</code></td>
<td>
<p>For the dependent Gamma prior only. The main parameter
<code class="reqn">\alpha</code> for the dependent Gamma prior, as described below. It is
recommended to take <code>alpha.dep</code> smaller than <code>alpha0.dep</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha0.dep</code></td>
<td>
<p>For the dependent Gamma prior only. The shape parameter for
the Gamma prior on the histogram height for the first interval. It is
recommended to take <code>alpha.dep</code> smaller than <code>alpha0.dep</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta0.dep</code></td>
<td>
<p>For the dependent Gamma prior only. The rate parameter for
the Gamma prior on the histogram height for the first interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha.indep</code></td>
<td>
<p>For the independent Gamma prior only. The shape parameter
for the Gamma prior on the histogram height for each interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>beta.indep</code></td>
<td>
<p>For the independent Gamma prior only. The rate parameter
for the Gamma prior on the histogram height for each interval.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surv.factor</code></td>
<td>
<p>The survival function is computed on an equispaced grid
consisting of <code>K x surv.factor</code> (the number of intervals times this
factor).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surv.epsilon</code></td>
<td>
<p>The survival function is computed on the interval [0,
<code>time.max</code> - <code>surv.epsilon</code>].</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>There are two options for the prior: a piecewise exponential (histogram)
prior with dependent Gamma heights and a piecewise exponential (histogram)
prior with independent Gamma heights. Both priors are described in detail in
Castillo and Van der Pas (2020). The dependent prior has a Markov structure,
where the height of each interval depends on the height of the previous
interval. It implements the autoregressive idea of Arjas and Gasbarra (1994).
With <code class="reqn">\lambda_k</code> the histogram height on interval <code class="reqn">k</code> and <code class="reqn">\alpha</code> a
user-selected parameter, the structure is such that, with <code class="reqn">K</code> the number
of intervals:
</p>
<p style="text-align: center;"><code class="reqn">E[\lambda_k | \lambda_{k-1}, \ldots, \lambda_1] = \lambda_{k-1}, k = 2, \ldots, K.</code>
</p>

<p style="text-align: center;"><code class="reqn">Var(\lambda_k | \lambda_{k-1}, \ldots, \lambda_1) = (\lambda_{k-1})^2/\alpha, k = 2, \ldots, K.</code>
</p>

<p>In the independent Gamma prior, the prior draws for the <code class="reqn">\lambda_k</code>'s are
independent of each other and are taken from a Gamma distribution with
user-specified shape and rate parameters.
</p>
<p>The guideline for the number of intervals <code class="reqn">K</code> suggested by Castillo and
Van der Pas (2020) is
</p>
<p style="text-align: center;"><code class="reqn">K = (n / \log{n})^{1/(1 + 2\gamma)},</code>
</p>

<p>where <code class="reqn">n</code> is the number of observations and <code class="reqn">\gamma</code> is related to
the smoothness of the true hazard function. In the absence of information
about the smoothness, a default value of <code class="reqn">\gamma = 1/2</code> is recommended
and this is implemented as the default in this package. If this choice leads
to many intervals with zero events, it is recommended to decrease the number
of intervals.
</p>
<p>The samplers used for the dependent and independent Gamma priors are described
in the Supplement to Castillo and Van der Pas (2020).
</p>


<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>haz.post.mean</code></td>
<td>
<p>The posterior mean for the hazard, given as the
value on each of the <code class="reqn">K</code> intervals.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cumhaz.post.mean</code></td>
<td>
<p>The posterior mean for the cumulative hazard,
given as the value at the end of each of the <code class="reqn">K</code> intervals. The
cumulative hazard can be obtained from this by starting at 0 and
linearly interpolating between each of the returned values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cumhaz.radius</code></td>
<td>
<p>The radius for the credible set for
the cumulative hazard.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surv.post.mean</code></td>
<td>
<p>The posterior mean for the
survival, given at each value contained in the also returned
<code>surv.eval.grid</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surv.radius</code></td>
<td>
<p>The radius for the credible set for
the survival.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>surv.eval.grid</code></td>
<td>
<p>The grid on which the
posterior mean for the survival has been computed. A finer grid can be
obtained by increasing <code>surv.factor</code> in the function call.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>time.max</code></td>
<td>
<p>The maximum follow-up time considered.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Castillo and Van der Pas (2020). Multiscale Bayesian survival
analysis. &lt;arXiv:2005.02889&gt;.
</p>
<p>Arjas and Gasbarra (1994). Nonparametric Bayesian inference from right
censored survival data, using the Gibbs sampler. Statistica Sinica 4(2):505-524.
</p>


<h3>See Also</h3>

<p>PlotBayesSurv for a function that takes the result
from <code>BayesSurv()</code> and produces plots of the posterior mean of the hazard,
the posterior mean and credible band for the cumulative hazard, and the
posterior mean and credible band for the survival. To obtain direct samples
from the posterior for the hazard, see SamplePosteriorDepGamma and
SamplePosteriorIndepGamma.
</p>


<h3>Examples</h3>

<pre><code class="language-R">#Demonstration on a simulated data set
library(simsurv)
library(ggplot2)
hazard.true &lt;- function(t,x, betas, ...){1.2*(5*(t+0.05)^3 - 10*(t+0.05)^2 + 5*(t+0.05) ) + 0.7}
sim.df &lt;- data.frame(id = 1:1000)
df &lt;- simsurv(x = sim.df, maxt = 1, hazard = hazard.true)

bs &lt;- BayesSurv(df, "eventtime", "status")
PlotBayesSurv(bs, object = "survival")
PlotBayesSurv(bs, object = "cumhaz")
PlotBayesSurv(bs, object = "hazard")

</code></pre>


</div>