<div class="container">

<table style="width: 100%;"><tr>
<td>create_ThetaMatrix</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Create Theta Matrix</h2>

<h3>Description</h3>

<p>Create the <code class="reqn">\Theta</code> matrix with the shared uncertainties
that can used as input in, e.g., AgeS_Computation and Age_OSLC14 which is used for the
covariance matrix <code class="reqn">\Sigma</code> (Combès &amp; Philippe, 2017)
</p>


<h3>Usage</h3>

<pre><code class="language-R">create_ThetaMatrix(input, output_file = NULL, sigma_s, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>input</code></td>
<td>
<p>character or data.frame (<em>optional</em>): input data frame or file connection
to import a CSV-file with the needed information. If nothing is provided the function returns
an input template. The argument <code>output_file</code> can be used to write this input template to the file
system</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output_file</code></td>
<td>
<p>character (optional): file path for the output CSV-file, the field separator
is hard set to <code>","</code>. Please use utils::write.table for more flexibility.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma_s</code></td>
<td>
<p>numeric (<strong>required</strong>): named character with values for systematic uncertainties. Those values
are lab-specific. Can be set to <code>NULL</code> to remove systematic uncertainties. The order of the <em>named</em>
vector is not important, but the naming!
<strong>Note</strong>: some of the uncertainties have a unit, please check details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>further arguments that can be passed to utils::read.table (for the CSV-file import)</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The function intends to ease the creation of the <code class="reqn">Theta</code> matrix, which cannot be
created straight forward, e.g., base R functions such as <code>stats::cov</code>.
The relationship between the covariance matrix  <code class="reqn">Sigma</code> and <code class="reqn">Theta</code> is given with
</p>
<p style="text-align: center;"><code class="reqn">\Sigma_ij = A_i * A_j * \Theta_ij</code>
</p>

<p>For details see Combès &amp; Philippe, 2017 and Guérin et al. (2021).
</p>
<p><strong>Input modes</strong>
</p>
<p>The function supports two different operation modes:
</p>

<ol>
<li> <p><code>input</code> is left empty: the function returns a data.frame template that can be used as input (the option <code>output_file</code> works as well)
</p>
</li>
<li> <p><code>input</code> is fed with a data.frame or a <code>character</code> (file path), the <code class="reqn">\Theta</code> matrix is returned
</p>
</li>
</ol>
<p><strong>Input format</strong>
</p>
<p>The function expects either a CSV-file or a data.frame as input. To create template you can
run the function leaving the argument <code>input</code> empty (see example). Please note the format
of the input table (data.frame) needs to kept as specified in the template.
</p>
<p>The following table lists the meaning of the columns:
</p>

<table>
<tr>
<td style="text-align: left;">
COLUMN </td>
<td style="text-align: left;"> DESCRIPTION </td>
<td style="text-align: left;"> UNIT </td>
</tr>
<tr>
<td style="text-align: left;">
<code>SAMPLE_ID</code> </td>
<td style="text-align: left;"> sample name </td>
<td style="text-align: left;"> - </td>
</tr>
<tr>
<td style="text-align: left;">
<code>DR_BETA_K</code> </td>
<td style="text-align: left;">  standard error beta-dose rate K </td>
<td style="text-align: left;"> Gy/ka </td>
</tr>
<tr>
<td style="text-align: left;">
<code>DR_BETA_U</code> </td>
<td style="text-align: left;">  standard error beta-dose rate U </td>
<td style="text-align: left;"> Gy/ka </td>
</tr>
<tr>
<td style="text-align: left;">
<code>DR_BETA_Th</code> </td>
<td style="text-align: left;">  standard error beta-dose rate Th </td>
<td style="text-align: left;"> Gy/ka </td>
</tr>
<tr>
<td style="text-align: left;">
<code>DR_GAMMA_K</code> </td>
<td style="text-align: left;">  standard error gamma-dose rate K </td>
<td style="text-align: left;"> Gy/ka </td>
</tr>
<tr>
<td style="text-align: left;">
<code>DR_GAMMA_U</code> </td>
<td style="text-align: left;">  standard error gamma-dose rate U </td>
<td style="text-align: left;"> Gy/ka </td>
</tr>
<tr>
<td style="text-align: left;">
<code>DR_GAMMA_Th</code> </td>
<td style="text-align: left;">  standard error gamma-dose rate Th </td>
<td style="text-align: left;"> Gy/ka </td>
</tr>
<tr>
<td style="text-align: left;">
<code>DR_GAMMA_TOTAL</code> </td>
<td style="text-align: left;">  standard error total gamma-dose rate </td>
<td style="text-align: left;"> Gy/ka </td>
</tr>
<tr>
<td style="text-align: left;">
<code>DR_TOTAL</code> </td>
<td style="text-align: left;"> total dose rate  </td>
<td style="text-align: left;"> Gy/ka </td>
</tr>
<tr>
<td style="text-align: left;">
<code>DR_TOTAL_X</code> </td>
<td style="text-align: left;"> standard error total dose rate  </td>
<td style="text-align: left;"> Gy/ka </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<p><em>Note: All columns can be set to 0 or <code>NA</code> but no column must be left empty! If a value &gt; 0 is provided
for <code>DR_GAMMA_TOTAL</code> this value is taken and values in, e.g., <code>DR_GAMMA_K</code> are discarded (set to 0)!</em>
</p>
<p><strong>Systematic uncertainties</strong>
</p>
<p>The following table provides information on the named argument
that can be provided via the argument <code>sigma_s</code>. Missing values are not allowed, all
values must be set.
</p>

<table>
<tr>
<td style="text-align: left;">
ARGUMENT </td>
<td style="text-align: left;"> DESCRIPTION </td>
<td style="text-align: left;"> UNIT </td>
</tr>
<tr>
<td style="text-align: left;">
<code>s_betaK</code> </td>
<td style="text-align: left;"> relative uncertainty K concentration </td>
<td style="text-align: left;"> - </td>
</tr>
<tr>
<td style="text-align: left;">
<code>s_betaU</code> </td>
<td style="text-align: left;"> relative uncertainty U concentration </td>
<td style="text-align: left;"> - </td>
</tr>
<tr>
<td style="text-align: left;">
<code>s_betaTh</code> </td>
<td style="text-align: left;"> relative uncertainty Th concentration </td>
<td style="text-align: left;"> - </td>
</tr>
<tr>
<td style="text-align: left;">
<code>s_gammaK</code> </td>
<td style="text-align: left;"> relative uncertainty K concentration </td>
<td style="text-align: left;"> - </td>
</tr>
<tr>
<td style="text-align: left;">
<code>s_gammaU</code> </td>
<td style="text-align: left;"> relative uncertainty U concentration </td>
<td style="text-align: left;"> - </td>
</tr>
<tr>
<td style="text-align: left;">
<code>s_gammaTh</code> </td>
<td style="text-align: left;"> relative uncertainty Th concentration </td>
<td style="text-align: left;"> - </td>
</tr>
<tr>
<td style="text-align: left;">
<code>s_gammaDR</code> </td>
<td style="text-align: left;"> relative uncertainty gamma-dose rate  </td>
<td style="text-align: left;"> - </td>
</tr>
<tr>
<td style="text-align: left;">
<code>s_CAL</code> </td>
<td style="text-align: left;"> relative uncertainty beta-source calibration </td>
<td style="text-align: left;"> - </td>
</tr>
<tr>
<td style="text-align: left;">
<code>s_intDR</code> </td>
<td style="text-align: left;"> absolute uncertainty internal dose rate </td>
<td style="text-align: left;"> Gy/ka </td>
</tr>
<tr>
<td style="text-align: left;">
</td>
</tr>
</table>
<h3>Value</h3>

<p>A symmetric <code class="reqn">Theta</code> matrix or if <code>input</code> is missing, a data.frame with an input
template
</p>


<h3>Function version</h3>

<p>0.1.0
</p>


<h3>Author(s)</h3>

<p>Sebastian Kreutzer, IRAMAT-CRP2A, UMR 5060, CNRS-Université Bordeaux Montaigne (France), based
on an 'MS Excel' sheet by Guillaume Guérin, IRAMAT-CRP2A, UMR 5060, CNRS-Université Bordeaux Montaigne (France)
, RLum Developer Team</p>


<h3>References</h3>

<p>Combès, B., Philippe, A., 2017. Bayesian analysis of individual and systematic multiplicative errors
for estimating ages with stratigraphic constraints in optically stimulated luminescence dating.
Quaternary Geochronology 39, 24–34. <a href="https://doi.org/10.1016/j.quageo.2017.02.003">doi:10.1016/j.quageo.2017.02.003</a>
</p>
<p>Guérin, G., Lahaye, C., Heydari, M., Autzen, M., Buylaert, J.-P., Guibert, P., Jain, M., Kreutzer, S., Lebrun, B., Murray, A.S., Thomsen, K.J., Urbanova, P., Philippe, A., 2021. Towards an improvement of optically stimulated luminescence (OSL) age uncertainties: modelling OSL ages with systematic errors, stratigraphic constraints and radiocarbon ages using the R package BayLum. Geochronology 3, 229—245.
<a href="https://doi.org/10.5194/gchron-3-229-2021">doi:10.5194/gchron-3-229-2021</a>
</p>


<h3>See Also</h3>

<p>AgeS_Computation, Age_OSLC14, utils::read.table, utils::write.table
</p>


<h3>Examples</h3>

<pre><code class="language-R">##(1) return template data.frame (no file output)
create_ThetaMatrix()

## Not run: 
##(2) return template as data.frame + file
file_path &lt;- tempfile(fileext = ".csv")
create_ThetaMatrix(output_file = file_path )

##NOT RUNNING EXAMPLE for sigma_s
calc_ThetaMatrix(...,
sigma_s =  c(
 s_betaK = 0.010,
 s_betaU = 0.007,
 s_betaTh = 0.006,
 s_gammaK = 0.010,
 s_gammaU = 0.007,
 s_gammaTh = 0.006,
 s_gammaDR = 0.05,
 s_CAL = 0.020,
 s_intDR = 0.030))


## End(Not run)



</code></pre>


</div>