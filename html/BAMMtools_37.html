<div class="container">

<table style="width: 100%;"><tr>
<td>plot.bammdata</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Plot <code>BAMM</code>-estimated macroevolutionary rates on a phylogeny</h2>

<h3>Description</h3>

<p><code>plot.bammdata</code> plots a phylogenetic tree from a
<code>bammdata</code> object and colors each branch by the estimated rate of
speciation, extinction, or trait evolution. Rates are not assumed to
be constant in time, and the function can plot continuously-varying
rates along individual branches.
</p>


<h3>Usage</h3>

<pre><code class="language-R">## S3 method for class 'bammdata'
plot(
  x,
  tau = 0.01,
  method = "phylogram",
  xlim = NULL,
  ylim = NULL,
  vtheta = 5,
  rbf = 0.001,
  show = TRUE,
  labels = FALSE,
  legend = FALSE,
  spex = "s",
  lwd = 1,
  cex = 1,
  pal = "RdYlBu",
  mask = integer(0),
  mask.color = gray(0.5),
  colorbreaks = NULL,
  logcolor = FALSE,
  breaksmethod = "linear",
  color.interval = NULL,
  JenksSubset = 20000,
  par.reset = FALSE,
  direction = "rightwards",
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>An object of class <code>bammdata</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tau</code></td>
<td>
<p>A numeric indicating the grain size for the calculations. See
documentation for <code>dtRates</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>method</code></td>
<td>
<p>A character string indicating the method for plotting the
phylogenetic tree. <code>method = "phylogram"</code> (default) plots the
phylogenetic tree using rectangular coordinates.
<code>method = "polar"</code> plots the phylogenetic tree using polar
coordinates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>xlim</code></td>
<td>
<p>A numeric vector of coordinates for the x-axis endpoints.
Defaults to <code>NULL</code>, in which case they are calculated
automatically. The x-axis corresponds to time when the phylogeny is
plotted facing to the left or to the right. The time at the root
equals zero.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ylim</code></td>
<td>
<p>A numeric vector of coordinates for the y-axis endpoints.
Defaults to <code>NULL</code>, in which case they are calculated
automatically. Tips are plotted at integer values beginning from zero
and stepping by one when the phylogeny is plotted facing to the left
or to the right.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vtheta</code></td>
<td>
<p>A numeric indicating the angular separation (in degrees) of
the first and last terminal nodes. Ignored if
<code>method = "phylogram"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rbf</code></td>
<td>
<p>A numeric indicating the length of the root branch as a
fraction of total tree height. Ignored if <code>method = "phylogram"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show</code></td>
<td>
<p>A logical indicating whether or not to plot the tree. Defaults
to <code>TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>labels</code></td>
<td>
<p>A logical indicating whether or not to plot the tip labels.
Defaults to <code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>legend</code></td>
<td>
<p>A logical indicating whether or not to plot a legend for
interpreting the mapping of evolutionary rates to colors. Defaults to
<code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>spex</code></td>
<td>
<p>A character string indicating what type of macroevolutionary
rates should be plotted. "s" (default) indicates speciation rates, "e"
indicates extinction rates, and "netdiv" indicates net diversification
rates. Ignored if <code>ephy$type = "trait"</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lwd</code></td>
<td>
<p>A numeric specifying the line width for branches.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cex</code></td>
<td>
<p>A numeric specifying the size of tip labels.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pal</code></td>
<td>
<p>A character string or vector of mode character that describes
the color palette. See Details for explanation of options.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mask</code></td>
<td>
<p>An optional integer vector of node numbers specifying branches
that will be masked with <code>mask.color</code> when plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mask.color</code></td>
<td>
<p>The color for the mask.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>colorbreaks</code></td>
<td>
<p>A numeric vector of percentiles delimiting the bins for
mapping rates to colors. If <code>NULL</code> (default) bins are calculated
from the rates that are passed with the <code>bammdata</code> object.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>logcolor</code></td>
<td>
<p>Logical. Should colors be plotted on a log scale.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>breaksmethod</code></td>
<td>
<p>Method used for determining color breaks. See help
file for <code>assignColorBreaks</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>color.interval</code></td>
<td>
<p>Min and max value for the mapping of rates. If
<code>NULL</code>, then min and max are inferred from the data. NA can also
be supplied for one of the two values. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>JenksSubset</code></td>
<td>
<p>If <code>breaksmethod = "jenks"</code>, the number of
regularly spaced samples to subset from the full rates vector. Only
relevant for large datasets. See help file for
<code>assignColorBreaks</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>par.reset</code></td>
<td>
<p>A logical indicating whether or not to reset the
graphical parameters when the function exits. Defaults to
<code>FALSE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>direction</code></td>
<td>
<p>A character string. Options are "rightwards",
"leftwards", "upwards", and "downwards", which determine the
orientation of the tips when the phylogeny plotted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Further arguments passed to <code>par</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>To calculate rates, each branch of the phylogeny is discretized
into a number of small segments, and the mean of the marginal
posterior density of the rate of speciation/extinction or trait
evolution is calculated for each such segment. Rates are mapped to
colors such that cool colors represent slow rates and warm colors
represent fast rates. When the tree is plotted each of these small
segments is plotted so that changes in rates through time and shifts
in rates are visible as gradients of color. The <code>spex</code> argument
determines the type of rate that will be calculated. <code>spex = "s"</code>
will plot speciation rates, <code>spex = "e"</code> will plot extinction
rates, and <code>spex = "netdiv"</code> will plot diversification rates
(speciation - extinction). Note that if <code>x$type = "trait"</code> the
<code>spex</code> argument is ignored and rates of phenotypic evolution are
plotted instead. If <code>legend = TRUE</code> the function will plot a
legend that contains the mapping of colors to numerical values.  
</p>
<p>A number of color palettes come built in with <code>BAMMtools</code>.
Color-blind friendly options include:
</p>

<ul>
<li>
<p> BrBG
</p>
</li>
<li>
<p> PiYG
</p>
</li>
<li>
<p> PRGn
</p>
</li>
<li>
<p> PuOr
</p>
</li>
<li>
<p> RdBu
</p>
</li>
<li>
<p> RdYlBu
</p>
</li>
<li>
<p> BuOr
</p>
</li>
<li>
<p> BuOrRd
</p>
</li>
<li>
<p> DkRdBu
</p>
</li>
<li>
<p> BuDkOr
</p>
</li>
<li>
<p> GnPu
</p>
</li>
</ul>
<p>Some color-blind unfriendly options include:
</p>

<ul>
<li>
<p> RdYlGn
</p>
</li>
<li>
<p> Spectral
</p>
</li>
<li>
<p> temperature
</p>
</li>
<li>
<p> terrain
</p>
</li>
</ul>
<p>Some grayscale options include:
</p>

<ul>
<li>
<p> grayscale
</p>
</li>
<li>
<p> revgray
</p>
</li>
</ul>
<p>For more information about these color palettes visit
<a href="https://colorbrewer2.org/">https://colorbrewer2.org/</a> and
<a href="https://pjbartlein.github.io/datagraphics/color_scales.html">https://pjbartlein.github.io/datagraphics/color_scales.html</a> or
use the help files of the R packages <code>RColorBrewer</code> and
<code>dichromat</code>.
</p>
<p>Additionally, any vector of valid named colors may also be used. The
only restriction is that the length of this vector be greater than or
equal to three (you can provide a single color, but in this case the
entire tree will be assigned the same color). The colors should be
ordered from cool to warm as the colors will be mapped from low rates
to high rates in the order supplied (e.g. <code>pal=c("darkgreen",
    "yellow2", "red")</code>). The option <code>pal = "temperature"</code> uses the
<code>rich.colors</code> function written by Arni Magnusson for the R
package <code>gplots</code>.
</p>
<p>Internally <code>plot.bammdata</code> checks whether or not rates have been
calculated by looking for a component named "dtrates" in the
<code>bammdata</code> object. If rates have not been calculated
<code>plot.bammdata</code> calls <code>dtRates</code> with <code>tau</code>. Specifying
smaller values for <code>tau</code> will result in smoother-looking rate
changes on the tree. Note that smaller values of <code>tau</code> require
more computation. If the <code>colorbreaks</code> argument
is <code>NULL</code> a map of rates to colors is also made by calling
<code>assignColorBreaks</code> with <code>NCOLORS = 64</code>. A user supplied
<code>colorbreaks</code> argument can be passed as well. This allows one to
plot parts of a tree while preserving the map of rates to colors that
was made using rates for the entire tree.
</p>
<p>If color.interval is defined, then those min and max values override
the automatic detection of min and max. This might be useful if some
small number of lineages have very high or very low rates, such that
the map of colors is being skewed towards these extremes, resulting in
other rate variation being drowned out. If specified, the color ramp
will be built between these two color.interval values, and the rates
outside of the color interval range will be set to the highest and
lowest color. The total number of colors will also be increased such
that 64 color bins are found within the color.interval.
</p>
<p>If <code>plot.bammdata</code> is called repeatedly with the same
<code>bammdata</code> object, computation can be reduced by first calling
<code>dtRates</code> in the global environment.
</p>


<h3>Value</h3>

<p>Returns (invisibly) a list with three components. 
</p>

<ul>
<li>
<p> coords: A matrix of plot coordinates. Rows correspond to
branches. Columns 1-2 are starting (x,y) coordinates of each
branch and columns 3-4 are ending (x,y) coordinates of each
branch. If <code>method = "polar"</code> a fifth column gives the
angle(in radians) of each branch.
</p>
</li>
<li>
<p> colorbreaks: A vector of percentiles used to group
macroevolutionary rates into color bins.
</p>
</li>
<li>
<p> colordens: A matrix of the kernel density estimates (column
2) of evolutionary rates (column 1) and the color (column 3)
corresponding to each rate value.
</p>
</li>
</ul>
<h3>Author(s)</h3>

<p>Mike Grundler, Pascal Title
</p>


<h3>Source</h3>

<p><a href="https://colorbrewer2.org/">https://colorbrewer2.org/</a>,
<a href="https://pjbartlein.github.io/datagraphics/color_scales.html">https://pjbartlein.github.io/datagraphics/color_scales.html</a>
</p>


<h3>See Also</h3>

<p><code>dtRates</code>, <code>addBAMMshifts</code>,
<code>assignColorBreaks</code>, <code>subtreeBAMM</code>,
<code>colorRampPalette</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">data(whales, events.whales)
ed &lt;- getEventData(whales, events.whales, burnin=0.25, nsamples=500)

# The first call to plot.bammdata
# No calculations or assignments of rates have been made
plot(ed, lwd = 3, spex = "s") # calls dtRates &amp; assignColorBreaks

# Compare the different color breaks methods
par(mfrow=c(1,3))
plot(ed, lwd = 3, spex = "s", breaksmethod = "linear")
title(main="linear")
plot(ed, lwd = 3, spex = "s", breaksmethod = "quantile")
title(main="quantile")
plot(ed, lwd = 3, spex = "s", breaksmethod = "jenks")
title(main="jenks")

## Not run: 
# now plot.bammdata no longer calls dtRates
ed &lt;- dtRates(ed, tau = 0.01)
xx &lt;- plot(ed, lwd = 3, spex = "s")

# you can plot subtrees while preserving the original 
# rates to colors map by passing the colorbreaks object as an argument
sed &lt;- subtreeBAMM(ed, node = 103)
plot(sed, lwd = 3, colorbreaks = xx$colorbreaks)
sed &lt;- subtreeBAMM(ed, node = 140)
plot(sed, lwd = 3, colorbreaks = xx$colorbreaks)
# note how if we do not pass colorbreaks the map is 
# no longer relative to the rest of the tree and the plot is quite
# distinct from the original
plot(sed, lwd = 3)

# if you want to change the value of tau and the rates to colors map for
# the entire tree
ed &lt;- dtRates(ed, tau = 0.002)
xx &lt;- plot(ed, lwd = 3, spex = "s")
# now you can re-plot the subtrees using this finer tau partition
sed &lt;- subtreeBAMM(ed, node = 103)
sed &lt;- dtRates(sed, 0.002)
plot(sed, lwd = 3, colorbreaks = xx$colorbreaks)
sed &lt;- subtreeBAMM(ed, node = 140)
sed &lt;- dtRates(sed, 0.002)
plot(sed, lwd = 3, colorbreaks = xx$colorbreaks)

# multi-panel plotting and adding shifts of specific posterior samples
par(mfrow=c(2,3))
samples &lt;- sample(1:length(ed$eventData), 6)
ed &lt;- dtRates(ed, 0.005)
# individual plots will have a color map relative to the mean
xx &lt;- plot(ed, show=FALSE)
for (i in 1:6) {
    ed &lt;- dtRates(ed, 0.005, samples[i])
    plot(ed, colorbreaks=xx$colorbreaks)
    addBAMMshifts(ed,index=samples[i],method="phylogram", par.reset=FALSE)	
}
dev.off()

# color options
ed &lt;- dtRates(ed,0.01)
plot(ed, pal="temperature",lwd=3)
plot(ed, pal="terrain",lwd=3)
plot(ed, pal=c("darkgreen","yellow2","red"),lwd=3)
plot(ed,method="polar",pal="Spectral", lwd=3)
plot(ed,method="polar",pal="RdYlBu", lwd=3)
## End(Not run)
</code></pre>


</div>