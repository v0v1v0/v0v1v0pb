<div class="container">

<table style="width: 100%;"><tr>
<td>nlme_fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Mixed-model nlme fit to 13C Breath Data</h2>

<h3>Description</h3>

<p>Fits exponential beta curves to 13C breath test series data using
a mixed-model population approach. See
<a href="https://menne-biomed.de/blog/breath-test-stan">https://menne-biomed.de/blog/breath-test-stan</a> for a comparison between
single curve, mixed-model population and Bayesian methods.
</p>


<h3>Usage</h3>

<pre><code class="language-R">nlme_fit(
  data,
  dose = 100,
  start = list(m = 30, k = 1/100, beta = 2),
  sample_minutes = 15
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>Data frame or tibble as created by <code>cleanup_data</code>,
with mandatory columns <code>patient_id, group, minute</code> and <code>pdr</code>.
It is recommended to run all data through <code>cleanup_data</code> to
insert dummy columns for <code>patient_id</code> and <code>group</code> if the
data are distinct, and report an error if not. At least 2 records are required
for a population fit, but 10 or more are recommended to obtain a stable result.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dose</code></td>
<td>
<p>Dose of acetate or octanoate. Currently, only one common dose
for all records is supported. The dose only affects parameter <code>m</code> of the 
fit; all important t50-parameters are unaffected by the dose.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start</code></td>
<td>
<p>Optional start values. In most case, the default values are good
enough to achieve convergence, but slightly different values for <code>beta</code>
(between 1 and 2.5) can save a non-convergent run.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sample_minutes</code></td>
<td>
<p>When the mean sampling interval is &lt; <code>sampleMinutes</code>, 
data are subsampled using a spline algorithm by function <code>subsample_data</code>.
See the graphical output of <code>plot.breathtestfit</code> for an example where
too densely sampled data of one patients were subsampled for the fit.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<p>A list of class ("breathtestnlmefit" "breathtestfit") with elements
</p>

<dl>
<dt>coef</dt>
<dd>
<p>Estimated parameters in a key-value format with 
columns <code>patient_id, group, parameter, stat, method</code> and <code>value</code>.
Parameter <code>stat</code> currently always has value <code>"estimate"</code>. 
Confidence intervals will be added later, so do not take for granted that 
all parameters are estimates.  Has an attribute AIC which can be retrieved by
the S3-function <code>AIC</code>.</p>
</dd>
<dt>data</dt>
<dd>
<p>The data effectively fitted. If points are to closely sampled
in the input, e.g. with BreathId devices, data are subsampled before fitting.</p>
</dd>
</dl>
<h3>See Also</h3>

<p>Base methods <code>coef, plot, print</code>; methods from package
<code>broom: tidy, augment</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R">d = simulate_breathtest_data(n_records = 3, noise = 0.7, seed = 4712)
data = cleanup_data(d$data)
fit = nlme_fit(data)
plot(fit) # calls plot.breathtestfit
options(digits = 3)
library(dplyr)
cf = coef(fit)
# The coefficients are in long key-value format
cf
# AIC can be extracted
AIC(fit)
# Reformat the coefficients to wide format and compare 
# with the expected coefficients from the simulation 
# in d$record.
cf %&gt;%
  filter(grepl("m|k|beta", parameter )) %&gt;%
  select(-method, -group) %&gt;%
  tidyr::spread(parameter, value) %&gt;%
  inner_join(d$record, by = "patient_id") %&gt;%
  select(patient_id, m_in = m.y, m_out = m.x,
         beta_in = beta.y, beta_out = beta.x,
         k_in = k.y, k_out = k.x)
</code></pre>


</div>