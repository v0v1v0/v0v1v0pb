<div class="container">

<table style="width: 100%;"><tr>
<td>next_allocation_rate_BAR</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Calculate the allocation probability for the next block of new patients using Bayesian adaptive randomization
</h2>

<h3>Description</h3>

<p>Calculate updated allocation probability for each arm based on the accumulative data with binary outcomes
</p>


<h3>Usage</h3>

<pre><code class="language-R">next_allocation_rate_BAR(n, success_count, tot_num,
                         power_c = "n/2N",
                         lower_bound = .05,
                         control_arm = "",
                         seed = 100)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>n</code></td>
<td>

<p>the number of patients enrolled for each arm
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>success_count</code></td>
<td>

<p>the number of responders for each arm
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>tot_num</code></td>
<td>

<p>the total number of patients enrolled for the trial. If this number cannot be pre-planned, the user can choose argument "power_c" to be numeric instead of "n/2N". In this case, even if the "tot_num" is given a number, this number will not be used
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>power_c</code></td>
<td>

<p>the power correction of allocation probability. The default value is power_c = "n/2N" and can also be numeric, e.g., power_c = .5
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lower_bound</code></td>
<td>

<p>the lower bound of the allocation probability. It must between 0 and <code class="reqn">\frac{1}{K}</code>. The default value is lower_bound = .05; K indicates total number of arms (including control arm)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control_arm</code></td>
<td>

<p>if this argument is "fixed", then allocation probability of control arm (the first slot)
will be fixed to <code class="reqn">\frac{1}{K}</code>. The default of this argument will return unfixed results; K indicates total number of arms (including control arm)
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>seed</code></td>
<td>

<p>the seed. The default value is seed = 100
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>We show how the updated allocation probabilities for each arm are calculated.<br><br> Treatments are denoted by <code class="reqn">k = 1,\ldots,K</code>.<code class="reqn">\;N</code> is the total sample size. If no burn-in(s), the BAR will be initiated start of a study, that is, for each enrolled patient, <code class="reqn">n = 1,\ldots,N,</code> the BAR will be used to assign each patient. Denoting the true unknown response rates of <code class="reqn">K</code> treatments by <code class="reqn">\pi_{1},\ldots,\pi_{K},\;</code>we can compute <code class="reqn">K</code> posterior probabilities: <code class="reqn">r_{k,n} = Pr(\pi_{k} = max\{\pi_{1},\ldots,\pi_{K}\}\;|\;Data_{n})</code>, here, <code class="reqn">n</code> refers to the <code class="reqn">n</code>-th patient and <code class="reqn">k</code> refers to the <code class="reqn">k</code>-th arm. We calculate the updated probabilities of the BAR algorithm according to the following steps.<br><code class="reqn">\;</code><br> Step 1: (Normalization) Normalize <code class="reqn">r_{k,n}</code> as <code class="reqn">r_{k,n}^{(c)} = \frac{(r_{k,n})^{c}}{\sum_{j=1}^{K}(r_{j,n})^{c}}</code>, here <code class="reqn">\;c = \frac{n}{2N}</code>.<br><br>
Step 2: (Restriction) To avoid the BAR sticking to very low/high probabilities, a restriction rule to the posterior probability <code class="reqn">r_{k,n}^{(c)}</code> will be applied: </p>
<p style="text-align: center;"><code class="reqn">Lower\;Bound \le r_{k,n}^{(c)} \le 1 - (K - 1) \times Lower\;Bound,</code>
</p>

<p style="text-align: center;"><code class="reqn">0 \le Lower\;Bound \le \frac{1}{K}</code>
</p>

<p>After restriction, the posterior probability is denoted as <code class="reqn">r_{k,n}^{(c,re)}</code>.<br><br>
Step 3: (Re-normalization) Then, we can have the updated allocation probabilities by the BAR denoted as:</p>
<p style="text-align: center;"><code class="reqn">r_{k,n}^{(f)} = \frac{r_{k,n}^{(c,re)}\times(\frac{r_{k,n}^{(c,re)}}{\frac{n_{k}}{n}})^{2}}{\sum_{j=1}^{K}\{r_{j,n}^{(c,re)}\times(\frac{r_{j,n}^{(c,re)}}{\frac{n_{j}}{n}})^{2}\}}</code>
</p>
<p> where <code class="reqn">n_{k}</code> is the number of patients enrolled on arm <code class="reqn">k</code> up-to-now.<br><br>
Step 4: (Re-restriction) Finally, restricts again by using </p>
<p style="text-align: center;"><code class="reqn">Lower\;Bound \le r_{k,n}^{(f)} \le 1 - (K-1) \times Lower\;Bound,</code>
</p>

<p style="text-align: center;"><code class="reqn">0 \le Lower\;Bound \le \frac{1}{K}</code>
</p>
<p>and denote <code class="reqn">r_{k,n}^{(ff)}</code> as the allocation probability used in the BAR package.
</p>


<h3>Value</h3>

<p><code>next_allocation_rate_BAR()</code> returns the updated allocation probability for each arm
</p>


<h3>Author(s)</h3>

<p>Chia-Wei Hsu, Haitao Pan
</p>


<h3>References</h3>

<p>Wathen JK, Thall PF. A simulation study of outcome adaptive randomization in multi-arm clinical trials. Clin Trials. 2017 Oct; 14(5): 432-440. doi: 10.1177/1740774517692302.
</p>
<p>Xiao, Y., Liu, Z. &amp; Hu, F. Bayesian doubly adaptive randomization in clinical trials. Sci. China Math. 60, 2503-2514 (2017). doi: 10.1007/s11425-016-0056-1.
</p>
<p>Hu F, Zhang L X. Asymptotic properties of doubly adaptive biased coin designs for multi-treatment clinical trials. Ann Statist, 2004, 30: 268â€“301.
</p>


<h3>Examples</h3>

<pre><code class="language-R">## power_c = "n/2N"
next_allocation_rate_BAR(n = c(30, 30, 30),
                         success_count = c(5, 6, 12),
                         tot_num = 150)

## power_c = .5
next_allocation_rate_BAR(n = c(30, 30, 30),
                         success_count = c(5, 6, 12),
                         tot_num = 150, power_c = .5)
</code></pre>


</div>