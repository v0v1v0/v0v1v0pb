<div class="container">

<table style="width: 100%;"><tr>
<td>mtpc</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Multi-threshold permutation correction</h2>

<h3>Description</h3>

<p>Applies the <em>multi-threshold permutation correction (MTPC)</em> method to
perform inference in graph theory analyses of brain MRI data.
</p>
<p>Plot the statistics from an MTPC analysis, along with the maximum permuted
statistics. The output is similar to Figure 11 in Drakesmith et al. (2015).
</p>


<h3>Usage</h3>

<pre><code class="language-R">mtpc(g.list, thresholds, covars, measure, contrasts, con.type = c("t",
  "f"), outcome = NULL, con.name = NULL, level = c("vertex",
  "graph"), clust.size = 3L, perm.method = c("freedmanLane",
  "terBraak", "smith", "draperStoneman", "manly", "stillWhite"),
  part.method = c("beckmann", "guttman", "ridgway"), N = 500L,
  perms = NULL, alpha = 0.05, res.glm = NULL, long = TRUE, ...)

## S3 method for class 'mtpc'
summary(object, contrast = NULL, digits = max(3L,
  getOption("digits") - 2L), print.head = TRUE, ...)

## S3 method for class 'mtpc'
plot(x, contrast = 1L, region = NULL,
  only.sig.regions = TRUE, show.null = TRUE, caption.stats = FALSE,
  ...)

## S3 method for class 'mtpc'
nobs(object, ...)

## S3 method for class 'mtpc'
terms(x, ...)

## S3 method for class 'mtpc'
formula(x, ...)

## S3 method for class 'mtpc'
labels(object, ...)

## S3 method for class 'mtpc'
case.names(object, ...)

## S3 method for class 'mtpc'
variable.names(object, ...)

## S3 method for class 'mtpc'
df.residual(object, ...)

## S3 method for class 'mtpc'
region.names(object)

## S3 method for class 'mtpc'
nregions(object)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>g.list</code></td>
<td>
<p>A list of <code>brainGraphList</code> objects for all thresholds</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>thresholds</code></td>
<td>
<p>Numeric vector of the thresholds applied to the raw
connectivity matrices.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>covars</code></td>
<td>
<p>A <code>data.table</code> of covariates</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>measure</code></td>
<td>
<p>Character string of the graph measure of interest</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contrasts</code></td>
<td>
<p>Numeric matrix (for T statistics) or list of matrices (for F
statistics) specifying the contrast(s) of interest; if only one contrast is
desired, you can supply a vector (for T statistics)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>con.type</code></td>
<td>
<p>Character string; either <code>'t'</code> or <code>'f'</code> (for t or
F-statistics). Default: <code>'t'</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>outcome</code></td>
<td>
<p>Character string specifying the name of the outcome variable,
if it differs from the graph metric (<code>measure</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>con.name</code></td>
<td>
<p>Character vector of the contrast name(s); if <code>contrasts</code>
has row/list names, those will be used for reporting results</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>level</code></td>
<td>
<p>Character string; either <code>vertex</code> (default) or
<code>graph</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>clust.size</code></td>
<td>
<p>Integer indicating the size of “clusters” (i.e.,
consecutive thresholds for which the observed statistic exceeds the null)
(default: <code>3L</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>perm.method</code></td>
<td>
<p>Character string indicating the permutation method.
Default: <code>'freedmanLane'</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>part.method</code></td>
<td>
<p>Character string; the method of partitioning the design
matrix into covariates of interest and nuisance. Default: <code>'beckmann'</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>N</code></td>
<td>
<p>Integer; number of permutations to create. Default: <code>5e3</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>perms</code></td>
<td>
<p>Matrix of permutations, if you would like to provide your own.
Default: <code>NULL</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>alpha</code></td>
<td>
<p>Numeric; the significance level. Default: 0.05</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res.glm</code></td>
<td>
<p>A list of <code>bg_GLM</code> objects, as output by a previous run
of <code>mtpc</code>. Useful if you want to change the cluster size without
re-running all of the GLM's and permutations (default: <code>NULL</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>long</code></td>
<td>
<p>Logical indicating whether or not to return all permutation
results. Default: <code>FALSE</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Other arguments passed to <code>brainGraph_GLM</code> and/or
<code>brainGraph_GLM_design</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>object, x</code></td>
<td>
<p>A <code>mtpc</code> object</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contrast</code></td>
<td>
<p>Integer specifying the contrast to plot/summarize; defaults
to showing results for all contrasts</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>digits</code></td>
<td>
<p>Integer specifying the number of digits to display for P-values</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>print.head</code></td>
<td>
<p>Logical indicating whether or not to print only the first
and last 5 rows of the statistics tables (default: <code>TRUE</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>region</code></td>
<td>
<p>Character string specifying which region's results to
plot; only relevant if <code>level='vertex'</code>. Default: <code>NULL</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>only.sig.regions</code></td>
<td>
<p>Logical indicating whether to plot only significant
regions (default: <code>TRUE</code>)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>show.null</code></td>
<td>
<p>Logical indicating whether to plot points of the maximum
null statistics (per permutation)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>caption.stats</code></td>
<td>
<p>Logical indicating whether to print the MTPC statistics
in the caption of the plot. Default: <code>FALSE</code></p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This is a multi-step procedure: (steps 3-4 are the time-consuming steps)
</p>

<ol>
<li>
<p> Apply thresholds <code class="reqn">\tau</code> to the networks, and compute network
metrics for all networks and thresholds. (already done beforehand)
</p>
</li>
<li>
<p> Compute test statistics <code class="reqn">S_{obs}</code> for each threshold. (done by
<code>brainGraph_GLM</code>)
</p>
</li>
<li>
<p> Permute group assignments and compute test statistics for each
permutation and threshold. (done by <code>brainGraph_GLM</code>)
</p>
</li>
<li>
<p> Build a null distribution of the maximum statistic across thresholds
(and across brain regions) for each permutation. (done by
<code>brainGraph_GLM</code>)
</p>
</li>
<li>
<p> Determine the critical value, <code class="reqn">S_{crit}</code> from the null
distribution of maximum statistics.
</p>
</li>
<li>
<p> Identify clusters where <code class="reqn">S_{obs} &gt; S_{crit}</code> and compute the AUC
for these clusters (denoted <code class="reqn">A_{MTPC}</code>).
</p>
</li>
<li>
<p> Compute a critical AUC (<code class="reqn">A_{crit}</code>) from the mean of the
supra-critical AUC's for the permuted tests.
</p>
</li>
<li>
<p> Reject <code class="reqn">H_0</code> if <code class="reqn">A_{MTPC} &gt; A_{crit}</code>.
</p>
</li>
</ol>
<h3>Value</h3>

<p>An object of class <code>mtpc</code> with some input arguments plus the
following elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>X,qr,cov.unscaled</code></td>
<td>
<p>Design matrix, QR decomposition, and unscaled
covariance matrix, if the design is the same across thresholds</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>contrasts</code></td>
<td>
<p>The contrast matrix or list of matrices</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>con.name</code></td>
<td>
<p>Contrast names</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>removed.subs</code></td>
<td>
<p>Named integer vector of subjects with incomplete data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>atlas</code></td>
<td>
<p>The atlas of the input graphs</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>rank,df.residual</code></td>
<td>
<p>The model rank and residual degrees of freedom</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>res.glm</code></td>
<td>
<p>List with length equal to the number of thresholds; each
list element is the output from <code>brainGraph_GLM</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>DT</code></td>
<td>
<p>A <code>data.table</code> for all thresholds, combined from the outputs
of <code>brainGraph_GLM</code></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stats</code></td>
<td>
<p>A data.table containing <code>S.mtpc</code> (the max. observed
statistic), <code>tau.mtpc</code> (the threshold of the max. observed
statistic), <code>S.crit</code> (the critical statistic value), and
<code>A.crit</code> (the critical AUC)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>null.dist</code></td>
<td>
<p>Numeric array with <code>N</code> columns and number of rows
equal to the number of thresholds. The 3rd dimension is for each
contrast. Each element of the array is the maximum statistic
for that permutation, threshold, and contrast combination.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>perm.order</code></td>
<td>
<p>Numeric matrix; the permutation set applied for all
thresholds (each row is a separate permutation)</p>
</td>
</tr>
</table>
<p>The <code>plot</code> method returns a <code>trellis</code> object or a list of
<code>ggplot</code> objects
</p>


<h3>Author(s)</h3>

<p>Christopher G. Watson, <a href="mailto:cgwatson@bu.edu">cgwatson@bu.edu</a>
</p>


<h3>References</h3>

<p>Drakesmith, M. and Caeyenberghs, K. and Dutt, A. and Lewis, G. and
David, A.S. and Jones, D.K. (2015) Overcoming the effects of false
positives and threshold bias in graph theoretical analyses of neuroimaging
data. <em>NeuroImage</em>, <b>118</b>, 313–333.
doi: <a href="https://doi.org/10.1016/j.neuroimage.2015.05.011">10.1016/j.neuroimage.2015.05.011</a>
</p>


<h3>See Also</h3>

<p>Other Group analysis functions: <code>Bootstrapping</code>,
<code>GLM</code>, <code>Mediation</code>,
<code>NBS</code>, <code>brainGraph_permute</code>
</p>
<p>Other GLM functions: <code>GLM design</code>,
<code>GLM fits</code>, <code>GLM</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
diffs.mtpc &lt;- mtpc(g.list=g.norm, thresholds=thresholds, N=N,
     covars=covars.dti, measure='E.nodal.wt', coding='effects',
     contrasts=c(0, 0, 0, 0, -2), alt='greater',
     binarize=c('Sex', 'Scanner'), con.name='Group 1 &gt; Group 2')
sig.regions &lt;- diffs.mtpc$DT[A.mtpc &gt; A.crit]

## End(Not run)
## Not run: 
mtpcPlots &lt;- plot(mtpc.diffs)

## Arrange plots into 3x3 grids
ml &lt;- marrangeGrob(mtpcPlots, nrow=3, ncol=3)
ggsave('mtpc.pdf', ml)

## End(Not run)
</code></pre>


</div>