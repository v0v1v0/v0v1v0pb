<div class="container">

<table style="width: 100%;"><tr>
<td>backtest</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Creating an Object of Class Backtest</h2>

<h3>Description</h3>

<p>Conducts a backtest and returns the results as an object of class <code>backtest</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">backtest(x,
         in.var,
         ret.var,
         universe,
         by.var    = NULL,
         date.var  = NULL,
         id.var    = NULL,
         buckets   = 5,
         natural   = FALSE,
         do.spread = TRUE,
         by.period = TRUE,
         overlaps  = 1)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>A data frame containing the data to be analysed in the
backtest.  The details of what this data frame must contain are
given below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>in.var</code></td>
<td>
<p>A character vector which indicates the name of the
column or columns in <code>x</code> to be used as input variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ret.var</code></td>
<td>
<p>A character vector which indicates the name of the
column or columns in <code>x</code> to be used as return variables.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by.var</code></td>
<td>
<p>An optional character value, specifying a second
variable in <code>x</code> to be used for categorising the data.  The details
of how categories are created are given below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>id.var</code></td>
<td>
<p>An optional character value which indicates the name of
the column in <code>x</code> containing a unique identifier for each
observation.  <code>id.var</code> must be specified if <code>natural</code> is
TRUE.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>date.var</code></td>
<td>
<p>An optional character vector which indicates the name
of the column in <code>x</code> to be used as a date for each
observation. <code>date.var</code> must be specified if <code>natural</code> is
TRUE.  In order to call <code>plot</code>, the contents of <code>date.var</code>
must be of class <code>Date</code> or be coercible to an object of class
<code>Date</code> via <code>as.Date</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>buckets</code></td>
<td>
<p>An optional numeric vector which specifies how many
quantiles to create according to <code>in.var</code> and <code>by.var</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>universe</code></td>
<td>
<p>An optional expression for selecting a subset of <code>x</code>.
The details of how this expression may be constructed are given below.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>natural</code></td>
<td>
<p>An optional logical value.  If TRUE, the <code>summary</code>
method returns additional information and the backtest object may be
plotted.  The details of how a natural backtest differs from a pooled
backtest are given below.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>do.spread</code></td>
<td>
<p>Object of class <code>"logical"</code>. If TRUE the <code>summary</code>
method displays information about the spread between the extreme
quantiles.  If FALSE this information is suppressed.  Defaults to TRUE.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>by.period</code></td>
<td>
<p>Object of class <code>"logical"</code>. If TRUE the quantiles are
recalculated within each date period.  If FALSE the quantiles are
calculated all at once.  Defaults to TRUE.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>overlaps</code></td>
<td>
<p>An object of class <code>"numeric"</code> which specifies
the number of prior periods to include in the current period's
portfolio weights calculation. If <code>overlaps</code> is the default of 1,
backtest behaves as usual and only uses a periods own data to
determine its portfolio.  If <code>overlaps</code> is set to
n &gt; 1, a period's portfolio comprises the weighted mean of
portfolio weights from the previous n periods, with period n
having a weight of 1/n.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Data frames for <code>backtest</code> must, at a minimum, contain a column of class
numeric to be referenced by the <code>in.var</code> and <code>ret.var</code> arguments.  
</p>
<p>The <code>in.var</code> is the primary variable by which the backtest categorises
observations.  It must reference a numeric column in <code>x</code>.  Using the
values in <code>x</code>, <code>backtest</code> breaks the values into equal sized
quantiles, or <code>buckets</code>.
</p>
<p>The <code>by.var</code> is the secondary variable by which the backtest categorises
observations.  When specifying both <code>in.var</code> and <code>by.var</code>, <code>backtest</code>
organises the observations into a <code>n</code> by <code>j</code> matrix where <code>n</code> is the
number of quantiles or categories created for the <code>by.var</code> and <code>j</code> is
the number of quantiles created for the <code>in.var</code>.  By default,
<code>backtest</code> creates 5 quantiles.
</p>
<p>If <code>natural</code> is TRUE, the data and arguments must meet certain
requirements.  First, the frequency of the observations and <code>ret.var</code>
must be the same.  Second, an <code>id.var</code> and <code>date.var</code> are
required.  Third, a <code>by.var</code> is not allowed.  Note that the code
does not verify that the backtest is truly natural; <code>backtest</code>
accepts the value passed by the user as valid.
</p>


<h3>Value</h3>

<p>Returns an object of class <code>backtest</code>.
</p>
<p>The functions <code>show</code> and <code>summary</code> are used to obtain and
print a short description and longer summary of the results of the
<code>backtest</code>.  The accessor functions <code>counts</code>, <code>totalCounts</code>,
<code>marginals</code>, <code>means</code>, <code>naCounts</code>, and <code>turnover</code>
extract different parts of the value returned by <code>backtest</code>.
</p>


<h3>Author(s)</h3>

<p>Kyle Campbell <a href="mailto:kyle.w.campbell@williams.edu">kyle.w.campbell@williams.edu</a> and Jeff Enos
<a href="mailto:jeff@kanecap.com">jeff@kanecap.com</a></p>


<h3>See Also</h3>

<p><code>backtest-class</code></p>


<h3>Examples</h3>

<pre><code class="language-R">
data(starmine)

## Backtest with 1 'in.var' and 1 'ret.var'

bt &lt;- backtest(starmine, in.var = "smi", ret.var = "ret.0.1.m", by.period = FALSE)
summary(bt)

## Backtest with 2 'in.var' values, 1 'ret.var', and a 'by.var'

bt &lt;- backtest(starmine, in.var = c("smi", "cap.usd"),
               ret.var = "ret.0.1.m", by.var = "sector", by.period = FALSE)
summary(bt)

## Backtest with 1 'in.var', 1 'by.var', and 1 'ret.var'.  Number of
## buckets changed from default of 5 to 4.  Change in number of buckets
## only affects the 'in.var' because the 'by.var' column in 'starmine'
## contains character data. For each value in this column there is a
## unique category.

bt &lt;- backtest(starmine, in.var = "smi", by.var = "sector",
               ret.var = "ret.0.1.m", buckets = 4, by.period = FALSE)
summary(bt)

## Backtest with 1 'in.var', multiple 'ret.var', and a
## universe restriction

bt &lt;- backtest(starmine, in.var = "smi",
               ret.var = c("ret.0.1.m", "ret.0.6.m"),
               universe = sector == "HiTec", by.period = FALSE)
summary(bt)

## Running a natural backtest with 2 'in.vars', 1 'ret.var'
## 10 buckets

bt &lt;- backtest(starmine, in.var = c("smi","cap.usd"),
               ret.var = "ret.0.1.m", date.var = "date",
               id.var = "id", buckets = 10,
               natural = TRUE, by.period = FALSE)
summary(bt)

## The same backtest, but calculating quantiles within periods.

bt &lt;- backtest(starmine, in.var = c("smi","cap.usd"),
               ret.var = "ret.0.1.m", date.var = "date",
               id.var = "id", buckets = 10,
               natural = TRUE, by.period = TRUE)
summary(bt)

plot(bt, type = "turnover")
plot(bt, type = "return")
plot(bt, type = "cumreturn")
plot(bt, type = "cumreturn.split")


</code></pre>


</div>