<div class="container">

<table style="width: 100%;"><tr>
<td>do.fit</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Estimate background</h2>

<h3>Description</h3>

<p><code>do.fit</code> estimates the background using the Bayesian approach and Differential Evolution algorithm.</p>


<h3>Usage</h3>

<pre><code class="language-R">do.fit(data, bounds.lower, bounds.upper, scale=c(1,1), knots.x=NA,
       knots.n=NA, analytical=FALSE, stdev=TRUE, control=list(), p.bkg=.5,
	   save.to="")
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an object of type <code>data</code>. See <code>set.data</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bounds.lower, bounds.upper</code></td>
<td>
<p>numerics specifying the lower and upper bounds for the fitted spline values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>numeric vector which, if applicable, determines the bounds for the fitted scale parameter. The default value of <code>c(1,1)</code> means a no-scale fit. See details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots.x</code></td>
<td>
<p>numeric vector which, if not <code>NA</code>, specifies the knot positions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots.n</code></td>
<td>
<p>numeric, the number of knots. If <code>knots.x</code> is <code>NA</code> then <code>knots.n</code> equidistant knots will be created.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>analytical</code></td>
<td>
<p>logical. If <code>TRUE</code> background is approximated by an analytical function <code class="reqn">f(x)=P_1\exp(-P_2x)x^{P_3} + P_4/[(x-P_5)^2+P_6^2]</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stdev</code></td>
<td>
<p>logical, whether to calculate the uncertainty for the estimated background. Should be set to <code>FALSE</code> if <code>analytical=TRUE</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>list, the return value of <code>set.control</code>. Specifies various parameters of the Differential Evolution optimization algorithm implemented in <code>DEoptim</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>p.bkg</code></td>
<td>
<p>numeric, the probability that a single pixel contains "only" a background.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>save.to</code></td>
<td>
<p>character, a filename for saving the results.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>If information on the low-r behavior of G(r) is provided, the global intensity scale  and atomic displacement parameters can be fitted along with the positions of the knots,  (<code>set.Gr</code>). To fit normalization parameter set bounds in <code>scale</code> for the desired values. To fit Atomic Displacement Parameters see <code>set.SB</code>.
</p>
<p>In most cases <code>p.bkg</code> should be set to its default value 0.5.
</p>
<p>For further details see <code>BBEST-package</code>.
</p>


<h3>Value</h3>

<p>A list with elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>numeric vector of grid points</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>curves</code></td>
<td>
<p>list, see below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>uncrt</code></td>
<td>
<p>list, see below.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots</code></td>
<td>
<p>list with elements <code>x</code> and <code>y</code> that specify the positions of the knots and the corresponding fitted intensity values, respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pars</code></td>
<td>
<p>numeric vector. If the background is approximated using the analytical function, contains all the relevant parameters <code>P</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>fitted value of the <code>scale</code> parameter, if used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ADP</code></td>
<td>
<p>fitted values of the atomic displacement parameters, if applicable.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fit.details</code></td>
<td>
<p>list, see below.</p>
</td>
</tr>
</table>
<p>Element <code>curves</code> is a list with sub-elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>numeric vector of the (normalized) function values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bkg</code></td>
<td>
<p>numeric vector, the estimated background.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>SB</code></td>
<td>
<p>numeric vector, the (fitted) coherent baseline.</p>
</td>
</tr>
</table>
<p>Element <code>uncrt</code> is a list with sub-elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>stdev</code></td>
<td>
<p>numeric vector, indicates estimated standard deviations for the reconstructed signal.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>stdev.r</code></td>
<td>
<p>numeric vector, indicates estimated standard deviations for a reconstructed signal in r-space.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>hess</code></td>
<td>
<p>Hessian matrix for a <code class="reqn">\psi(c)</code> function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov.matrix</code></td>
<td>
<p>covariance matrix, i.e. the inverse of the Hessian.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cov.matrix.r</code></td>
<td>
<p>covariance matrix in r-space.</p>
</td>
</tr>
</table>
<p>Element <code>fit.details</code> is a list with sub-elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>lambda</code></td>
<td>
<p>numeric vector, the estimated mean magnitude of the signal.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sigma</code></td>
<td>
<p>numeric vector, the estimated Gaussian noise.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots.n</code></td>
<td>
<p>the number of knots used in the fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>knots.x</code></td>
<td>
<p>knot positions used in the fit.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>control</code></td>
<td>
<p>see the <code>control</code> argument.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>Gr</code></td>
<td>
<p>list contacting information on the low-r behaviour of G(r) . See <code>set.Gr</code> for details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>n.atoms</code></td>
<td>
<p>numeric vector, number of different atoms per unit cell.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scatter.length</code></td>
<td>
<p>numeric vector, atomic scattering factors.</p>
</td>
</tr>
</table>
<h3>References</h3>

<p>Ardia, D., Mullen, K., Peterson, B. &amp; Ulrich, J. (2011): DEoptim. R Package Version 2.2-2. <a href="https://CRAN.R-project.org/package=DEoptim">https://CRAN.R-project.org/package=DEoptim</a>.
</p>
<p>Mullen, K.M., Ardia, D., Gil, D., Windover, D., Cline, J. (2011): DEoptim: An R Package for Global Optimization by Differential Evolution. <em>J. Stat. Softw.</em>, <b>40</b>(6), 1-26. <a href="https://www.jstatsoft.org/article/view/v040i06">https://www.jstatsoft.org/article/view/v040i06</a>.
</p>


</div>