<div class="container">

<table style="width: 100%;"><tr>
<td>pop.predict</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Probabilistic Population Projection
</h2>

<h3>Description</h3>

<p>The function generates trajectories of probabilistic population projection for all countries for which input data is available, or any subset of them.
</p>


<h3>Usage</h3>

<pre><code class="language-R">pop.predict(end.year = 2100, start.year = 1950, present.year = 2020, 
    wpp.year = 2019, countries = NULL, 
    output.dir = file.path(getwd(), "bayesPop.output"),
    annual = FALSE,
    inputs = list(popM=NULL, popF=NULL, mxM=NULL, mxF=NULL, srb=NULL,
        pasfr=NULL, patterns=NULL, 
        migM=NULL, migF=NULL, migMt=NULL, migFt=NULL, mig=NULL,
        e0F.file=NULL, e0M.file=NULL, tfr.file=NULL,
        e0F.sim.dir=NULL, e0M.sim.dir=NULL, tfr.sim.dir=NULL,
        migMtraj = NULL, migFtraj = NULL, migtraj = NULL,
        GQpopM = NULL, GQpopF = NULL, average.annual = NULL), 
    nr.traj = 1000, keep.vital.events = FALSE, 
    fixed.mx = FALSE, fixed.pasfr = FALSE,
    lc.for.hiv = TRUE, lc.for.all = TRUE, mig.is.rate = FALSE,
    mig.age.method  = c("auto", "un", "rc", "user"), my.locations.file = NULL, 
    replace.output = FALSE, verbose = TRUE, ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>end.year</code></td>
<td>
<p>End year of the projection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>start.year</code></td>
<td>
<p>First year of the historical data.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>present.year</code></td>
<td>
<p>Year for which initial population data is to be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wpp.year</code></td>
<td>
<p>Year for which WPP data is used. The functions loads a package called <span class="pkg">wpp</span><code class="reqn">x</code> where <code class="reqn">x</code> is the <code>wpp.year</code> and uses the various datasets as default if the corresponding <code>inputs</code> element is missing (see below).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>countries</code></td>
<td>
<p>Array of country codes or country names for which a projection is generated. If it is <code>NULL</code>, all available countries are used. If it is <code>NA</code> and there is an existing projection in <code>output.dir</code> and <code>replace.output=FALSE</code>, then a projection is performed for all countries that are not included in the existing projection. Names of countries are matched to those in the <code>UNlocations</code> dataset (or in the dataset loaded from <code>my.locations.file</code> if used).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output.dir</code></td>
<td>
<p>Output directory of the projection. If there is an existing projection in <code>output.dir</code> and <code>replace.output=TRUE</code>, everything in the directory will be deleted.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>annual</code></td>
<td>
<p>Logical. If <code>TRUE</code> it is assumed that this is 1x1 simulation, i.e. one year age groups and one year time periods. Note that this is still an experimental feature!</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inputs</code></td>
<td>
<p>A list of file names where input data is stored. It contains the following elements (Unless otherwise noted, these are tab delimited ASCII files; Names of default datasets from the corresponding <span class="pkg">wpp</span> package which are used if the corresponding element is <code>NULL</code> are shown in brackets):
</p>

<dl>
<dt>popM, popF</dt>
<dd>
<p>Initial male/female age-specific population (at time <code>present.year</code>) [<code>popM</code>, <code>popF</code>].</p>
</dd>
<dt>mxM, mxF</dt>
<dd>
<p>Historical data and (optionally) projections of male/female age-specific death rates [<code>mxM</code>, <code>mxF</code>] (see also argument <code>fixed.mx</code>).</p>
</dd>
<dt>srb</dt>
<dd>
<p>Projection of sex ratio at birth. [<code>sexRatio</code>]</p>
</dd>
<dt>pasfr</dt>
<dd>
<p>Historical data and (optionally) projections of percentage age-specific fertility rate [<code>percentASFR</code>] (see also argument <code>fixed.pasfr</code>).</p>
</dd>
<dt>patterns, mig.type</dt>
<dd>
<p>Migration type and base year of the migration. In addition, this dataset gives information on country's specifics regarding mortality and fertility age patterns as defined in [<code>vwBaseYear</code>]. <code>patterns</code> and <code>mig.type</code> have the same meaning and can be used interchangeably.</p>
</dd>
<dt>migM, migF, migMt, migFt, mig</dt>
<dd>
<p>Projection and (optionally) historical data of net migration on the same scale as the initital population. There are three ways of defining this quantity, here in order of priority: 1. via <code>migM</code> and <code>migF</code> which should give male and female age-specific migration [<code>migrationM</code>, <code>migrationF</code>]; 2. via <code>migMt</code> and <code>migFt</code> which should give male and female total net migration; 3. via <code>mig</code> which should give the total net migration. For 2. and 3., the totals are disagregated into age-specific migration by applying a Rogers-Castro schedule. For 3., the totals are equally split between sexes. If all of these input items are missing, the migration schedules are reconstructed from total migration counts derived from <code>migration</code> using the <code>age.specific.migration</code> function.</p>
</dd>
<dt>e0F.file</dt>
<dd>
<p>Comma-delimited CSV file with results of female life expectancy (generated using <span class="pkg">bayesLife</span>, function <code>convert.e0.trajectories</code>, file “ascii_trajectories.csv”). Required columns are “LocID”, “Year”, “Trajectory”, and “e0”. If this element is not <code>NULL</code>, the argument <code>e0F.sim.dir</code> is ignored. If both <code>e0F.file</code> and <code>e0F.sim.dir</code> are <code>NULL</code>, data from the corresponding <span class="pkg">wpp</span> package is taken, namely the median projections as one trajectory and the low and high variants (if available) as second and third trajectory.</p>
</dd>
<dt>e0M.file</dt>
<dd>
<p>Comma-delimited CSV file containing results of male life expectancy (generated using <span class="pkg">bayesLife</span>, function <code>convert.e0.trajectories</code>, file “ascii_trajectories.csv”). Required columns are “LocID”, “Year”, “Trajectory”, and “e0”. If this element is not <code>NULL</code>, the argument <code>e0M.sim.dir</code> is ignored. As in the female case, if both <code>e0M.file</code> and <code>e0M.sim.dir</code> are <code>NULL</code>, data from the corresponding <span class="pkg">wpp</span> package is taken.</p>
</dd>
<dt>tfr.file</dt>
<dd>
<p>Comma-delimited CSV file with results of total fertility rate (generated using <span class="pkg">bayesTFR</span>, function <code>convert.tfr.trajectories</code>, file “ascii_trajectories.csv”). Required columns are “LocID”, “Year”, “Trajectory”, and “TF”. If this element is not <code>NULL</code>, the argument <code>tfr.sim.dir</code> is ignored. If both <code>tfr.file</code> and <code>tfr.sim.dir</code> are <code>NULL</code>, data from the corresponding <span class="pkg">wpp</span> package is taken (median and the low and high variants as three trajectories). Alternatively, this argument can be the keyword “median_” in which case only the wpp median is taken.</p>
</dd>
<dt>e0F.sim.dir</dt>
<dd>
<p>Simulation directory with results of female life expectancy (generated using <span class="pkg">bayesLife</span>). It is only used if <code>e0F.file</code> is <code>NULL</code>.</p>
</dd>
<dt>e0M.sim.dir</dt>
<dd>
<p>Simulation directory with results of male life expectancy (generated using <span class="pkg">bayesLife</span>). Alternatively, it can be the string “joint_”, in which case it is assumed that the male life expectancy was projected jointly from the female life expectancy (see joint.male.predict) and thus contained in the <code>e0F.sim.dir</code> directory. The argument is only used if <code>e0M.file</code> is <code>NULL</code>.</p>
</dd>
<dt>tfr.sim.dir</dt>
<dd>
<p>Simulation directory with results of total fertility rate (generated using <span class="pkg">bayesTFR</span>). It is only used if <code>tfr.file</code> is <code>NULL</code>.</p>
</dd>
<dt>migMtraj, migFtraj, migtraj</dt>
<dd>
<p>Comma-delimited CSV file with male/female age-specific migration trajectories, or total migration trajectories (<code>migtraj</code>). If present, it replaces deterministic projections given by the <code>mig*</code> items. It has a similar format as e.g. <code>e0M.file</code> with columns “LocID”, “Year”, “Trajectory”, “Age” (except for <code>migtraj</code>) and “Migration”. For a five-year simulation, the “Age” column must have values “0-4”, “5-9”, “10-14”, ..., “95-99”, “100+”. In an annual simulation, age is given by a single number between 0 and 100.</p>
</dd>
<dt>GQpopM, GQpopF</dt>
<dd>
<p>Age-specific population counts (male and female) that should be excluded from application of the cohort component method (CCM). It can be used for defining group quarters. These counts are removed from population before the CCM projection and added back afterwards. It is not used when computing vital events on observed data. The datasets should have columns “country_code”, “age” and “gq”. For a five-year simulation, the “age” column should include values “0-4”, “5-9”, “10-14”, ..., “95-99”, “100+”. However, rows with zeros do not need to be included. In an annual simulation, age is given by a single number between 0 and 100.</p>
</dd>
<dt>average.annual</dt>
<dd>
<p>Character string with values “TFR”, “e0M”, “e0F”. If this is a 5-year simulation, but the inputs of TFR or/and e0 comes from an annual simulation, including the corresponding string here will cause that the TFR or/and e0 trajectories are converted into 5-year averages.</p>
</dd>
</dl>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nr.traj</code></td>
<td>
<p>Number of trajectories to be generated. If this number is smaller than the number of available trajectories of the probabilistic components (TFR, life expectancy and migration), the trajectories are equidistantly thinned. 
If all of those components contain less trajectories than <code>nr.traj</code>, the value is adjusted to the maximum of available trajectories of the components. For those that have less trajectories than the adjusted number, the available trajectories are re-sampled, so that all components have the same number of trajectories.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>keep.vital.events</code></td>
<td>
<p>Logical. If <code>TRUE</code> age- and sex-specific vital events of births and deaths as well as other objects are stored in the prediction object, see Details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed.mx</code></td>
<td>
<p>Logical. If <code>TRUE</code>, it is assumed the dataset of death rates (mxM and mxF) include data for projection years and they are then used instead of the life expectancy.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fixed.pasfr</code></td>
<td>
<p>Logical. If <code>TRUE</code>, it is assumed the dataset on percent age-specific fertility rate (percentASFR) include data for projection years and they are then used instead of computing it on the fly.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lc.for.hiv</code></td>
<td>
<p>Logical controlling if the modified Lee-Carter method should be used 
for projection of mortality rates for countries with HIV epidemics. If <code>FALSE</code>, the function <code>hiv.mortmod</code> from the HIV.LifeTables package is used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lc.for.all</code></td>
<td>
<p>Logical controlling if the modified Lee-Carter method should be used 
for projection of mortality rates for all countries. If <code>FALSE</code>, the corresponding method is determined by the columns “AgeMortProjMethod1” and “AgeMortProjMethod2” of the <code>vwBaseYear</code> dataset.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mig.is.rate</code></td>
<td>
<p>Logical determining if migration data are to be interpreted as net migration rates (<code>TRUE</code>) or counts (<code>FALSE</code>, default). It can also be a vector of two logicals, where the first element refers to observed data and the second element refers to predictions. A value of <code>c(FALSE, TRUE)</code> could for example be used if observed data in <code>inputs$migration</code> are counts, and migration trajectories in <code>inputs$migtraj</code> are rates.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>mig.age.method</code></td>
<td>
<p>If migration is given as totals, this argument determines a method to disaggregate into age-specific migration. 
The “un” method, available only for <span class="pkg">wpp2022</span> and only for projected migration, uses the UN migration schedules. The “rc” method uses a simple Rogers-Castro disaggregation. The “auto” method (default) uses “un” if <code>wpp.year</code> is 2022; if not and if it is a 5-year simulation, it uses a residual method, otherwise a Rogers-Castro. For the “un” method, Rogers-Castro is used for observed data. Value “user” can be used 
for this argument if user-specific schedules are provided in a binary file, given in the item “mig.alt.age.schedule” of the <code>inputs</code> argument. It has the same structure as the internal package objects <code>mig1.schedule</code> (annual) or <code>mig5.schedule</code> (5-year). If there are different schedules for positive and negative totals, the negative schedules are in <code>mig1.neg.schedule</code> or <code>mig5.neg.schedule</code> objects.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>my.locations.file</code></td>
<td>
<p>Name of a tab-delimited ascii file with a set of all locations for which a projection is generated. Use this argument if you are projecting for a country/region that is not included in the standard <code>UNlocations</code> dataset. It must have the same structure.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>replace.output</code></td>
<td>
<p>Logical. If <code>TRUE</code>, everything in the directory <code>output.dir</code> is deleted prior to the prediction.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>verbose</code></td>
<td>
<p>Logical controlling the amount of output messages.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>Additional arguments passed to the underlying function. These can be <code>parallel</code> and <code>nr.nodes</code> for parallel processing and the number of nodes, respectively, as well as further arguments passed for creating a parallel cluster.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>The population projection is computed using the cohort component method and is based on an algorithm used by the United Nation Population Division (see also  Sevcikova et al (2015) in the References below). For each country, one projection is calculated for each trajectory of male and female life expectancy, TFR and possibly migration. This results in a set of trajectories of population projection which forms its posterior distribution. The trajectories of life expectancy and TFR can be given either in its binary form generated by the packages <span class="pkg">bayesLife</span> and <span class="pkg">bayesTFR</span>, respectively (as directories <code>e0M.sim.dir</code>, <code>e0F.sim.dir</code>, <code>tfr.sim.dir</code> of the <code>inputs</code> argument), or they can be given as ASCII tables in csv format, see above. The number of trajectories for male and female life expectancy must match, as does for male and female migration.
</p>
<p>The projection is generated sequentially country by country. Results are stored in a sub-directory of <code>output.dir</code> called ‘<span class="file">prediction</span>’. There is one binary file per country, called ‘<span class="file">totpop_country<code class="reqn">x</code>.rda</span>’, where <code class="reqn">x</code> is the country code. It contains six objects: <code>totp</code>, <code>totpf</code>, <code>totpm</code> (trajectories of total population, age-specific female and age-specific male, respectively),  <code>totp.hch</code>, <code>totpf.hch</code>, <code>totpm.hch</code> (the UN half-child variant for total population, age-specific female and age-specific male, respectively). Optionally, if <code>keep.vital.events</code> is <code>TRUE</code>, there is an additional file per country, called ‘<span class="file">vital_events_country<code class="reqn">x</code>.rda</span>’, containing the following objects: <code>btm</code>, <code>btf</code> (trajectories for births by age of mothers for male and female child, respectively), <code>deathsm</code>, <code>deathsf</code> (trajectories for age-specific male and female deaths, respectively), <code>asfert</code> (trajectories of age-specific fertility), <code>mxm</code>, <code>mxf</code> (trajectories of male and female age-specific mortality rates), <code>migm</code>, <code>migf</code> (if used, these are trajectories of male and female age-specific migration), <code>btm.hch</code>, <code>btf.hch</code>, <code>deathsm.hch</code>, <code>deathsf.hch</code>, <code>asfert.hch</code>, <code>mxm.hch</code>, <code>mxf.hch</code> (the UN half-child variant for age- and sex-specific births, deaths, fertility rates and mortality rates).  An object of class <code>bayesPop.prediction</code> is stored in the same directory in a file ‘<span class="file">prediction.rda</span>’. It is updated every time a country projection is finished.
</p>
<p>See <code>pop.trajectories</code> for extracting trajectories.
</p>
<p>To access a previously stored prediction object, use <code>get.pop.prediction</code>.
</p>


<h3>Value</h3>

<p>Object of class <code>bayesPop.prediction</code> with the following elements:
</p>
<table>
<tr style="vertical-align: top;">
<td><code>base.directory</code></td>
<td>
<p>Full path to the base directory <code>output.dir</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>output.directory</code></td>
<td>
<p>Sub-directory relative to <code>base.directory</code> with the projections.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nr.traj</code></td>
<td>
<p>The actual number of trajectories of the projections.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantiles</code></td>
<td>
<p>Three-dimensional array of projection quantiles (countries x number of quantiles x projection periods). The second dimension corresponds to the following quantiles: <code class="reqn">0.025,0.05,0.1,0.25,0.5,0.75,0.9,0.95,0.975</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>traj.mean.sd</code></td>
<td>
<p>Three-dimensional array of projection mean and standard deviation (countries x 2 x projection periods). First and second matrix of the second dimension, respectively, is the mean and standard deviation, respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantilesM, quantilesF</code></td>
<td>
<p>Quantiles of male and female projection, respectively. Same structure as <code>quantiles</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>traj.mean.sdM, traj.mean.sdF</code></td>
<td>
<p>Same as <code>traj.mean.sd</code> corresponding to male and female projection, respectively.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantilesMage, quantilesFage</code></td>
<td>
<p>Four-dimensional array of age-specific quantiles of male and female projection, respectively (countries x age groups x number of quantiles x projection periods). The same quantiles are used as in <code>quantiles</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantilesPropMage, quantilesPropFage</code></td>
<td>
<p>Array of age-specific quantiles of male and female projection, respectively, divided by the total population. The dimensions are the same as in <code>quantilesMage</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estim.years</code></td>
<td>
<p>Vector of time for which historical data was used in the projections.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>proj.years</code></td>
<td>
<p>Vector of projection time periods starting with the present period.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>wpp.year</code></td>
<td>
<p>The wpp year used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>inputs</code></td>
<td>
<p>List of input data used for the projection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>function.inputs</code></td>
<td>
<p>Content of the <code>inputs</code> argument passed to the function.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>countries</code></td>
<td>
<p>Matrix of countries for which projection exists. It contains two columns: <code>code</code>, <code>name</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>ages</code></td>
<td>
<p>Vector of age groups.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>annual</code></td>
<td>
<p>If <code>TRUE</code>, this object corresponds to a 1x1 prediction, otherwise 5x5.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cache</code></td>
<td>
<p>This component is added by <code>get.pop.prediction</code> and modified and used by <code>pop.map</code> and <code>write.pop.projection.summary</code>. It is an environment for caching and re-using results of expressions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>write.to.cache</code></td>
<td>
<p>Logical determining if <code>cache</code> should be modified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>is.aggregation</code></td>
<td>
<p>Logical determining if this object is a result of <code>pop.predict</code> or <code>pop.aggregate</code>.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Hana Sevcikova, Thomas Buettner, based on code of Nan Li and helpful comments from Patrick Gerland
</p>


<h3>References</h3>

<p>H. Sevcikova, A. E. Raftery (2016). bayesPop: Probabilistic
Population Projections. Journal of Statistical Software, 75(5), 1-29.
doi:10.18637/jss.v075.i05
</p>
<p>A. E. Raftery,  N. Li, H. Sevcikova , P. Gerland, G. K. Heilig (2012). Bayesian probabilistic population projections for all countries. Proceedings of the National Academy of Sciences 109:13915-13921.
</p>
<p>P. Gerland, A. E. Raftery, H. Sevcikova, N. Li, D. Gu, T. Spoorenberg, L. Alkema, B. K. Fosdick, J. L. Chunn, N. Lalic, G. Bay, T. Buettner, G. K. Heilig,  J. Wilmoth (2014). World Population Stabilization Unlikely This Century. Science 346:234-237.
</p>
<p>H. Sevcikova, N. Li, V. Kantorova, P. Gerland and A. E. Raftery (2015). Age-Specific Mortality and Fertility Rates for Probabilistic Population Projections. arXiv:1503.05215. <a href="https://arxiv.org/abs/1503.05215">https://arxiv.org/abs/1503.05215</a>

</p>


<h3>See Also</h3>

<p><code>pop.trajectories.plot</code>, <code>pop.pyramid</code>, <code>pop.trajectories</code>, <code>get.pop.prediction</code>, <code>age.specific.migration</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">## Not run: 
sim.dir &lt;- tempfile()
# Countries can be given as a combination of numerical codes and names
pred &lt;- pop.predict(countries=c("Netherlands", 218, "Madagascar"), nr.traj=3, 
           output.dir=sim.dir)
pop.trajectories.plot(pred, "Ecuador", sum.over.ages=TRUE)
unlink(sim.dir, recursive=TRUE)

## End(Not run)</code></pre>


</div>