<div class="container">

<table style="width: 100%;"><tr>
<td>cv_cluster</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Use environmental or spatial clustering to separate train and test folds</h2>

<h3>Description</h3>

<p>This function uses clustering methods to specify sets of similar environmental
conditions based on the input covariates, or cluster of spatial coordinates of the sample data.
Sample data (i.e. species data) corresponding to any of
these groups or clusters are assigned to a fold. Clustering is done
using <code>kmeans</code> for both approaches. The only requirement is <code>x</code> that leads to
a clustering of the confidantes of sample data. Otherwise, by providing <code>r</code>, environmental
clustering is done.
</p>


<h3>Usage</h3>

<pre><code class="language-R">cv_cluster(
  x,
  column = NULL,
  r = NULL,
  k = 5L,
  scale = TRUE,
  raster_cluster = FALSE,
  num_sample = 10000L,
  biomod2 = TRUE,
  report = TRUE,
  ...
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>a simple features (sf) or SpatialPoints object of spatial sample data (e.g., species data or ground truth sample for image classification).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>column</code></td>
<td>
<p>character (optional). Indicating the name of the column in which response variable (e.g. species data as a binary
response i.e. 0s and 1s) is stored. This is only used to see whether all the folds contain all the classes in the final report.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>r</code></td>
<td>
<p>a terra SpatRaster object of covariates to identify environmental groups. If provided, clustering will be done
in environmental space rather than spatial coordinates of sample points.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>k</code></td>
<td>
<p>integer value. The number of desired folds for cross-validation. The default is <code>k = 5</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>scale</code></td>
<td>
<p>logical; whether to scale the input rasters (recommended) for clustering.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>raster_cluster</code></td>
<td>
<p>logical; if <code>TRUE</code>, the clustering is done over the entire raster layer,
otherwise it will be over the extracted raster values of the sample points. See details for more information.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>num_sample</code></td>
<td>
<p>integer; the number of samples from raster layers to build the clusters (when <code>raster_cluster = FALSE</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>biomod2</code></td>
<td>
<p>logical. Creates a matrix of folds that can be directly used in the <span class="pkg">biomod2</span> package as
a <em>CV.user.table</em> for cross-validation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>report</code></td>
<td>
<p>logical; whether to print the report of the records per fold.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>additional arguments for <code>stats::kmeans</code> function, e.g. <code>algorithm = "MacQueen"</code>.</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>As k-means algorithms use Euclidean distance to estimate clusters, the input raster covariates should be quantitative variables.
Since variables with wider ranges of values might dominate the clusters and bias the environmental clustering (Hastie et al., 2009),
all the input rasters are first scaled and centred (<code>scale = TRUE</code>) within the function.
</p>
<p>If <code>raster_cluster = TRUE</code>, the clustering is done in the raster space. In this approach the clusters will be consistent throughout the region
and different sample datasets in the same region (for comparison). However, this may result in a cluster(s)
that covers none of the species records (the spatial location of response samples),
especially when species data is not dispersed throughout the region or the number of clusters (k or folds) is high. In this
case, the number of folds is less than specified <code>k</code>. If <code>raster_cluster = FALSE</code>, the clustering will be done in
species points and the number of the folds will be the same as <code>k</code>.
</p>
<p>Note that the input raster layer should cover all the species points, otherwise an error will rise. The records with no raster
value should be deleted prior to the analysis or another raster layer must be provided.
</p>


<h3>Value</h3>

<p>An object of class S3. A list of objects including:
</p>

<ul>
<li>
<p>folds_list - a list containing the folds. Each fold has two vectors with the training (first) and testing (second) indices
</p>
</li>
<li>
<p>folds_ids - a vector of values indicating the number of the fold for each observation (each number corresponds to the same point in x)
</p>
</li>
<li>
<p>biomod_table - a matrix with the folds to be used in <span class="pkg">biomod2</span> package
</p>
</li>
<li>
<p>k - number of the folds
</p>
</li>
<li>
<p>column - the name of the column if provided
</p>
</li>
<li>
<p>type - indicates whether spatial or environmental clustering was done.
</p>
</li>
<li>
<p>records - a table with the number of points in each category of training and testing
</p>
</li>
</ul>
<h3>References</h3>

<p>Hastie, T., Tibshirani, R., &amp; Friedman, J. (2009). The elements of statistical learning: Data mining, inference, and prediction ( 2nd ed., Vol. 1).
</p>


<h3>See Also</h3>

<p><code>cv_buffer</code> and <code>cv_spatial</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">
library(blockCV)

# import presence-absence species data
points &lt;- read.csv(system.file("extdata/", "species.csv", package = "blockCV"))
# make an sf object from data.frame
pa_data &lt;- sf::st_as_sf(points, coords = c("x", "y"), crs = 7845)

# load raster data
path &lt;- system.file("extdata/au/", package = "blockCV")
files &lt;- list.files(path, full.names = TRUE)
covars &lt;- terra::rast(files)

# spatial clustering
set.seed(6)
sc &lt;- cv_cluster(x = pa_data,
                 column = "occ", # optional; name of the column with response
                 k = 5)

# environmental clustering
set.seed(6)
ec &lt;- cv_cluster(r = covars, # if provided will be used for environmental clustering
                 x = pa_data,
                 column = "occ", # optional; name of the column with response
                 k = 5,
                 scale = TRUE)


</code></pre>


</div>