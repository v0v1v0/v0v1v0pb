<div class="container">

<table style="width: 100%;"><tr>
<td>splinebins</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>
Optimized spline PDF and CDF fitted to binned data
</h2>

<h3>Description</h3>

<p>Creates a smooth cubic spline CDF and piecewise-quadratic PDF based on a set of binned data (edges and counts).
</p>


<h3>Usage</h3>

<pre><code class="language-R">splinebins(bEdges, bCounts, m = NULL,
           numIterations = 16, monoMethod = c("hyman", "monoH.FC"))
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>bEdges</code></td>
<td>

<p>A vector <code class="reqn">e_1, e_2, \ldots, e_n</code> giving the right endpoints of each bin. The value in <code class="reqn">e_n</code> is ignored and assumed to be <code>Inf</code> or <code>NA</code>, indicating that the top bin is unbounded. The edges determine <code class="reqn">n</code> bins on the intervals <code class="reqn">e_{i-1} \le x \le e_i</code>, where <code class="reqn">e_0</code> is assumed to be 0.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bCounts</code></td>
<td>

<p>A vector <code class="reqn">c_1, c_2, \ldots, c_n</code> giving the counts for each bin (i.e., the number of data elements in each bin). Assumed to be nonnegative.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>m</code></td>
<td>

<p>An estimate for the mean of the distribution. If no value is supplied, the mean will be estimated by (temporarily) setting <code class="reqn">e_n</code> equal to <code class="reqn">2e_{n-1}</code>, and a warning message will be generated.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numIterations</code></td>
<td>

<p>The number of iterations performed by a binary search that optimizes the CDF to fit the mean.
</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>monoMethod</code></td>
<td>

<p>The method for constructing a monotone spline. Must be one of <code>"hyman"</code> or <code>"monoH.FC"</code>. The former choice tends to integrate faster and produce smoother density functions. See <code>splinefun</code> for more details.
</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>Fits a monotone cubic spline to the points specified by the binned data to produce a smooth cumulative distribution function. The PDF is then obtained by differentiating, so it will be piecewise quadratic and preserve the area of each bin.
</p>


<h3>Value</h3>

<p>Returns a list with the following components.
</p>
<table>
<tr style="vertical-align: top;">
<td><code>splinePDF</code></td>
<td>
<p>A piecewise-quadratic function giving the fitted PDF.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>splineCDF</code></td>
<td>
<p>A piecewise-cubic function giving the CDF.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>E</code></td>
<td>
<p>The right-hand endpoint of the support of the PDF.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>shrinkFactor</code></td>
<td>
<p>If the supplied estimate for the mean is too small to be fitted with our method, the bins edges will be scaled by <code>shrinkFactor</code>, which will be chosen less than (and close to) 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>splineInvCDF</code></td>
<td>
<p>An approximate inverse of <code>splineCDF</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>fitWarn</code></td>
<td>
<p>Flag set to <code>TRUE</code> if the fitted median falls in the wrong bin.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>David J. Hunter and McKalie Drown
</p>


<h3>References</h3>

<p>Paul T. von Hippel, David J. Hunter, McKalie Drown. <em>Better Estimates from Binned Income Data: Interpolated CDFs and Mean-Matching</em>, Sociological Science, November 15, 2017. <a href="https://www.sociologicalscience.com/articles-v4-26-641/">https://www.sociologicalscience.com/articles-v4-26-641/</a>
</p>


<h3>Examples</h3>

<pre><code class="language-R"># 2005 ACS data from Cook County, Illinois
binedges &lt;- c(10000,15000,20000,25000,30000,35000,40000,45000,
              50000,60000,75000,100000,125000,150000,200000,NA)
bincounts &lt;- c(157532,97369,102673,100888,90835,94191,87688,90481,
               79816,153581,195430,240948,155139,94527,92166,103217)
sb &lt;- stepbins(binedges, bincounts, 76091)
splb &lt;- splinebins(binedges, bincounts, 76091)

plot(splb$splinePDF, 0, 300000, n=500)
plot(sb$stepPDF, do.points=FALSE, col="gray", add=TRUE)
# notice that the curve preserves bin area

library(pracma)
integral(splb$splinePDF, 0, splb$E)
integral(function(x){1-splb$splineCDF(x)}, 0, splb$E) # should be the mean
splb &lt;- splinebins(binedges, bincounts, 76091, numIterations=20)
integral(function(x){1-splb$splineCDF(x)}, 0, splb$E) # closer to given mean
</code></pre>


</div>