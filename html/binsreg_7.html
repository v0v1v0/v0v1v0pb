<div class="container">

<table style="width: 100%;"><tr>
<td>binstest</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Data-Driven Nonparametric Shape Restriction and Parametric Model Specification Testing using Binscatter</h2>

<h3>Description</h3>

<p><code>binstest</code> implements binscatter-based hypothesis testing procedures for parametric functional
forms of and nonparametric shape restrictions on the regression function of interest, following the results
in <a href="https://nppackages.github.io/references/Cattaneo-Crump-Farrell-Feng_2024_AER.pdf">Cattaneo, Crump, Farrell and Feng (2024a)</a> and
<a href="https://nppackages.github.io/references/Cattaneo-Crump-Farrell-Feng_2024_NonlinearBinscatter.pdf">Cattaneo, Crump, Farrell and Feng (2024b)</a>.
If the binning scheme is not set by the user,
the companion function <code>binsregselect</code> is used to implement binscatter in a
data-driven way and inference procedures are based on robust bias correction.
Binned scatter plots based on different methods can be constructed using the companion functions <code>binsreg</code>,
<code>binsqreg</code> or <code>binsglm</code>.
</p>


<h3>Usage</h3>

<pre><code class="language-R">binstest(y, x, w = NULL, data = NULL, estmethod = "reg",
  family = gaussian(), quantile = NULL, deriv = 0, at = NULL,
  nolink = F, testmodel = NULL, testmodelparfit = NULL,
  testmodelpoly = NULL, testshape = NULL, testshapel = NULL,
  testshaper = NULL, testshape2 = NULL, lp = Inf, bins = NULL,
  nbins = NULL, pselect = NULL, sselect = NULL, binspos = "qs",
  binsmethod = "dpi", nbinsrot = NULL, randcut = NULL, nsims = 500,
  simsgrid = 20, simsseed = NULL, vce = NULL, cluster = NULL,
  asyvar = F, dfcheck = c(20, 30), masspoints = "on", weights = NULL,
  subset = NULL, numdist = NULL, numclust = NULL, estmethodopt = NULL,
  ...)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>y</code></td>
<td>
<p>outcome variable. A vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>x</code></td>
<td>
<p>independent variable of interest. A vector.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>w</code></td>
<td>
<p>control variables. A matrix, a vector or a <code>formula</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>data</code></td>
<td>
<p>an optional data frame containing variables used in the model.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estmethod</code></td>
<td>
<p>estimation method. The default is <code>estmethod="reg"</code> for tests based on binscatter least squares regression. Other options are <code>"qreg"</code> for quantile regression and <code>"glm"</code> for generalized linear regression. If <code>estmethod="glm"</code>, the option <code>family</code> must be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>family</code></td>
<td>
<p>a description of the error distribution and link function to be used in the generalized linear model when <code>estmethod="glm"</code>. (See <code>family</code> for details of family functions.)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>quantile</code></td>
<td>
<p>the quantile to be estimated. A number strictly between 0 and 1.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>deriv</code></td>
<td>
<p>derivative order of the regression function for estimation, testing and plotting.
The default is <code>deriv=0</code>, which corresponds to the function itself.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>at</code></td>
<td>
<p>value of <code>w</code> at which the estimated function is evaluated.  The default is <code>at="mean"</code>, which corresponds to
the mean of <code>w</code>. Other options are: <code>at="median"</code> for the median of <code>w</code>, <code>at="zero"</code> for a vector of zeros.
<code>at</code> can also be a vector of the same length as the number of columns of <code>w</code> (if <code>w</code> is a matrix) or a data frame containing the same variables as specified in <code>w</code> (when
<code>data</code> is specified). Note that when <code>at="mean"</code> or <code>at="median"</code>, all factor variables (if specified) are excluded from the evaluation (set as zero).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nolink</code></td>
<td>
<p>if true, the function within the inverse link function is reported instead of the conditional mean function for the outcome.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testmodel</code></td>
<td>
<p>a vector or a logical value. It sets the degree of polynomial and the number of smoothness constraints for parametric model specification
testing. If <code>testmodel=c(p,s)</code> is specified, a piecewise polynomial of degree <code>p</code> with <code>s</code> smoothness constraints is used.
If <code>testmodel=T</code> or <code>testmodel=NULL</code> (default) is specified, <code>testmodel=c(1,1)</code> is used unless the degree <code>p</code> or the smoothness <code>s</code>
selection is requested via the option <code>pselect</code> or <code>sselect</code> (see more details in the explanation of <code>pselect</code> and <code>sselect</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testmodelparfit</code></td>
<td>
<p>a data frame or matrix which contains the evaluation grid and fitted values of the model(s) to be
tested against.  The column contains a series of evaluation points
at which the binscatter model and the parametric model of interest are compared with
each other.  Each parametric model is represented by other columns, which must
contain the fitted values at the corresponding evaluation points.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testmodelpoly</code></td>
<td>
<p>degree of a global polynomial model to be tested against.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testshape</code></td>
<td>
<p>a vector or a logical value. It sets the degree of polynomial and the number of smoothness constraints for nonparametric shape restriction
testing. If <code>testshape=c(p,s)</code> is specified, a piecewise polynomial of degree <code>p</code> with <code>s</code> smoothness constraints is used.
If <code>testshape=T</code> or <code>testshape=NULL</code> (default) is specified, <code>testshape=c(1,1)</code> is used unless the degree <code>p</code> or smoothness <code>s</code> selection
is requested via the option <code>pselect</code> or <code>sselect</code> (see more details in the explanation of <code>pselect</code> and <code>sselect</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testshapel</code></td>
<td>
<p>a vector of null boundary values for hypothesis testing. Each number <code>a</code> in the vector
corresponds to one boundary of a one-sided hypothesis test to the left of the form
<code>H0: sup_x mu(x)&lt;=a</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testshaper</code></td>
<td>
<p>a vector of null boundary values for hypothesis testing. Each number <code>a</code> in the vector
corresponds to one boundary of a one-sided hypothesis test to the right of the form
<code>H0: inf_x mu(x)&gt;=a</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testshape2</code></td>
<td>
<p>a vector of null boundary values for hypothesis testing. Each number <code>a</code> in the vector
corresponds to one boundary of a two-sided hypothesis test of the form
<code>H0: sup_x |mu(x)-a|=0</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>lp</code></td>
<td>
<p>an Lp metric used for parametric model specification testing and/or shape restriction testing. The default is <code>lp=Inf</code>, which
corresponds to the sup-norm of the t-statistic. Other options are <code>lp=q</code> for a positive number <code>q&gt;=1</code>. Note that
<code>lp=Inf</code> ("sup-norm") has to be used for testing one-sided shape restrictions.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>bins</code></td>
<td>
<p>a vector. If <code>bins=c(p,s)</code>, it sets the piecewise polynomial of degree <code>p</code> with <code>s</code> smoothness constraints
for data-driven (IMSE-optimal) selection of the partitioning/binning scheme.
The default is <code>bins=c(0,0)</code>, which corresponds to the piecewise constant.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbins</code></td>
<td>
<p>number of bins for partitioning/binning of <code>x</code>.  If <code>nbins=T</code> or <code>nbins=NULL</code> (default) is specified, the number
of bins is selected via the companion command <code>binsregselect</code> in a data-driven, optimal way whenever possible.
If a vector with more than one number is specified, the number of bins is selected within this vector via the companion command <code>binsregselect</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>pselect</code></td>
<td>
<p>vector of numbers within which the degree of polynomial <code>p</code> for point estimation is selected.
If the selected optimal degree is <code>p</code>, then piecewise polynomials of degree
<code>p+1</code> are used to conduct testing for nonparametric shape restrictions or parametric model specifications.
<em>Note:</em> To implement the degree or smoothness selection, in addition to <code>pselect</code> or <code>sselect</code>,
<code>nbins=#</code> must be specified.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>sselect</code></td>
<td>
<p>vector of numbers within which the number of smoothness constraints <code>s</code> for point estimation is selected.
If the selected optimal smoothness is <code>s</code>, then piecewise polynomials of <code>s+1</code> smoothness constraints
are used to conduct testing for nonparametric shape restrictions or parametric model specifications.
If not specified, for each value <code>p</code> supplied in the option <code>pselect</code>, only the piecewise polynomial
with the maximum smoothness is considered, i.e., <code>s=p</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>binspos</code></td>
<td>
<p>position of binning knots. The default is <code>binspos="qs"</code>, which corresponds to quantile-spaced
binning (canonical binscatter).  The other options are <code>"es"</code> for evenly-spaced binning, or
a vector for manual specification of the positions of inner knots (which must be within the range of
<code>x</code>).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>binsmethod</code></td>
<td>
<p>method for data-driven selection of the number of bins. The default is <code>binsmethod="dpi"</code>,
which corresponds to the IMSE-optimal direct plug-in rule.  The other option is: <code>"rot"</code>
for rule of thumb implementation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nbinsrot</code></td>
<td>
<p>initial number of bins value used to construct the DPI number of bins selector.
If not specified, the data-driven ROT selector is used instead.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>randcut</code></td>
<td>
<p>upper bound on a uniformly distributed variable used to draw a subsample for bins/degree/smoothness selection.
Observations for which <code>runif()&lt;=#</code> are used. # must be between 0 and 1. By default, <code>max(5000, 0.01n)</code> observations
are used if the samples size <code>n&gt;5000</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>nsims</code></td>
<td>
<p>number of random draws for hypothesis testing. The default is
<code>nsims=500</code>, which corresponds to 500 draws from a standard Gaussian random vector of size
<code>[(p+1)*J - (J-1)*s]</code>. Setting at least <code>nsims=2000</code> is recommended to obtain the final results.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>simsgrid</code></td>
<td>
<p>number of evaluation points of an evenly-spaced grid within each bin used for evaluation of
the supremum (infimum or Lp metric) operation needed to construct hypothesis testing
procedures. The default is <code>simsgrid=20</code>, which corresponds to 20 evenly-spaced
evaluation points within each bin for approximating the supremum (infimum or Lp metric) operator.
Setting at least <code>simsgrid=50</code> is recommended to obtain the final results.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>simsseed</code></td>
<td>
<p>seed for simulation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>vce</code></td>
<td>
<p>procedure to compute the variance-covariance matrix estimator. For least squares regression and generalized linear regression, the allowed options are the same as that for <code>binsreg</code> or <code>binsqreg</code>.
For quantile regression, the allowed options are the same as that for <code>binsqreg</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>cluster</code></td>
<td>
<p>cluster ID. Used for compute cluster-robust standard errors.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>asyvar</code></td>
<td>
<p>if true, the standard error of the nonparametric component is computed and the uncertainty related to control
variables is omitted. Default is <code>asyvar=FALSE</code>, that is, the uncertainty related to control variables is taken into account.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dfcheck</code></td>
<td>
<p>adjustments for minimum effective sample size checks, which take into account number of unique
values of <code>x</code> (i.e., number of mass points), number of clusters, and degrees of freedom of
the different stat models considered. The default is <code>dfcheck=c(20, 30)</code>.
See <a href="https://nppackages.github.io/references/Cattaneo-Crump-Farrell-Feng_2024_Stata.pdf">Cattaneo, Crump, Farrell and Feng (2024c)</a> for more details.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>masspoints</code></td>
<td>
<p>how mass points in <code>x</code> are handled. Available options:
</p>

<ul>
<li> <p><code>"on"</code> all mass point and degrees of freedom checks are implemented. Default.
</p>
</li>
<li> <p><code>"noadjust"</code> mass point checks and the corresponding effective sample size adjustments are omitted.
</p>
</li>
<li> <p><code>"nolocalcheck"</code> within-bin mass point and degrees of freedom checks are omitted.
</p>
</li>
<li> <p><code>"off"</code> "noadjust" and "nolocalcheck" are set simultaneously.
</p>
</li>
<li> <p><code>"veryfew"</code> forces the function to proceed as if <code>x</code> has only a few number of mass points (i.e., distinct values).
In other words, forces the function to proceed as if the mass point and degrees of freedom checks were failed.
</p>
</li>
</ul>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>weights</code></td>
<td>
<p>an optional vector of weights to be used in the fitting process. Should be <code>NULL</code> or
a numeric vector. For more details, see <code>lm</code>.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>subset</code></td>
<td>
<p>optional rule specifying a subset of observations to be used.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numdist</code></td>
<td>
<p>number of distinct values for selection. Used to speed up computation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>numclust</code></td>
<td>
<p>number of clusters for selection. Used to speed up computation.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>estmethodopt</code></td>
<td>
<p>a list of optional arguments used by <code>rq</code> (for quantile regression) or <code>glm</code> (for fitting generalized linear models).</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>...</code></td>
<td>
<p>optional arguments to control bootstrapping if <code>estmethod="qreg"</code> and <code>vce="boot"</code>. See <code>boot.rq</code>.</p>
</td>
</tr>
</table>
<h3>Value</h3>

<table>
<tr style="vertical-align: top;">
<td><code>testshapeL</code></td>
<td>
<p>Results for <code>testshapel</code>, including: <code>testvalL</code>, null boundary values;
<code>stat.shapeL</code>, test statistics; and <code>pval.shapeL</code>, p-value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testshapeR</code></td>
<td>
<p>Results for <code>testshaper</code>, including: <code>testvalR</code>, null boundary values;
<code>stat.shapeR</code>, test statistics; and <code>pval.shapeR</code>, p-value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testshape2</code></td>
<td>
<p>Results for <code>testshape2</code>, including: <code>testval2</code>, null boundary values;
<code>stat.shape2</code>, test statistics; and <code>pval.shape2</code>, p-value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testpoly</code></td>
<td>
<p>Results for <code>testmodelpoly</code>, including: <code>testpoly</code>, the degree of global polynomial;
<code>stat.poly</code>, test statistic; <code>pval.poly</code>, p-value.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>testmodel</code></td>
<td>
<p>Results for <code>testmodelparfit</code>, including: <code>stat.model</code>, test statistics;
<code>pval.model</code>, p-values.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>imse.var.rot</code></td>
<td>
<p>Variance constant in IMSE, ROT selection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>imse.bsq.rot</code></td>
<td>
<p>Bias constant in IMSE, ROT selection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>imse.var.dpi</code></td>
<td>
<p>Variance constant in IMSE, DPI selection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>imse.bsq.dpi</code></td>
<td>
<p>Bias constant in IMSE, DPI selection.</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>opt</code></td>
<td>
<p> A list containing options passed to the function, as well as total sample size <code>n</code>,
number of distinct values <code>Ndist</code> in <code>x</code>, number of clusters <code>Nclust</code>, and
number of bins <code>nbins</code>.</p>
</td>
</tr>
</table>
<h3>Author(s)</h3>

<p>Matias D. Cattaneo, Princeton University, Princeton, NJ. <a href="mailto:cattaneo@princeton.edu">cattaneo@princeton.edu</a>.
</p>
<p>Richard K. Crump, Federal Reserve Bank of New York, New York, NY. <a href="mailto:richard.crump@ny.frb.org">richard.crump@ny.frb.org</a>.
</p>
<p>Max H. Farrell, UC Santa Barbara, Santa Barbara, CA. <a href="mailto:mhfarrell@gmail.com">mhfarrell@gmail.com</a>.
</p>
<p>Yingjie Feng (maintainer), Tsinghua University, Beijing, China. <a href="mailto:fengyingjiepku@gmail.com">fengyingjiepku@gmail.com</a>.
</p>


<h3>References</h3>

<p>Cattaneo, M. D., R. K. Crump, M. H. Farrell, and Y. Feng. 2024a: <a href="https://nppackages.github.io/references/Cattaneo-Crump-Farrell-Feng_2024_AER.pdf">On Binscatter</a>. American Economic Review 114(5): 1488-1514.
</p>
<p>Cattaneo, M. D., R. K. Crump, M. H. Farrell, and Y. Feng. 2024b: <a href="https://nppackages.github.io/references/Cattaneo-Crump-Farrell-Feng_2024_NonlinearBinscatter.pdf">Nonlinear Binscatter Methods</a>. Working Paper.
</p>
<p>Cattaneo, M. D., R. K. Crump, M. H. Farrell, and Y. Feng. 2024c: <a href="https://nppackages.github.io/references/Cattaneo-Crump-Farrell-Feng_2024_Stata.pdf">Binscatter Regressions</a>. Working Paper.
</p>


<h3>See Also</h3>

<p><code>binsreg</code>, <code>binsqreg</code>, <code>binsglm</code>, <code>binsregselect</code>.
</p>


<h3>Examples</h3>

<pre><code class="language-R"> x &lt;- runif(500); y &lt;- sin(x)+rnorm(500)
 est &lt;- binstest(y,x, testmodelpoly=1)
 summary(est)
</code></pre>


</div>