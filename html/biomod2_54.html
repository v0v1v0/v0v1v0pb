<div class="container">

<table style="width: 100%;"><tr>
<td>BIOMOD_FormatingData</td>
<td style="text-align: right;">R Documentation</td>
</tr></table>
<h2>Format input data, and select pseudo-absences if wanted, for usage in <span class="pkg">biomod2</span>
</h2>

<h3>Description</h3>

<p>This function gathers together all input data needed (<em>xy, 
presences/absences, explanatory variables, and the same for evaluation data if available</em>) to 
run <span class="pkg">biomod2</span> models. It allows to select pseudo-absences if no absence data is available, 
with different strategies (see Details).
</p>


<h3>Usage</h3>

<pre><code class="language-R">BIOMOD_FormatingData(
  resp.name,
  resp.var,
  expl.var,
  dir.name = ".",
  resp.xy = NULL,
  eval.resp.var = NULL,
  eval.expl.var = NULL,
  eval.resp.xy = NULL,
  PA.nb.rep = 0,
  PA.nb.absences = 1000,
  PA.strategy = NULL,
  PA.dist.min = 0,
  PA.dist.max = NULL,
  PA.sre.quant = 0.025,
  PA.user.table = NULL,
  na.rm = TRUE,
  filter.raster = FALSE
)
</code></pre>


<h3>Arguments</h3>

<table>
<tr style="vertical-align: top;">
<td><code>resp.name</code></td>
<td>
<p>a <code>character</code> corresponding to the species name</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resp.var</code></td>
<td>
<p>a <code>vector</code>, a <code>SpatVector</code>
without associated data (<em>if presence-only</em>), 
or a <code>SpatVector</code> object containing binary data  
(<code>0</code> : absence, <code>1</code> : presence, <code>NA</code> : indeterminate) 
for a single species that will be used to build the species distribution model(s)
<br><em>Note that old format from <span class="pkg">sp</span> are still supported such as
<code>SpatialPoints</code>  (if presence-only) or <code>SpatialPointsDataFrame</code>
object containing binary data.</em></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>expl.var</code></td>
<td>
<p>a <code>matrix</code>, <code>data.frame</code>, <code>SpatVector</code>
or <code>SpatRaster</code> object containing the explanatory variables 
(in columns or layers) that will be used to build the species distribution model(s)
<br><em>Note that old format from <span class="pkg">raster</span> and <span class="pkg">sp</span> are still supported such as 
<code>RasterStack</code> and <code>SpatialPointsDataFrame</code> objects. </em></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>dir.name</code></td>
<td>
<p>(<em>optional, default</em> <code>.</code>) <br>
A <code>character</code> corresponding to the modeling folder</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>resp.xy</code></td>
<td>
<p>(<em>optional, default</em> <code>NULL</code>) <br> 
If <code>resp.var</code> is a <code>vector</code>, a 2-columns <code>matrix</code> or <code>data.frame</code> 
containing the corresponding <code>X</code> and <code>Y</code> coordinates that will be
used to build the species distribution model(s)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eval.resp.var</code></td>
<td>
<p>(<em>optional, default</em> <code>NULL</code>) <br> 
A <code>vector</code>, a <code>SpatVector</code>
without associated data (<em>if presence-only</em>), 
or a <code>SpatVector</code> object containing binary data  
(<code>0</code> : absence, <code>1</code> : presence, <code>NA</code> : indeterminate) 
for a single species that will be used to 
evaluate the species distribution model(s) with independent data
<br><em>Note that old format from <span class="pkg">sp</span> are still supported such as
<code>SpatialPoints</code>  (if presence-only) or <code>SpatialPointsDataFrame</code>
object containing binary data.</em></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eval.expl.var</code></td>
<td>
<p>(<em>optional, default</em> <code>NULL</code>) <br> 
A <code>matrix</code>, <code>data.frame</code>, <code>SpatVector</code>
or <code>SpatRaster</code> object containing the explanatory variables (in 
columns or layers) that will be used to evaluate the species distribution model(s) with 
independent data.
<br><em>Note that old format from <span class="pkg">raster</span> and <span class="pkg">sp</span> are still supported such as 
<code>RasterStack</code> and <code>SpatialPointsDataFrame</code> objects. </em></p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>eval.resp.xy</code></td>
<td>
<p>(<em>optional, default</em> <code>NULL</code>) <br> 
If <code>resp.var</code> is a <code>vector</code>, a 2-columns <code>matrix</code> or <code>data.frame</code> 
containing the corresponding <code>X</code> and <code>Y</code> coordinates that will be used to evaluate 
the species distribution model(s) with independent data</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PA.nb.rep</code></td>
<td>
<p>(<em>optional, default</em> <code>0</code>) <br> 
If pseudo-absence selection, an <code>integer</code> corresponding to the number of sets 
(repetitions) of pseudo-absence points that will be drawn</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PA.nb.absences</code></td>
<td>
<p>(<em>optional, default</em> <code>0</code>) <br> 
If pseudo-absence selection, and <code>PA.strategy = 'random'</code> or <code>PA.strategy = 'sre'</code> 
or <code>PA.strategy = 'disk'</code>, an <code>integer</code> corresponding to the number of pseudo-absence 
points that will be selected for each pseudo-absence repetition (true absences included). <br>
It can also be a <code>vector</code> of the same length as <code>PA.nb.rep</code> containing <code>integer</code> 
values corresponding to the different numbers of pseudo-absences to be selected</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PA.strategy</code></td>
<td>
<p>(<em>optional, default</em> <code>NULL</code>) <br> 
If pseudo-absence selection, a <code>character</code> defining the strategy that will be used to 
select the pseudo-absence points. Must be <code>random</code>, <code>sre</code>, <code>disk</code> or 
<code>user.defined</code> (see Details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PA.dist.min</code></td>
<td>
<p>(<em>optional, default</em> <code>0</code>) <br> 
If pseudo-absence selection and <code>PA.strategy = 'disk'</code>, a <code>numeric</code> defining the 
minimal distance to presence points used to make the <code>disk</code> pseudo-absence selection 
(in meters, see Details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PA.dist.max</code></td>
<td>
<p>(<em>optional, default</em> <code>0</code>) <br> 
If pseudo-absence selection and <code>PA.strategy = 'disk'</code>, a <code>numeric</code> defining the 
maximal distance to presence points used to make the <code>disk</code> pseudo-absence selection 
(in meters, see Details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PA.sre.quant</code></td>
<td>
<p>(<em>optional, default</em> <code>0</code>) <br> 
If pseudo-absence selection and <code>PA.strategy = 'sre'</code>, a <code>numeric</code> between <code>0</code> 
and <code>0.5</code> defining the half-quantile used to make the <code>sre</code> pseudo-absence selection 
(see Details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>PA.user.table</code></td>
<td>
<p>(<em>optional, default</em> <code>NULL</code>) <br> 
If pseudo-absence selection and <code>PA.strategy = 'user.defined'</code>, a <code>matrix</code> or 
<code>data.frame</code> with as many rows as <code>resp.var</code> values, as many columns as 
<code>PA.nb.rep</code>, and containing <code>TRUE</code> or <code>FALSE</code> values defining which points 
will be used to build the species distribution model(s) for each repetition (see Details)</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>na.rm</code></td>
<td>
<p>(<em>optional, default</em> <code>TRUE</code>) <br> 
A <code>logical</code> value defining whether points having one or several missing values for 
explanatory variables should be removed from the analysis or not</p>
</td>
</tr>
<tr style="vertical-align: top;">
<td><code>filter.raster</code></td>
<td>
<p>(<em>optional, default</em> <code>FALSE</code>) <br> 
If <code>expl.var</code> is of raster type, a <code>logical</code> value defining whether <code>resp.var</code> 
is to be filtered when several points occur in the same raster cell</p>
</td>
</tr>
</table>
<h3>Details</h3>

<p>This function gathers and formats all input data needed to run <span class="pkg">biomod2</span> models. It 
supports different kind of inputs (e.g. <code>matrix</code>,
<code>SpatVector</code>, <code>SpatRaster</code>)
and provides different methods to select pseudo-absences if needed. <br><br></p>
<p><b>Concerning explanatory variables and XY coordinates :</b> 
</p>

<ul>
<li>
<p> if <code>SpatRaster</code>, <code>RasterLayer</code> or <code>RasterStack</code>
provided for <code>expl.var</code> or <code>eval.expl.var</code>, <br><span class="pkg">biomod2</span> will extract 
the corresponding values from XY coordinates provided :
</p>

<ul>
<li>
<p> either through <code>resp.xy</code> or <code>eval.resp.xy</code> respectively
</p>
</li>
<li>
<p> or <code>resp.var</code> or <code>eval.resp.var</code>, if provided as 
<code>SpatVector</code> or <code>SpatialPointsDataFrame</code>
</p>
</li>
</ul>
<p><em>Be sure to give the objects containing XY coordinates in the same projection 
system than the raster objects !</em>
</p>
</li>
<li>
<p> if <code>data.frame</code> or <code>matrix</code> provided for <code>expl.var</code> or
<code>eval.expl.var</code>, <br><span class="pkg">biomod2</span> will simply merge it (<code>cbind</code>) 
with <code>resp.var</code> without considering XY coordinates. <br><em>Be sure to give explanatory and response values in the same row order !</em>
</p>
</li>
</ul>
<p><b>Concerning pseudo-absence selection (see <code>bm_PseudoAbsences</code>) :</b>
</p>

<ul>
<li>
<p> if both presence and absence data are available, and there is enough absences :
set <code>PA.nb.rep = 0</code> and no pseudo-absence will be selected.
</p>
</li>
<li>
<p> if no absence data is available, several pseudo-absence repetitions  
are recommended (to estimate the effect of pseudo-absence selection), as well as high 
number of pseudo-absence points. <br><em>Be sure not to select more pseudo-absence points than maximum number of pixels in 
the studied area !</em>
</p>
</li>
<li>
<p> it is possible now to create several pseudo-absence repetitions with different 
number of points, BUT with the same sampling strategy. <br><br><br><br></p>
</li>
</ul>
<dl>
<dt>Response variable</dt>
<dd>
<p><span class="pkg">biomod2</span> models single species at a time (no multi-species). Hence, <code>resp.var</code> 
must be a uni-dimensional object (either a <code>vector</code>, a one-column <code>matrix</code>, 
<code>data.frame</code>, a <code>SpatVector</code> (<em>without associated 
data - if presence-only</em>), a <code>SpatialPoints</code> (<em>if presence-only</em>), 
a <code>SpatialPointsDataFrame</code> or <code>SpatVector</code> object),
containing values among :
</p>

<ul>
<li> <p><code>1</code> : presences
</p>
</li>
<li> <p><code>0</code> : true absences (if any)
</p>
</li>
<li> <p><code>NA</code> : no information point (might be used to select pseudo-absences if any)
</p>
</li>
</ul>
<p>If no true absences are available, pseudo-absence selection must be done. <br>
If <code>resp.var</code> is a non-spatial object (<code>vector</code>, <code>matrix</code> or 
<code>data.frame</code>), XY coordinates must be provided through <code>resp.xy</code>. <br> 
If pseudo-absence points are to be selected, <code>NA</code> points must be provided in order to 
select pseudo-absences among them.
</p>
</dd>
<dt>Explanatory variables</dt>
<dd>
<p>Factorial variables are allowed, but might lead to some pseudo-absence strategy or models 
omissions (e.g. <code>sre</code>).
</p>
</dd>
<dt>Evaluation data</dt>
<dd>
<p>Although <span class="pkg">biomod2</span> provides tools to automatically divide dataset into calibration and 
validation parts through the modeling process (see <code>CV.[..]</code> parameters in 
<code>BIOMOD_Modeling</code> function ; or <code>bm_CrossValidation 
  function</code>), it is also possible (and strongly advised) to directly provide two independent 
datasets, one for calibration/validation and one for evaluation
</p>
</dd>
<dt>Pseudo-absence selection (see <code>bm_PseudoAbsences</code>)</dt>
<dd>
<p>If no true absences are available, pseudo-absences must be selected from the 
<em>background data</em>, meaning data there is no information whether the species of 
interest occurs or not. It corresponds either to the remaining pixels of the <code>expl.var</code> 
(if provided as a <code>SpatRaster</code> or <code>RasterSatck</code>)
or to the points identified as  <code>NA</code> in <code>resp.var</code> (if <code>expl.var</code>
provided as a <code>matrix</code> or <code>data.frame</code>). <br> 
Several methods are available to do this selection :
</p>

<dl>
<dt>random</dt>
<dd>
<p>all points of initial background are pseudo-absence candidates. 
<code>PA.nb.absences</code> are drawn randomly, for each <code>PA.nb.rep</code> requested.
</p>
</dd>
<dt>sre</dt>
<dd>
<p>pseudo-absences have to be selected in conditions (combination of explanatory 
variables) that differ in a defined proportion (<code>PA.sre.quant</code>) from those of 
presence points. A <em>Surface Range Envelop</em> model is first run over the species of 
interest (see <code>bm_SRE</code>), and pseudo-absences are selected outside this envelop. <br><em>This case is appropriate when all the species climatic niche has been sampled, 
otherwise it may lead to over-optimistic model evaluations and predictions !</em>
</p>
</dd>
<dt>disk</dt>
<dd>
<p>pseudo-absences are selected within circles around presence points defined by 
<code>PA.dist.min</code> and <code>PA.dist.max</code> distance values (in meters). It allows to select 
pseudo-absence points that are not too close to (avoid same niche and pseudo-replication) 
or too far (localized sampling strategy) from presences.
</p>
</dd>
<dt>user.defined</dt>
<dd>
<p>pseudo-absences are defined in advance and given as <code>data.frame</code> 
through the <code>PA.user.table</code> parameter.
</p>
</dd>
</dl>
</dd>
</dl>
<h3>Value</h3>

<p>A <code>BIOMOD.formated.data</code> object that can be used to build species distribution 
model(s) with the <code>BIOMOD_Modeling</code> function. <br><a href="https://biomodhub.github.io/biomod2/reference/BIOMOD.formated.data.html"><code>print/show</code></a>, 
<a href="https://biomodhub.github.io/biomod2/reference/plot.html"><code>plot</code></a> and 
<a href="https://biomodhub.github.io/biomod2/reference/summary.html"><code>summary</code></a> functions 
are available to have a summary of the created object.
</p>


<h3>Author(s)</h3>

<p>Damien Georges, Wilfried Thuiller
</p>


<h3>See Also</h3>

<p><code>bm_PseudoAbsences</code>, <code>BIOMOD_Modeling</code>
</p>
<p>Other Main functions: 
<code>BIOMOD_EnsembleForecasting()</code>,
<code>BIOMOD_EnsembleModeling()</code>,
<code>BIOMOD_LoadModels()</code>,
<code>BIOMOD_Modeling()</code>,
<code>BIOMOD_Projection()</code>,
<code>BIOMOD_RangeSize()</code>
</p>


<h3>Examples</h3>

<pre><code class="language-R">library(terra)

# Load species occurrences (6 species available)
data(DataSpecies)
head(DataSpecies)

# Select the name of the studied species
myRespName &lt;- 'GuloGulo'

# Get corresponding presence/absence data
myResp &lt;- as.numeric(DataSpecies[, myRespName])

# Get corresponding XY coordinates
myRespXY &lt;- DataSpecies[, c('X_WGS84', 'Y_WGS84')]

# Load environmental variables extracted from BIOCLIM (bio_3, bio_4, bio_7, bio_11 &amp; bio_12)
data(bioclim_current)
myExpl &lt;- terra::rast(bioclim_current)



# ---------------------------------------------------------------#
# Format Data with true absences
myBiomodData &lt;- BIOMOD_FormatingData(resp.var = myResp,
                                     expl.var = myExpl,
                                     resp.xy = myRespXY,
                                     resp.name = myRespName)
myBiomodData
summary(myBiomodData)
plot(myBiomodData)


# ---------------------------------------------------------------#
# # Transform true absences into potential pseudo-absences
# myResp.PA &lt;- ifelse(myResp == 1, 1, NA)
# 
# # Format Data with pseudo-absences : random method
# myBiomodData.r &lt;- BIOMOD_FormatingData(resp.var = myResp.PA,
#                                        expl.var = myExpl,
#                                        resp.xy = myRespXY,
#                                        resp.name = myRespName,
#                                        PA.nb.rep = 4,
#                                        PA.nb.absences = 1000,
#                                        PA.strategy = 'random')
# 
# # Format Data with pseudo-absences : disk method
# myBiomodData.d &lt;- BIOMOD_FormatingData(resp.var = myResp.PA,
#                                        expl.var = myExpl,
#                                        resp.xy = myRespXY,
#                                        resp.name = myRespName,
#                                        PA.nb.rep = 4,
#                                        PA.nb.absences = 500,
#                                        PA.strategy = 'disk',
#                                        PA.dist.min = 5,
#                                        PA.dist.max = 35)
# 
# # Format Data with pseudo-absences : SRE method
# myBiomodData.s &lt;- BIOMOD_FormatingData(resp.var = myResp.PA,
#                                        expl.var = myExpl,
#                                        resp.xy = myRespXY,
#                                        resp.name = myRespName,
#                                        PA.nb.rep = 4,
#                                        PA.nb.absences = 1000,
#                                        PA.strategy = 'sre',
#                                        PA.sre.quant = 0.025)
# 
# # Format Data with pseudo-absences : user.defined method
# myPAtable &lt;- data.frame(PA1 = ifelse(myResp == 1, TRUE, FALSE),
#                         PA2 = ifelse(myResp == 1, TRUE, FALSE))
# for (i in 1:ncol(myPAtable)) myPAtable[sample(which(myPAtable[, i] == FALSE), 500), i] = TRUE
# myBiomodData.u &lt;- BIOMOD_FormatingData(resp.var = myResp.PA,
#                                        expl.var = myExpl,
#                                        resp.xy = myRespXY,
#                                        resp.name = myRespName,
#                                        PA.strategy = 'user.defined',
#                                        PA.user.table = myPAtable)
# 
# myBiomodData.r
# myBiomodData.d
# myBiomodData.s
# myBiomodData.u
# plot(myBiomodData.r)
# plot(myBiomodData.d)
# plot(myBiomodData.s)
# plot(myBiomodData.u)


# ---------------------------------------------------------------#
# # Select multiple sets of pseudo-absences
#
# # Transform true absences into potential pseudo-absences
# myResp.PA &lt;- ifelse(myResp == 1, 1, NA)
# 
# # Format Data with pseudo-absences : random method
# myBiomodData.multi &lt;- BIOMOD_FormatingData(resp.var = myResp.PA,
#                                            expl.var = myExpl,
#                                            resp.xy = myRespXY,
#                                            resp.name = myRespName,
#                                            PA.nb.rep = 4,
#                                            PA.nb.absences = c(1000, 500, 500, 200),
#                                            PA.strategy = 'random')
# myBiomodData.multi
# summary(myBiomodData.multi)
# plot(myBiomodData.multi)


</code></pre>


</div>